import{r as g,q as w,ik as b,w as I,S as P,a8 as R,F as O,ef as x}from"./index-c2b82012.js";var D;let h=D=class extends P{constructor(e){super(e),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new D({variableName:this.variableName,dimensionName:this.dimensionName,values:R(this.values),isSlice:this.isSlice})}};g([w({type:String,json:{write:!0}})],h.prototype,"variableName",void 0),g([w({type:String,json:{write:!0}})],h.prototype,"dimensionName",void 0),g([w({type:b.array(b.oneOf([b.native(Number),b.array(b.native(Number))])),json:{write:!0}})],h.prototype,"values",void 0),g([w({type:Boolean,json:{write:!0}})],h.prototype,"isSlice",void 0),h=D=g([I("esri.layers.support.DimensionalDefinition")],h);const N=h;function U(e,n,t){var a;const r=n.shift();if(t.length===0){const s=[];t.push({sliceId:-1,multidimensionalDefinition:s})}const i=t.length;for(let s=0;s<i;s++){const m=t.shift().multidimensionalDefinition;(a=r.values)==null||a.forEach(l=>{t.push({sliceId:-1,multidimensionalDefinition:[...m,{variableName:e,dimensionName:r.name,values:[l]}]})})}n.length&&U(e,n,t)}function W(e,n){const t=[];let r=0;return(n?e.variables.filter(i=>i.name.toLowerCase()===n.toLowerCase()):[...e.variables].sort((i,a)=>i.name>a.name?1:-1)).forEach(i=>{const a=[],s=[...i.dimensions].sort((m,l)=>m.name>l.name?-1:1);U(i.name,s,a),a.forEach(m=>{t.push({...m,sliceId:r++})})}),t}function G(e,n,t){let r=e;if(n&&(n=[...n].sort((i,a)=>i.dimensionName<a.dimensionName?-1:1)).forEach(({dimensionName:i,values:a,isSlice:s})=>{a.length&&(r=r.filter(m=>{const l=m.multidimensionalDefinition.find(o=>o.dimensionName===i);if(l==null)return!1;const u=l.values[0];return typeof u=="number"?typeof a[0]=="number"?a.includes(u):a.some(o=>o[0]<=u&&o[1]>=u):typeof a[0]=="number"?a.some(o=>u[0]<=o&&u[1]>=o):s?a.some(o=>o[0]===u[0]&&o[0]===u[1]):a.some(o=>o[0]>=u[0]&&o[0]<=u[1]||o[1]>=u[0]&&o[1]<=u[1]||o[0]<u[0]&&o[1]>u[1])}))}),r.length&&(t==null?void 0:t.start)!=null&&t.end!=null){const i=t.start.getTime(),a=t.end.getTime(),s=r[0].multidimensionalDefinition.findIndex(m=>m.dimensionName==="StdTime");s>-1&&(r=r.filter(m=>{const l=m.multidimensionalDefinition[s].values[0];return i<=l&&a>=l}))}return r.map(i=>i.sliceId)}function k(e,n){return Array.isArray(e)?n[0]===n[1]?e[0]===n[0]||e[1]===n[0]:e[0]>=n[0]&&e[0]<=n[1]&&e[1]>=n[0]&&e[1]<=n[1]:e>=n[0]&&e<=n[1]}function E(e,n){return e[0]<=n[0]&&e[1]>=n[0]||e[0]<=n[1]&&e[1]>=n[1]||e[0]>=n[0]&&e[1]<=n[1]}function F(e){return e.length===1?[e[0],e[0]]:[e[0],e[e.length-1]]}function V(e,n,t){var s,m;if(!((s=n==null?void 0:n.subsetDefinitions)!=null&&s.length))return e;let r;if(t){const{variables:l}=n;if(l.length&&!l.includes(t))return null;const u=n.subsetDefinitions.find(o=>o.dimensionName===e.name&&o.variableName===t);if(!((m=u==null?void 0:u.values)!=null&&m.length))return e;r=F(u.values)}else{const l=n.dimensions.find(({name:u})=>u===e.name);r=l==null?void 0:l.extent}const i=r;if(!(i!=null&&i.length))return e;const a=e.values.filter(l=>k(l,i));return{...e,extent:[...i],values:a}}function Y(e,n,t){var i;if(!((i=n==null?void 0:n.subsetDefinitions)!=null&&i.length))return!1;const{variables:r}=n;if(r.length&&e.some(({variableName:a})=>a&&!r.includes(a)))return!0;for(let a=0;a<e.length;a++){const s=e[a],m=n.subsetDefinitions.find(l=>(s.variableName===""||l.variableName===s.variableName)&&l.dimensionName===s.dimensionName);if(m!=null&&m.values.length){const l=F(m.values);if(!s.isSlice&&s.values.length===2&&!Array.isArray(s.values[0])&&s.values[0]!==s.values[1]&&t){if(!E(s.values,l))return!0}else if(s.values.some(u=>!k(u,l)))return!0}}return!1}function H(e,n){if(e==null)return{isOutside:!1};const{geometry:t,timeExtent:r,multidimensionalDefinition:i}=n;let a=null;if(r!=null&&(a=L(e,r),a==null))return{isOutside:!0};const{areaOfInterest:s}=e;if(s&&t){const m=t.type==="point"?t:t.type==="extent"?t.center:t.type==="polygon"?t.centroid:null;if(m&&!s.contains(m))return{isOutside:!0}}return i!=null&&i.length&&Y(i,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:t,timeExtent:a,multidimensionalDefinition:i}}}function L(e,n){const t=e.dimensions.find(({name:s})=>s==="StdTime");if(t==null||n.start==null&&n.end==null)return n;n=n.clone();const{start:r,end:i}=n.toJSON(),a=r===i?[r]:r!=null&&i!=null?[r,i]:[r??i];return a.length===2&&(t!=null&&t.extent.length)&&(a[0]=Math.max(a[0],t.extent[0]),a[1]=Math.min(a[1],t.extent[1]??t.extent[0]),a[1]<a[0])||Y([new N({variableName:"",dimensionName:"StdTime",isSlice:a.length===1,values:a})],e,!0)?null:(n.start=new Date(a[0]),n.end=new Date(a[1]??a[0]),n)}function j(e,n={}){var o,c;const{multidimensionalInfo:t,keyProperties:r}=e;if(t==null)return null;const{variableName:i,multidimensionalSubset:a,multidimensionalDefinition:s}=n,m=s!=null?(o=s[0])==null?void 0:o.variableName:null,l=i||m||(r==null?void 0:r.DefaultVariable);let{variables:u}=t;return(c=a==null?void 0:a.variables)!=null&&c.length&&(u=u.filter(({name:f})=>a.variables.includes(f))),l?u.find(({name:f})=>f===l)??u[0]:u[0]}function K(e,n={}){const t=j(e,n);if(!t)return null;const r=[],{dimensions:i,name:a}=t;if(i.length===0)return[new N({variableName:a,dimensionName:"",values:[],isSlice:!0})];for(let s=0;s<i.length;s++){const m=V(i[s],n.multidimensionalSubset,a);if(!m)return null;const{values:l,extent:u}=m;let o=(l==null?void 0:l[0])??(u==null?void 0:u[0]);m.name.toLowerCase()==="stdz"&&!m.hasRanges&&u&&Math.abs(u[1])<=Math.abs(u[0])&&(o=l!=null&&l.length?l[l.length-1]:u[1]),r.push(new N({variableName:a,dimensionName:m.name,values:[o],isSlice:!n.useRangeForRangedDimensionInfo||!!m.hasRanges}))}return r}function Q(e){return!!(e!=null&&e.length)&&e.some(n=>{if(n.values==null)return!0;const t=n.values.length;return t===0||t>1||!n.isSlice&&Array.isArray(n.values[0])})}function X(e,n){var r;if(n==null||e==null)return null;let t=n.variables.map(i=>({...i}));return(r=e==null?void 0:e.variables)!=null&&r.length&&(t=t.filter(({name:i})=>e.variables.includes(i)),t.forEach(i=>{i.dimensions=i.dimensions.map(a=>V(a,e,i.name)).filter(O)})),t}function B(e,n){var m;const{values:t}=n;if(t!=null&&t.length){const l=Array.isArray(t[0]),u=Array.isArray(e);return l!==u?-1:l&&u?t.findIndex(o=>o[0]===e[0]&&o[1]===e[1]):t.indexOf(e)}const{extent:r}=n;if(Array.isArray(e)||!r||e<r[0]||e>r[1])return-1;const i=n.interval||1;if(n.unit!=="ISO8601")return Math.round((e-r[0])/i);const a=r[0];let s=-1;switch(((m=n.intervalUnit)==null?void 0:m.toLowerCase())||"days"){case"seconds":s=Math.round((e-a)/1e3/i);break;case"minutes":s=Math.round((e-a)/6e4/i);break;case"hours":s=Math.round((e-a)/36e5/i);break;case"days":s=Math.round((e-a)/864e5/i);break;case"months":{const l=new Date(e).getUTCFullYear()-new Date(a).getUTCFullYear(),u=new Date(a).getUTCMonth(),o=new Date(e).getUTCMonth();s=l===0?o-u:o+11-u+12*(l-1)}break;case"years":s=Math.round((new Date(e).getUTCFullYear()-new Date(a).getUTCFullYear())/i);break;case"decades":s=Math.round((new Date(e).getUTCFullYear()-new Date(a).getUTCFullYear())/10/i)}return s}function C(e){var s,m;let n=(s=e.values)==null?void 0:s.length;if(n)return n;const{extent:t,unit:r}=e,i=e.interval||1,a=t?t[1]-t[0]:0;if(r!=="ISO8601")return Math.round(a/i);switch(((m=e.intervalUnit)==null?void 0:m.toLowerCase())??"seconds"){case"seconds":n=Math.round(a/1e3/i);break;case"minutes":n=Math.round(a/6e4/i);break;case"hours":n=Math.round(a/36e5/i);break;case"days":n=Math.round(a/864e5/i);break;case"months":if(t){const l=new Date(t[1]).getUTCFullYear()-new Date(t[0]).getUTCFullYear(),u=new Date(t[0]).getUTCMonth(),o=new Date(t[1]).getUTCMonth();n=l===0?o-u+1:o+11-u+12*(l-1)+1}else n=0;break;case"years":n=t?Math.round((new Date(t[1]).getUTCFullYear()-new Date(t[0]).getUTCFullYear())/i):0;break;case"decades":n=t?Math.round((new Date(t[1]).getUTCFullYear()-new Date(t[0]).getUTCFullYear())/10/i):0;break;default:n=0}return n}function _(e){var a,s;if(((a=e.extent)==null?void 0:a.length)!==2||!e.interval)return[];const{extent:[n,t],interval:r}=e;if(e.unit==="ISO8601"){const m=((s=e.intervalUnit)==null?void 0:s.toLowerCase())??"days";return["decades","years","months","days","hours","minutes","seconds"].includes(m)?Z(n,t,r,m):[]}const i=Math.round((t-n)/r);return Array.from({length:i},(m,l)=>l===i-1?t:n+l*r)}function Z(e,n,t,r){const i=[];let a=e;const s=new Date(e);for(;a<=n;)switch(i.push(a),r){case"decades":s.setUTCFullYear(s.getUTCFullYear()+10*t),a=s.getTime();break;case"years":s.setUTCFullYear(s.getUTCFullYear()+t),a=s.getTime();break;case"months":s.setUTCMonth(s.getUTCMonth()+t),a=s.getTime();break;case"days":a+=864e5*t;break;case"hours":a+=36e5*t;break;case"minutes":a+=6e4*t;break;case"seconds":a+=1e3*t}return i.length===1?i[1]=n:i[i.length-1]=n,i}function ee(e,n){let t=0;const r=e[0].variableName,i=[...n.variables].sort((a,s)=>a.name>s.name?1:-1);for(let a=0;a<i.length;a++){const s=i[a],m=[...s.dimensions].sort((o,c)=>o.name>c.name?-1:1);if(s.name!==r){t+=m.map(o=>C(o)).reduce((o,c)=>o*c);continue}const l=m.map(o=>C(o)),u=m.length;for(let o=0;o<u;o++){const c=e.find($=>$.dimensionName===m[o].name);if(c==null)return null;const f=B(c.values[0],m[o]);if(f===-1)return null;l.shift(),t+=o===u-1?f:f*l.reduce(($,A)=>$*A)}break}return t}const q="Raster.",v="Raster.Dim.",S=".Max",d={servicePixelValue:"Raster.ServicePixelValue",rawServicePixelValue:"Raster.ServicePixelValue.Raw",itemPixelValue:"Raster.ItemPixelValue",magnitude:"Raster.Magnitude",direction:"Raster.Direction",variable:"Raster.Variable"};function y(e,n){return new x({name:e,alias:n,domain:null,editable:!1,length:50,type:"string"})}function T(e,n){return new x({name:e,alias:n,domain:null,editable:!1,type:"double"})}function z(e,n){return new x({name:e,alias:n,domain:null,editable:!1,type:"date"})}function ne(e){return y(d.servicePixelValue,e??"Service Pixel Value")}function te(e){return y(d.rawServicePixelValue,e??"Raw Service Pixel Value")}function ae(){return y(d.itemPixelValue,"Item Pixel Value")}function ie(e){return y(`${d.servicePixelValue}.${e}`,e)}function se(e){return T(`${d.magnitude}`,"Magnitude"+(e?` (${e})`:""))}function re(){return T(`${d.direction}`,"Direction (°)")}function le(e){return e.fields.filter(n=>n.type!=="oid"&&n.name.toLowerCase()!=="value").map(n=>{const t=n.clone();return t.name=`${q}${n.name}`,t})}function ue(e){const n=new Set,t=new Set;return e.variables.forEach(({dimensions:r})=>{r.forEach(i=>{var s;const a=((s=i.unit)==null?void 0:s.trim())!=="ISO8601"||i.recurring?t:n;a.add(i.name),i.hasRanges&&a.add(`${i.name}${S}`)})}),[y(d.variable,"Variable"),...[...n].map(r=>z(`${v}${r}`,M(r))),...[...t].map(r=>T(`${v}${r}`,M(r)))]}function M(e){const n=e.endsWith(S),t=n?e.slice(0,-4):e,r=t==="StdTime"?"Standard Time":t==="StdZ"?"Standard Z":t;return n?`${r} Max`:r}function p(e,n){return n?new Date(e):e}function oe(e,n,t){t!=null&&t.length&&(n[d.variable]=t[0].variableName,t.forEach(({dimensionName:r,values:i})=>{if(r&&(i!=null&&i.length)){const a=`${v}${r}`,s=e.find(({name:u})=>u===a);if(!s)return;const m=s.type==="date",l=i[0];if(Array.isArray(l)){if(n[`${v}${r}`]=p(l[0],m),l[1]!=null){const u=`${v}${r}${S}`;if(e.some(({name:o})=>o===u)){const o=p(l[1],m);n[u]=o}}}else n[`${v}${r}`]=p(l,m)}}))}export{le as $,_ as D,oe as P,W as a,ne as b,te as c,K as d,se as e,j as f,X as g,Q as h,G as i,re as j,H as k,v as l,ie as m,q as n,Y as o,N as p,ae as s,d as t,ue as v,ee as w};
