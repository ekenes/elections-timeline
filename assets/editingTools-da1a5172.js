import{am as Qe,bt as li,aG as ue,r as a,q as h,w as x,gA as _i,S as Pr,a0 as H,ej as pe,gI as kr,Y as C,P as pi,y as Dn,C as de,rm as j,rn as Ll,ai as It,bU as q,ro as di,kG as Gn,oo as Dl,op as Gl,eN as Ne,eL as zl,gT as L,aF as g,d1 as it,ah as is,fG as Cr,fP as Eo,hm as Ul,hl as Hl,rp as Nl,cH as So,s as zn,cI as Fl,rq as Fe,bF as De,bB as fn,kH as Zl,hq as Bl,fD as ql,fF as Yl,hp as Wl,rr as jl,iE as Xl,pu as Mo,rs as Kl,rt as Ql,er as Un,e4 as fe,aB as Z,e3 as Tt,aE as le,aC as Ot,hh as Po,F as Pi,cj as Rr,ru as Vr,a8 as ns,i as Ze,nt as Jl,d_ as Us,iM as Se,rv as tc,br as vi,lN as Hs,ei as N,rw as jt,rx as Be,ry as ye,ap as bi,eV as dt,hi as G,me as ec,e2 as _e,mM as ge,e7 as lt,iy as ss,mL as Ar,rz as ic,gN as qt,cU as nc,iN as sc,e5 as Or,ar as oc,au as rc,rA as qe,iD as Ir,ki as ac,rB as sn,gd as Ns,qm as ko,bC as lc,rC as Dt,rD as Lr,jJ as Dr,rE as Fs,rF as cc,rG as hc,e6 as pt,eA as Gr,rH as gn,rI as gt,rJ as Zs,rK as zr,et as uc,g6 as Ur,fJ as Hr,kL as ki,kN as v,V as pc,rL as dc,rM as fc,rN as gc,rO as te,rP as mc,rQ as yc,rR as _c,rS as vc,rT as bc,rU as xc,rV as wc,rW as $c,rX as Tc,rY as Ec,rZ as Sc,r_ as Kt,oh as Ci,kK as os,gU as fi,r$ as wt,s0 as Mc,kM as Bs,_ as Et,kA as Co,a1 as Pc,s1 as kc,g7 as Cc,s2 as Nr,s3 as Rc,s4 as Vc,s5 as Ac,s6 as Oc,s7 as Ro,cv as U,dw as ke,hx as Pe,s8 as Ic,cC as ft,cw as rs,s9 as Lc,cB as Dc,f8 as qs,sa as Vo,gV as Ys,h2 as as,sb as Ye,b7 as Gc,sc as Qt,sd as Ws,se as mn,ao as js,sf as zc,h6 as Uc,an as Hc,g_ as Nc,sg as Fc,q4 as Zc,sh as Bc,si as we,ab as qc,dR as Yc,sj as Ao,sk as Fr,sl as Wc,o8 as jc,sm as Xc,gg as Kc,iK as Hn,av as Qc,qz as Jc,aq as th,aA as eh,bK as Zr,iG as xi,hd as ih,el as Oo,mf as Xs,bG as nh,ge as Br,mK as sh,sn as on,so as oh,cF as We,cn as qr,sp as Yr,im as ls,lK as Wr,gJ as cs,fH as jr,sq as rh,jI as ah,nS as lh,dt as Ge,db as ch,sr as hh,ss as Io,cG as uh,o2 as ph,jl as Lo,ee as Xr,eS as Kr,st as dh,su as fh,mg as Nn,mh as Do,sv as Go,iv as zo,gS as Qr,ek as wi,eO as gh,sw as Uo,sx as mh,sy as yh}from"./index-c2b82012.js";import{e as Ks,a as _h,n as bt}from"./projectVectorToVector-50e881cf.js";import{m as vh,x as bh,j as yn,a as xh,b as wh,E as Jr,p as Ho,u as $h,l as Th}from"./elevationInfoUtils-38a6b617.js";import{h as Qs}from"./GraphicsLayer-a0d687bf.js";import{j as $i,q as _n,b as vn,N as rn,y as ta,v as Eh,R as Sh}from"./geodesicUtils-ddd17d18.js";import{simplify as Mh,distance as Ph,geodesicArea as kh,geodesicLength as ea}from"./geometryEngine-6ac27f5e.js";import{R as Ch,L as Rh}from"./quat-7efbb1da.js";import{e as No}from"./quatf64-216ddd5a.js";import{M as ct,z as ia,l as Ri,Q as hs,d as na,k as Js,V as Ve,H as to,O as ze,p as sa,D as Vh,J as Ah,b as Oh,f as Fo,h as Fn,t as ii}from"./plane-4d383c93.js";import{I as Ih,O as Lh,_ as Dh,$ as Gh,U as zh}from"./sphere-3b34619e.js";import"./MeshTransform-7d6e6d2a.js";import{a as Uh}from"./meshVertexSpaceUtils-9f59c7fe.js";import{e as Hh}from"./earcut-5a6c70eb.js";import{v as Nh}from"./triangle-0ea1f80d.js";import{w as Fh,a as Zh}from"./spatialReferenceEllipsoidUtils-b06cb7a2.js";import"./MeshLocalVertexSpace-da2d5a3a.js";import{c as Bh}from"./projectPointToVector-7df6f554.js";import{i as qh}from"./drapedUtils-54abbb48.js";import{W as Ti,K as bn,Z as Qi}from"./boundedPlane-e9e703c5.js";import"./geometryEngineBase-58446043.js";import"./_commonjsHelpers-2f3e7994.js";import"./hydrated-353ef6c6.js";import"./mat3f64-e19cdcb8.js";import"./mat4f64-9a8384aa.js";import"./lineSegment-fc392a78.js";function gi(i,t){return i===t||i!=null&&t!=null&&Qe(i.spatialReference,t.spatialReference)&&i.x===t.x&&i.y===t.y&&i.z===t.z&&i.m===t.m}function Zn(i,t,e){return i===t||i!=null&&t!=null&&Qe(i.spatialReference,t.spatialReference)&&li(i.x,t.x,e)&&li(i.y,t.y,e)&&li(i.z??0,t.z??0,e)&&li(i.m??0,t.m??0,e)}function Zo(i){return"declaredClass"in i}function oa(i,t){if(!i)return null;let e;if(Zo(i)){if(t==null)return i.clone();if(Zo(t))return t.copy(i)}return t!=null?(e=t,e.x=i.x,e.y=i.y,e.spatialReference=i.spatialReference,i.hasZ?(e.z=i.z,e.hasZ=i.hasZ):(e.z=void 0,e.hasZ=!1),i.hasM?(e.m=i.m,e.hasM=!0):(e.m=void 0,e.hasM=!1)):(e=Ks(i.x,i.y,i.z,i.spatialReference),i.hasM&&(e.m=i.m,e.hasM=!0)),e}var Bo;function ra(i,t,e){return X(i,t,e)}function X(i=0,t=0,e=0){return ue(i,t,e)}function ve(i,t,e){return ue(i,t,e)}function je(i){const[t,e,n]=i;return i.length>3?[t,e,n,i[3]]:[t,e,n]}function eo(i,t,e,n=X()){return n[0]=i.x,n[1]=i.y,n[2]=i.z??0,t==null||(t.type==="2d"?n[2]=0:n[2]=vh(t,i,e,yn)??0),n}function Yh(i,t,{z:e,m:n},s,o){const{spatialReference:r,elevationInfo:l}=s;let c;e==null&&n==null?c=void 0:t==null||t.type==="2d"?c=e??void 0:c=bh(t,i,r,yn,l)??0;const[u,p]=i;return o?_h(o,u,p,c,r):o=Ks(u,p,c,r),n!=null&&(o.m=n,o.hasM=!0),o}(function(i){i[i.NONE=0]="NONE",i[i.TARGET=1]="TARGET"})(Bo||(Bo={}));let St=class extends Pr{constructor(){super(...arguments),this.enabled=!0}};a([h({type:Boolean})],St.prototype,"enabled",void 0),St=a([x("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],St);let V=class extends Pr{constructor(t){super(t),this.lineSnapper=new St,this.parallelLineSnapper=new St,this.rightAngleSnapper=new St,this.rightAngleTriangleSnapper=new St,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new _i([255,127,0]),this.orangeTransparent=new _i([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};a([h({type:St,constructOnly:!0,nonNullable:!0,json:{write:!0}})],V.prototype,"lineSnapper",void 0),a([h({type:St,constructOnly:!0,nonNullable:!0,json:{write:!0}})],V.prototype,"parallelLineSnapper",void 0),a([h({type:St,constructOnly:!0,nonNullable:!0,json:{write:!0}})],V.prototype,"rightAngleSnapper",void 0),a([h({type:St,constructOnly:!0,nonNullable:!0,json:{write:!0}})],V.prototype,"rightAngleTriangleSnapper",void 0),a([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],V.prototype,"shortLineThreshold",void 0),a([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],V.prototype,"distance",void 0),a([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],V.prototype,"pointThreshold",void 0),a([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],V.prototype,"intersectionParallelLineThreshold",void 0),a([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],V.prototype,"parallelLineThreshold",void 0),a([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],V.prototype,"verticalLineThresholdMeters",void 0),a([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],V.prototype,"touchSensitivityMultiplier",void 0),a([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],V.prototype,"pointOnLineThreshold",void 0),a([h({type:_i,nonNullable:!0})],V.prototype,"orange",void 0),a([h({type:_i,nonNullable:!0})],V.prototype,"orangeTransparent",void 0),a([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],V.prototype,"lineHintWidthReference",void 0),a([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],V.prototype,"lineHintWidthTarget",void 0),a([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],V.prototype,"lineHintFadedExtensions",void 0),a([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],V.prototype,"parallelLineHintWidth",void 0),a([h({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],V.prototype,"parallelLineHintLength",void 0),a([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],V.prototype,"parallelLineHintOffset",void 0),a([h({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],V.prototype,"rightAngleHintSize",void 0),a([h({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],V.prototype,"rightAngleHintOutlineSize",void 0),a([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],V.prototype,"satisfiesConstraintScreenThreshold",void 0),V=a([x("esri.views.interactive.snapping.Settings.Defaults")],V);const Bn=new V;var Xe;(function(i){i[i.FEATURE=1]="FEATURE",i[i.SELF=2]="SELF",i[i.ALL=3]="ALL"})(Xe||(Xe={}));let Vi=class{constructor(t,e){this.isDraped=t,this.domain=e}},Wh=class aa extends Vi{constructor(t,e,n=Xe.ALL){super(e,n),this.intersectionPoint=t}equals(t){return t instanceof aa&&H(this.intersectionPoint,t.intersectionPoint)}},jh=class la extends Vi{constructor(t,e,n,s,o=Xe.ALL,r=!0,l=!0){super(s,o),this.type=t,this.lineStart=e,this.lineEnd=n,this.fadeLeft=r,this.fadeRight=l}equals(t){return t instanceof la&&this.type===t.type&&H(this.lineStart,t.lineStart)&&H(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight}get length(){return pe(this.lineStart,this.lineEnd)}},Xh=class ca extends Vi{constructor(t,e,n,s=Xe.ALL){super(n,s),this.lineStart=t,this.lineEnd=e}equals(t){return t instanceof ca&&H(this.lineStart,t.lineStart)&&H(this.lineEnd,t.lineEnd)}},Kh=class ha extends Vi{constructor(t,e,n){super(e,n),this.point=t}equals(t){return t instanceof ha&&H(this.point,t.point)}},Qh=class ua extends Vi{constructor(t,e,n,s,o=Xe.ALL){super(s,o),this.previousVertex=t,this.centerVertex=e,this.nextVertex=n}equals(t){return t instanceof ua&&H(this.previousVertex,t.previousVertex)&&H(this.centerVertex,t.centerVertex)&&H(this.nextVertex,t.nextVertex)}},Jh=class{draw(t,e){const n=tu(t),s=this.sortUniqueHints(n),o=[];for(const r of s)r instanceof Wh&&o.push(this.visualizeIntersectionPoint(r,e)),r instanceof jh&&o.push(this.visualizeLine(r,e)),r instanceof Xh&&o.push(this.visualizeParallelSign(r,e)),r instanceof Qh&&o.push(this.visualizeRightAngleQuad(r,e)),r instanceof Kh&&o.push(this.visualizePoint(r,e));return kr(o)}sortUniqueHints(t){return t}};function tu(i){const t=[];for(const e of i){let n=!0;for(const s of t)if(e.equals(s)){n=!1;break}n&&t.push(e)}return t}let eu=class extends Jh{constructor(t){super(),this._graphicsLayer=t,this._symbolPairingsByType=new Map}visualizeIntersectionPoint(t,e){return this._visualizeSnappingIndicator(new C({x:t.intersectionPoint[0],y:t.intersectionPoint[1],spatialReference:e.spatialReference}),this._getOrCreateSymbol("intersectionPoint",e.view.effectiveTheme.accentColor))}visualizePoint(t,e){return this._visualizeSnappingIndicator(new C({x:t.point[0],y:t.point[1],spatialReference:e.spatialReference}),this._getOrCreateSymbol("point",e.view.effectiveTheme.accentColor))}visualizeLine(t,e){return this._visualizeSnappingIndicator(new pi({paths:[[[...t.lineStart],[...t.lineEnd]]],spatialReference:Dn(de,e.spatialReference)}),this._getOrCreateSymbol("line",e.view.effectiveTheme.accentColor))}visualizeParallelSign(t,e){return this._visualizeSnappingIndicator(new pi({paths:[[[...t.lineStart],[...t.lineEnd]]],spatialReference:Dn(de,e.spatialReference)}),this._getOrCreateSymbol("parallelSign",e.view.effectiveTheme.accentColor))}visualizeRightAngleQuad(t,e){const n=L(),s=L(),o=g();j(n,t.centerVertex,t.previousVertex),j(s,t.nextVertex,t.previousVertex),Ll(o,n,s);const r=`rightAngleQuad${o[2]<0?45:225}`;return this._visualizeSnappingIndicator(new pi({paths:[[[...t.previousVertex],[...t.centerVertex],[...t.nextVertex]]],spatialReference:Dn(de,e.spatialReference)}),this._getOrCreateSymbol(r,e.view.effectiveTheme.accentColor))}_visualizeSnappingIndicator(t,e){const n=new It({geometry:t,symbol:e});return this._graphicsLayer.add(n),q(()=>{this._graphicsLayer.remove(n)})}_getOrCreateSymbol(t,e){var s;const n=this._symbolPairingsByType;return((s=n.get(t))==null?void 0:s.color)!==e&&n.set(t,{color:e,symbol:iu(t,e)}),n.get(t).symbol}};function iu(i,t){const e=[...t.toRgb(),255*t.a];switch(i){case"point":return new Ne({outline:{width:.5,color:[0,0,0,1]},size:10,color:t});case"intersectionPoint":return new Ne({outline:new zl({width:1.5,color:t}),size:15,color:[0,0,0,0]});case"line":return new di({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:Dl.Butt,joinStyle:Gl.Round,miterLimit:10,width:Gn(Bn.lineHintWidthTarget),color:e}]}}});case"parallelSign":return new di({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:e}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:e}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}});case"rightAngleQuad45":case"rightAngleQuad225":{const n=i==="rightAngleQuad45"?45:225;return new di({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:Gn(Bn.rightAngleHintSize),rotation:n,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:Gn(Bn.rightAngleHintOutlineSize),color:e},{type:"CIMSolidFill",enable:!0,color:[...t.toRgb(),255*t.a*.4]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}})}}}const nu=new di({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[3.75,3.75],lineDashEnding:"HalfPattern",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:1.6,color:[255,255,255,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:2,color:[0,0,0,255]}]}}}),su=new Ne({style:"circle",size:6,color:[127,127,127,1],outline:{color:[50,50,50],width:1}}),ou=new Ne({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}});var ut;(function(i){i[i.NeverApplied=0]="NeverApplied",i[i.Applied=1]="Applied",i[i.Undone=2]="Undone"})(ut||(ut={}));var Lt;(function(i){i.UndoRedoUpdating="UndoRedoUpdating",i.UndoInvalidError="UndoInvalidError",i.RedoInvalidError="RedoInvalidError",i.ApplyInvalidError="ApplyInvalidError"})(Lt||(Lt={}));const xn={[Lt.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[Lt.UndoInvalidError]:"There are no items to Undo",[Lt.RedoInvalidError]:"There are no items to Redo",[Lt.ApplyInvalidError]:"Cannot apply an item that is already applied"};let ni=class extends Error{constructor(){super(xn[Lt.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},us=class extends Error{constructor(){super(xn[Lt.UndoInvalidError]),this.type="undo-redo-undo-error"}},qo=class extends Error{constructor(){super(xn[Lt.RedoInvalidError]),this.type="undo-redo-redo-error"}},ru=class extends Error{constructor(){super(xn[Lt.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var Wt;(function(i){i[i.Apply=0]="Apply",i[i.Undo=1]="Undo",i[i.Redo=2]="Redo"})(Wt||(Wt={}));let Di=class extends it{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=ut.NeverApplied}get canUndo(){return this.status===ut.Applied}get canRedo(){return this.status===ut.Undone}async executeUndoRedoOperation(t){switch(t){case Wt.Apply:if(this.status!==ut.NeverApplied)throw new ru;return await this.apply(),void(this.status=ut.Applied);case Wt.Undo:if(this.status!==ut.Applied)throw new us;return await this.undo(),void(this.status=ut.Undone);case Wt.Redo:if(this.status!==ut.Undone)throw new us;return await this.redo(),void(this.status=ut.Applied)}}};a([h()],Di.prototype,"name",void 0),a([h()],Di.prototype,"tag",void 0),Di=a([x("esri.undoredo.UndoableOperation")],Di);let Ct=class extends it{constructor(){super(...arguments),this._stack=new is,this._stackPosition=-1,this._updatingHandles=new Cr}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(t=>t.destroy())}_drainStack(){this._stack.drain(t=>t.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new us;if(this.updating)throw new ni;const t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(Wt.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new qo;if(this.updating)throw new ni;const t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new qo;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(Wt.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new ni;await this._updatingHandles.addPromise((async()=>{t.status===ut.NeverApplied&&await t.executeUndoRedoOperation(Wt.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new ni;await this._updatingHandles.addPromise((async()=>{t.status===ut.NeverApplied&&await t.executeUndoRedoOperation(Wt.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,e=!1){if(this.updating&&!e)return;await Eo(()=>!this.updating);const n=new is;for(let s=0;s<this._stack.length;s++){const o=this._stack.getItemAt(s);o&&(o.tag===t?(o.destroy(),s===this._stackPosition&&(this._stackPosition=n.length-1)):n.push(o))}this._stack=n,this._stackPosition>n.length-1&&(this._stackPosition=n.length-1)}async clear(t=!1){if(this.updating&&!t)throw new ni;await Eo(()=>!this.updating),this._drainStack()}};a([h()],Ct.prototype,"_stack",void 0),a([h()],Ct.prototype,"_stackPosition",void 0),a([h()],Ct.prototype,"updating",null),a([h({readOnly:!0})],Ct.prototype,"canUndo",null),a([h({readOnly:!0})],Ct.prototype,"hasUndo",null),a([h({readOnly:!0})],Ct.prototype,"canRedo",null),a([h({readOnly:!0})],Ct.prototype,"hasRedo",null),Ct=a([x("esri.UndoRedo")],Ct);function io(){return Hl()}function au(){return Ul()}function Ei(i,t){const e=[];i=(i=(i=i.replaceAll(/[\u00B0\u00BA]/g,"^")).replaceAll("′","'")).replaceAll("″",'"');const n=hu(t);return Nl.dmsToGeog(n,1,[i],e)?new C(e[0][0],e[0][1],t||de.WGS84):null}function lu(i){var t,e;return i&&io()?Fe(i)??((t=Ei(`0° 0' 0" N | ${i}`))==null?void 0:t.longitude)??((e=Ei(`0 | ${i}`))==null?void 0:e.longitude)??null:null}function cu(i){var t,e;return i&&io()?Fe(i)??((t=Ei(`${i} | 0° 0' 0" E`))==null?void 0:t.latitude)??((e=Ei(`${i} | 0`))==null?void 0:e.latitude)??null:null}function hu(i){let t=null;if(i||(i=de.WGS84),i.wkid){if(t=So.geogcs(i.wkid),!t)throw new zn("coordinate-formatter:invalid-spatial-reference","wkid is not valid")}else{if(!i.wkt2&&!i.wkt)throw new zn("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");if(t=So.fromString(Fl.PE_TYPE_GEOGCS,i.wkt2||i.wkt),!t)throw new zn("coordinate-formatter:invalid-spatial-reference","wkt is not valid")}return t}let uu=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};var ps;let se=ps=class extends De{constructor(i){super(i),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const i=this.center,t=this.numberOfPoints;if(this.hasZ=(i==null?void 0:i.hasZ)??!1,this.rings.length!==0||!i)return;const e=fn(this.radius,this.radiusUnit,"meters"),n=i.spatialReference;let s,o="geographic";if(n.isWebMercator?o="webMercator":((n.wkid&&Zl[n.wkid])!=null||(n.wkt2||n.wkt)&&Bl(n.wkt2||n.wkt))&&(o="projected"),this.geodesic){let r;switch(o){case"webMercator":r=ql(i);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":r=i}s=this._createGeodesicCircle(r,e,t),o==="webMercator"&&(s=Yl(s))}else{let r;o==="webMercator"||o==="projected"?r=e/Wl(i.spatialReference):o==="geographic"&&(r=jl(e,"meters",Xl(i.spatialReference).radius)),s=this._createPlanarCircle(i,r,t)}this.spatialReference=s.spatialReference,this.addRing(s.rings[0])}clone(){const{center:i,numberOfPoints:t,radius:e,radiusUnit:n,geodesic:s}=this;return new ps({center:i==null?void 0:i.clone(),numberOfPoints:t,radius:e,radiusUnit:n,geodesic:s})}_createGeodesicCircle(i,t,e){let n=0;const s=[];for(;n<360;){const o=[0,0],r=[i.x,i.y];$i(o,r,n,t,de.WGS84),this.hasZ&&o.push(i.z??0),s.push(o),n+=360/e}return s.push(s[0]),new De({rings:[s]})}_createPlanarCircle(i,t,e){const n=[],s=2*Math.PI/e;for(let o=0;o<e;++o){const r=s*o,l=[i.x+Math.cos(-r)*t,i.y+Math.sin(-r)*t];this.hasZ&&l.push(i.z??0),n.push(l)}return n.push(n[0]),new De({spatialReference:i.spatialReference,rings:[n]})}};a([h({type:C})],se.prototype,"center",void 0),a([h()],se.prototype,"geodesic",void 0),a([h()],se.prototype,"numberOfPoints",void 0),a([h()],se.prototype,"radius",void 0),a([h()],se.prototype,"radiusUnit",void 0),se=ps=a([x("esri.geometry.Circle")],se);const pu=se;function an(i,t,e=null){return e!=null?[i,t,e]:[i,t]}function k(i,t,e=null){return e!=null?{x:i,y:t,z:e}:{x:i,y:t}}let pa=class{constructor(t){this.spatialReference=t}mapToLocalMultiple(t){return t.map(e=>this.mapToLocal(e)).filter(Pi)}get doUnnormalization(){return!1}},du=class extends pa{constructor(t,e,n=null){super(e),this._defaultZ=n,this.transform=Mo(),this.transformInv=Mo(),this.transform=Kl(t),Ql(this.transformInv,this.transform)}makeMapPoint(t,e){return an(t,e,this._defaultZ)}mapToLocal(t){return k(this.transform[0]*t[0]+this.transform[2]*t[1]+this.transform[4],this.transform[1]*t[0]+this.transform[3]*t[1]+this.transform[5])}localToMap(t){return an(this.transformInv[0]*t.x+this.transformInv[2]*t.y+this.transformInv[4],this.transformInv[1]*t.x+this.transformInv[3]*t.y+this.transformInv[5],this._defaultZ)}},fu=class extends pa{constructor(t,e){super(t.spatialReference),this.view=t,this.defaultZ=null,this.pWS=g(),this.tangentFrameUpWS=g(),this.tangentFrameRightWS=g(),this.tangentFrameForwardWS=g(),this.localFrameRightWS=g(),this.localFrameUpWS=g(),this.worldToLocalTransform=No(),this.localToWorldTransform=No(),this.scale=1,this.scale=t.resolution,this.referenceMapPoint=e,this.defaultZ=e.hasZ?e.z:null;const n=t.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Un.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Un.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Un.Z,this.tangentFrameForwardWS);const s=g();fe(s,this.tangentFrameForwardWS,Z(n,this.tangentFrameForwardWS)),Tt(this.localFrameRightWS,n,s),le(this.localFrameRightWS,this.localFrameRightWS),Ot(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),Ch(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),Rh(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(t,e){return an(t,e,this.defaultZ)}mapToLocal(t){const e=g();this.view.renderCoordsHelper.toRenderCoords(new C({x:t[0],y:t[1],spatialReference:this.spatialReference}),e),Po(e,e,this.worldToLocalTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(e,new C({spatialReference:this.view.spatialReference}));return n!=null?k(n.x/this.scale,n.y/this.scale):null}localToMap(t){const e=g();this.view.renderCoordsHelper.toRenderCoords(new C({x:t.x*this.scale,y:t.y*this.scale,spatialReference:this.spatialReference}),e),Po(e,e,this.localToWorldTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(e,new C({spatialReference:this.view.spatialReference}));return n!=null?an(n.x,n.y,this.defaultZ):null}};function gu(i,t){if(i.type==="2d")return new du(i.state.transform,i.spatialReference,t.length>2?t[2]:null);if(i.type==="3d"){const e=t.length>2?new C({x:t[0],y:t[1],z:t[2],spatialReference:i.spatialReference}):new C({x:t[0],y:t[1],spatialReference:i.spatialReference});return new fu(i,e)}return null}function Me(i,t){const e=new C({x:i[0],y:i[1],spatialReference:t});return i.length>2&&(e.z=i[2]),e}function mu(i,t){return new Rr({points:i,spatialReference:t})}function Yo(i,t,e){const n=new pi({paths:i,spatialReference:t});return e&&Vr(n),n}function Ai(i,t,e,n=!0){const s=ns(i);s.forEach(r=>{const l=r[0],c=r[r.length-1];Ze(l,c)&&r.length!==1||r.push(r[0])});let o=new De({rings:s,spatialReference:t});return o.rings.forEach(r=>{Jl(r)||r.reverse()}),e&&Vr(o),n&&o.isSelfIntersecting&&Us(t)&&(o=Mh(o)),o}function Wo(i,t,e){const n=t.mapToLocalMultiple(i),s=[],o={x:n[0].x,y:n[0].y},r={x:n[1].x,y:n[1].y},l=Math.round(r.x-o.x),c=Math.round(r.y-o.y),u=Math.max(Math.abs(l),Math.abs(c));if(e){const p={x:o.x+u,y:o.y+u},d={x:o.x-u,y:o.y-u};s.push(k(p.x,d.y),k(d.x,d.y),k(d.x,p.y),k(p.x,p.y))}else{const p={x:l>0?o.x+u:o.x-u,y:c>0?o.y+u:o.y-u};s.push(k(o.x,o.y),k(p.x,o.y),k(p.x,p.y),k(o.x,p.y))}return da(Ai([s.map(p=>t.localToMap(p)).filter(Pi)],t.spatialReference,t.doUnnormalization,!0),s,t)}function yu(i,t,e){let n=t.mapToLocalMultiple(i);if(n.length===1){const c=n[0];n=[k(c.x-48,c.y+48),k(c.x+48,c.y-48),k(c.x+48,c.y-48),k(c.x-48,c.y+48)]}const s=[],o={x:n[0].x,y:n[0].y},r={x:n[1].x,y:n[1].y};if(e){const l=Math.round(r.x-o.x),c=Math.round(r.y-o.y);s.push(k(o.x-l,o.y-c),k(r.x,o.y-c),k(r.x,r.y),k(o.x-l,r.y))}else s.push(k(o.x,o.y),k(r.x,o.y),k(r.x,r.y),k(o.x,r.y));return da(Ai([s.map(l=>t.localToMap(l)).filter(Pi)],t.spatialReference,t.doUnnormalization,!0),s,t)}function da(i,t,e){const n=Gi(t[3],t[2],e),s=Gi(t[1],t[2],e),o=Gi(t[0],t[1],e),r=Gi(t[0],t[3],e);return{geometry:i,midpoints:n!=null&&s!=null&&o!=null&&r!=null?{top:n,right:s,bottom:o,left:r}:null}}function Gi(i,t,e){Ce[0]=i.x,Ce[1]=i.y,Ce[2]=0,Re[0]=t.x,Re[1]=t.y,Re[2]=0,Se(Ce,Ce,Re,.5),zi.x=Ce[0],zi.y=Re[1],zi.z=Re[2];const n=e.localToMap(zi);return n!=null?Me(n,e.spatialReference):null}const zi=k(0,0,0),Ce=g(),Re=g();function jo(i,t,e,n){const s=t.mapToLocalMultiple(i);let o=null,r=null;if(e)o=s[0],r=s[1];else{const m=s[0],y=s[1],w=Math.round(y.x-m.x),b=Math.round(y.y-m.y),$=Math.max(Math.abs(w),Math.abs(b));o=k(w>0?m.x+$/2:m.x-$/2,b>0?m.y+$/2:m.y-$/2),r=k(Math.abs(w)>Math.abs(b)?o.x-$/2:o.x,Math.abs(w)>Math.abs(b)?o.y:o.y-$/2)}const l=t.localToMap(o),c=t.localToMap(r);if(l==null||c==null)return null;t.doUnnormalization&&tc([[l,c]],t.spatialReference);const u=Me(l,t.spatialReference),p=Me(c,t.spatialReference),d=vi(t.spatialReference);let _=0;if(Us(t.spatialReference))_=d*Ph(u,p,null);else{const m=o.x-r.x,y=o.y-r.y;_=d*Math.sqrt(m*m+y*y)*(n||1)}const f=new pu({center:u,radius:_,radiusUnit:"meters",spatialReference:t.spatialReference});return{geometry:Ai(f.rings,f.spatialReference,!1),center:u,edge:p}}function _u(i,t,e){const n=t.mapToLocalMultiple(i),s=n[0],o=n[1],r=Math.round(o.x-s.x),l=Math.round(o.y-s.y),c=k(e?s.x:s.x+r/2,e?s.y:s.y+l/2),u=e?r:r/2,p=e?l:l/2,d=60,_=[],f=2*Math.PI/d;function m(Y){const mt=Math.cos(Y),ht=Math.sin(Y);return k(u*mt+c.x,p*ht+c.y)}for(let Y=0;Y<d;Y++)_.push(m(Y*f));_.push(_[0]);const{spatialReference:y,doUnnormalization:w}=t,b=Ai([_.map(Y=>t.localToMap(Y)).filter(Pi)],y,w,!1),$=t.localToMap(m(Math.PI/2)),P=t.localToMap(m(0)),K=t.localToMap(m(-Math.PI/2)),Q=t.localToMap(m(Math.PI));return{geometry:b,midpoints:$!=null&&P!=null&&K!=null&&Q!=null?{top:Me($,y),right:Me(P,y),bottom:Me(K,y),left:Me(Q,y)}:null}}function no(i,t){switch(i){case"point":case"multipoint":return vu();case"polyline":return bu(t);case"polygon":return xu(t);default:return}}function vu(i){return"point"}function bu(i){return(i!=null&&i.type==="polyline"&&i.paths.length?i.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}function xu(i){const t=i!=null&&i.type==="polygon"&&i.rings.length?i.rings[0].length:0;return t<3?"polylineZeroVertices":t<4?"polygonOneVertex":"polygonTwoVertices"}function wu(i,t){const e=i==null?void 0:i.geometry;if(!i||(e==null?void 0:e.type)!=="mesh"||!t)return;const{renderCoordsHelper:n,elevationProvider:s}=t,{camera:o}=t.state,{extent:r}=e,{center:l,spatialReference:c}=r,u=vi(c),p=Hs(c),d=vi(n.spatialReference),_=r.width*u,f=r.height*p,m=(r.zmax??0)*p,y=m-(r.zmin??0)*p,w=Math.max(_,f,y)/d,{x:b,y:$}=l,P=l.z??0;N(Ui,b,$,P),n.toRenderCoords(Ui,c,Ui);const K=w/o.computeScreenPixelSizeAt(Ui);if(K>o.width*Tu)return"meshTooClose";if(K<$u)return"meshTooFar";const Q=xh(i),{absoluteZ:Y}=wh(b,$,m,c,t,Q);return Y<(s.getElevation(b,$,P,c,"ground")??0)*p+y*Eu?"meshUnderground":"mesh"}const $u=20,Tu=1,Eu=.1,Ui=g();function qn(i,t){return i[0]*t[1]-i[1]*t[0]}function Su(i,t){const e=i.start,n=i.end,s=t.start,o=t.end,r=j(fa,n,e),l=j(ga,o,s),c=qn(r,l);if(Math.abs(c)<=Pu)return[];const u=j(ma,e,s),p=qn(l,u)/c,d=qn(r,u)/c;if(p>=0){if(d>=0||t.type===O.LINE)return[jt(ln,e,r,p)]}else if(i.type===O.LINE&&(d>=0||t.type===O.LINE))return[jt(ln,e,r,p)];return[]}function Mu(i,t,e){const n=[],s=j(fa,i.end,i.start),o=j(ga,i.start,t),r=Be(s),l=2*ye(s,o),c=l*l-4*r*(Be(o)-e*e);if(c===0){const u=-l/(2*r);(i.type===O.LINE||u>=0)&&n.push(jt(ln,i.start,s,u))}else if(c>0){const u=Math.sqrt(c),p=(-l+u)/(2*r);(i.type===O.LINE||p>=0)&&n.push(jt(ln,i.start,s,p));const d=(-l-u)/(2*r);(i.type===O.LINE||d>=0)&&n.push(jt(ma,i.start,s,d))}return n}var O;(function(i){i[i.RAY=0]="RAY",i[i.LINE=1]="LINE"})(O||(O={}));const Pu=1e-6,fa=L(),ga=L(),ma=L(),ln=L();function so({start:i,end:t,type:e},n,s){const o=[],r=j(Oi,t,i),l=j(wn,i,n),c=Be(r),u=2*ye(r,l),p=u*u-4*c*(Be(l)-s*s);if(p===0){const d=-u/(2*c);(e===xt.PLANE||d>=0)&&o.push(jt(L(),i,r,d))}else if(p>0){const d=Math.sqrt(p),_=(-u+d)/(2*c);(e===xt.PLANE||_>=0)&&o.push(jt(L(),i,r,_));const f=(-u-d)/(2*c);(e===xt.PLANE||f>=0)&&o.push(jt(L(),i,r,f))}return o}function ya(i,t){const e=i.start,n=i.end,s=j(Oi,n,e),o=N(Tn,-s[1],s[0],0),r=t.start,l=t.end,c=dt(ro,l,r),u=Z(c,o),p=N(Ea,e[0],e[1],0),d=dt(Sa,p,r),_=Z(d,o),f=bi();if(Math.abs(u)<f)return[];const m=G(Ma,r,c,_/u);if(t.type===O.RAY){const y=dt(ds,m,r);if(Z(y,c)<-f)return[]}if(i.type===xt.HALF_PLANE){const y=ec(wn,m,e);if(ye(y,s)<-f)return[]}return[_e(m)]}function ku(i,t){return Ru(cn(ao,t[2],i),t)}function _a(i,t){return $a(cn(ao,0,i),cn(Iu,0,t)).map(([n,s])=>ge(n,s))}function va(i,t,e){return xa(i,cn(ao,i[2],t),e)}function ba(i,t,e,n=g()){const s=j(Oi,i,t),o=ic(s);return jt(n,t,s,o===0?1:e/o),n[2]=i[2],n}function xa(i,{start:t,end:e,type:n},s=g()){const o=dt($n,i,t),r=dt(Tn,e,t),l=Z(o,r)/Z(r,r);return G(s,t,r,n===O.RAY?Math.max(l,0):l)}const Cu=(()=>{const i=g(),t=g(),e=g();return({start:n,end:s},{center:o,radius:r,normal:l,slicePlane:c})=>{const u=Ri(o,l,Ou);if(R(hs(u,n),0)&&R(hs(u,s),0)){na(l,i,t);const d=(m,y)=>(Tt(e,y,o),qt(m,Z(e,i),Z(e,t)),m),_=Mu({start:d(Oi,n),end:d(wn,s),type:O.LINE},nc,r),f=[];for(const[m,y]of _){const w=lt(g(),o);G(w,w,i,m),G(w,w,t,y),c&&!me(c,w)||f.push(w)}return f}const p=g();return Js(u,n,s,p)?!R(pe(p,o),r)||c&&!me(c,p)?[]:[p]:[]}})();function wa({start:i,end:t,type:e},n,s){const o=[],r=Tt($n,t,i),l=j(wn,i,n),c=Be(r),u=2*ye(r,l),p=u*u-4*c*(Be(l)-s*s);if(p===0){const d=-u/(2*c);(e===O.LINE||d>=0)&&o.push(G(g(),i,r,d))}else if(p>0){const d=Math.sqrt(p),_=(-u+d)/(2*c);(e===O.LINE||_>=0)&&o.push(G(g(),i,r,_));const f=(-u-d)/(2*c);(e===O.LINE||f>=0)&&o.push(G(g(),i,r,f))}return o}function $a(i,t){const e=i.start,n=i.end,s=t.start,o=t.end,r=dt($n,n,e),l=dt(Tn,o,s),c=dt(ro,s,e),u=Ot(Ea,r,l);if(!R(Z(c,u),0))return[];const p=ss(u);if(R(p,0))return[];const d=Ot(Sa,c,l),_=Z(d,u)/p,f=G(Ma,e,r,_);if(i.type===O.RAY){const m=dt(ds,f,e);if(Z(r,m)<-bi())return[]}if(t.type===O.RAY){const m=dt(ds,f,s);if(Z(l,m)<-bi())return[]}return[_e(f)]}function Ru({start:i,end:t,type:e},n){const s=dt($n,n,i),o=dt(Tn,t,i),r=Ot(ro,o,s),l=ss(r)/ss(o),c=bi();if(l<c)switch(e){case O.LINE:return[_e(n)];case O.RAY:return Z(o,s)<-c?[]:[_e(n)]}return[]}function oo(i,t,e,n){const[s,o]=i,[r,l]=e,c=r-s,u=l-o,p=c*c+u*u,d=Math.sqrt(p);if(d>t+n)return[];if(d<Math.abs(t-n))return[];if(R(d,0)&&R(t,n))return[];const _=(t*t-n*n+p)/(2*d),f=Math.sqrt(t*t-_*_),m=f*u/d,y=f*c/d,[w,b]=Ar(Oi,i,e,_/d);return R(m,y)?[ge(w,b)]:[ge(w+m,b-y),ge(w-m,b+y)]}function cn(i,t,{start:e,end:n,type:s}){return N(i.start,e[0],e[1],t),N(i.end,n[0],n[1],t),i.type=Au[s],i}function Ta(i,t){return R(i[2],t[2])}function R(i,t){return li(Math.abs(i-t),0,bi())}function Vu(i,t){return t.filter(e=>me(i,e))}function me(i,t){return ia(i,t)}var xt;(function(i){i[i.PLANE=0]="PLANE",i[i.HALF_PLANE=1]="HALF_PLANE"})(xt||(xt={}));const Au={[xt.PLANE]:O.LINE,[xt.HALF_PLANE]:O.RAY},Oi=L(),wn=L(),$n=g(),Tn=g(),ro=g(),Ea=g(),Sa=g(),Ma=g(),ds=g(),Ou=ct(),ao={start:g(),end:g(),type:O.LINE},Iu={start:g(),end:g(),type:O.LINE};class $t{intersect(t){return Ut(this,t)}closestPoints(t){return[this.closestTo(t)]}}class Je extends $t{constructor(t){super(),this.point=t}equals(t){return this===t||vt(t)&&H(this.point,t.point)}closestTo(){return je(this.point)}}class lo extends $t{constructor(t,e,n){super(),this.start=t,this.end=e,this.lineLike={start:t,end:e,type:n}}equals(t){return this===t||Rt(t)&&this.lineLike.type===t.lineLike.type&&H(this.start,t.start)&&H(this.end,t.end)}closestTo(t){const e=X();return xa(t,this.lineLike,e),e}}class Pa extends lo{constructor(t,e){super(t,e,O.LINE)}}class Lu extends lo{constructor(t,e){super(t,e,O.RAY)}}class ka extends $t{constructor(t){super(),this.constraints=t}equals(t){return this===t||fs(t)&&Ze(this.constraints,t.constraints,(e,n)=>e.equals(n))}closestTo(t){let e,n=1/0;for(const s of this.constraints){const o=s.closestTo(t),r=sc(t,o);r<n&&(n=r,e=o)}return je(e??t)}closestPoints(t){return this.constraints.flatMap(e=>e===this?[]:e.closestPoints(t))}}class Ca extends $t{constructor(t,e){super(),this.center=t,this.radius=e}equals(t){return this===t||At(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}closestTo(t){const e=X();return ba(t,this.center,this.radius,e),e}}class co extends $t{constructor(t,e){super(),this.center=t,this.radius=e}equals(t){return this===t||Nt(t)&&H(this.center,t.center)&&this.radius===t.radius}closestTo(t){const e=X();return ba(t,this.center,this.radius,e),e[2]=this.center[2],e}asCircle(){return new ho(je(this.center),this.radius,ve(0,0,1))}}class ho extends $t{constructor(t,e,n,s=void 0){super(),this.center=t,this.radius=e,this.normal=n,this.slicePlane=s}equals(t){return this===t||oe(t)&&H(this.center,t.center)&&H(this.normal,t.normal)&&this.radius===t.radius}closestTo(t){const{center:e,radius:n}=this;to(this.getPlane(Du),t,Yn);const s=dt(Yn,Yn,e),o=Or(s);if(R(o,0))return je(t);const r=n/Math.sqrt(o),l=X();G(l,e,s,r);const{slicePlane:c}=this;if(c&&!me(c,l)){const u=po(c,this);return(u==null?void 0:u.closestTo(t))??je(t)}return l}getPlane(t=ct()){return Ri(this.center,this.normal,t)}}const Yn=g(),Du=ct();class Ra extends $t{constructor(t){super(),this.z=t}equals(t){return this===t||Ht(t)&&this.z===t.z}closestTo(t){return ve(t[0],t[1],this.z)}getPlane(t=ct()){return N(Xo,0,0,this.z),Ri(Xo,Ns,t)}}const Xo=g();class Va extends $t{constructor(t,e,n){super(),this.start=t,this.end=e,this.planeLike={start:t,end:e,type:n}}equals(t){return this===t||Vt(t)&&this.planeLike.type===t.planeLike.type&&H(this.start,t.start)&&H(this.end,t.end)}closestTo(t){const e=X();return va(t,this.planeLike,e),e}closestEndTo(t){const{start:e,end:n}=this.planeLike;return Math.sign(ye(j(Gu,n,e),j(zu,t,e)))>0?this.end:this.start}getPlane(t=ct()){const e=lt(Ko,this.end);return e[2]+=1,sa(this.start,this.end,e,t)}getSlicePlane(t=ct()){const{start:e,end:n,type:s}=this.planeLike;if(s===xt.PLANE)return;const o=N(Ko,e[0],e[1],0),r=N(Qo,n[0],n[1],0),l=Tt(Qo,r,o);return Ri(o,l,t),t}}const Gu=L(),zu=L(),Ko=g(),Qo=g();class Uu extends Va{constructor(t,e){super(t,e,xt.HALF_PLANE)}}class Hu extends $t{constructor(t,e){super(),this.sphere=Lh(t,e)}equals(t){return this===t||Ft(t)&&Dh(this.sphere,t.sphere)}closestTo(t){const e=X();return Gh(this.sphere,t,e),e}get center(){return zh(this.sphere)}get radius(){return this.sphere[3]}}class Nu extends $t{constructor(t,e,n){super(),this.start=t,this.end=e,this.getZ=n,this.planeLike={start:t,end:e,type:xt.PLANE}}equals(t){return this===t||hn(t)&&H(this.start,t.start)&&H(this.end,t.end)&&this.getZ===t.getZ}closestTo(t){return qu(this,t)}addIfOnTheGround(t,e){for(const n of e){const s=this.getZ(n[0],n[1])??0;R(n[2],s)&&(n[2]=s,t.push(n))}}}class uo extends $t{constructor(t,e,n){super(),this._x=t,this._y=e,this._z=n}equals(t){return this===t||lp(t)&&this._x===t._x&&this._y===t._y&&this._z===t._z}closestTo([t,e,n]){return ra(this._x??t,this._y??e,this._z??n)}}class Aa extends $t{constructor(t,e,n,s,o){super(),this._origin=t,this._spatialReference=e,this._distanceMeters=n,this._z=s,this._directionDegrees=o}equals(t){return this===t||ap(t)&&ko(this._origin,t._origin)&&this._spatialReference===t._spatialReference&&this._distanceMeters===t._distanceMeters&&this._z===t._z&&this._directionDegrees===t._directionDegrees}closestTo([t,e,n]){return qt(si,t,e),ko(si,this._origin)||this._applyDirectionAndDistance(si),ra(si[0],si[1],this._z??n)}_applyDirectionAndDistance(t){if(this._directionDegrees!=null&&this._distanceMeters!=null)$i(t,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)Zu(t,this._origin,this._directionDegrees,t,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:e}=_n(Fu,this._origin,t,this._spatialReference);$i(t,this._origin,e??0,this._distanceMeters,this._spatialReference)}}}const si=[0,0],Fu=new vn;function Zu(i,t,e,n,s){let{azimuth:o,distance:r}=_n(Bu,t,n,s);o??(o=0);let l=r*Math.cos((o-e)*lc);l=Math.max(0,l),$i(i,t,e,l,s)}const Bu=new vn;function qu(i,t){const e=X();return va(t,i.planeLike,e),e[2]=i.getZ(e[0],e[1])??Ia,e}function Ut(i,t){if(fs(i)){const e=[];for(const n of i.constraints){const s=n.intersect(t);s&&e.push(s)}return Ii(e)}if(fs(t))return Ut(t,i);if(hn(i))return Jo(i,t);if(hn(t))return Jo(t,i);if(vt(i)){const{point:e}=i;if(vt(t))return H(e,t.point)?i:void 0;const n=t.closestTo(e);return qe(n,e)?i:void 0}if(Rt(i)){if(vt(t))return Ut(t,i);if(Rt(t))return Mt($a(i.lineLike,t.lineLike));if(Ht(t))return Yu(i,t);if(Vt(t))return Mt(ya(t.planeLike,i.lineLike));if(At(t))return Mt(wa(i.lineLike,t.center,t.radius));if(oe(t))return Mt(Cu(i.lineLike,t));if(Nt(t))return Wu(i,t);if(Ft(t))return ju(i,t)}else if(Ht(i)){if(vt(t)||Rt(t))return Ut(t,i);if(Ht(t))return Xu(i,t);if(Vt(t))return Ku(i,t);if(At(t))return Qu(i,t);if(oe(t))return tp(i,t);if(Nt(t))return Ju(i,t);if(Ft(t))return ep(i,t)}else if(Vt(i)){if(vt(t)||Rt(t)||Ht(t))return Ut(t,i);if(Vt(t))return Wn(_a(i.planeLike,t.planeLike));if(At(t))return Wn(so(i.planeLike,t.center,t.radius));if(oe(t))return np(i,t);if(Nt(t))return ip(i,t);if(Ft(t))return sp(i,t)}else if(At(i)){if(vt(t)||Rt(t)||Ht(t)||Vt(t))return Ut(t,i);if(At(t))return Wn(oo(i.center,i.radius,t.center,t.radius));if(oe(t))return void 0;if(Nt(t))return op(i,t);if(Ft(t))return void 0}else if(oe(i)){if(vt(t)||Rt(t)||Ht(t)||Vt(t)||At(t))return Ut(t,i);if(oe(t))return void 0;if(Nt(t))return t.asCircle(),void 0;if(Ft(t))return void 0}else if(Nt(i)){if(vt(t)||Rt(t)||Ht(t)||Vt(t)||At(t)||oe(t))return Ut(t,i);if(Nt(t))return rp(t,i);if(Ft(t))return void 0}else if(Ft(i)){if(vt(t)||Rt(t)||Ht(t)||Vt(t)||At(t)||Nt(t))return Ut(t,i);if(Ft(t))return void 0}}const Yu=(()=>{const i=ct();return(t,e)=>{const{start:n,end:s}=t;if(Ta(n,s)&&R(n[2],e.z))return t;const o=X();return Js(e.getPlane(i),n,s,o)?new Je(o):void 0}})();function Wu({lineLike:i},{center:t,radius:e}){const n=t[2];return Mt(wa(i,t,e).filter(s=>R(s[2],n)))}function ju({lineLike:i},{sphere:t}){return Mt(Ih(t,i.start,i.end))}const po=(()=>{const i=Ir(),t=g(),e=g();return(n,s,o)=>{const{normal:r,center:l,radius:c}=s;na(r,t,e);const u=ze(n),p=c*Z(u,t),d=c*Z(u,e);oc(i,l[0],l[1],l[2],1);const _=rc(n,i),f=Math.hypot(p,d),m=R(f,0);if(R(hs(n,l),0)){if(m)return s;if(R(c,0))return!o||me(o,l)?new Je(je(l)):void 0;Ot(t,u,r),le(t,t);const Y=new Array,mt=_e(l);G(mt,mt,t,c),o&&!me(o,mt)||Y.push(mt);const ht=_e(l);return G(ht,ht,t,-c),o&&!me(o,ht)||Y.push(ht),Mt(Y)}if(m)return;const y=-_/f;if(Math.abs(y)>1||R(y,1))return;const w=Math.atan(p/d),b=ac(y)-w,$=Math.PI-b,P=new Array,K=g();G(K,l,t,c*Math.cos(b)),G(K,K,e,c*Math.sin(b)),P.push(K);const Q=g();return G(Q,l,t,c*Math.cos($)),G(Q,Q,e,c*Math.sin($)),P.push(Q),Mt(o?Vu(o,P):P)}})();function Xu(i,t){return R(i.z,t.z)?i:void 0}function Ku({z:i},{planeLike:t}){const[e,n]=t.start,[s,o]=t.end,r=ve(e,n,i),l=ve(s,o,i);return t.type===xt.PLANE?new Pa(r,l):new Lu(r,l)}function Qu(i,t){const[e,n]=t.center;return new co(ve(e,n,i.z),t.radius)}function Ju(i,t){return R(t.center[2],i.z)?t:void 0}const tp=(()=>{const i=ct();return(t,e)=>po(t.getPlane(i),e,e.slicePlane)})();function ep(i,{center:t,radius:e}){const n=Math.abs(t[2]-i.z);if(n>e&&!R(n,e))return;const s=ve(t[0],t[1],i.z),o=Math.sqrt(e**2-n**2);return R(o,0)?void 0:new co(s,o)}const ip=(()=>{const i=ct();return(t,{center:e,radius:n})=>{const s=so(t.planeLike,e,n),o=e[2];t.getSlicePlane(i);const r=new Array;for(const[l,c]of s){const u=[l,c,o];me(i,u)&&r.push(u)}return Mt(r)}})(),np=(()=>{const i=ct(),t=ct();return(e,n)=>po(e.getPlane(i),n,e.getSlicePlane(t))})(),sp=(()=>{const i=ct();return(t,{center:e,radius:n})=>{const s=t.getPlane(i),o=Ve(s,e),r=Math.abs(o);if(r>n&&!R(r,n))return;const l=Math.sqrt(n**2-o**2);if(R(l,0)){const p=X();return to(s,e,p),new Je(p)}const c=X(),u=_e(ze(s));return G(c,e,u,o),new ho(c,l,u,t.getSlicePlane())}})();function op(i,t){const e=sn(i.center,t.center);return R(e,0)&&R(i.radius,t.radius)?t:Oa(oo(i.center,i.radius,t.center,t.radius),t.center[2])}function rp(i,t){if(!Ta(i.center,t.center))return;const e=sn(i.center,t.center);return R(e,0)&&R(i.radius,t.radius)?i:Oa(oo(i.center,i.radius,t.center,t.radius),i.center[2])}function Jo(i,t){const{planeLike:e,getZ:n}=i,s=new Array;if(vt(t))i.addIfOnTheGround(s,ku(e,t.point));else if(Rt(t))i.addIfOnTheGround(s,ya(e,t.lineLike));else if(At(t))for(const[o,r]of so(e,t.center,t.radius)){const l=n(o,r);l!=null&&s.push(ue(o,r,l))}else if(Vt(t)||hn(t))for(const[o,r]of _a(e,t.planeLike)){const l=n(o,r)??Ia;s.push(ue(o,r,l))}return Mt(s)}function Wn(i){return Ii(i.map(([t,e])=>{const n=ve(t,e,0),s=ve(t,e,1);return new Pa(n,s)}))}function Mt(i){return Ii(i.map(t=>t?new Je(t):void 0))}function Oa(i,t){return Mt(i.map(([e,n])=>[e,n,t]))}function Ii(i){if(i.length!==0)return i.length===1?i[0]??void 0:new ka(i.filter(Pi))}function fs(i){return i instanceof ka}function vt(i){return i instanceof Je}function Rt(i){return i instanceof lo}function Ht(i){return i instanceof Ra}function Vt(i){return i instanceof Va}function At(i){return i instanceof Ca}function Nt(i){return i instanceof co}function oe(i){return i instanceof ho}function Ft(i){return i instanceof Hu}function hn(i){return i instanceof Nu}function ap(i){return i instanceof Aa}function lp(i){return i instanceof uo}const Ia=0;var A;function fo(i,t){if(i==null||t==null)return;const e=gs(i,t);return e!=null?Dt(e,"radians","geographic"):void 0}(function(i){i.Absolute="absolute",i.Relative="relative",i.RelativeBilateral="relative-bilateral"})(A||(A={}));const gs=(()=>{const i=g(),t=g();return(e,n)=>(N(i,e.x,e.y,e.z??0),N(t,n.x,n.y,n.z??0),cp(i,t,e.spatialReference,n.spatialReference))})(),cp=(()=>{const i=L(),t=g(),e=g();return(n,s,o,r)=>{if(H(n,s))return;const l=rn(o),c=rn(r);if(l&&c&&Qe(l,c)&&bt(n,o,t,l)&&bt(s,r,e,c)){const{azimuth:p}=_n(dp,t,e,l);return p!=null?fn(p,"degrees","radians"):void 0}i[0]=s[0]-n[0],i[1]=s[1]-n[1];let u=cc(hc,i);return i[0]<0&&(u=fp-u),u}})();function hp(i,t,e,n=A.Absolute){if(t&&e)switch(n){case A.Absolute:return fo(t,e);case A.Relative:return un(tr(i,t,e),A.Relative);case A.RelativeBilateral:return un(tr(i,t,e),A.RelativeBilateral)}}function tr(i,t,e){if(!i||!t||!e)return;const n=gs(i,t),s=gs(t,e);return n!=null&&s!=null?Dt(s-n,"radians","geographic"):void 0}function un(i,t){if(i!=null)switch(t){case A.Absolute:return ms(i);case A.Relative:{const e=Pt(i);let n=er.normalize(e,0,!0);return n===-180&&(n=180),Dt(n,"degrees","geographic")}case A.RelativeBilateral:{const e=Pt(i),n=Math.abs(er.normalize(e,0,!0));return Dt(n,"degrees","geographic")}}}function ms(i){const t=Pt(i),e=gp.normalize(t,0,!0);return Dt(e,"degrees","geographic")}const up=(()=>{const i=g();return(t,e,n,s,o,r="geodesic")=>{lt(i,e);const l=Pt(o);if(r==="geodesic"){const f=rn(n);if(f&&bt(i,n,i,f))return $i(t,i,l,s,f),t[2]=e[2],!!bt(t,f,t,n)}const c=Lr(l,"geographic","arithmetic"),u=fn(c,"degrees","radians"),p=e[0]+s*Math.cos(u),d=e[1]+s*Math.sin(u),_=e[2];return N(t,p,d,_),!0}})();function Pt(i){if(i!=null)return Lr(pp(i),i.rotationType,"geographic")}function pp(i){return fn(i.value,i.unit,"degrees")}const dp=new vn,fp=2*Math.PI,gp=Dr,er=new Fs(-180,180);function mp(i,t,e,n,s,o){let r="geodesic",l=rn(e);const c=X();return eo(i,t,n,c),c[2]=0,l&&bt(c,e,c,l)||(r="euclidean",l=e),{mode:r,view:t,elevationInfo:n,hasZ:s,directionMode:o,spatialReference:i.spatialReference,measurementSR:l,origin:c}}function yp(i,t,e){if(t==null||i==null)return;const n=Zs(e.measurementSR);if(n==null)return;const s=En(i,e);if(s==null)return;const o=gn(t,n);return new Ca(s,o)}function _p(i,t,e,n){if(e==null||i==null)return;const s=En(i,n);if(s==null)return;const o=Pt(e),r=10,l=u=>{if(u==null)return;const p=X(),d=Dt(u,"degrees","geographic");return up(p,s,n.measurementSR,r,d,n.mode)?new Uu(s,p):void 0},c=()=>{if(t!=null&&i!=null)return Pt(fo(t,i))};switch(n.directionMode){case A.Absolute:return l(o);case A.Relative:{const u=c();return u==null?void 0:l(u+o)}case A.RelativeBilateral:{const u=c();return u==null?void 0:Ii([l(u+o),l(u-o)])}}}function La(i,t){const e=Sn(i,t);return e!=null?new Ra(e):void 0}function Da(i,t,e){const{context:n,longitude:s,latitude:o,direction:r,distance:l,elevation:c}=e;if(s!=null||o!=null||l!=null||c!=null||r!=null){if(s!=null||o!=null){const u=Pt(s),p=Pt(o),d=Sn(c,n);return new uo(u,p,d)}return vp(i,t,e)}}function vp(i,t,{context:e,direction:n,distance:s,elevation:o}){if(t==null)return La(o,e);const{view:r,elevationInfo:l,measurementSR:c}=e,u=eo(t,r,l);if(!c||!bt(u,t.spatialReference,ir,c))return;const[p,d]=ir,_=s!=null?gn(s,"meters"):void 0,f=Pt(n),m=Sn(o,e),y=b=>{const $=new Aa([p,d],c,_,m,b);return _==null||b==null||m==null&&e.hasZ?$:new Je($.closestTo(u))};if(f==null)return y(void 0);const w=()=>{if(i!=null&&t!=null)return Pt(fo(i,t))};switch(e.directionMode){case A.Absolute:return y(f);case A.Relative:{const b=w();return b==null?void 0:y(b+f)}case A.RelativeBilateral:{const b=w();return b==null?void 0:Ii([y(b+f),y(b-f)])}}}function bp(i){return i.context.mode==="geodesic"?Da(null,null,i):Ga(i)}function xp(i,t,e){const{context:n,x:s,y:o,distance:r,direction:l,elevation:c}=e;return n.mode==="geodesic"?Da(t,i,e):s!=null||o!=null?Ga(e):wp([yp(i,r,n),_p(i,t,l,n),La(c,n)])}function Ga({x:i,y:t,elevation:e,context:n}){Hi.x=(i==null?void 0:i.value)??0,Hi.y=(t==null?void 0:t.value)??0,Hi.spatialReference=n.spatialReference;const s=En(Hi,n,Ep);return new uo(i!=null&&s!=null?s[0]:void 0,t!=null&&s!=null?s[1]:void 0,Sn(e,n))}function wp(i){let t;for(const e of i)e&&(t=(t==null?void 0:t.intersect(e))??e);return t}function En(i,t,e=X()){const{view:n,elevationInfo:s,measurementSR:o,origin:r,mode:l}=t;if(eo(i,n,s,e),bt(e,i.spatialReference,e,o))return l!=="geodesic"&&Tt(e,e,r),e}function $p(i,t,e,n){const{view:s,measurementSR:o,spatialReference:r,origin:l,mode:c}=e;if(c==="geodesic"?lt(oi,i):pt(oi,i,l),bt(oi,o,oi,r))return Yh(oi,s,t,e,n)}function Sn(i,t){var e;return((e=Tp(i,t))==null?void 0:e.value)??void 0}function Tp(i,{view:t,origin:e,elevationInfo:n,hasZ:s,measurementSR:o}){if(i==null||!s)return;const r=Gr(o);if(r==null)return;const[l,c]=e,u=gn(i,r),p=(t==null?void 0:t.type)==="3d"?Jr(t,l,c,u,o,n):u;return p!=null?gt(p,r):void 0}const ir=X(),Ep=X(),oi=X(),Hi=Ks(0,0,0,de.WGS84),Sp="z",Mp="r",nr={toggle:"Control"},Ue={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},kt={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:zr,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0},undo:Sp,redo:Mp};let Pp=class{constructor(){this._bindings=new Map}add(t,e){return this.addToggle(t,n=>{n.type==="key-down"&&e(n)})}addToggle(t,e){const n=kp.fromDefinition(t,e),s=uc(this._bindings,n.key,()=>[]);return s.push(n),q(()=>Ur(s,n))}register(t,e=Hr.WIDGET){return kr([t.on("key-down",n=>this.dispatch(t.inputManager,n),e),t.on("key-up",n=>this.dispatch(t.inputManager,n),e)])}dispatch(t,e){const n=e.key,s=this._bindings.get(n);if(s)for(const o of s)o.process(t,e)}},kp=class ys{constructor(t,e,n,s,o){this.key=t,this.modifiers=e,this.repeats=n,this.continuePropagation=s,this.callback=o}process(t,e){if(!(e.key!==this.key||"repeat"in e&&e.repeat&&!this.repeats)){for(const n of this.modifiers)if(!t.isModifierKeyDown(n))return;this.continuePropagation||e.stopPropagation(),this.callback(e)}}static fromDefinition(t,e){if(typeof t=="string")return new ys(t,[],!1,!1,e);const{key:n,modifier:s,repeats:o,continuePropagation:r}=t;return new ys(n,s?Array.isArray(s)?s:[s]:[],!!o,!!r,e)}};const J="esri-tooltip",Cp=`${J}-content`,Rp=`${J}-content--input`,Vp=`${J}-content__header`,Ap=`${J}-content__header__spacer`,sr=`${J}-content__header__actions`,za=`${J}-draw-header-actions`,Op=`${J}-table`,Ip=`${J}-help-message`,Lp=`${J}-help-message__text`,Dp=`${J}-help-message__icon`,Ni=`${J}-field`,Fi={base:Ni,inputMode:`${Ni}--input`,title:`${Ni}__title`,value:`${Ni}__value`};let z=class extends ki{constructor(){super(...arguments),this.hidden=!1,this.mode="feedback"}render(){return v("div",{class:this.classes({[Fi.base]:!0,[Fi.inputMode]:this.mode==="input"})},v("div",{class:Fi.title,key:"title"},this.title),v("div",{class:Fi.value,key:"value"},this.value))}};a([h()],z.prototype,"hidden",void 0),a([h()],z.prototype,"mode",void 0),a([h()],z.prototype,"title",void 0),a([h()],z.prototype,"value",void 0),z=a([x("esri.views.interactive.tooltip.components.TooltipField")],z);const Gp={base:`${J}-value-by-value`};let Yt=class extends ki{constructor(){super(...arguments),this.divider="×"}render(){return v("div",{class:Gp.base},v("span",null,this.left),v("span",null,this.divider),v("span",null,this.right))}};a([h()],Yt.prototype,"left",void 0),a([h()],Yt.prototype,"divider",void 0),a([h()],Yt.prototype,"right",void 0),Yt=a([x("esri.views.interactive.tooltip.components.ValueByValue")],Yt);function _s(i){let t,e,n=[],s=!1;function o(...r){return s&&t===this&&zp(r,n)||(e=i.apply(this,r),t=this,n=r,s=!0),e}return o}function zp(i,t){if(i.length!==t.length)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}function or(i){var s,o;const t="metric";if(i==null)return t;const e=i.map,n=(e&&"portalItem"in e?(s=e.portalItem)==null?void 0:s.portal:null)??pc.getDefault();switch(((o=n.user)==null?void 0:o.units)??n.units){case t:return t;case"english":return"imperial"}return dc(i.spatialReference)??t}function go(i,t,e,n=2,s="abbr"){return gc(i,te(t,e).value,e,n,s)}function Ua(i,t,e,n=2,s="abbr"){return mc(i,te(t,e).value,e,n,s)}function Up(i,t,e=2,n="abbr"){return yc(i,t.value,t.unit,e,n)}function Hp(i,t,e=2,n="abbr"){return _c(i,t.value,t.unit,e,n)}function Np(i,t,e=2,n="abbr"){return vc(i,t.value,t.unit,e,n)}function Fp(i,t,e=2,n="abbr"){return bc(i,t.value,t.unit,e,n)}function Zp(i,t,e=2,n="abbr"){return xc(i,t.value,t.unit,e,n)}function Bp(i,t,e=2,n="abbr"){return wc(i,t.value,t.unit,e,n)}function qp(i,t,e=2,n="abbr"){return $c(i,t.value,t.unit,e,n)}function Yp(i,t,e=2,n="abbr"){return Tc(i,t.value,t.unit,e,n)}function Wp(i,t,e=2,n="abbr"){return Ec(i,t.value,t.unit,e,n)}function jp(i,t,e=2,n="abbr"){return Sc(i,t.value,t.unit,e,n)}function Mn(i,t,e,n=Dr,s=!0){return fc(i.value,i.unit,i.rotationType,t,e,n,s)}function rr(i,t,e,n,s="abbr"){switch(n=n??2,e){case"imperial":return Bp(i,t,n,s);case"metric":return Up(i,t,n,s);default:return go(i,t,e,n,s)}}function Xp(i,t,e,n=2,s="abbr"){switch(e){case"imperial":return qp(i,t,n,s);case"metric":return Hp(i,t,n,s);default:return Ua(i,t,e,n,s)}}function Kp(i,t,e,n=2,s="abbr"){switch(e){case"imperial":return Yp(i,t,n,s);case"metric":return Np(i,t,n,s);default:return go(i,t,e,n,s)}}function Qp(i,t,e,n=2,s="abbr"){switch(e){case"imperial":return Wp(i,t,n,s);case"metric":return Fp(i,t,n,s);default:return Ua(i,t,e,n,s)}}function Jp(i,t,e,n=2,s="abbr"){switch(e){case"imperial":return jp(i,t,n,s);case"metric":return Zp(i,t,n,s);default:return go(i,t,e,n,s)}}const Pn=1,Ha=6;function td(i,t){return{angleRelative:ed,direction:id,directionRelative:nd,directionRelativeBilateral:sd,latitudeDecimalDegrees:rd,longitudeDecimalDegrees:od,area:(e,n)=>Jp(i,e,n??t.area),length:(e,n,s)=>rr(i,e,n??t.length,s),lengthRelative:(e,n)=>Xp(i,e,n??t.length),totalLength:(e,n)=>rr(i,e,n??t.length),verticalLength:(e,n)=>Kp(i,e,n??t.verticalLength),verticalLengthRelative:(e,n)=>Qp(i,e,n??t.verticalLength),percentage:cd,scalar:Za,scale:hd}}function ed(i){return Ci(i,{signDisplay:"exceptZero",...mo(Pn)})}function id(i){return Mn(i,i.rotationType,Pn)}function nd(i){const t=Pt(i);return Ci(t,{style:"unit",unitDisplay:"narrow",unit:"degree",signDisplay:t>0?"never":"exceptZero",...mo(Pn)})}function sd(i){return Mn(i,i.rotationType,Pn)}function od(i){return Na(i,Ya)}function rd(i){return Na(i,Wa)}function ad(i){return Fa(i,Ya)}function ld(i){return Fa(i,Wa)}function Na(i,t){const n="geographic";return Mn(te(i,"degrees"),n,Ha,t,!1)}function Fa(i,t){const n=t.normalize(te(i,"degrees").value,void 0,!1);return Za(Kt(n),Ha)}function cd(i){return Ci(i.value,{style:"percent"})}function hd(i){return Ci(i,{style:"percent",maximumFractionDigits:0})}function Za(i,t){return Ci(i.value,mo(t))}function mo(i){return{minimumFractionDigits:i,maximumFractionDigits:i}}function be({createQuantity:i,sanitize:t}){return(e,n)=>{if(e==null)return null;t&&(e=t(e));const s=Fe(e);return s==null?null:i(s,n)}}function Ba(i){return i.replaceAll(/[*^~°º]/g,"")}const ud=i=>{let t=`[-+]?[0-9${i.thousands}]+`;return i.decimal!==""&&(t+=`${i.decimal}[0-9]+`),new RegExp(`^(${t}\\s*)${i.separator}(\\s*${t})$`,"i")},pd=" ",qa=[];for(const i of[",","\\|","\\s+"])for(const t of["\\.",",",""])for(const e of["",",","\\.",pd,"\\s+"])i!==t&&i!==e&&t!==e&&qa.push({separator:i,decimal:t,thousands:e,pattern:ud({decimal:t,thousands:e,separator:i})});function dd(i){for(const{decimal:t,thousands:e,pattern:n}of qa){n.lastIndex=0;const s=i.match(n);if(!s)continue;const o=Fe(ar(s[1],t,e)),r=Fe(ar(s[2],t,e));if(o!=null&&r!=null)return{x:Kt(o),y:Kt(r)}}return null}function ar(i,t,e){let n=i.replaceAll(/[\s+]/g,"");return e!==""&&(n=n.replaceAll(e,"")),t!==""&&(n=n.replaceAll(t,".")),n}function fd(i){if(!i||Fe(i)!=null||!io())return null;const t=Ei(i),e=Ke(t==null?void 0:t.latitude),n=Ke(t==null?void 0:t.longitude);return n!=null&&e!=null?{latitude:e,longitude:n}:null}function gd(i){return Ke(lu(i))}function md(i){return Ke(cu(i))}function Ke(i){return i!=null?Dt(i,"degrees","geographic"):null}const Ya=new Fs(-180,180),Wa=new Fs(-90,90),jn=Symbol("dragHandles");let E=class extends ki{constructor(){super(...arguments),this._focusAbortController=new AbortController,this._transitionInfo=null,this._mode="feedback",this._getFormatters=_s(td),this._onHeaderPointerDown=t=>{var n;const e=t.target;e instanceof HTMLElement&&((n=e==null?void 0:e.tagName)==null?void 0:n.toLowerCase())!=="calcite-button"&&(this.removeHandles(jn),e.setPointerCapture(t.pointerId),this.tooltip.onDragStart(t.clientX,t.clientY),this.addHandles([fi(e,"pointermove",({clientX:s,clientY:o})=>{this.tooltip.onDrag(s,o)}),fi(e,["pointerup","pointercancel"],s=>{this.removeHandles(jn),e.releasePointerCapture(t.pointerId),this.tooltip.onDragEnd()}),fi(e,"touchstart",s=>s.preventDefault())],jn))},this._onDiscard=()=>{this.destroyed||(this.tooltip.emit("discard"),this.info.clearInputValues(),this.exitInputMode())},this._onCommit=(t,e)=>{if(this.destroyed)return;if(this.tooltip.emit("commit",{type:e}),e==="commit-and-exit")return void this.exitInputMode();if(e==="commit-on-blur")return;const n=this._getFocusableElements(),s=n.length,o=n.indexOf(t);if(o===-1)return void this.exitInputMode();const r=((o+(e==="commit-and-next"?1:-1))%s+s)%s;Zi(n.at(r))},this._onKeyDown=t=>{switch(t.code){case Ue.next:return this._onNextKey(t);case Ue.discard:return t.stopPropagation(),this._onDiscard()}}}get mode(){return this._mode}get _displayUnits(){const{displayUnits:t}=this.info.sketchOptions.values,e=or(this.tooltip.view);return{length:t.length??e,verticalLength:t.verticalLength??e,area:t.area??e}}get _inputUnitInfos(){const t=this._messagesUnits,e=c=>({unit:c,abbreviation:Rc(t,c,"abbr")}),{inputUnits:n}=this.info.sketchOptions.values,s=or(this.tooltip.view),o=n.length??s,r=n.verticalLength??s,l=n.area??s;return{length:e(Vc(o)),verticalLength:e(Ac(r)),area:e(Oc(l)),angle:e("degrees")}}get _formatters(){return this._getFormatters(this._messagesUnits,this._displayUnits)}get fieldContext(){return{formatters:this._formatters,inputUnitInfos:this._inputUnitInfos,messages:this._messagesTooltip,sketchOptions:this.info.sketchOptions,onCommit:this._onCommit,onDiscard:this._onDiscard}}render(){const{visibleElements:t}=this.info.sketchOptions.tooltips,e=this._renderedContent,n=this._renderedActions,s=this._renderedHelpMessage,o=e.length>0,r=o||!!s,l=this.mode==="input";return v("div",{class:Mc(Cp,l&&Rp),onkeydown:this._onKeyDown,tabIndex:-1},l&&r&&t.header?v("div",{class:Vp,"data-testid":"tooltip-header",key:"header",onpointerdown:this._onHeaderPointerDown},v("calcite-button",{appearance:"transparent","data-testid":"tooltip-back-button",iconFlipRtl:"both",iconStart:"chevron-left",key:"discard-button",kind:"neutral",onclick:this._onDiscard,scale:"s",tabIndex:-1}),n.length>0?v(wt,null,v("div",{class:Ap,key:"spacer"}),v("div",{class:sr,key:"actions"},n)):null):null,o?v("div",{class:Op,key:"content"},...e):null,s)}destroy(){var t;this._focusAbortController.abort(),(t=this._transitionInfo)==null||t.transition.skipTransition()}_renderActions(){return null}loadDependencies(){return Bs({button:()=>Et(()=>import("./index-15e9522c.js"),["assets/index-15e9522c.js","assets/customElement-0e166f14.js","assets/index-c2b82012.js","assets/index-c76e6b87.css","assets/guid-292ce05e.js","assets/useT9n-02df561a.js","assets/customElement-12caf69a.js","assets/dom-a9dae031.js","assets/observers-059762d5.js","assets/ref-221d3061.js","assets/static-e2349cae.js","assets/form-929bbc09.js","assets/interactive-48dbdf77.js","assets/label-179a953e.js","assets/loadable-e4285dcc.js","assets/component-c50b2e81.js"]),icon:()=>Et(()=>import("./index-a556ab14.js"),["assets/index-a556ab14.js","assets/customElement-12caf69a.js","assets/index-c2b82012.js","assets/index-c76e6b87.css","assets/dom-a9dae031.js","assets/observers-059762d5.js"]),input:()=>Et(()=>import("./index-390f2e12.js"),["assets/index-390f2e12.js","assets/customElement-12caf69a.js","assets/index-c2b82012.js","assets/index-c76e6b87.css","assets/dom-a9dae031.js","assets/observers-059762d5.js","assets/customElement-2155d173.js","assets/customElement-2aa70c2f.js","assets/ref-221d3061.js","assets/keyed-46da301f.js","assets/static-e2349cae.js","assets/form-929bbc09.js","assets/interactive-48dbdf77.js","assets/key-a897e5ad.js","assets/label-179a953e.js","assets/loadable-e4285dcc.js","assets/component-c50b2e81.js","assets/useT9n-02df561a.js"])})}async enterInputMode(t,e){try{await this._transitionTo("input",e),await this._focusField(t)}catch(n){Co(n)}}async exitInputMode({focusOnView:t=!0}={}){var e;try{const{container:n,info:s}=this;s.clearInputValues();const o=t?(e=n==null?void 0:n.closest(".esri-view"))==null?void 0:e.querySelector(".esri-view-surface"):null;await this._transitionTo("feedback"),o instanceof HTMLElement&&o.focus()}catch(n){Co(n)}}_onNextKey(t){const e=this._getFocusableElements(),n=e.at(0),s=e.at(-1);n&&s&&(t.shiftKey?document.activeElement===n&&(t.preventDefault(),t.stopPropagation(),Zi(s)):document.activeElement===s&&(t.preventDefault(),t.stopPropagation(),Zi(n)))}get _renderedContent(){return lr(this._renderContent())}get _renderedActions(){return lr(this._renderActions())}get _renderedHelpMessage(){const{sketchOptions:t,visibleElements:e}=this.info;if(!e.helpMessage)return null;const n=t.tooltips.helpMessage??this._defaultHelpMessage;if(!n)return null;const s=t.tooltips.helpMessageIcon??"information";return v("div",{class:Ip,key:"help-message"},s?v("calcite-icon",{class:Dp,icon:s,scale:"s"}):null,v("div",{class:Lp},n))}get _defaultHelpMessage(){var s,o,r;const{helpMessage:t,viewType:e}=this.info;if(t==null)return null;const n=e==="3d"?"helpMessages3d":"helpMessages2d";return(r=(o=(s=this._messagesTooltip)==null?void 0:s.sketch)==null?void 0:o[n])==null?void 0:r[t]}async _focusField(t){var o;(o=this._focusAbortController)==null||o.abort(),this._focusAbortController=new AbortController;const{signal:e}=this._focusAbortController;await this._waitForInputs(),Pc(e);const n=this._getFocusableInputs(),s=t?n.find(r=>r.getAttribute("data-field-name")===t):n.at(0);await Zi(s)}async _transitionTo(t,e){var o,r,l;if(this._mode===t&&!this._transitionInfo)return;if(((o=this._transitionInfo)==null?void 0:o.mode)===t)return this._transitionInfo.transition.finished;(r=this._transitionInfo)==null||r.transition.skipTransition();const n=async()=>{this.destroyed||(this._mode=t,await Ro(),this.destroyed||(this.renderNow(),await Ro(),this.destroyed||(e==null||e())))};if(!((l=this.domNode)!=null&&l.firstChild)||!document.startViewTransition||kc())return void await n();this.autoRenderingEnabled=!1;const s=this._transitionInfo={transition:document.startViewTransition(async()=>{this.destroyed||s!==this._transitionInfo||(this.autoRenderingEnabled=!0,await n())}),mode:t};try{await s.transition.finished}finally{s===this._transitionInfo&&(this._transitionInfo=null)}}async _waitForInputs(){const t=()=>{var e;return Array.from(((e=this.domNode)==null?void 0:e.querySelectorAll("calcite-input"))??[])};for(;t().length===0;)await Cc(yd);await Nr()}_getFocusableInputs(){var t;return Array.from(((t=this.domNode)==null?void 0:t.querySelectorAll("calcite-input:not([read-only]):not([disabled])"))??[])}_getFocusableElements(){var e;const t=(e=this.domNode)==null?void 0:e.querySelector(`.${za}`);return[...Array.from((t==null?void 0:t.querySelectorAll(`.${sr} calcite-button:not([disabled])`))??[]),...this._getFocusableInputs()]}};async function Zi(i){await(i==null?void 0:i.setFocus())}function lr(i){return(Array.isArray(i)?i:[i]).flat(10).filter(t=>!!t)}a([os("esri/core/t9n/Units"),h()],E.prototype,"_messagesUnits",void 0),a([os("esri/views/interactive/tooltip/t9n/Tooltip"),h()],E.prototype,"_messagesTooltip",void 0),a([h()],E.prototype,"info",void 0),a([h()],E.prototype,"tooltip",void 0),a([h()],E.prototype,"_mode",void 0),a([h()],E.prototype,"mode",null),a([h()],E.prototype,"_displayUnits",null),a([h()],E.prototype,"_inputUnitInfos",null),a([h()],E.prototype,"_formatters",null),a([h()],E.prototype,"fieldContext",null),a([h()],E.prototype,"_renderedContent",null),a([h()],E.prototype,"_renderedActions",null),a([h()],E.prototype,"_renderedHelpMessage",null),a([h()],E.prototype,"_defaultHelpMessage",null),E=a([x("esri.views.interactive.tooltip.content.TooltipContent")],E);const yd=20;let vs=class extends E{_renderContent(){const{area:t,radius:e,xSize:n,ySize:s,visibleElements:o}=this.info,r=this._messagesTooltip.sketch,l=this._formatters;return v(wt,null,o.radius&&e!=null?v(z,{title:r.radius,value:l.length(e)}):null,o.size&&n!=null&&s!=null?v(z,{title:r.size,value:v(Yt,{left:l.length(n),right:l.length(s)})}):null,o.area?v(z,{title:r.area,value:l.area(t)}):null)}};vs=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawCircle")],vs);const nt=`${J}-editable-field`,tt={base:nt,inputMode:`${nt}--input`,feedbackMode:`${nt}--feedback`,readOnly:`${nt}--read-only`,locked:`${nt}--locked`,title:`${nt}__title`,value:`${nt}__value`,valueContent:`${nt}__value__content`,valueContentReadOnly:`${nt}__value__content--read-only`,lockIcon:`${nt}__lock-icon`,input:`${nt}__input`,inputWrapper:`${nt}__input-wrapper`,inputMessage:`${nt}__input-message`,inputSuffix:`${nt}__input-suffix`,button:`${nt}__button`},Xn={lock:"lock",unlock:"unlock"};let rt=class extends ki{constructor(){super(...arguments),this._input=null,this._lock=null,this._onLockClick=()=>{this.field.toggleLock(this.context)},this._onLockAfterCreate=t=>{this._lock=t},this._onLockAfterRemoved=()=>{this._lock=null},this._onKeyDown=t=>{t.key===Ue.discard&&this.mode==="input"&&this._input&&this.context.onDiscard(this._input)},this._onInputKeyDown=t=>{const e=this._input;if(e)switch(t.key){case Ue.commit:return this.field.onCommit("commit-and-exit",e,this.context);case Ue.next:{t.preventDefault(),t.stopPropagation();const n=t.shiftKey?"commit-and-previous":"commit-and-next";return this.field.onCommit(n,e,this.context)}}},this._onInput=t=>{this.field.onInput(t.currentTarget.value)},this._onInputBlur=t=>{const e=this._input;e&&t.relatedTarget!==this._lock&&this.field.onCommit("commit-on-blur",e,this.context)},this._selectText=()=>{const t=()=>{var e;this._input===document.activeElement&&((e=this._input)==null||e.selectText())};t(),Nr().then(t)},this._onAfterCreate=t=>{this._input=t,t.addEventListener("paste",this._onPaste),t.addEventListener("beforeinput",this._onBeforeInput)},this._onAfterRemoved=t=>{t.removeEventListener("paste",this._onPaste),t.removeEventListener("beforeinput",this._onBeforeInput)},this._onPaste=t=>{var n;const e=(n=t.clipboardData)==null?void 0:n.getData("text");e&&this.field.parse(e,this.context)!=null&&(t.stopPropagation(),this.field.onInput(e))},this._onBeforeInput=t=>{(t.inputType==="historyUndo"||t.inputType==="historyRedo")&&!this.field.dirty&&t.preventDefault()}}initialize(){this.addHandles(U(()=>this._rawDisplayValue,()=>{const{committed:t,inputValue:e}=this.field;t||e||this._input!==document.activeElement||this._selectText()}))}loadDependencies(){return Bs({button:()=>Et(()=>import("./index-15e9522c.js"),["assets/index-15e9522c.js","assets/customElement-0e166f14.js","assets/index-c2b82012.js","assets/index-c76e6b87.css","assets/guid-292ce05e.js","assets/useT9n-02df561a.js","assets/customElement-12caf69a.js","assets/dom-a9dae031.js","assets/observers-059762d5.js","assets/ref-221d3061.js","assets/static-e2349cae.js","assets/form-929bbc09.js","assets/interactive-48dbdf77.js","assets/label-179a953e.js","assets/loadable-e4285dcc.js","assets/component-c50b2e81.js"]),icon:()=>Et(()=>import("./index-a556ab14.js"),["assets/index-a556ab14.js","assets/customElement-12caf69a.js","assets/index-c2b82012.js","assets/index-c76e6b87.css","assets/dom-a9dae031.js","assets/observers-059762d5.js"]),input:()=>Et(()=>import("./index-390f2e12.js"),["assets/index-390f2e12.js","assets/customElement-12caf69a.js","assets/index-c2b82012.js","assets/index-c76e6b87.css","assets/dom-a9dae031.js","assets/observers-059762d5.js","assets/customElement-2155d173.js","assets/customElement-2aa70c2f.js","assets/ref-221d3061.js","assets/keyed-46da301f.js","assets/static-e2349cae.js","assets/form-929bbc09.js","assets/interactive-48dbdf77.js","assets/key-a897e5ad.js","assets/label-179a953e.js","assets/loadable-e4285dcc.js","assets/component-c50b2e81.js","assets/useT9n-02df561a.js"]),"input-message":()=>Et(()=>import("./index-390426c0.js"),["assets/index-390426c0.js","assets/customElement-12caf69a.js","assets/index-c2b82012.js","assets/index-c76e6b87.css","assets/dom-a9dae031.js","assets/observers-059762d5.js","assets/customElement-2155d173.js"])})}render(){const{field:t,mode:e}=this,n=e==="input",{locked:s,readOnly:o}=t;return v("div",{class:this.classes({[tt.base]:!0,[tt.feedbackMode]:e==="feedback",[tt.inputMode]:e==="input",[tt.locked]:s,[tt.readOnly]:o})},v("div",{class:tt.title,key:"title"},this._title),v("div",{class:tt.value,key:"value",onkeydown:this._onKeyDown},n?this._renderValueInputMode():this._renderValueFeedbackMode()))}get _formattedValue(){return this.field.getFormattedValue(this.context)||cr}get _rawDisplayValue(){return this.field.getRawDisplayValue(this.context)}get _suffix(){return this.field.getSuffix(this.context)}get _title(){const{title:t}=this.field;return typeof t=="string"?t:t(this.context)}get _messages(){var t;return((t=this.context)==null?void 0:t.messages.sketch)??{}}_renderValueFeedbackMode(){return v(wt,null,v("div",{class:tt.valueContent,key:"value-feedback"},this._formattedValue),this.field.locked&&this.mode!=="input"?v("calcite-icon",{class:tt.lockIcon,icon:Xn.lock,key:"icon",scale:"s"}):null)}_renderValueInputMode(){return this.field.readOnly?this._renderValueReadOnly():this._renderValueWritable()}_renderValueReadOnly(){return v("div",{class:this.classes(tt.valueContent,tt.valueContentReadOnly),key:"value-read-only"},this._formattedValue)}_renderValueWritable(){const{field:t}=this,e=this._messages,{name:n,invalid:s}=t;return v(wt,null,v("div",{class:tt.inputWrapper,key:"value-input"},v("calcite-input",{afterCreate:this._onAfterCreate,afterRemoved:this._onAfterRemoved,class:tt.input,"data-field-name":n,"data-testid":`tooltip-field-${n}`,key:"input",onblur:this._onInputBlur,onfocus:this._selectText,onkeydown:this._onInputKeyDown,scale:"s",status:s?"invalid":"idle",type:"text",value:this._rawDisplayValue??cr,onCalciteInputInput:this._onInput}),s?v("calcite-input-message",{class:tt.inputMessage,scale:"s",status:"invalid"},e.invalidValue):null),v("div",{class:tt.inputSuffix,key:"suffix"},this._suffix),this._renderedLockButton)}get _renderedLockButton(){const{name:t,locked:e,lockable:n}=this.field;if(!n)return v("div",{key:"no-lock-button"});const s=this._messages,o=e?s.unlockConstraint:s.lockConstraint;return v("calcite-button",{afterCreate:this._onLockAfterCreate,afterRemoved:this._onLockAfterRemoved,alignment:"center",appearance:"transparent",class:tt.button,"data-testid":`tooltip-field-${t}-lock`,iconStart:e?Xn.lock:Xn.unlock,key:"lock-button",kind:"neutral",label:o,onclick:this._onLockClick,scale:"s",tabIndex:-1,title:o})}};a([h()],rt.prototype,"field",void 0),a([h()],rt.prototype,"context",void 0),a([h()],rt.prototype,"mode",void 0),a([h()],rt.prototype,"_input",void 0),a([h()],rt.prototype,"_lock",void 0),a([h()],rt.prototype,"_formattedValue",null),a([h()],rt.prototype,"_rawDisplayValue",null),a([h()],rt.prototype,"_suffix",null),a([h()],rt.prototype,"_title",null),a([h()],rt.prototype,"_messages",null),a([h()],rt.prototype,"_renderedLockButton",null),rt=a([x("esri.views.interactive.tooltip.components.TooltipEditableField")],rt);const cr="—";function ee(i){const t=i.fields.filter(e=>(e==null?void 0:e.visible)===!0);return t.length===0?null:v(wt,null,t.map(e=>v(rt,{context:i.context,field:e,key:e.id,mode:i.mode})))}let bs=class extends E{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:s}=e;return v(ee,{context:t,fields:[s.coordinates?e.effectiveX:void 0,s.coordinates?e.effectiveY:void 0,s.elevation?e.elevation:void 0,s.orientation?e.orientation:void 0,s.scale?e.scale:void 0],mode:n})}};bs=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawMesh")],bs);let xs=class extends E{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{elevation:s,visibleElements:o}=e;return v(ee,{context:t,fields:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0,o.elevation?s:void 0],mode:n})}};xs=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],xs);const Kn={absolute:"absolute-direction",relative:"relative-direction"};let Te=class extends ki{constructor(t){super(t),this.visibleElements={}}render(){return v("div",{class:za},this._isElementVisible("direction")?v(_d,{messages:this.messages,sketchOptions:this.sketchOptions}):null)}loadDependencies(){return Bs({button:()=>Et(()=>import("./index-15e9522c.js"),["assets/index-15e9522c.js","assets/customElement-0e166f14.js","assets/index-c2b82012.js","assets/index-c76e6b87.css","assets/guid-292ce05e.js","assets/useT9n-02df561a.js","assets/customElement-12caf69a.js","assets/dom-a9dae031.js","assets/observers-059762d5.js","assets/ref-221d3061.js","assets/static-e2349cae.js","assets/form-929bbc09.js","assets/interactive-48dbdf77.js","assets/label-179a953e.js","assets/loadable-e4285dcc.js","assets/component-c50b2e81.js"]),dropdown:()=>Et(()=>import("./index-b4bfd23f.js"),["assets/index-b4bfd23f.js","assets/customElement-aa41a154.js","assets/index-c2b82012.js","assets/index-c76e6b87.css","assets/ref-221d3061.js","assets/dom-a9dae031.js","assets/floating-ui-8404cc2c.js","assets/debounce-0dae6e02.js","assets/guid-292ce05e.js","assets/interactive-48dbdf77.js","assets/key-a897e5ad.js","assets/loadable-e4285dcc.js","assets/observers-059762d5.js","assets/openCloseComponent-7a772128.js","assets/dynamicClasses-bc274cfc.js"]),"dropdown-item":()=>Et(()=>import("./index-34c842f8.js"),["assets/index-34c842f8.js","assets/customElement-12caf69a.js","assets/index-c2b82012.js","assets/index-c76e6b87.css","assets/dom-a9dae031.js","assets/observers-059762d5.js","assets/customElement-64c6ef87.js","assets/ref-221d3061.js","assets/loadable-e4285dcc.js","assets/component-c50b2e81.js","assets/interactive-48dbdf77.js","assets/resources6-a6e5996d.js"]),"dropdown-group":()=>Et(()=>import("./index-433b9a87.js"),["assets/index-433b9a87.js","assets/customElement-c110e3e3.js","assets/index-c2b82012.js","assets/index-c76e6b87.css","assets/observers-059762d5.js","assets/resources6-a6e5996d.js"])})}_isElementVisible(t){var e;return((e=this.visibleElements)==null?void 0:e[t])??this.sketchOptions.tooltips.visibleElements[t]}};function _d(i){var r,l,c,u;const{directionMode:t}=i.sketchOptions.values,e=(r=i.messages)==null?void 0:r.sketch,n=(l=e==null?void 0:e.directionModeSelect)==null?void 0:l.title,s="absolute",o="relative";return v("calcite-dropdown",{key:"direction-mode",placement:"bottom-end",scale:"s",widthScale:"s",onCalciteDropdownSelect:p=>{var _,f;const d=(f=(_=p.currentTarget.selectedItems)==null?void 0:_[0])==null?void 0:f.getAttribute("data-mode");i.sketchOptions.values.directionMode=d??"absolute"}},v("calcite-button",{alignment:"end",appearance:"transparent",iconStart:Kn[t],kind:"neutral",label:n,scale:"s",slot:"trigger",title:n}),v("calcite-dropdown-group",{selectionMode:"single"},v("calcite-dropdown-item",{"data-mode":o,"data-testid":"tooltip-direction-mode-relative",iconStart:Kn.relative,key:"relative",selected:t===o},(c=e==null?void 0:e.directionModeSelect)==null?void 0:c.relative),v("calcite-dropdown-item",{"data-mode":s,"data-testid":"tooltip-direction-mode-absolute",iconStart:Kn.absolute,key:"absolute",selected:t===s},(u=e==null?void 0:e.directionModeSelect)==null?void 0:u.absolute)))}a([os("esri/views/interactive/tooltip/t9n/Tooltip"),h()],Te.prototype,"messages",void 0),a([h()],Te.prototype,"sketchOptions",void 0),a([h()],Te.prototype,"visibleElements",void 0),Te=a([x("esri.views.interactive.tooltip.components.DrawHeaderActions")],Te);let ws=class extends E{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{xyMode:s,visibleElements:o}=e;return v(ee,{context:t,fields:[...s==="direction-distance"?[o.direction?e.direction:void 0,o.distance?e.distance:void 0]:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0],o.elevation?e.elevation:void 0,o.area?e.area:void 0],mode:n})}_renderActions(){const{xyMode:t,sketchOptions:e}=this.info;return v(Te,{sketchOptions:e,visibleElements:{direction:t==="direction-distance"}})}};ws=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],ws);let $s=class extends E{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{xyMode:s,visibleElements:o}=e;return v(ee,{context:t,fields:[...s==="direction-distance"?[o.direction?e.direction:void 0,o.distance?e.distance:void 0]:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0],o.elevation?e.elevation:void 0,o.totalLength?e.totalLength:void 0],mode:n})}_renderActions(){const{xyMode:t,sketchOptions:e}=this.info;return v(Te,{sketchOptions:e,visibleElements:{direction:t==="direction-distance"}})}};$s=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],$s);let Ts=class extends E{_renderContent(){const{area:t,xSize:e,ySize:n,visibleElements:s}=this.info,o=this._messagesTooltip.sketch,r=this._formatters;return v(wt,null,s.size&&e!=null&&n!=null?v(z,{title:o.size,value:v(Yt,{left:r.length(e),right:r.length(n)})}):null,s.area?v(z,{title:o.area,value:r.area(t)}):null)}};Ts=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawRectangle")],Ts);let Es=class extends E{_renderContent(){const{angle:t,visibleElements:e}=this.info,n=this._messagesTooltip.sketch;return v(wt,null,e.rotation?v(z,{title:n.rotation,value:this._formatters.angleRelative(t)}):null)}};Es=a([x("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],Es);let Ss=class extends E{_renderContent(){const t=this.info,{visibleElements:e}=t,n=this._messagesTooltip.sketch,s=this._formatters;return v(wt,null,e.size?v(z,{title:n.size,value:v(Yt,{left:s.length(t.xSize),right:s.length(t.ySize)})}):null,e.scale?v(z,{title:n.scale,value:v(Yt,{left:s.scale(t.xScale),right:s.scale(t.yScale)})}):null)}};Ss=a([x("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],Ss);let Ms=class extends E{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:s}=e;return v(ee,{context:t,fields:[s.coordinates?e.effectiveX:void 0,s.coordinates?e.effectiveY:void 0,s.elevation?e.elevation:void 0],mode:n})}};Ms=a([x("esri.views.interactive.tooltip.content.TooltipContentMovePoint")],Ms);let Ps=class extends E{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:s}=e;return v(ee,{context:t,fields:[s.distance?e.distance:void 0,s.area?e.area:void 0,s.totalLength?e.totalLength:void 0],mode:n})}};Ps=a([x("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],Ps);let ks=class extends E{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:s}=e;return v(ee,{context:t,fields:[s.coordinates?e.effectiveX:void 0,s.coordinates?e.effectiveY:void 0,s.elevation?e.elevation:void 0,s.area&&e.geometryType==="polygon"?e.area:null,s.totalLength&&e.geometryType==="polyline"?e.totalLength:null],mode:n})}};ks=a([x("esri.views.interactive.tooltip.content.TooltipContentSelectedVertex")],ks);let Cs=class extends E{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:s}=e;return v(ee,{context:t,fields:[s.coordinates?e.effectiveX:void 0,s.coordinates?e.effectiveY:void 0,s.elevation?e.elevation:void 0,s.orientation?e.orientation:void 0,s.scale?e.scale:void 0],mode:n})}};Cs=a([x("esri.views.interactive.tooltip.content.TooltipContentTransformMesh")],Cs);let Rs=class extends E{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:s}=e;return v(ee,{context:t,fields:[s.coordinates?e.effectiveX:void 0,s.coordinates?e.effectiveY:void 0,s.elevation?e.elevation:void 0,s.orientation?e.orientation:void 0,s.size?e.size:void 0],mode:n})}};Rs=a([x("esri.views.interactive.tooltip.content.TooltipContentTransformPoint")],Rs);let Vs=class extends E{_renderContent(){const{info:t}=this,{visibleElements:e}=t,n=this._messagesTooltip.sketch,s=this._formatters;return v(wt,null,e.distance?v(z,{title:n.distance,value:s.length(t.distance)}):null)}};Vs=a([x("esri.views.interactive.tooltip.content.TooltipContentTranslate")],Vs);let As=class extends E{_renderContent(){const{distance:t,elevation:e,area:n,totalLength:s,visibleElements:o}=this.info,r=this._messagesTooltip.sketch,l=this._formatters;return v(wt,null,o.distance?v(z,{title:r.distance,value:l.length(t)}):null,o.elevation&&(e==null?void 0:e.actual)!=null?v(z,{title:r.elevation,value:l.verticalLength(e.actual)}):null,o.area&&n!=null?v(z,{title:r.area,value:l.area(n)}):null,o.totalLength&&s!=null?v(z,{title:r.totalLength,value:l.length(s)}):null)}};As=a([x("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],As);let Os=class extends E{_renderContent(){const{info:t}=this,{visibleElements:e}=t,n=this._messagesTooltip.sketch,s=this._formatters;return v(wt,null,e.distance?v(z,{title:n.distance,value:s.length(t.distance)}):null)}};Os=a([x("esri.views.interactive.tooltip.content.TooltipContentTranslateXY")],Os);let Is=class extends E{_renderContent(){const{info:t}=this,{visibleElements:e}=t,n=this._messagesTooltip.sketch;return v(wt,null,e.distance?v(z,{title:n.distance,value:this._formatters.verticalLengthRelative(t.distance)}):null)}};Is=a([x("esri.views.interactive.tooltip.content.TooltipContentTranslateZ")],Is);function vd(i,t){if(t==null)return null;const e=document.createElement("div");switch(t.type){case"draw-point":return new xs({tooltip:i,info:t,container:e});case"draw-polygon":return new ws({tooltip:i,info:t,container:e});case"draw-polyline":return new $s({tooltip:i,info:t,container:e});case"draw-mesh":return new bs({tooltip:i,info:t,container:e});case"draw-rectangle":return new Ts({tooltip:i,info:t,container:e});case"draw-circle":return new vs({tooltip:i,info:t,container:e});case"extent-rotate":return new Es({tooltip:i,info:t,container:e});case"extent-scale":return new Ss({tooltip:i,info:t,container:e});case"move-point":return new Ms({tooltip:i,info:t,container:e});case"selected-vertex":return new ks({tooltip:i,info:t,container:e});case"transform-point":return new Rs({tooltip:i,info:t,container:e});case"transform-mesh":return new Cs({tooltip:i,info:t,container:e});case"translate":return new Vs({tooltip:i,info:t,container:e});case"translate-vertex":return new As({tooltip:i,info:t,container:e});case"translate-z":return new Is({tooltip:i,info:t,container:e});case"translate-xy":return new Os({tooltip:i,info:t,container:e});case"reshape-edge-offset":return new Ps({tooltip:i,info:t,container:e})}}const ci={base:`${J}`,ltr:`${J}--ltr`,rtl:`${J}--rtl`,debug:`${J}--debug`},bd=20,xd=16,wd="bottom-end";let F=class extends ke.EventedAccessor{constructor(t){super(t),this.info=null,this.options=null,this.position=null,this.content=null,this._focused=!1,this.outerContainer=document.createElement("div"),this.debug=!1,this._lastPosition=null,this._rtl=!1,this._prevXY=[0,0]}initialize(){const{outerContainer:t}=this;this.addHandles([U(()=>{var e;return(e=this.view.overlay)==null?void 0:e.surface},e=>{t.remove(),e==null||e.appendChild(t),this._rtl=Ic(e)},Pe),U(()=>this.info,(e,n)=>{if(this.content!=null&&e!=null&&n!=null&&e.type===n.type)this.content.info=e;else{ft(this.content);const s=vd(this,e);s?(this.content=s,s.container&&t.appendChild(s.container),this.exitInputMode()):this.content=null}},Pe),U(()=>({container:this.outerContainer,style:this._outerContainerStyle}),({container:e,style:n})=>{Object.assign(e.style,n)},rs),U(()=>({outerContainer:this.outerContainer,placement:this.effectivePlacement,effectiveOffset:this._effectiveOffset,rtl:this._rtl,debug:this.debug}),({outerContainer:e,placement:n,effectiveOffset:s,rtl:o,debug:r})=>{const{classList:l}=e;l.add(ci.base),l.toggle(ci.rtl,o),l.toggle(ci.ltr,!o),l.toggle(ci.debug,r),this.outerContainer.style.setProperty("--offset",`${s}px`),Lc(e),Ed(e,n)},rs),Dc(()=>this.mode==="feedback",()=>{this.position=null,this._clearOverride("effectivePlacement")},qs),fi(this.outerContainer,"paste",e=>{this.emit("paste",e)}),fi(this.outerContainer,["focusin","focusout"],()=>{setTimeout(()=>{var e,n;this._focused=((n=(e=this.content)==null?void 0:e.container)==null?void 0:n.contains(document.activeElement))??!1})})])}destroy(){this.info=null,this.content=ft(this.content),this.outerContainer.remove()}get mode(){var t;return((t=this.content)==null?void 0:t.mode)??"feedback"}get focused(){return this._focused}get visible(){return this._outerContainerStyle.display!=="none"}get contentContainer(){var t;return(t=this.content)==null?void 0:t.container}get effectivePlacement(){var e;const t=(e=this.options)==null?void 0:e.placement;return t==="auto"?"bottom-end":t??wd}get _screenPoint(){const{inputManager:t}=this.view;return t!=null&&t.multiTouchActive?null:t==null?void 0:t.latestPointerLocation}get _effectiveOffset(){var t;return((t=this.options)==null?void 0:t.offset)??bd}get _outerContainerStyle(){const t=this.position??this._screenPoint;return this._lastPosition=Vo(t),t!=null&&this.content!=null?{display:"block",transform:`translate(${Math.round(t.x)}px, ${Math.round(t.y)}px)`}:{display:"none",transform:"none"}}clear(){this.info=null}async enterInputMode(t){var r;const e=this.position??this._lastPosition??this._screenPoint,n=this.position=Vo(e),{effectivePlacement:s}=this;this._override("effectivePlacement",s);const o=()=>{n&&(this.position=$d(this.contentContainer,n,this._effectiveOffset,this.view),Object.assign(this.outerContainer.style,this._outerContainerStyle))};await((r=this.content)==null?void 0:r.enterInputMode(t,o))}async exitInputMode(t){var e;await((e=this.content)==null?void 0:e.exitInputMode(t))}onDragStart(t,e){this._prevXY=[t,e]}onDrag(t,e){const n=t-this._prevXY[0],s=e-this._prevXY[1];this._prevXY=[t,e];const{position:o}=this;if(o){const{view:r}=this,l=t-r.position[0],c=e-r.position[1];if(l<0||l>r.width||c<0||c>r.height-xd)return;this.position=Ys(o.x+n,o.y+s)}}onDragEnd(){this._prevXY=[0,0]}};function $d(i,t,e,n){if(!i||!n.container)return t;const s=i.getBoundingClientRect(),{left:o,top:r}=n.container.getBoundingClientRect();let{x:l,y:c}=t;const u=s.left-o-e;u<0&&(l-=u);const p=s.right-o+e-n.width;p>0&&(l-=p);const d=s.top-r-e;d<0&&(c-=d);const _=s.bottom-r+e-n.height;return _>0&&(c-=_),Ys(l,c)}a([h({nonNullable:!0})],F.prototype,"view",void 0),a([h()],F.prototype,"info",void 0),a([h()],F.prototype,"options",void 0),a([h()],F.prototype,"position",void 0),a([h()],F.prototype,"content",void 0),a([h({readOnly:!0})],F.prototype,"mode",null),a([h()],F.prototype,"_focused",void 0),a([h({readOnly:!0})],F.prototype,"focused",null),a([h({readOnly:!0})],F.prototype,"outerContainer",void 0),a([h({readOnly:!0})],F.prototype,"contentContainer",null),a([h({readOnly:!0})],F.prototype,"effectivePlacement",null),a([h()],F.prototype,"debug",void 0),a([h()],F.prototype,"_lastPosition",void 0),a([h()],F.prototype,"_screenPoint",null),a([h()],F.prototype,"_rtl",void 0),a([h()],F.prototype,"_effectiveOffset",null),a([h()],F.prototype,"_outerContainerStyle",null),F=a([x("esri.views.interactive.Tooltip")],F);const Td=["top","bottom","leading","trailing"].flatMap(i=>[Ji(`${i}-start`),Ji(i),Ji(`${i}-end`)]);function Ji(i){return`${ci.base}--${i}`}function Ed({classList:i},t){Td.forEach(e=>i.remove(e)),i.add(Ji(t))}const Sd=F;function Md(i){const t=new Sd(i());return t.addHandles(U(()=>i(),({view:e,options:n,info:s})=>{t.view=e,n!==void 0&&(t.options=n),s!==void 0&&(t.info=s)})),t}function Pd(i,t){const e=Uh(t.vertexSpace),{scale:n,orientation:s}=i,{transform:o}=t,r=kd(o);e&&r!=null?(s.actual=Dt(r,"degrees","arithmetic"),s.visible=!0):(s.actual=null,s.visible=!1),e?(n.actual=Kt(Vd(o)),n.visible=!0):(n.actual=null,n.visible=!1)}function kd(i){if(!i)return 0;const t=Cd(i.rotationAxis);return t!=null?t*i.rotationAngle:null}function Cd(i){return qe(i,Ns)?1:qe(i,Rd)?-1:null}const Rd=as(g(),Ns);function Vd(i){return i?Math.max(...i.scale):1}function Ad(i,t){return!(i.type!=="key-down"||i.key!==Ue.enterInputMode||!t||!Od(t.info))&&(t.enterInputMode(),i.preventDefault(),i.stopPropagation(),!0)}function Od(i){const t=i==null?void 0:i.sketchOptions;if(!t)return!1;const{inputEnabled:e,visibleElements:n}=t.tooltips;return e&&i.editableFields.some(({name:s})=>s==="x"||s==="y"?n.coordinates:n[s])===!0}function Id(i,t,e){var o;if(!t||!("geographic"in t))return;const n=(o=i.clipboardData)==null?void 0:o.getData("text");if(!n)return;const s=r=>{i.stopPropagation(),i.preventDefault(),e==null||e.onBeforePaste(),r(),e==null||e.onAfterPaste()};if(t.geographic){const r=fd(n);r&&s(()=>{t.longitude.applyValue(r.longitude),t.latitude.applyValue(r.latitude)})}else{const r=dd(n);r&&s(()=>{t.x.applyValue(r.x),t.y.applyValue(r.y)})}}let at=class extends it{constructor(t){super(t),this.helpMessage=void 0,this.viewType=void 0}get visibleElements(){return this.sketchOptions.tooltips.visibleElements}get allFields(){return[]}get editableFields(){return this.allFields.filter(t=>t.visible&&!t.readOnly)}clearInputValues(){this.allFields.forEach(t=>t.clearInputValue())}};a([h()],at.prototype,"sketchOptions",void 0),a([h()],at.prototype,"visibleElements",null),a([h()],at.prototype,"helpMessage",void 0),a([h()],at.prototype,"viewType",void 0),a([h()],at.prototype,"allFields",null),a([h()],at.prototype,"editableFields",null),at=a([x("esri.views.interactive.tooltip.infos.SketchTooltipInfo")],at);let Zt=class extends at{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=Ye}get allFields(){return[]}};a([h()],Zt.prototype,"type",void 0),a([h()],Zt.prototype,"radius",void 0),a([h()],Zt.prototype,"xSize",void 0),a([h()],Zt.prototype,"ySize",void 0),a([h()],Zt.prototype,"area",void 0),a([h()],Zt.prototype,"allFields",null),Zt=a([x("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],Zt);let M=class extends it{constructor(t){super(t),this.actual=null,this.lockable=!0,this.id=Gc(),this.inputValue=null,this.readOnly=!1,this.suffix=null,this.visible=!0,this.invalid=!1,this.unlockOnVertexPlacement=!0}get committed(){return this.lockable?this._get("committed"):null}set committed(t){this.lockable&&this._set("committed",t)}get dirty(){return this.inputValue!=null}get locked(){return this.lockable&&this.committed!=null}onInput(t){this.inputValue=t,this.invalid=!1}onCommit(t,e,n){this.lockable?this._onCommitLockable(t,n):this._onCommitNonLockable(n),this.invalid&&t==="commit-and-exit"||n.onCommit(e,t)}_onCommitLockable(t,e){const{inputValue:n,locked:s}=this;s&&Bi(n)?this.unlock():(t==="commit-and-exit"&&!s||n!=null)&&this._parseInputAndLock(e)}_onCommitNonLockable(t){const{inputValue:e}=this;Bi(e)?this.lockable?this.setActual(null):this.clearInputValue():e!=null&&this._parseInputAndSetActual(t)}applyValue(t){this.lockable?this.lock(t):this.setActual(t)}clearInputValue(){this.inputValue=null,this.invalid=!1}setActual(t){this.actual=t,this.clearInputValue()}lock(t){this.lockable&&(this.committed=t??this.actual,this.clearInputValue())}unlock(){this.lockable&&(this.committed=null,this.clearInputValue())}toggleLock(t){this.lockable&&(this.locked?this.unlock():this._parseInputAndLock(t))}getSuffix(t){const{suffix:e}=this;return typeof e=="function"?e(t):e}getFormattedValue(t){const{actual:e,committed:n,format:s}=this;return n!=null?s(n,t):e!=null?s(e,t):null}getRawDisplayValue(t){const{actual:e,committed:n,inputValue:s}=this;return s??(this.lockable&&n!=null?this.formatForInputMode(n,t):e!=null?this.formatForInputMode(e,t):null)}_parseInputAndSetActual(t){const{inputValue:e}=this;if(e==null||Bi(e))return this.setActual(null);const n=this.parse(e,t);n!=null?this.setActual(n):this.invalid=!0}_parseInputAndLock(t){const{inputValue:e,actual:n}=this;if(Bi(e))return this.unlock();if(e==null)return this.lock(n);const s=this.parse(e,t);s!=null?this.lock(s):this.invalid=!0}};function Bi(i){return i!=null&&i.trim()===""}a([h()],M.prototype,"actual",void 0),a([h()],M.prototype,"committed",null),a([h()],M.prototype,"dirty",null),a([h()],M.prototype,"format",void 0),a([h()],M.prototype,"formatForInputMode",void 0),a([h()],M.prototype,"lockable",void 0),a([h()],M.prototype,"locked",null),a([h()],M.prototype,"id",void 0),a([h()],M.prototype,"inputValue",void 0),a([h()],M.prototype,"name",void 0),a([h()],M.prototype,"parse",void 0),a([h()],M.prototype,"readOnly",void 0),a([h()],M.prototype,"suffix",void 0),a([h()],M.prototype,"title",void 0),a([h()],M.prototype,"visible",void 0),a([h()],M.prototype,"invalid",void 0),a([h()],M.prototype,"unlockOnVertexPlacement",void 0),M=a([x("esri.views.interactive.tooltip.fields.TooltipField")],M);let tn=class extends M{constructor(t){super(t),this.showAsZ=!1}normalizeCtorArgs(t){const e=n=>n.inputUnitInfos.verticalLength.unit;return{name:"elevation",actual:Qt,parse:be({createQuantity:(n,s)=>gt(n,e(s))}),format:(n,s)=>s.formatters.verticalLength(n),formatForInputMode:(n,s)=>s.formatters.scalar(te(n,e(s))),suffix:n=>n.inputUnitInfos.verticalLength.abbreviation,title:n=>n.messages.sketch[this.showAsZ?"z":"elevation"],unlockOnVertexPlacement:!1,...t}}};a([h()],tn.prototype,"showAsZ",void 0),tn=a([x("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],tn);let en=class extends M{constructor(t){super(t),this.precision=1}normalizeCtorArgs(t){const e=n=>n.inputUnitInfos.angle.unit;return{name:"orientation",actual:null,parse:be({createQuantity:(n,s)=>Dt(n,e(s),"geographic"),sanitize:Ba}),format:n=>{const s=ms(n);return Mn(s,"geographic",this.precision)},formatForInputMode:(n,s)=>{const o=ms(n);return s.formatters.scalar(o)},suffix:n=>n.inputUnitInfos.angle.abbreviation,title:n=>n.messages.sketch.orientation,...t}}};a([h()],en.prototype,"precision",void 0),en=a([x("esri.views.interactive.tooltip.fields.TooltipFieldOrientation")],en);let Qn=class extends M{constructor(t){super(t),this.precision=null}normalizeCtorArgs(t){const e=n=>n.inputUnitInfos.length.unit;return{name:"size",actual:null,parse:be({createQuantity:(n,s)=>gt(n,e(s))}),format:(n,s)=>s.formatters.length(n),formatForInputMode:(n,s)=>s.formatters.scalar(te(n,e(s))),suffix:n=>n.inputUnitInfos.length.abbreviation,title:n=>n.messages.sketch.size,...t}}};a([h()],Qn.prototype,"precision",void 0),Qn=a([x("esri.views.interactive.tooltip.fields.TooltipFieldSize")],Qn);function ja(i){const t=n=>n.inputUnitInfos.angle.unit,e=n=>n.sketchOptions.values.effectiveDirectionMode;return new M({name:"direction",actual:Ws,parse:be({createQuantity:(n,s)=>Dt(n,t(s),"geographic"),sanitize:Ba}),format:(n,s)=>{const o=e(s),r=un(n,o);switch(o){case A.Absolute:return s.formatters.direction(r);case A.Relative:return s.formatters.directionRelative(r);case A.RelativeBilateral:return s.formatters.directionRelativeBilateral(r)}},formatForInputMode:(n,s)=>{const o=un(n,e(s));return s.formatters.scalar(te(o,t(s)))},suffix:n=>n.inputUnitInfos.angle.abbreviation,title:n=>{const s=e(n),{absolute:o,relative:r}=n.messages.sketch.direction;switch(s){case A.Absolute:return o;case A.Relative:case A.RelativeBilateral:return r}},...i})}function Xa(i){const t=e=>e.inputUnitInfos.length.unit;return new M({name:"distance",actual:Qt,parse:be({createQuantity:(e,n)=>gt(Math.max(e,0),t(n))}),format:(e,n)=>n.formatters.length(e),formatForInputMode:(e,n)=>n.formatters.scalar(te(e,t(n))),suffix:e=>e.inputUnitInfos.length.abbreviation,title:e=>e.messages.sketch.distance,...i})}function Ld(i){return Xa({format:(t,e)=>e.formatters.totalLength(t),title:t=>t.messages.sketch.totalLength,readOnly:!0,...i})}function Ka(i){return Xa({...i})}function Dd(i){return new tn(i)}function Gd(i){return new en(i)}function zd(i){return yo("scale",{name:"scale",actual:null,parse:be({createQuantity:t=>Kt(Math.abs(t))}),...i})}function Ud(i){const t=e=>e.inputUnitInfos.area.unit;return new M({name:"area",actual:Ye,parse:be({createQuantity:(e,n)=>mn(e,t(n))}),format:(e,n)=>n.formatters.area(e),formatForInputMode:(e,n)=>n.formatters.scalar(te(e,t(n))),suffix:e=>e.inputUnitInfos.area.abbreviation,title:e=>e.messages.sketch.area,readOnly:!0,...i})}function Hd(i){return new M({name:"x",actual:Ws,parse:gd,format:(t,e)=>e.formatters.longitudeDecimalDegrees(t),formatForInputMode:t=>ad(t),suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>t.messages.sketch.longitude,...i})}function Nd(i){return new M({name:"y",actual:Ws,parse:md,format:(t,e)=>e.formatters.latitudeDecimalDegrees(t),formatForInputMode:t=>ld(t),suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>t.messages.sketch.latitude,...i})}function Fd(i){return yo("x",{name:"x",...i})}function Zd(i){return yo("y",{name:"y",...i})}function yo(i,t){return new M({actual:Kt(0),parse:be({createQuantity:e=>Kt(e)}),format:(e,n)=>n.formatters.scalar(e),formatForInputMode:(e,n)=>n.formatters.scalar(e),title:e=>e.messages.sketch[i],...t})}function Bd(i){return ta(i)||js(i)}function _o(i,t,e,...n){return ta(i)?t.apply(void 0,n):js(i)?e.apply(void 0,n):null}const kn=i=>{let t=class extends i{constructor(){super(...arguments),this.longitude=Hd(),this.latitude=Nd(),this.x=Fd(),this.y=Zd(),this.elevation=Dd(),this.geographic=!1}get effectiveX(){return this.geographic?this.longitude:this.x}get effectiveY(){return this.geographic?this.latitude:this.y}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic}}setLocationFromPoint(e,n=e==null?void 0:e.spatialReference){if(this.geographic=!!n&&Bd(n),e==null)return this._setActualLonLat(null,null),void this._setActualXY(null,null);if(this.geographic){const s=zc(e,qd);this._setActualLonLat(Ke(s==null?void 0:s[0]),Ke(s==null?void 0:s[1]))}else this._setActualXY(Kt(e.x),Kt(e.y))}_setActualLonLat(e,n){this.longitude.actual=e,this.latitude.actual=n}_setActualXY(e,n){this.x.actual=e,this.y.actual=n}};return a([h()],t.prototype,"geographic",void 0),a([h()],t.prototype,"effectiveX",null),a([h()],t.prototype,"effectiveY",null),a([h()],t.prototype,"key",null),t=a([x("esri.views.interactive.tooltip.infos.TooltipInfoWithCoordinates")],t),t},qd=[0,0];let hi=class extends kn(at){constructor(t){super(t),this.type="draw-mesh",this.orientation=Gd({lockable:!1}),this.scale=zd({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};a([h()],hi.prototype,"helpMessage",void 0),a([h()],hi.prototype,"allFields",null),hi=a([x("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],hi);let ui=class extends kn(at){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};a([h()],ui.prototype,"helpMessage",void 0),a([h()],ui.prototype,"allFields",null),ui=a([x("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],ui);let Ae=class extends kn(at){constructor(t){super(t),this.type="draw-polygon",this.direction=ja(),this.distance=Ka(),this.area=Ud(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};a([h()],Ae.prototype,"xyMode",void 0),a([h()],Ae.prototype,"helpMessage",void 0),a([h()],Ae.prototype,"allFields",null),Ae=a([x("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],Ae);let Oe=class extends kn(at){constructor(t){super(t),this.type="draw-polyline",this.direction=ja(),this.distance=Ka(),this.totalLength=Ld(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};a([h()],Oe.prototype,"helpMessage",void 0),a([h()],Oe.prototype,"xyMode",void 0),a([h()],Oe.prototype,"allFields",null),Oe=a([x("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],Oe);let re=class extends at{constructor(t){super(t),this.type="draw-rectangle",this.xSize=Qt,this.ySize=Qt,this.area=Ye}get allFields(){return[]}};a([h()],re.prototype,"type",void 0),a([h()],re.prototype,"xSize",void 0),a([h()],re.prototype,"ySize",void 0),a([h()],re.prototype,"area",void 0),a([h()],re.prototype,"allFields",null),re=a([x("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],re);function vo(i){return Uc(i)?Hc(i)||js(i)||Nc(i)||Fc(i)?Fh:i:Zh(i)}function Yd(i,t=Cn()){return Qa(i,t)}function Wd(i,t=Cn()){return Qa(i,t,!1)}function Qa(i,t,e=i.hasZ){const n=vo(i.spatialReference),s=Zc(n);if(s==null)return null;const o=(l,c)=>!(c.length<2)&&(N(l,c[0],c[1],e&&c[2]||0),!0);let r=0;for(const l of i.rings){const c=l.length;if(c<3)continue;const{positionsWorldCoords:u}=t;for(;u.length<c;)u.push(g());const p=jd,d=N(Xd,0,0,0),_=1/c;for(let y=0;y<c;y++){if(!o(p,l[y])||!bt(p,i.spatialReference,u[y],n))return null;G(d,d,u[y],_)}const f=sa(u[0],u[1],d,Vh());if(Or(ze(f))===0)continue;for(let y=0;y<c;y++)Ah(f,d,u[y],u[y]);const m=Kd(u);for(let y=0;y<m.length;y+=3)r+=Nh(u[m[y]],u[m[y+1]],u[m[y+2]])}return mn(r,s)}const jd=g(),Xd=g();function Cn(){return{positionsWorldCoords:[]}}function Kd(i){return Hh(Qd(i),[],2)}function Qd(i){const t=new Float64Array(2*i.length);for(let e=0;e<i.length;++e){const n=i[e],s=2*e;t[s]=n[0],t[s+1]=n[1]}return t}function Jd(i){const{spatialReference:t}=i;return _o(t,tf,ef,i)}function tf(i){return mn(Math.abs(Eh([i],"square-meters")[0]),"square-meters")}function ef(i){try{return mn(Math.abs(kh(i,"square-meters")),"square-meters")}catch{return null}}function nf(i,t,e=Cn()){if(t==="on-the-ground"){const n=Jd(i);return n??Wd(i,e)}return Yd(i,e)}function Ja(i,t=Cn()){return nf(i,"on-the-ground",t)}var Xt;function sf(i){return of(i,Xt.Horizontal)}function of(i,t){const{hasZ:e,spatialReference:n}=i,s=vo(n);let o=0;const r=Zs(s);if(r==null)return null;const l=t===Xt.Direct?lf:el;for(const c of i.paths){if(c.length<2)continue;const u=c.length-1;for(let p=0;p<u;++p){const d=c[p];ce[0]=d[0],ce[1]=d[1],ce[2]=e?d[2]:0;const _=c[p+1];he[0]=_[0],he[1]=_[1],he[2]=e?_[2]:0;const f=l(ce,he,n);if(f==null)return null;o+=f.value}}return gt(o,r)}function rf(i,t){const{spatialReference:e}=i;return Qe(e,t.spatialReference)?(ce[0]=i.x,ce[1]=i.y,ce[2]=i.hasZ?i.z:0,he[0]=t.x,he[1]=t.y,he[2]=t.hasZ?t.z:0,el(ce,he,e)):null}function af(i){return i!=null?tl(i.hasZ?i.z:0,i.spatialReference):null}function tl(i,t){const e=Gr(t);return e!=null?gt(i??0,e):null}function lf(i,t,e){const n=il(i,t,e,Xt.Direct);return n!=null?gt(n.direct,n.unit):null}function el(i,t,e){const n=il(i,t,e,Xt.Horizontal);return n!=null?gt(n.horizontal,n.unit):null}function il(i,t,e,n){const s=vo(e),o=Zs(s);if(o==null)return null;const r=t[2]-i[2];if(n===Xt.Vertical)return{verticalSigned:r,unit:o};if(!bt(i,e,Jn,s)||!bt(t,e,qi,s))return null;if(n===Xt.Direct)return{direct:pe(qi,Jn),unit:o};if(N(Yi,i[0],i[1],t[2]),!bt(Yi,e,Yi,s))return null;const l=pe(Yi,qi);return n===Xt.Horizontal?{horizontal:l,unit:o}:{direct:pe(qi,Jn),horizontal:l,vertical:Math.abs(r),unit:o}}(function(i){i[i.Direct=0]="Direct",i[i.Horizontal=1]="Horizontal",i[i.Vertical=2]="Vertical"})(Xt||(Xt={}));const ce=g(),he=g(),Jn=g(),qi=g(),Yi=g();function cf(i){const{spatialReference:t}=i;return _o(t,ff,gf,i)}function hf(i,t){if(!Qe(i.spatialReference,t.spatialReference))return null;const{spatialReference:e}=i;return Wi[0]=i.x,Wi[1]=i.y,Wi[2]=i.hasZ?i.z:0,ji[0]=t.x,ji[1]=t.y,ji[2]=t.hasZ?t.z:0,uf(Wi,ji,e)}function uf(i,t,e){return _o(e,pf,df,i,t,e)}function pf(i,t,e){return gt(_n(yf,i,t,e).distance,"meters")}function df(i,t,e){return gt(ea(mf(i,t,e),"meters"),"meters")}function ff(i){return gt(Sh([i],"meters")[0],"meters")}function gf(i){return gt(ea(i,"meters"),"meters")}function mf(i,t,e){return{type:"polyline",spatialReference:e,paths:[[[...i],[...t]]]}}const yf=new vn,Wi=g(),ji=g();function _f(i){return cf(i)??sf(i)}function Rn(i,t){return hf(i,t)??rf(i,t)}function vf(i,t){return{point:new ui({sketchOptions:t,viewType:i}),polyline:new Oe({sketchOptions:t,viewType:i}),polygon:new Ae({sketchOptions:t,viewType:i}),mesh:new hi({sketchOptions:t,viewType:i}),rectangle:new re({sketchOptions:t}),circle:new Zt({sketchOptions:t})}}function hr(i){const{directionOptions:t,geometryType:e,sketchOptions:n,tooltipInfos:s}=i,o=l=>{const c=Vn(i).mode,u=s[l].elevation;c==="relative-to-ground"||c==="relative-to-scene"||c==="on-the-ground"?u.lock(xo(i)):u.unlock()},r=l=>{if(t){const c=s[l].direction;c.committed=t.angle,c.unlockOnVertexPlacement=!1,n.values.directionMode=t.mode}};switch(e){case"polygon":case"polyline":o(e),r(e);break;case"point":case"mesh":o(e)}}function bf(i,t){const{drawOperation:e,view:n}=t,s=bo(t),o=Vn(t);if(n.type==="2d"||!i||o.mode!=="absolute-height"||(e==null?void 0:e.numCommittedVertices)!==1||!s||s.type!=="draw-polyline"&&s.type!=="draw-polygon"||s.elevation.locked)return;const[r,l,c]=i,u=Vf(r,l,c,o,t);u!=null&&s.elevation.lock(u)}function ur(i){var t;(t=bo(i))==null||t.allFields.forEach(e=>{e.unlockOnVertexPlacement&&e.unlock()})}function bo({geometryType:i,graphic:t,tooltipInfos:e}){var n;return i==="multipoint"||((n=t==null?void 0:t.geometry)==null?void 0:n.type)!==xf[i]?null:e[i]}const xf={point:"point",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon"};function wf(i,t){switch(i==null?void 0:i.type){case"draw-point":$f(i,t);break;case"draw-polyline":Ef(i,t);break;case"draw-polygon":Sf(i,t);break;case"draw-rectangle":Pf(i,t);break;case"draw-circle":kf(i,t);break;case"draw-mesh":Tf(i,t)}}function $f(i,t){var n;const e=(n=t.graphic)==null?void 0:n.geometry;(e==null?void 0:e.type)==="point"&&(nl(i,e,t),i.helpMessage=no("point",e))}function Tf(i,t){const{graphic:e,view:n}=t,s=e==null?void 0:e.geometry;n.type!=="3d"||s&&s.type!=="mesh"||(nl(i,s==null?void 0:s.origin,t),s&&Pd(i,s),i.helpMessage=wu(e,n))}function nl(i,t,e){const{drawOperation:n,view:s,sketchOptions:o}=e,{cursorVertex:r}=n;if(i.sketchOptions=o,i.viewType=s.type,i.setLocationFromPoint(t,ti(e)),ol(i.elevation,e),!r)return void(n.constraints=void 0);const l=r;n.constraints={context:cl(l,e),x:i.x.committed,y:i.y.committed,longitude:i.longitude.committed,latitude:i.latitude.committed,elevation:i.elevation.committed,distance:null,direction:null}}function Ef(i,t){const{createOperationGeometry:e,drawOperation:n}=t,s=e!=null?e.full:null;s&&s.type!=="polyline"||(sl(i,t),i.totalLength.actual=n.lastVertex?(s?_f(s):null)??Qt:null,i.helpMessage=no("polyline",s))}function Sf(i,t){const{createOperationGeometry:e,drawOperation:n}=t,s=e!=null?e.full:null;s&&s.type!=="polygon"||(sl(i,t),i.area.actual=n.lastVertex?(s?Ja(s):null)??Ye:null,i.helpMessage=no("polygon",s))}function sl(i,t){const{drawOperation:e,sketchOptions:n,view:s}=t,{cursorVertex:o,lastVertex:r,secondToLastVertex:l}=e,c=n.values.effectiveDirectionMode;i.sketchOptions=n,i.viewType=s.type;const u=r&&o?Rn(r,o)??Qt:null;if(i.distance.actual=u,i.distance.readOnly=r==null,i.direction.actual=null,i.direction.readOnly=!0,r&&o&&(c==="absolute"||l)){const _=hp(l,r,o,c);i.direction.actual=_??Bc,i.direction.readOnly=!1}i.setLocationFromPoint(o,ti(t)),ol(i.elevation,t);const p=Mf(r,t);i.xyMode=p,i.direction.visible=p==="direction-distance",i.distance.visible=p==="direction-distance",i.effectiveX.visible=p==="coordinates",i.effectiveY.visible=p==="coordinates";const d=o??r;e.constraints=d?{context:cl(d,t),x:i.x.committed,y:i.y.committed,longitude:i.longitude.committed,latitude:i.latitude.committed,elevation:i.elevation.committed,distance:i.distance.committed,direction:i.direction.committed}:void 0}function Mf(i,{sketchOptions:t}){const e=t.tooltips.xyMode;return e==="auto"?i?"direction-distance":"coordinates":e}function Pf(i,t){i.sketchOptions=t.sketchOptions,i.xSize=al(t),i.ySize=ll(t),i.area=rl(t)}function kf(i,t){const{forceUniformSize:e,sketchOptions:n}=t;i.sketchOptions=n,i.radius=e?Cf(t):null,i.xSize=e?null:al(t),i.ySize=e?null:ll(t),i.area=rl(t)}function ol(i,t){const{drawOperation:e}=t,n=(e==null?void 0:e.cursorVertex)??(e==null?void 0:e.lastVertex);i.actual=af(n)??xo(t),i.visible=e.hasZ,i.readOnly=!1,i.showAsZ=!0}function rl(i){var e;const t=(e=i.createOperationGeometry)==null?void 0:e.full;return(t==null?void 0:t.type)!=="polygon"?Ye:Ja(t)??Ye}function al(i){var e,n;const t=(n=(e=i.createOperationGeometry)==null?void 0:e.rectangle)==null?void 0:n.midpoints;return(t!=null?Rn(t.left,t.right):null)??Qt}function ll(i){var e,n;const t=(n=(e=i.createOperationGeometry)==null?void 0:e.rectangle)==null?void 0:n.midpoints;return(t!=null?Rn(t.top,t.bottom):null)??Qt}function Cf({createOperationGeometry:i}){var t;return(((t=i==null?void 0:i.circle)==null?void 0:t.center)!=null&&i.circle.edge!=null?Rn(i.circle.center,i.circle.edge):null)??Qt}function Rf(i){const{geometryType:t,tooltipInfos:e}=i;switch(t){case"point":case"mesh":case"polyline":case"polygon":{const n=e[t].elevation.committed;return n?gn(n,"meters")/Hs(ti(i)):void 0}default:return}}function Vf(i,t,e,n,s){const{view:o,drawOperation:r}=s;if(o.type!=="3d"||!r)return;e??(e=0);const l=ti(s),c=Vn(s),u=Jr(o,i,t,e,l,c,n);return tl(u,l)??xo(s)}function Vn(i){return i.drawOperation.elevationInfo??yn}function ti(i){return i.drawOperation.coordinateHelper.spatialReference}function xo(i){const t=Hs(ti(i));return gt(i.defaultZ*t,"meters")}function cl(i,t){return mp(i,t.view,ti(t),Vn(t),t.drawOperation.coordinateHelper.hasZ(),t.sketchOptions.values.effectiveDirectionMode)}var Ee;(function(i){i[i.WhenToolEditable=0]="WhenToolEditable",i[i.WhenToolNotEditable=1]="WhenToolNotEditable",i[i.Always=2]="Always"})(Ee||(Ee={}));let Af=class{constructor(){this._isToolEditable=!0,this._manipulators=new is,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(t){this._isToolEditable=t}get length(){return this._manipulators.length}add(t,e=Ee.WhenToolEditable){this.addMany([t],e)}addMany(t,e=Ee.WhenToolEditable){for(const n of t){const s={manipulator:n,visibilityPredicate:e,attached:!1};this._manipulators.add(s),this._attached&&this._updateManipulatorAttachment(s)}}remove(t){for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.at(e).manipulator===t){const n=this._manipulators.splice(e,1)[0];this._detachManipulator(n);break}}removeAll(){this._manipulators.forEach(t=>{this._detachManipulator(t)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(t=>{this._updateManipulatorAttachment(t)}),this._attached=!0}detach(){this._manipulators.forEach(t=>{this._detachManipulator(t)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:t})=>t.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(t,e){return this._manipulators.on(t,n=>{e(n)})}forEach(t){for(const e of this._manipulators.items)t(e)}some(t){return this._manipulators.items.some(t)}toArray(){const t=[];return this.forEach(e=>t.push(e.manipulator)),t}intersect(t,e){let n=null,s=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:o,attached:r})=>{if(!r||!o.interactive)return;const l=o.intersectionDistance(t,e);l!=null&&l<s&&(s=l,n=o)}),n}_updateManipulatorAttachment(t){this._isManipulatorItemVisible(t)?this._attachManipulator(t):this._detachManipulator(t)}_attachManipulator(t){t.attached||(t.manipulator.attach&&t.manipulator.attach(this._resourceContexts),t.attached=!0)}_detachManipulator(t){if(!t.attached)return;const e=t.manipulator;e.grabbing=!1,e.dragging=!1,e.hovering=!1,e.selected=!1,e.detach&&e.detach(this._resourceContexts),t.attached=!1}_isManipulatorItemVisible(t){return t.visibilityPredicate===Ee.Always||(this._isToolEditable?t.visibilityPredicate===Ee.WhenToolEditable:t.visibilityPredicate===Ee.WhenToolNotEditable)}},B=class extends it{constructor(t){super(t),this.manipulators=new Af,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[we.MANAGER,!0],[we.USER,!0]]),this._creationFinishedResolver=qc()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(t){this._get("visible")!==t&&(this._set("visible",t),this._syncVisible())}get editable(){return this.getEditableFlag(we.USER)}set editable(t){this.setEditableFlag(we.USER,t)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){this.view!=null&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(t){this.onInputEvent(t)}handleInputEventAfter(t){this.onInputEventAfter(t)}setEditableFlag(t,e){this._editableFlags.set(t,e),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),t===we.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(t){return this._editableFlags.get(t)??!1}endDrag(){const t=this.view.inputManager.latestPointerLocation;if(!t)return;let e=!1;this.manipulators.forEach(({manipulator:n})=>{n.dragging&&(e=!0,n.events.emit("drag",{action:"end",start:t,screenPoint:t}))}),e&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(t){}onInputEventAfter(t){}get internallyEditable(){return this.getEditableFlag(we.USER)&&this.getEditableFlag(we.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};a([h({constructOnly:!0})],B.prototype,"view",void 0),a([h({readOnly:!0})],B.prototype,"active",null),a([h({value:!0})],B.prototype,"visible",null),a([h({value:!0})],B.prototype,"editable",null),a([h({readOnly:!0})],B.prototype,"manipulators",void 0),a([h({readOnly:!0})],B.prototype,"updating",null),a([h()],B.prototype,"cursor",null),a([h({readOnly:!0})],B.prototype,"automaticManipulatorSelection",void 0),a([h()],B.prototype,"hasFocusedManipulators",null),a([h()],B.prototype,"hasGrabbedManipulators",void 0),a([h()],B.prototype,"hasHoveredManipulators",void 0),a([h()],B.prototype,"firstGrabbedManipulator",void 0),a([h({readOnly:!0})],B.prototype,"created",void 0),a([h({readOnly:!0})],B.prototype,"removeIncompleteOnCancel",void 0),B=a([x("esri.views.interactive.InteractiveToolBase")],B);let nn=class extends it{constructor(t){super(t),this.enabled=!1}};a([h({type:Boolean,nonNullable:!0})],nn.prototype,"enabled",void 0),nn=a([x("esri.views.interactive.sketch.SketchLabelOptions")],nn);const An=nn;let mi=class extends it{constructor(t){super(t),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};a([h({type:String,nonNullable:!0})],mi.prototype,"mode",void 0),mi=a([x("esri.views.interactive.sketch.SketchTooltipElevationOptions")],mi);let et=class extends it{constructor(t){super(t),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};a([h({type:Boolean,nonNullable:!0})],et.prototype,"area",void 0),a([h({type:Boolean,nonNullable:!0})],et.prototype,"coordinates",void 0),a([h({type:Boolean,nonNullable:!0})],et.prototype,"direction",void 0),a([h({type:Boolean,nonNullable:!0})],et.prototype,"distance",void 0),a([h({type:Boolean,nonNullable:!0})],et.prototype,"elevation",void 0),a([h({type:Boolean,nonNullable:!0})],et.prototype,"header",void 0),a([h({type:Boolean,nonNullable:!0})],et.prototype,"helpMessage",void 0),a([h({type:Boolean,nonNullable:!0})],et.prototype,"orientation",void 0),a([h({type:Boolean,nonNullable:!0})],et.prototype,"radius",void 0),a([h({type:Boolean,nonNullable:!0})],et.prototype,"rotation",void 0),a([h({type:Boolean,nonNullable:!0})],et.prototype,"scale",void 0),a([h({type:Boolean,nonNullable:!0})],et.prototype,"size",void 0),a([h({type:Boolean,nonNullable:!0})],et.prototype,"totalLength",void 0),et=a([x("esri.views.interactive.sketch.SketchTooltipVisibleElements")],et);const hl=et;let st=class extends it{constructor(t){super(t),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new mi,this.placement="auto",this.offset=null,this.visibleElements=new hl,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};a([h({type:Boolean,nonNullable:!0})],st.prototype,"enabled",void 0),a([h()],st.prototype,"forceEnabled",void 0),a([h()],st.prototype,"effectiveEnabled",null),a([h()],st.prototype,"helpMessage",void 0),a([h()],st.prototype,"helpMessageIcon",void 0),a([h({type:Boolean,nonNullable:!0})],st.prototype,"inputEnabled",void 0),a([h({type:mi,nonNullable:!0})],st.prototype,"elevation",void 0),a([h()],st.prototype,"placement",void 0),a([h()],st.prototype,"offset",void 0),a([h({type:hl,nonNullable:!0})],st.prototype,"visibleElements",void 0),a([h()],st.prototype,"visualVariables",void 0),a([h()],st.prototype,"xyMode",void 0),st=a([x("esri.views.interactive.sketch.SketchTooltipOptions")],st);const ul=st;let Ie=class extends it{constructor(t){super(t),this.length=null,this.verticalLength=null,this.area=null}};a([h()],Ie.prototype,"length",void 0),a([h()],Ie.prototype,"verticalLength",void 0),a([h()],Ie.prototype,"area",void 0),Ie=a([x("esri.views.interactive.sketch.Units")],Ie);const pn=Ie;let ae=class extends it{constructor(t){super(t),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?A.RelativeBilateral:A.Relative;case"absolute":return A.Absolute}}get displayUnits(){return this._get("displayUnits")??new pn}set displayUnits(t){this._set("displayUnits",t)}get inputUnits(){return this._get("inputUnits")??new pn}set inputUnits(t){this._set("inputUnits",t)}};a([h({type:String,nonNullable:!0})],ae.prototype,"directionMode",void 0),a([h({type:Boolean,nonNullable:!0})],ae.prototype,"relativeDirectionIsBilateral",void 0),a([h()],ae.prototype,"effectiveDirectionMode",null),a([h({type:pn,nonNullable:!0})],ae.prototype,"displayUnits",null),a([h({type:pn,nonNullable:!0})],ae.prototype,"inputUnits",null),ae=a([x("esri.views.interactive.sketch.SketchValueOptions")],ae);const pl=ae;let Le=class extends it{constructor(t){super(t),this.labels=new An,this.tooltips=new ul,this.values=new pl}};a([h({nonNullable:!0,type:An})],Le.prototype,"labels",void 0),a([h({nonNullable:!0,type:ul})],Le.prototype,"tooltips",void 0),a([h({nonNullable:!0,type:pl})],Le.prototype,"values",void 0),Le=a([x("esri.views.interactive.sketch.SketchOptions")],Le);const dl=Le;let S=class extends ke.EventedMixin(B){constructor(i){super(i),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new dl}initialize(){const{view:i}=this;this.internalGraphicsLayer=new Qs({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const t=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=vf(i.type,this.sketchOptions);const e=Md(()=>({view:i,options:this.sketchOptions.tooltips}));this.tooltip=e,hr(this._tooltipsContext),this._coordinateFormatterLoadTask=Yc(()=>au()),this.addHandles([t.on("vertex-add",n=>this.onVertexAdd(n)),t.on("vertex-remove",n=>this.onVertexRemove(n)),t.on("vertex-update",n=>this.onVertexUpdate(n)),t.on("cursor-update",n=>this.onCursorUpdate(n)),t.on("cursor-remove",()=>this._updateGraphic()),t.on("complete",n=>this.onComplete(n)),this._coordinateFormatterLoadTask,e.on("paste",n=>Id(n,this.activeTooltipInfo)),U(()=>this.cursor,n=>{t.cursor=n},Pe),Ao(()=>{const{activeTooltipInfo:n,sketchOptions:s}=this;wf(n,this._tooltipsContext),e.info=s.tooltips.effectiveEnabled?n:null}),Ao(()=>{t.constraintZ=Rf(this._tooltipsContext)},qs)]),this.finishToolCreation()}destroy(){this.drawOperation=ft(this.drawOperation),this.tooltip=ft(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=ft(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(i){this._set("centered",i),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(i){this._set("cursor",i)}set enabled(i){this.drawOperation.interactive=i,this._set("enabled",i)}set forceUniformSize(i){this._set("forceUniformSize",i),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(i){this._set("graphicSymbol",i),this._graphic!=null&&(this._graphic.symbol=i)}set mode(i){const t=this.drawOperation;t&&(t.drawingMode=i),this._set("mode",i)}get updating(){var i;return((i=this.drawOperation)==null?void 0:i.updating)??!1}get undoRedo(){const{view:{type:i,map:t}}=this;return i==="2d"&&t&&"undoRedo"in t&&t.undoRedo instanceof Ct?t.undoRedo:null}set undoRedo(i){this._override("undoRedo",i)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(i){this.destroyed||Ad(i,this.tooltip)||this.drawOperation.onInputEvent(i)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&hr(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(yt.outline),this.removeHandles(yt.regularVertices),this.removeHandles(yt.activeVertex),this.removeHandles(yt.activeEdge),this.removeHandles(ts)}_createOrUpdateGraphic(i){if(this._graphic!=null)return this.updateGraphicGeometry(i),this._graphic;const t=new It({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=t,this.updateGraphicGeometry(i),this.internalGraphicsLayer.add(t),this.addHandles(this.initializeGraphic(t)),this.notifyChange("graphic"),this.addHandles(q(()=>{this.internalGraphicsLayer.remove(t),this._graphic===t&&(this._graphic=null)}),ts),t}updateGraphicGeometry(i){this._graphic.geometry=i}_getCreateOperationGeometry(i={operationComplete:!1}){var y,w;if(this.drawOperation==null)return;const{coordinateHelper:t,view:e,visualizationCursorVertex:n,lastVertex:s,committedVertices:o,geometryIncludingUncommittedVertices:r,numCommittedVertices:l}=this.drawOperation;if(!(l>0||n!=null))return;const c=i.operationComplete?o:r,u=c.length,p=n!=null?t.pointToArray(n):null,d=this._drawSpatialReference,_=e.type==="3d"&&e.viewingMode==="global",f=new uu;f.committedVertices=o,f.cursorVertex=p;const{geometryType:m}=this;switch(m){case"point":case"mesh":f.full=t.arrayToPoint(c[0]);break;case"multipoint":f.full=u>0?mu(c,d):null;break;case"polyline":case"polygon":u>0&&(f.full=m==="polygon"?Ai([c],d,_,!0):Yo([c],d,_),f.cursorEdge=p!=null&&s&&!gi(n,s)?Yo([[p,t.pointToArray(s)]],d,_):null,f.outline=u>1?f.full:null);break;case"circle":case"rectangle":{if(f.committedVertices=f.cursorVertex=null,!u)break;const b=gu(e,c[0]),$=c[0],P=b.makeMapPoint($[0]+If*e.resolution,$[1]);m==="circle"?u===1&&i.operationComplete?f.circle=jo([$,P],b,!0):u===2&&(this.forceUniformSize?f.circle=jo(c,b,this.centered):f.rectangle=_u(c,b,this.centered)):u===1&&i.operationComplete?f.rectangle=Wo([$,P],b,!0):u===2&&(f.rectangle=this.forceUniformSize?Wo(c,b,this.centered):yu(c,b,this.centered)),f.full=f.circle!=null?f.circle.geometry:(y=f.rectangle)==null?void 0:y.geometry,f.outline=((w=f.full)==null?void 0:w.type)==="polygon"?f.full:null;break}default:return null}return f}initializeGraphic(i){return q()}onComplete(i){if(!this.drawOperation)return;this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateOperationGeometry({operationComplete:!0});e!=null&&(t=this._createOrUpdateGraphic(e.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:t,...i})}onCursorUpdate(i){this._updateGraphic(),this.emit("cursor-update",i)}onDeactivate(){const{drawOperation:i}=this;i&&(i.isCompleted||i.cancel())}onOutlineChanged(i){return q()}onCursorEdgeChanged(i){return q()}onVertexAdd(i){var t;ur(this._tooltipsContext),this._updateGraphic(),bf((t=i.vertices.at(0))==null?void 0:t.coordinates,this._tooltipsContext),this.emit("vertex-add",i)}onVertexRemove(i){ur(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",i)}onVertexUpdate(i){this._updateGraphic(),this.emit("vertex-update",i)}_updateGraphic(){const i=this._getCreateOperationGeometry();this._createOperationGeometry=i,i!=null?(i.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(i.cursorEdge),yt.activeEdge):this.removeHandles(yt.activeEdge),i.outline!=null?this.addHandles(this.onOutlineChanged(i.outline),yt.outline):this.removeHandles(yt.outline),i.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(i.committedVertices),yt.regularVertices):this.removeHandles(yt.regularVertices),i.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(i.cursorVertex),yt.activeVertex):this.removeHandles(yt.activeVertex),i.full!=null?this._createOrUpdateGraphic(i.full):this.removeHandles(ts)):this._destroyAllVisualizations()}get activeTooltipInfo(){var i;return(i=this._coordinateFormatterLoadTask)!=null&&i.finished?bo(this._tooltipsContext):null}};a([h()],S.prototype,"_coordinateFormatterLoadTask",void 0),a([h()],S.prototype,"_createOperationGeometry",void 0),a([h()],S.prototype,"_tooltipsContext",null),a([h({value:!0})],S.prototype,"centered",null),a([h()],S.prototype,"cursor",null),a([h({nonNullable:!0})],S.prototype,"defaultZ",void 0),a([h({constructOnly:!0})],S.prototype,"directionOptions",void 0),a([h()],S.prototype,"drawOperation",void 0),a([h({value:!0})],S.prototype,"enabled",null),a([h({value:!0})],S.prototype,"forceUniformSize",null),a([h({constructOnly:!0})],S.prototype,"geometryType",void 0),a([h()],S.prototype,"graphic",null),a([h({constructOnly:!0})],S.prototype,"graphicProperties",void 0),a([h()],S.prototype,"graphicSymbol",null),a([h({constructOnly:!0})],S.prototype,"hasZ",void 0),a([h({constructOnly:!0})],S.prototype,"geometryToPlace",void 0),a([h()],S.prototype,"mode",null),a([h()],S.prototype,"snappingManager",void 0),a([h()],S.prototype,"snapToScene",void 0),a([h()],S.prototype,"tooltip",void 0),a([h()],S.prototype,"tooltipInfos",void 0),a([h({constructOnly:!0,type:dl})],S.prototype,"sketchOptions",void 0),a([h()],S.prototype,"updating",null),a([h({constructOnly:!0,nonNullable:!0})],S.prototype,"view",void 0),a([h({constructOnly:!0})],S.prototype,"undoRedo",null),a([h()],S.prototype,"activeTooltipInfo",null),S=a([x("esri.views.draw.DrawGraphicTool")],S);const ts=Symbol("create-operation-graphic"),yt={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function Of(i){switch(i){case"point":case"polyline":case"polygon":case"multipoint":return i;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const If=48,fl="click";let Lf=class{constructor({consumesClicks:t,grabbableForEvent:e}){this.events=new ke,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=t,this.grabbableForEvent=e}destroy(){}intersectionDistance(t,e){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}};var D;(function(i){i[i.Z=0]="Z",i[i.M=1]="M"})(D||(D={}));let Df=class{constructor(t){this.spatialReference=t}createVector(){return this._tag(L())}pointToVector(t){return this._tag(ge(t.x,t.y))}arrayToVector(t){return this._tag(ge(t[0],t[1]))}vectorToArray(t){return[t[0],t[1]]}pointToArray(t){return[t.x,t.y]}vectorToPoint(t,e=new C){return e.x=t[0],e.y=t[1],e.z=void 0,e.m=void 0,e.spatialReference=this.spatialReference,e}arrayToPoint(t,e=new C){return e.x=t[0],e.y=t[1],e.z=void 0,e.m=void 0,e.spatialReference=this.spatialReference,e}vectorToDehydratedPoint(t,e){if(t)return e??(e={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"}),e.x=t[0],e.y=t[1],e.z=void 0,e.m=void 0,e.hasZ=!1,e.hasM=!1,e.spatialReference=this.spatialReference,e}lerp(t,e,n,s){return Ar(s,t,e,n)}addDelta(t,e,n){t[0]+=e,t[1]+=n}distance(t,e){return Fr(t,e)}getZ(t,e=void 0){return e}hasZ(){return!1}getM(t,e=void 0){return e}hasM(){return!1}clone(t){return this._tag(Wc(t))}copy(t,e){return jc(e,t)}fromXYZ(t){return this._tag(ge(t[0],t[1]))}toXYZ(t,e=g()){return N(e,t[0],t[1],0)}pointToXYZ(t,e=g()){return N(e,t.x,t.y,0)}equals(t,e){return Xc(t,e)}_tag(t){return t}};class pr{constructor(t,e){this._valueType=t,this.spatialReference=e}createVector(){return this._tag(g())}pointToVector(t){return this._tag(ue(t.x,t.y,this._valueType===D.Z?t.z:t.m))}arrayToVector(t){return this._tag(ue(t[0],t[1],t[2]||0))}vectorToArray(t){return[t[0],t[1],t[2]]}pointToArray(t){return this._valueType===D.Z?[t.x,t.y,t.z]:[t.x,t.y,t.m]}vectorToPoint(t,e=new C){return e.x=t[0],e.y=t[1],e.z=this._valueType===D.Z?t[2]:void 0,e.m=this._valueType===D.M?t[2]:void 0,e.spatialReference=this.spatialReference,e}arrayToPoint(t,e=new C){return e.x=t[0],e.y=t[1],e.z=this._valueType===D.Z?t[2]:void 0,e.m=this._valueType===D.M?t[2]:void 0,e.spatialReference=this.spatialReference,e}vectorToDehydratedPoint(t,e){if(!t)return;e??(e={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"});const n=this._valueType===D.Z,s=this._valueType===D.M;return e.x=t[0],e.y=t[1],e.z=n?t[2]:void 0,e.m=s?t[2]:void 0,e.hasZ=n,e.hasM=s,e.spatialReference=this.spatialReference,e}lerp(t,e,n,s){return Se(s,t,e,n)}addDelta(t,e,n,s){t[0]+=e,t[1]+=n,this._valueType===D.Z&&(t[2]+=s)}distance(t,e){return this._valueType===D.Z?pe(t,e):Fr(t,e)}getZ(t,e=void 0){return this._valueType===D.Z?t[2]:e}hasZ(){return this._valueType===D.Z}getM(t,e=void 0){return this._valueType===D.M?t[2]:e}hasM(){return this._valueType===D.M}clone(t){return this._tag(Kc(t))}copy(t,e){return lt(e,t)}fromXYZ(t,e=0,n=0){return this._tag(ue(t[0],t[1],this._valueType===D.Z?t.length>2?t[2]:e:n))}toXYZ(t,e=g()){return N(e,t[0],t[1],this._valueType===D.Z?t[2]:0)}pointToXYZ(t,e=g()){return N(e,t.x,t.y,this._valueType===D.Z?t.z??0:0)}equals(t,e){return qe(t,e)}_tag(t){return t}}let Gf=class{constructor(t){this.spatialReference=t}createVector(){return this._tag(Ir())}pointToVector(t){return this._tag(Hn(t.x,t.y,t.z,t.m))}arrayToVector(t){return this._tag(Hn(t[0],t[1],t[2]||0,t[3]||0))}vectorToArray(t){return[t[0],t[1],t[2],t[3]]}pointToArray(t){return[t.x,t.y,t.z,t.m]}vectorToPoint(t,e=new C){return e.x=t[0],e.y=t[1],e.z=t[2],e.m=t[3],e.spatialReference=this.spatialReference,e}arrayToPoint(t,e=new C){return e.x=t[0],e.y=t[1],e.z=t[2],e.m=t[3],e.spatialReference=this.spatialReference,e}vectorToDehydratedPoint(t,e){if(t)return e??(e={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"}),e.x=t[0],e.y=t[1],e.z=t[2],e.m=t[3],e.hasZ=!0,e.hasM=!0,e.spatialReference=this.spatialReference,e}lerp(t,e,n,s){return Qc(s,t,e,n)}addDelta(t,e,n,s){t[0]+=e,t[1]+=n,t[2]+=s}distance(t,e){return pe(t,e)}getZ(t){return t[2]}hasZ(){return!0}getM(t){return t[3]}hasM(){return!0}clone(t){return this._tag(Jc(t))}copy(t,e){return th(e,t)}fromXYZ(t,e=0,n=0){return this._tag(Hn(t[0],t[1],t.length>2?t[2]:e,n))}toXYZ(t,e=g()){return N(e,t[0],t[1],t[2])}pointToXYZ(t,e=g()){return N(e,t.x,t.y,t.z??0)}equals(t,e){return eh(t,e)}_tag(t){return t}};function gl(i,t,e){return i&&t?new Gf(e):t?new pr(D.M,e):i?new pr(D.Z,e):new Df(e)}function zf(i,t){if(!t.supported)return;let e=1/0,n=-1/0;const s=t.upperBoundX-t.lowerBoundX;i.forEach(r=>{let l=r.pos[0];for(;l<t.lowerBoundX;)l+=s;for(;l>t.upperBoundX;)l-=s;e=Math.min(e,l),n=Math.max(n,l),r.pos[0]=l});const o=n-e;s-o<o&&i.forEach(r=>{r.pos[0]<0&&(r.pos[0]+=s)})}function Uf(i,t){const e=Zr(i);return t===xi.Global&&e?{supported:!0,lowerBoundX:e.valid[0],upperBoundX:e.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}let Li=class{constructor(t){this.component=t,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}get pos(){return this._pos}set pos(t){this._pos=t,this.component.unnormalizeVertexPositions()}};class Jt{constructor(t,e,n){this.component=t,this.leftVertex=e,this.rightVertex=n,this.type="edge",e.rightEdge=this,n.leftEdge=this}}class On{constructor(t,e){this._spatialReference=t,this._viewingMode=e,this.vertices=[],this.edges=[],this.index=null}unnormalizeVertexPositions(){this.vertices.length<=1||zf(this.vertices,Uf(this._spatialReference,this._viewingMode))}updateVertexIndex(t,e){if(this.vertices.length===0)return;const n=this.vertices[0];let s=null,o=t,r=e;do s=o,s.index=r++,o=s.rightEdge?s.rightEdge.rightVertex:null;while(o!=null&&o!==n);s.leftEdge&&s!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(s),this.vertices.length-1)}getFirstVertex(){return this.vertices.at(0)}getLastVertex(){return this.vertices.at(-1)}isClosed(){return this.vertices.length>2&&this.vertices[0].leftEdge!==null}swapVertices(t,e){const n=this.vertices[t];this.vertices[t]=this.vertices[e],this.vertices[e]=n}iterateVertices(t){if(this.vertices.length===0)return;const e=this.vertices[0];let n=e;do t(n,n.index),n=n.rightEdge!=null?n.rightEdge.rightVertex:null;while(n!==e&&n!=null)}}let dn=class ml extends ke{constructor(t,e){super(),this.type=t,this.coordinateHelper=e,this._geometry=null,this._dirty=!0,this.components=[]}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon();break;case"mesh":break;default:ih(this.type)}this._dirty=!1}return this._geometry}get spatialReference(){return this.coordinateHelper.spatialReference}get allVertices(){return Array.from(this.iterateVertices())}*iterateVertices(){for(const t of this.components)for(const e of t.vertices)yield e}notifyChanges(t){this._dirty=!0,this.emit("change",t)}_toPoint(){return this.components.length===0||this.components[0].vertices.length===0?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)}_toPolyline(){const t=[],e=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const s=[];let o=n.vertices.find(l=>l.leftEdge==null);const r=o;do s.push(e(o.pos)),o=o.rightEdge?o.rightEdge.rightVertex:null;while(o&&o!==r);t.push(s)}return new pi({paths:t,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}_toPolygon(){const t=[],e=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const s=[],o=n.vertices[0];let r=o;const l=r;do s.push(e(r.pos)),r=r.rightEdge!=null?r.rightEdge.rightVertex:null;while(r&&r!==l);n.isClosed()&&s.push(e(o.pos)),t.push(s)}return new De({rings:t,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(t,e){const n=t.spatialReference,s=gl(t.hasZ,t.hasM,n),o=new ml(t.type,s);switch(t.type){case"polygon":Hf(o,t,e);break;case"polyline":Nf(o,t,e);break;case"point":dr(o,t,e);break;case"mesh":dr(o,t.origin,e),o._geometry=t,o._dirty=!1}return o}};function Hf(i,t,e){const n=t.spatialReference,s=i.coordinateHelper,o=t.rings;for(let r=0;r<o.length;++r){const l=o[r],c=new On(n,e);c.index=r;const u=l.length>2&&Ze(l[0],l[l.length-1]),p=u?l.length-1:l.length;for(let _=0;_<p;++_){const f=s.arrayToVector(l[_]),m=new Li(c);c.vertices.push(m),m.pos=f,m.index=_}const d=c.vertices.length-1;for(let _=0;_<d;++_){const f=c.vertices[_],m=c.vertices[_+1],y=new Jt(c,f,m);c.edges.push(y)}if(u){const _=new Jt(c,c.vertices[c.vertices.length-1],c.vertices[0]);c.edges.push(_)}i.components.push(c)}}function Nf(i,t,e){const n=t.spatialReference,s=i.coordinateHelper,o=t.paths;for(let r=0;r<o.length;++r){const l=o[r],c=new On(n,e);c.index=r;const u=l.length;for(let d=0;d<u;++d){const _=s.arrayToVector(l[d]),f=new Li(c);c.vertices.push(f),f.pos=_,f.index=d}const p=c.vertices.length-1;for(let d=0;d<p;++d){const _=c.vertices[d],f=c.vertices[d+1],m=new Jt(c,_,f);c.edges.push(m)}i.components.push(c)}}function dr(i,t,e){const n=t.spatialReference,s=i.coordinateHelper,o=new On(n,e);o.index=0;const r=new Li(o);r.index=0,r.pos=s.pointToVector(t),o.vertices.push(r),i.components.push(o)}function ri(i){return i.type==="mesh"}var I;(function(i){i[i.NEW_STEP=0]="NEW_STEP",i[i.ACCUMULATE_STEPS=1]="ACCUMULATE_STEPS"})(I||(I={}));let Ff=class{constructor(t,e,n){this._editGeometry=t,this._component=e,this._pos=n,this._addedVertex=null,this._originalEdge=null,this._left=null,this._right=null}apply(){let t="redo";this._addedVertex==null&&(t="apply",this._addedVertex=new Li(this._component));const e=this._component.getLastVertex();if(e==null)this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._addedVertex.index=0;else{let n=null;e.rightEdge&&(this._originalEdge=e.rightEdge,n=this._originalEdge.rightVertex,this._component.edges.splice(this._component.edges.indexOf(this._originalEdge),1)),this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._left==null&&(this._left=new Jt(this._component,e,this._addedVertex)),this._component.edges.push(this._left),e.rightEdge=this._left,this._originalEdge!=null&&n!=null&&(this._right==null&&(this._right=new Jt(this._component,this._addedVertex,n)),this._component.edges.push(this._right),n.leftEdge=this._right),this._component.updateVertexIndex(this._addedVertex,e.index+1)}this._editGeometry.notifyChanges({operation:t,addedVertices:[this._addedVertex]})}undo(){this._addedVertex!=null&&(this._component.vertices.splice(this._component.vertices.indexOf(this._addedVertex),1),this._left!=null&&(this._component.edges.splice(this._component.edges.indexOf(this._left),1),this._left.leftVertex.rightEdge=null),this._right!=null&&(this._component.edges.splice(this._component.edges.indexOf(this._right),1),this._right.rightVertex.leftEdge=null),this._originalEdge!=null&&(this._component.edges.push(this._originalEdge),this._originalEdge.leftVertex.rightEdge=this._originalEdge,this._originalEdge.rightVertex.leftEdge=this._originalEdge),this._left!=null?this._component.updateVertexIndex(this._left.leftVertex,this._left.leftVertex.index):this._component.updateVertexIndex(this._addedVertex,0),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this._addedVertex]}))}accumulate(){return!1}},yl=class _l{constructor(t,e,n){this._editGeometry=t,this._vertices=e,this.operation=n,this._undone=!1}apply(){this._vertices.forEach(t=>this.operation.apply(t)),this._editGeometry.components.forEach(t=>t.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:this._undone?"redo":"apply",updatedVertices:this._vertices})}undo(){this._vertices.forEach(t=>this.operation.undo(t)),this._editGeometry.notifyChanges({operation:"undo",updatedVertices:this._vertices}),this._undone=!0}canAccumulate(t){if(this._undone||t._vertices.length!==this._vertices.length)return!1;for(let e=0;e<t._vertices.length;++e)if(t._vertices[e]!==this._vertices[e])return!1;return this.operation.canAccumulate(t.operation)}accumulate(t){return!!(t instanceof _l&&this.canAccumulate(t))&&(this._vertices.forEach(e=>this.operation.accumulate(e,t.operation)),this.operation.accumulateParams(t.operation),this._editGeometry.components.forEach(e=>e.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:"apply",updatedVertices:this._vertices}),!0)}};var ot;(function(i){i[i.CUMULATIVE=0]="CUMULATIVE",i[i.REPLACE=1]="REPLACE"})(ot||(ot={}));let Zf=class{constructor(t,e,n=0){this._editGeometry=t,this._vertices=e,this._minNumberOfVertices=n,this.removedVertices=null}apply(){let t="redo";if(this.removedVertices==null){const e=this.removedVertices=[];this._vertices.forEach(n=>{const s=this._removeVertex(n);s!=null&&e.push(s)}),t="apply"}else this.removedVertices.forEach(e=>{this._removeVertex(e.removedVertex)});this._editGeometry.notifyChanges({operation:t,removedVertices:this._vertices})}undo(){var t;(t=this.removedVertices)==null||t.forEach(e=>{this._undoRemoveVertex(e)}),this._editGeometry.notifyChanges({operation:"undo",addedVertices:this._vertices})}accumulate(){return!1}_removeVertex(t){const e=t.component;if(e.vertices.length<=this._minNumberOfVertices)return null;const n={removedVertex:t,createdEdge:null},s=t.leftEdge,o=t.rightEdge;return e.vertices.splice(e.vertices.indexOf(t),1),s&&(e.edges.splice(e.edges.indexOf(s),1),s.leftVertex.rightEdge=null),o&&(e.edges.splice(e.edges.indexOf(o),1),o.rightVertex.leftEdge=null),t.index===0&&o&&this._vertices.length>0&&e.swapVertices(e.vertices.indexOf(o.rightVertex),0),s&&o&&(n.createdEdge=new Jt(e,s.leftVertex,o.rightVertex),e.edges.push(n.createdEdge)),o&&e.updateVertexIndex(o.rightVertex,o.rightVertex.index-1),n}_undoRemoveVertex(t){const e=t.removedVertex,n=t.removedVertex.component,s=e.leftEdge,o=e.rightEdge;t.createdEdge&&n.edges.splice(n.edges.indexOf(t.createdEdge),1),n.vertices.push(e),s&&(n.edges.push(s),s.leftVertex.rightEdge=s),o&&(n.edges.push(o),o.rightVertex.leftEdge=o),n.updateVertexIndex(e,e.index)}},Bf=class{constructor(t,e,n){this._editGeometry=t,this._edge=e,this._t=n,this.createdVertex=null,this._left=null,this._right=null}apply(){let t="redo";const e=this._edge,n=e.component,s=e.leftVertex,o=e.rightVertex;n.edges.splice(n.edges.indexOf(e),1),this.createdVertex==null&&(t="apply",this.createdVertex=new Li(e.component)),n.vertices.push(this.createdVertex),this.createdVertex.pos=this._editGeometry.coordinateHelper.lerp(e.leftVertex.pos,e.rightVertex.pos,this._t,this._editGeometry.coordinateHelper.createVector()),this._left==null&&(this._left=new Jt(n,s,this.createdVertex)),this._left.leftVertex.leftEdge?n.edges.push(this._left):n.edges.unshift(this._left),s.rightEdge=this._left,this._right==null&&(this._right=new Jt(n,this.createdVertex,o)),n.edges.push(this._right),o.leftEdge=this._right,n.updateVertexIndex(this.createdVertex,s.index+1),this._editGeometry.notifyChanges({operation:t,addedVertices:[this.createdVertex]})}undo(){if(this.createdVertex==null||this._left==null||this._right==null)return null;const t=this._edge,e=t.component,n=this.createdVertex.leftEdge,s=this.createdVertex.rightEdge,o=n==null?void 0:n.leftVertex,r=s==null?void 0:s.rightVertex;e.vertices.splice(e.vertices.indexOf(this.createdVertex),1),e.edges.splice(e.edges.indexOf(this._left),1),e.edges.splice(e.edges.indexOf(this._right),1),this._edge.leftVertex.leftEdge?e.edges.push(this._edge):e.edges.unshift(this._edge),o&&(o.rightEdge=t),r&&(r.leftEdge=t),o&&e.updateVertexIndex(o,o.index),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this.createdVertex]})}accumulate(){return!1}},qf=class vl{constructor(t,e,n){this._editGeometry=t,this._vertex=e,this._pos=n}apply(){const t=this._originalPosition==null;t&&(this._originalPosition=this._vertex.pos),this._apply(t?"apply":"redo")}undo(){this._vertex.pos=this._originalPosition,this._editGeometry.notifyChanges({operation:"undo",updatedVertices:[this._vertex]})}accumulate(t){return t instanceof vl&&t._vertex===this._vertex&&(this._pos=t._pos,this._apply("apply"),!0)}_apply(t){this._vertex.pos=this._pos,this._editGeometry.components.forEach(e=>e.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:t,updatedVertices:[this._vertex]})}},Yf=class{constructor(t,e){this._editGeometry=t,this._component=e,this._createdEdge=null}apply(){let t="redo";if(this._createdEdge==null){t="apply";const e=this._component.getFirstVertex(),n=this._component.getLastVertex();if(this._component.isClosed()||this._component.vertices.length<3||e==null||n==null)return;this._createdEdge=new Jt(this._component,n,e)}this._createdEdge.leftVertex.rightEdge=this._createdEdge,this._createdEdge.rightVertex.leftEdge=this._createdEdge,this._component.edges.push(this._createdEdge),this._editGeometry.notifyChanges({operation:t})}undo(){this._createdEdge!=null&&(Ur(this._component.edges,this._createdEdge),this._createdEdge.leftVertex.rightEdge=null,this._createdEdge.rightVertex.leftEdge=null,this._editGeometry.notifyChanges({operation:"undo"}))}accumulate(){return!1}},fr=class bl{constructor(t,e,n,s){this._editGeometry=t,this.dx=e,this.dy=n,this.dz=s,this._firstTime=!0}apply(){const t=this._firstTime?"apply":"redo";this._firstTime=!1,this._apply(t,this.dx,this.dy,this.dz)}undo(){this._apply("undo",-this.dx,-this.dy,-this.dz)}accumulate(t){const e=this._editGeometry.geometry;return t instanceof bl&&t._editGeometry.geometry===e&&(this._apply("apply",t.dx,t.dy,t.dz),this.dx+=t.dx,this.dy+=t.dy,this.dz+=t.dz,!0)}_apply(t,e,n,s){const o=this._editGeometry.geometry;o.offset(e,n,s);const r=this._editGeometry.components[0].getFirstVertex();if(!r)return;const l=this._editGeometry.coordinateHelper;r.pos=l.pointToVector(o.origin),this._editGeometry.notifyChanges({operation:t,updatedVertices:[r]})}},xl=class wl{constructor(t,e,n,s){this._helper=t,this.dx=e,this.dy=n,this.dz=s}_move(t,e,n,s){this._helper.addDelta(t.pos,e,n,s)}apply(t){this._move(t,this.dx,this.dy,this.dz)}undo(t){this._move(t,-this.dx,-this.dy,-this.dz)}canAccumulate(t){return t instanceof wl}accumulate(t,e){this._move(t,e.dx,e.dy,e.dz)}accumulateParams(t){this.dx+=t.dx,this.dy+=t.dy,this.dz+=t.dz}},Wf=class Ls{get plane(){return this._plane}get requiresSplitEdgeLeft(){return!this._left.isOriginalDirection}get requiresSplitEdgeRight(){return!this._right.isOriginalDirection}get edgeDirection(){return this._edgeDirection}constructor(t,e,n,s=0,o=yi.IMMEDIATE){this._helper=t,this._planeType=e,this._edge=n,this.distance=s,this._plane=ct(),this._offsetPlane=ct(),this._minDistance=-1/0,this._maxDistance=1/0,this._selectedArrow=1,o===yi.IMMEDIATE&&this._initialize()}_initialize(){this._initializeNeighbors(),this._initializePlane(),this._initializeDistanceConstraints()}_initializeNeighbors(){var o,r,l,c;const t=this._toXYZ(this._edge.leftVertex.pos),e=this._toXYZ((r=(o=this._edge.leftVertex.leftEdge)==null?void 0:o.leftVertex)==null?void 0:r.pos),n=this._toXYZ(this._edge.rightVertex.pos),s=this._toXYZ((c=(l=this._edge.rightVertex.rightEdge)==null?void 0:l.rightVertex)==null?void 0:c.pos);this._edgeDirection=Oo(g(),t,n),e?(this._left=this._computeNeighbor(t,e,this._edgeDirection),this._right=this._computeNeighbor(n,s,this._edgeDirection,this._left)):(this._right=this._computeNeighbor(n,s,this._edgeDirection),this._left=this._computeNeighbor(t,e,this._edgeDirection,this._right))}_toXYZ(t){return t!=null?this._helper.toXYZ(t):null}_pointToXYZ(t){return this._toXYZ(this._helper.pointToVector(t))}_computeNeighbor(t,e,n,s){const o=g();if(e){Oo(o,t,e);const r=!this._passesBisectingAngleThreshold(o,n);return{start:t,end:e,direction:r?this._bisectVectorsPerpendicular(n,o):o,isOriginalDirection:!r}}return this._helper.hasZ()?s&&(Ot(o,n,s.direction),Ot(o,o,n),le(o,o),Math.sign(o[1])!==Math.sign(n[0])&&fe(o,o,-1)):N(o,-n[1],n[0],0),{start:t,end:e,direction:o,isOriginalDirection:!0}}_passesBisectingAngleThreshold(t,e){const n=Math.abs(Oh(e,t));return n>=gr&&n<=Math.PI-gr}_bisectVectorsPerpendicular(t,e){const n=Z(t,e)<0?t:as(g(),t),s=Math.abs(Z(n,e));if(!(s<mr||s>1-mr))return this._bisectDirection(n,e);const o=Ot(g(),n,[0,0,1]);return le(o,o)}_bisectDirection(t,e){const n=pt(g(),t,e);return le(n,n)}_initializePlane(){const t=this._computeNormalDirection(this._left),e=this._computeNormalDirection(this._right);Z(t,e)<0&&as(e,e),Ri(this._left.start,this._bisectDirection(t,e),this._plane)}_computeNormalDirection(t){const e=Ot(g(),t.direction,this._edgeDirection);le(e,e);const n=Ot(g(),this._edgeDirection,e);return this._planeType===Ds.XY&&(n[2]=0),le(n,n)}_initializeDistanceConstraints(){this._left.end==null||this.requiresSplitEdgeLeft||this._updateDistanceConstraint(Ve(this._plane,this._left.end)),this._right.end==null||this.requiresSplitEdgeRight||this._updateDistanceConstraint(Ve(this._plane,this._right.end)),this._updateIntersectDistanceConstraint(this._plane)}_updateDistanceConstraint(t){t<=0&&(this._minDistance=Math.max(this._minDistance,t)),t>=0&&(this._maxDistance=Math.min(this._maxDistance,t))}_updateIntersectDistanceConstraint(t){const e=ze(t),n=this._edgeDirection,s=pt(g(),this._left.start,this._left.direction),o=pt(g(),this._right.start,this._right.direction),r=this._pointInBasis2D(L(),e,n,this._left.start),l=this._pointInBasis2D(L(),e,n,s),c=this._pointInBasis2D(L(),e,n,this._right.start),u=this._pointInBasis2D(L(),e,n,o),[p]=Su({start:l,end:r,type:O.LINE},{start:u,end:c,type:O.LINE});if(!p)return;const d=j(L(),r,l);Xs(d,d);const _=j(L(),p,l),f=ye(d,_),m=pt(g(),s,fe(g(),this._left.direction,-f)),y=Ve(t,m);this._updateDistanceConstraint(y)}_pointInBasis2D(t,e,n,s){return t[0]=Fo(e,s),t[1]=Fo(n,s),t}_offset(t,e){Number.isFinite(this._minDistance)&&(e=Math.max(this._minDistance,e)),Number.isFinite(this._maxDistance)&&(e=Math.min(this._maxDistance,e)),Fn(this._offsetPlane,this._plane),this._offsetPlane[3]-=e;const n=(o,r,l)=>r!=null&&Js(this._offsetPlane,o,pt(g(),o,r),l),s=g();(t===this._edge.leftVertex?n(this._left.start,this._left.direction,s):n(this._right.start,this._right.direction,s))&&this._helper.copy(this._helper.fromXYZ(s,void 0,this._helper.getM(t.pos)),t.pos)}selectArrowFromStartPoint(t){this._selectedArrow=ia(this.plane,this._pointToXYZ(t))?1:-1}get selectedArrow(){return this._selectedArrow}signedDistanceToPoint(t){return Ve(this.plane,this._pointToXYZ(t))}clampedStartAndEnd(t){const e=this._helper.toXYZ(this._helper.pointToVector(t)),n=to(this._plane,e,g()),s=Ve(this._plane,e),o=nh(s,this._minDistance,this._maxDistance);return Se(e,n,e,o/s),{start:n,end:e}}apply(t){this._offset(t,this.distance)}undo(t){this._offset(t,0)}canAccumulate(t){return t instanceof Ls&&this._edge.leftVertex.index===t._edge.leftVertex.index&&this._edge.rightVertex.index===t._edge.rightVertex.index&&this._edge.component===t._edge.component&&this._maybeEqualsVec3(this._left.direction,t._left.direction)&&this._maybeEqualsVec3(this._right.direction,t._right.direction)&&qe(ze(this._plane),ze(t._plane))}accumulate(t,e){const n=this._plane[3]-e._plane[3]+e.distance;this._offset(t,n)}accumulateParams(t){const e=t.distance-t._plane[3];this.distance=e+this._plane[3]}clone(){const t=new Ls(this._helper,this._planeType,this._edge,this.distance,yi.DEFERRED);return Fn(t._plane,this._plane),Fn(t._offsetPlane,this._offsetPlane),t._maxDistance=this._maxDistance,t._minDistance=this._minDistance,t._left=this._cloneNeighbor(this._left),t._right=this._cloneNeighbor(this._right),t._edgeDirection=lt(g(),this._edgeDirection),t}_maybeEqualsVec3(t,e){return t==null&&e==null||t!=null&&e!=null&&qe(t,e)}_cloneNeighbor({start:t,end:e,direction:n,isOriginalDirection:s}){return{start:lt(g(),t),end:e!=null?lt(g(),e):null,direction:lt(g(),n),isOriginalDirection:s}}};const gr=Br(15),mr=.001;var Ds,yi;(function(i){i[i.XYZ=0]="XYZ",i[i.XY=1]="XY"})(Ds||(Ds={})),function(i){i[i.IMMEDIATE=0]="IMMEDIATE",i[i.DEFERRED=1]="DEFERRED"}(yi||(yi={}));let $l=class Tl{constructor(t,e,n=ot.CUMULATIVE){this.origin=t,this.angle=e,this._accumulationType=n}_rotate(t,e){sh(t.pos,t.pos,this.origin,e)}apply(t){this._rotate(t,this.angle)}undo(t){this._rotate(t,-this.angle)}canAccumulate(t){return t instanceof Tl&&Ze(this.origin,t.origin)}accumulate(t,e){const n=e._accumulationType===ot.REPLACE;this._rotate(t,n?e.angle-this.angle:e.angle)}accumulateParams(t){const e=t._accumulationType===ot.REPLACE;this.angle=e?t.angle:this.angle+t.angle}};class In{constructor(t,e,n,s,o=ot.CUMULATIVE){this.origin=t,this.axis1=e,this.factor1=n,this.factor2=s,this._accumulationType=o,this.axis2=ge(e[1],-e[0])}_scale(t,e,n){on(t.pos,t.pos,this.origin,this.axis1,e),on(t.pos,t.pos,this.origin,this.axis2,n)}apply(t){this._scale(t,this.factor1,this.factor2)}undo(t){this._scale(t,1/this.factor1,1/this.factor2)}canAccumulate(t){return t instanceof In&&Ze(this.origin,t.origin)&&Ze(this.axis1,t.axis1)}accumulate(t,e){e._accumulationType===ot.REPLACE?this._scale(t,e.factor1/this.factor1,e.factor2/this.factor2):this._scale(t,e.factor1,e.factor2)}accumulateParams(t){const e=t._accumulationType===ot.REPLACE;this.factor1=e?t.factor1:this.factor1*t.factor1,this.factor2=e?t.factor2:this.factor2*t.factor2}}let jf=class El{constructor(t,e){this._editGeometry=t,this._newPositions=e}apply(){const t=this._originalPositions==null?"apply":"redo";if(!this._originalPositions){const e=this._editGeometry.coordinateHelper;this._originalPositions=this._editGeometry.allVertices.map(n=>e.clone(n.pos))}this._apply(t,this._newPositions)}undo(){this._originalPositions&&this._apply("undo",this._originalPositions)}accumulate(t){return t instanceof El&&(this._newPositions=t._newPositions,this._apply("apply",this._newPositions),!0)}_apply(t,e){const n=this._editGeometry.coordinateHelper,s=this._editGeometry.allVertices;for(let o=0;o<s.length;o++)n.copy(e[o],s[o].pos);this._editGeometry.components.forEach(o=>o.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:t,updatedVertices:s})}};var Sl;const Xf=Symbol();let Kf=class{constructor(t){this._operations=[],this._closed=!1,this[Sl]=!0,t&&(this._operations=t,this._closed=!0)}close(){this._closed=!0}apply(){for(const t of this._operations)t.apply()}undo(){for(let t=this._operations.length-1;t>=0;t--)this._operations[t].undo()}accumulate(t){if(this._closed)return!1;const e=this._operations.length?this._operations[this._operations.length-1]:null;return e&&e.accumulate(t)||(this._operations.push(t),t.apply()),!0}};Sl=Xf;let wo=class Ml extends ke{constructor(t,e){super(),this.data=t,this.viewingMode=e,this._undoStack=[],this._redoStack=[],this._listener=this.data.on("change",n=>{n.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:n.addedVertices,operation:n.operation}),n.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:n.removedVertices,operation:n.operation}),n.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:n.updatedVertices,operation:n.operation})})}destroy(){this._listener.remove()}splitEdge(t,e){return this._apply(new Bf(this.data,t,e))}updateVertices(t,e,n=I.ACCUMULATE_STEPS){return this._apply(new yl(this.data,t,e),n)}move(t,e,n,s=I.ACCUMULATE_STEPS){return ri(this.data)?this._apply(new fr(this.data,t,e,n),s):this.moveVertices(this.data.allVertices,t,e,n,s)}moveVertices(t,e,n,s,o=I.ACCUMULATE_STEPS){return ri(this.data)?this._apply(new fr(this.data,e,n,s),o):this.updateVertices(t,new xl(this.data.coordinateHelper,e,n,s),o)}scale(t,e,n,s,o=I.ACCUMULATE_STEPS,r=ot.CUMULATIVE){return this.scaleVertices(this.data.allVertices,t,e,n,s,o,r)}scaleVertices(t,e,n,s,o,r=I.ACCUMULATE_STEPS,l=ot.CUMULATIVE){return this.updateVertices(t,new In(e,n,s,o,l),r)}rotate(t,e,n=I.ACCUMULATE_STEPS,s=ot.CUMULATIVE){return this.rotateVertices(this.data.allVertices,t,e,n,s)}rotateVertices(t,e,n,s=I.ACCUMULATE_STEPS,o=ot.CUMULATIVE){return this.updateVertices(t,new $l(e,n,o),s)}removeVertices(t){return this._apply(new Zf(this.data,t,this._minNumVerticesPerType))}appendVertex(t){return this.data.components.length===0?null:this._apply(new Ff(this.data,this.data.components[0],t))}setVertexPosition(t,e){return this._apply(new qf(this.data,t,e))}offsetEdge(t,e,n,s=I.ACCUMULATE_STEPS){return this.updateVertices([e.leftVertex,e.rightVertex],new Wf(this.data.coordinateHelper,t,e,n),s)}trySetGeometry(t,e=I.ACCUMULATE_STEPS){const{data:n}=this,{coordinateHelper:s}=n;if(n.type!==t.type||!n.spatialReference.equals(t.spatialReference)||s.hasZ()!==t.hasZ||s.hasM()!==t.hasM||!oh(n.geometry,t)||ri(n))return;const o=Array.from(dn.fromGeometry(t,this.viewingMode).iterateVertices(),r=>r.pos);return this.setVertexPositions(o,e)}setVertexPositions(t,e=I.ACCUMULATE_STEPS){return this._apply(new jf(this.data,t),e)}createResetState(){if(ri(this.data))return this._createResetStateMesh();const t=this.data.geometry.clone();return q(()=>this.trySetGeometry(t))}closeComponent(t){return this.data.components.includes(t)?this._apply(new Yf(this.data,t)):null}canRemoveVertex(t){return t.vertices.length>this._minNumVerticesPerType}createUndoGroup(){const t=new Kf;return this._apply(t),q(()=>t.close())}undo(){if(this._undoStack.length>0){const t=this._undoStack.pop();return t.undo(),this._redoStack.push(t),t}return null}redo(){if(this._redoStack.length>0){const t=this._redoStack.pop();return t.apply(),this._undoStack.push(t),t}return null}get canUndo(){return this._undoStack.length>0}get canRedo(){return this._redoStack.length>0}get lastOperation(){return this._undoStack.length>0?this._undoStack[this._undoStack.length-1]:null}get _minNumVerticesPerType(){switch(this.data.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}_apply(t,e=I.ACCUMULATE_STEPS){return e!==I.NEW_STEP&&this.lastOperation!=null&&this.lastOperation.accumulate(t)||(t.apply(),this._undoStack.push(t),this._redoStack=[]),t}_createResetStateMesh(){if(!ri(this.data))return q();const t=this.data.geometry,{vertexSpace:e}=t;if(e.origin){const s=_e(e.origin);return q(()=>{t.vertexSpace.origin=s})}const n=t.vertexAttributes.clonePositional();return q(()=>{t.vertexAttributes=n,t.vertexAttributesChanged()})}static fromGeometry(t,e){return new Ml(dn.fromGeometry(t,e),e)}};function Qf(i,t){let e=null,n=null;return s=>{if(s.action==="cancel")return void(n!=null&&(n.execute({action:"cancel"}),e=null,n=null));const o={action:s.action,screenStart:s.start,screenEnd:s.screenPoint};s.action==="start"&&e==null&&(e=new Si,n=new Si,t(i,e,n,s.pointerType,o)),e!=null&&e.execute(o),s.action==="end"&&e!=null&&(e=null,n=null)}}function He(i,t){return i.events.on("drag",Qf(i,t))}function $o(i,t=null,e){var r;let n=null;const s=t==null||(r=i.spatialReference)!=null&&r.equals(t)?l=>l:l=>l!=null?We(l,t):l,o={exclude:[],...e};return l=>{if(l.action==="start"&&(n=s(i.toMap(l.screenStart,o))),n==null)return null;const c=s(i.toMap(l.screenEnd,o));return c!=null?{...l,mapStart:n,mapEnd:c}:null}}const Jf=()=>{};let Si=class Pl{constructor(){this.execute=Jf}next(t,e=new Pl){return t!=null&&(this.execute=n=>{const s=t(n);s!=null&&e.execute(s)}),e}};function tg(i,t,e=[]){if(i.type==="2d")return s=>s;let n=null;return s=>{s.action==="start"&&(n=i.toMap(s.screenStart,{exclude:e}),n!=null&&(n.z=Ho(n,i,t)));const o=i.toMap(s.screenEnd,{exclude:e});o!=null&&(o.z=Ho(o,i,t));const r=n!=null&&o!=null?{sceneStart:n,sceneEnd:o}:null;return{...s,scenePoints:r}}}let Gs=class{constructor(t){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=t.editGeometryOperations,this.elevationInfo=t.elevationInfo,this.pointer=t.pointer,this.vertexHandle=t.vertexHandle,this.excludeFeature=t.excludeFeature,this.feature=t.feature,this.visualizer=t.visualizer,this.selfSnappingZ=t.selfSnappingZ,this.drawConstraints=t.drawConstraints}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}};function eg({predicate:i=()=>!0,snappingManager:t,snappingContext:e,updatingHandles:n,useZ:s=!0}){const o=new Si;if(t==null)return{snappingStep:[yr,o],cancelSnapping:yr};let r,l=null,c=null,u=null;const p=()=>{l=ls(l),t.doneSnapping(),c==null||c.frameTask.remove(),c=null,r=Wr(r),u=null},d=ig(t,s,o);let _=null,f=null,m=null;return{snappingStep:[y=>{if(!i(y))return y;const{action:w}=y;if(w==="start"){const{info:b}=y,$=ng(t.view);if(c=sg(e,y,$),c.context.selfSnappingZ=null,!s&&b!=null){const P=rg(e.coordinateHelper,b.handle.component);P!=null&&(c.context.selfSnappingZ={value:P,elevationInfo:e.elevationInfo??yn})}}if(c!=null){const{context:b,originalScenePos:$,originalPos:P}=c,{mapEnd:K,mapStart:Q,scenePoints:Y}=y,mt=kl(P,zs(K,Q)),ht=zs(Q,P),ei={...y,action:"update"},Gt=c.context,ie=og($,Y),xe=t.update({point:mt,scenePoint:ie,context:b});if(m=xe,Cl(K,xe,ht,s),_=mt,f=ie,w!=="end"){const{frameTask:Ln}=c;l==null&&(l=new AbortController),u=Il=>{n.addPromise(cs(d({frameTask:Ln,event:ei,context:Gt,point:mt,scenePoint:ie,delta:ht,getLastState:()=>({point:_,scenePoint:f,updatePoint:Il.forceUpdate?null:m})},l.signal)))},u({forceUpdate:!1}),r==null&&(r=U(()=>t.options.effectiveEnabled,()=>u==null?void 0:u({forceUpdate:!0})))}}return w==="end"&&p(),y},o],cancelSnapping:y=>(p(),y)}}function ig(i,t,e){return jr(async({frameTask:n,point:s,scenePoint:o,context:r,event:l,delta:c,getLastState:u},p)=>{const d=await n.schedule(()=>i.snap({point:s,scenePoint:o,context:r,signal:p}),p);if(d.valid){let _=await n.schedule(()=>d.apply(),p);const f=u();f.point!=null&&s!==f.point&&(_=i.update({point:f.point,scenePoint:f.scenePoint,context:r})),f.updatePoint!=null&&gi(_,f.updatePoint)||(Cl(l.mapEnd,_,c,t),e.execute(l))}})}function ng(i){return i.type==="3d"?i.resourceController.scheduler.registerTask(qr.SNAPPING):Yr}function sg(i,t,e){return{context:new Gs({editGeometryOperations:i.editGeometryOperations,elevationInfo:i.elevationInfo,pointer:i.pointer,vertexHandle:t.info!=null?t.info.handle:null,excludeFeature:i.excludeFeature,feature:i.feature,visualizer:i.visualizer}),originalPos:t.snapOrigin!=null?i.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:t.scenePoints!=null?t.scenePoints.sceneStart:null,frameTask:e}}function kl(i,[t,e,n]){const s=oa(i);return s.x+=t,s.y+=e,s.hasZ&&(s.z+=n),s}function og(i,t){return i==null||t==null?null:kl(i,zs(t.sceneEnd,t.sceneStart))}function zs(i,t){const e=i.hasZ&&t.hasZ?i.z-t.z:0;return[i.x-t.x,i.y-t.y,e]}function Cl(i,t,[e,n,s],o){i.x=t.x+e,i.y=t.y+n,o&&i.hasZ&&t.hasZ&&(i.z=t.z+s)}function rg(i,t){if(!i.hasZ())return null;const e=t.vertices;let n=null;for(const s of e){const o=i.getZ(s.pos);if(n!=null&&o!=null&&Math.abs(o-n)>1e-6)return null;n==null&&(n=o)}return n}function yr(i){return i}let $e=class extends it{constructor(i){super(i),this.constrainResult=t=>t,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=jr(async(t,e,n,s)=>{const o=this._frameTask;if(o==null)return;const r=await o.schedule(()=>e.snap({...t,context:n,signal:s}),s);r.valid&&await o.schedule(()=>{this.stagedPoint=r.apply(),t!==this._snapPoints&&this._snapPoints!=null&&(this.stagedPoint=e.update({...this._snapPoints,context:n}))},s)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(i){this._stagedPoint=this.constrainResult(i)}initialize(){var t,e;const i=this.view.type==="3d"?(e=(t=this.view)==null?void 0:t.resourceController)==null?void 0:e.scheduler:null;this._frameTask=i!=null?i.registerTask(qr.SNAPPING):Yr}destroy(){this._abortController=ls(this._abortController),this._frameTask=Wr(this._frameTask)}update(i,t,e){this._snapPoints=i;const{point:n,scenePoint:s}=i,o=t.update({point:n,scenePoint:s,context:e});return this.stagedPoint=o,o}async snap(i,t,e){const{point:n,scenePoint:s}=i;return this.stagedPoint=t.update({point:n,scenePoint:s,context:e}),this._snapPoints=i,this._abortController==null&&(this._abortController=new AbortController),this._snap(i,t,e,this._abortController.signal)}async snapAgainNearPreviousMapPoint(i,t){this._snapPoints!=null&&await this.snap(this._snapPoints,i,t)}abort(){this._abortController=ls(this._abortController),this._snapPoints=null}};a([h({constructOnly:!0})],$e.prototype,"view",void 0),a([h()],$e.prototype,"stagedPoint",null),a([h()],$e.prototype,"constrainResult",void 0),a([h()],$e.prototype,"_stagedPoint",void 0),$e=a([x("esri.views.interactive.snapping.SnappingOperation")],$e);var _r;(function(i){i[i.TARGET=0]="TARGET",i[i.REFERENCE=1]="REFERENCE",i[i.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(_r||(_r={}));const vr=Symbol("snapping-toggle");function ag(i,t=()=>{}){const e=U(()=>({view:i.view,snappingOptions:i.snappingOptions}),({view:n,snappingOptions:s})=>{if(i.removeHandles(vr),!n||!s)return;const o=Hr.TOOL,r=[n.on("key-down",l=>{l.key!==nr.toggle||l.repeat||(s.enabledToggled=!0,t())},o),n.on("key-up",l=>{l.key===nr.toggle&&(s.enabledToggled=!1,t())},o),n.on("pointer-move",l=>{const c=l.native.ctrlKey;s.enabledToggled!==c&&(s.enabledToggled=c,t())},o)];i.addHandles(r,vr)},Pe);i.addHandles(e)}const lg="crosshair",cg="progress",br=Symbol(),xr=Symbol();let T=class extends ke.EventedMixin(it){constructor(t){super(t),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new rh,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new Cr,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=_s(bp),this._getPolylineOrPolygonConstraint=_s(xp),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new An,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,t.elevationInfo==null&&(this.elevationInfo=$h(!!t.hasZ))}initialize(){const{geometryType:t,view:e}=this,n=e.spatialReference,s="viewingMode"in e.state?e.state.viewingMode:xi.Local,o=t==="segment"||t==="multipoint"?"polyline":t;this.coordinateHelper=gl(this.hasZ,this.hasM,n),this._editGeometryOperations=new wo(new dn(o,this.coordinateHelper),s),this._snappingOperation=new $e({view:e}),this.addHandles([U(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:c,constraint:u},p)=>{const{snappingOptions:d}=this;if(d&&(d.forceDisabled=u!=null&&vt(u)),p!=null&&c===p.stagedPoint&&u!==p.constraint)return this._onKeyboardBasedChange();this._processCursor(c??this._screenToMap(this._stagedScreenPoint))},{equals:(c,u)=>c.stagedPoint===u.stagedPoint&&ah(c.constraint,u.constraint)}),U(()=>this.view.viewpoint,(c,u)=>{c&&u&&lh(c,u)&&this._onKeyboardBasedChange()})]),this._activeComponent=new On(n,s),this._editGeometryOperations.data.components.push(this._activeComponent);const r=this.segmentLabels;r!=null&&(r.context={view:e,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles(U(()=>this.labelOptions.enabled,c=>{r.visible=c},Pe))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],c=>{var m,y,w,b;const u=c.vertices.map($=>({componentIndex:0,vertexIndex:$.index,coordinates:this.coordinateHelper.vectorToArray($.pos)})),p=u.map($=>$.coordinates),d=this.coordinateHelper.vectorToDehydratedPoint((m=this._activeComponent.getFirstVertex())==null?void 0:m.pos)??null;gi(d,this.firstVertex)||(this.firstVertex=d);const _=this.coordinateHelper.vectorToDehydratedPoint((y=this._activeComponent.getLastVertex())==null?void 0:y.pos)??null;gi(_,this.lastVertex)||(this.lastVertex=_);const f=this.coordinateHelper.vectorToDehydratedPoint((b=(w=this._activeComponent.edges.at(-1))==null?void 0:w.leftVertex)==null?void 0:b.pos)??null;switch(gi(f,this.secondToLastVertex)||(this.secondToLastVertex=f),this._processCursor(this.cursorVertex),c.type){case"vertex-add":this.emit(c.type,{...c,added:p,vertices:u});break;case"vertex-update":this.emit(c.type,{...c,updated:p,vertices:u});break;case"vertex-remove":this.emit(c.type,{...c,removed:p,vertices:u})}}));const l=this._manipulator=new Lf({consumesClicks:!1,grabbableForEvent:c=>this.drawingMode!=="click"||c.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(l),l.grabbable=t!=="point",this.addHandles([l.events.on("immediate-click",c=>this._onImmediateClick(c)),l.events.on("immediate-double-click",c=>this._onImmediateDoubleClick(c)),U(()=>this.drawingMode,()=>{this.removeHandles(br),this.addHandles(this._createManipulatorDragPipeline(l),br)},Pe),U(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:c})=>{l.cursor=c},Pe)]),ag(this,()=>{const c=this.view.inputManager.latestPointerType??"mouse",u=this._getSnappingContext(c);if(this.snappingManager!=null){const p=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,u);this._updatingHandles.addPromise(cs(p))}})}destroy(){ft(this.segmentLabels),ft(this._snappingOperation),this._editGeometryOperations=ft(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:t,_manipulator:e}=this;return t!=null&&this._pointerDownStates.has(t)||e.grabbing||!e.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const t=this._updateAndGetEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(t=>this.coordinateHelper.vectorToArray(t.pos))}get _constraint(){const{constraints:t,constraintsEnabled:e}=this;if(t&&e)switch(this.geometryType){case"point":return this._getPointConstraint(t);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,t)}}set drawingMode(t){this._set("drawingMode",t??fl)}get effectiveCursor(){return this.loading?cg:this._hideDefaultCursor?null:this.cursor||lg}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return this._stagedPointerType==="mouse"?this.cursorVertex:null}get committableVertex(){const{cursorVertex:t,lastVertex:e,firstVertex:n,geometryType:s}=this;return s==="polygon"&&Zn(t,n)||Zn(t,e)?null:t}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:t,committableVertex:e,coordinateHelper:n}=this,s=t.slice();return e!=null&&s.push(n.pointToArray(e)),s}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:t}=this;t!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}complete(t){var r;const e=(t==null?void 0:t.aborted)||!1;this._snappingOperation.abort(),(r=this.snappingManager)==null||r.doneSnapping();const{geometryType:n,numCommittedVertices:s}=this,o=n==="multipoint"&&s===0||n==="polyline"&&s<2||n==="polygon"&&s<3;n!=="segment"&&n!=="point"||this.commitStagedVertex(),this._createOperationCompleted=!o,(this.isCompleted||e)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map((l,c)=>({componentIndex:0,vertexIndex:c,coordinates:l})),aborted:e,type:"complete"}))}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(t){var l,c;const e=ns(this.cursorVertex),n=ns(t),s=n&&(((l=this._updateAndGetEffectiveDrawSurface())==null?void 0:l.constrainZ(n))??n),o=this._snapToClosingVertex(s),r=this._applyConstraints(o);Zn(e,r)||(this._set("cursorVertex",r),(c=this.segmentLabels)==null||c.set("stagedVertex",r!=null?this.coordinateHelper.pointToVector(r):null),r==null||this._stagedPointerType!=="mouse"?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(r)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(t){if(t==null||this._isDragging||this.geometryType!=="polygon"||this.numCommittedVertices<=2)return t;const e=this._mapToScreen(t);if(!e)return t;const n=this._activeComponent;return this._vertexWithinPointerDistance(n.vertices[0].pos,e)?this.firstVertex:this._vertexWithinPointerDistance(n.vertices.at(-1).pos,e)?this.lastVertex:t}_createManipulatorDragPipeline(t){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return He(t,(e,n,s,o)=>{const r=o==="touch"&&this._snappingEnabled;if(this.isCompleted||!r)return;const{snappingStep:l,cancelSnapping:c}=eg({predicate:()=>r,snappingManager:this.snappingManager,snappingContext:new Gs({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:o,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});s=s.next(u=>(r&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),u)).next(c),n.next(this._screenToMapDragEventStep()).next(u=>(u.action==="start"&&(this._processCursor(u.mapStart),(this.geometryType==="segment"||r&&!this.numCommittedVertices)&&this.commitStagedVertex()),u)).next(tg(this.view,this.elevationInfo)).next(...l).next(u=>(r&&(this._processCursor(u.mapEnd),u.action==="end"&&this.commitStagedVertex()),u)).next(u=>(u.action==="end"&&(this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),u))})}_createManipulatorDragPipelineFreehand(t){return He(t,(e,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next(s=>(s.action==="start"&&(this._snappingOperation.abort(),this.committableVertex==null&&this._processCursor(s.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),s)).next(s=>{switch(s.action){case"start":case"update":this._processCursor(s.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return s})})}_createManipulatorDragPipelineHybrid(t){return He(t,(e,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next(s=>(s.action==="start"&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),xr),this._processCursor(s.mapStart),this.commitStagedVertex()),s)).next(s=>{switch(s.action){case"start":case"update":this._processCursor(s.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.removeHandles(xr),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return s})})}get _drawAtFixedElevation(){const{constraintsEnabled:t,constraintZ:e,geometryType:n,numCommittedVertices:s}=this;return t?e!=null||n==="segment"&&s>0:(n==="segment"||n==="polygon")&&s>0}_updateAndGetEffectiveDrawSurface(){var u;const{constraintsEnabled:t,coordinateHelper:e,drawSurface:n,elevationDrawSurface:s,snapToSceneEnabled:o}=this;if(s==null)return n;if(!this.hasZ)return s.defaultZ=null,s;const r=(u=this.elevationInfo)==null?void 0:u.mode;let l=this.defaultZ,c=t||r==="absolute-height";return o!=null&&(c=o),r==="on-the-ground"&&(c=!1),this._drawAtFixedElevation&&(l=(t?this.constraintZ:null)??e.getZ(this._activeComponent.vertices[0].pos),c=!1),c?n:(s.defaultZ=l,s)}_mapToScreen(t){var e;return(e=this._updateAndGetEffectiveDrawSurface())==null?void 0:e.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),this.drawingMode==="click"&&t.pointerType==="touch"&&this._snappingEnabled&&this._processCursor(t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if(!(t.pointerType==="mouse"&&t.button===2||this._manipulator.dragging))try{const{drawingMode:e,geometryType:n}=this;this._stagedPointerType=t.pointerType,this._stagedScreenPoint=t.screenPoint;const s=this._screenToMap(t.screenPoint);if(s==null||s==null||e==="freehand"&&n!=="point")return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(s),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),t.pointerType!=="mouse"&&this._processCursor(null),(e==="freehand"||n==="point"||n==="segment"&&this.numCommittedVertices===2||n==="segment"&&e==="hybrid"&&this.numCommittedVertices===1)&&this.complete()}finally{t.stopPropagation()}}_onImmediateDoubleClick(t){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),t.stopPropagation())}_onPointerMove(t){const e=Ys(t.x,t.y);this._stagedScreenPoint=e,this._stagedPointerType=t.pointerType,this._stagedPointerId=t.pointerId,this._isDragging?this._snappingOperation.abort():(t.stopPropagation(),this._processCursorMovementRelativeToSurface(e,t.pointerType))}_onKeyboardBasedChange(){this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(t,e){var c;const n=this._snappingOperation,s=this._screenToMap(t),o=this._requiresScenePoint?(c=this.drawSurface)==null?void 0:c.screenToMap(t):null;if(s==null)return this._hideDefaultCursor=!0,this._processCursor(null),void n.abort();this._hideDefaultCursor=!1;const r=this.snappingManager;if(r==null)return this._processCursor(s),void n.abort();const l=this._getSnappingContext(e);this._updatingHandles.addPromise(cs(n.snap({point:s,scenePoint:o},r,l)))}_applyConstraints(t){const{_constraint:e,constraints:n}=this;if(!t||!n||!e)return t;const{context:s}=n,o=En(t,s),r=o?e.closestTo(o):void 0;if(!r)return t;const l=$p(r,t,s),c=this.view.type==="2d"||s.elevationInfo.mode!=="absolute-height";return l!=null&&c&&this.constraintZ!=null&&this.hasZ&&(l.z=this.constraintZ),l}_screenToMap(t){var e;return t?(e=this._updateAndGetEffectiveDrawSurface())==null?void 0:e.screenToMap(t):null}_screenToMapDragEventStep(){let t=null;return e=>{if(e.action==="start"&&(t=this._screenToMap(e.screenStart)),t==null)return null;const n=this._screenToMap(e.screenEnd);return n!=null?{...e,mapStart:t,mapEnd:n}:null}}_vertexWithinPointerDistance(t,e){const s=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return s!=null&&hg(s,e,25)}_getSnappingContext(t){var n;const e=this._drawAtFixedElevation?(n=this.elevationDrawSurface)==null?void 0:n.defaultZ:null;return new Gs({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:e!=null?{value:e,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};function hg(i,t,e){const n=i.x-t.x,s=i.y-t.y;return n*n+s*s<=e}a([h()],T.prototype,"_hideDefaultCursor",void 0),a([h()],T.prototype,"_stagedPointerId",void 0),a([h()],T.prototype,"_isDragging",null),a([h()],T.prototype,"_snappingOperation",void 0),a([h()],T.prototype,"_snappingEnabled",null),a([h({constructOnly:!0})],T.prototype,"graphic",void 0),a([h()],T.prototype,"constraintsEnabled",void 0),a([h()],T.prototype,"constraints",void 0),a([h()],T.prototype,"_constraint",null),a([h()],T.prototype,"constraintZ",void 0),a([h()],T.prototype,"defaultZ",void 0),a([h()],T.prototype,"isDraped",void 0),a([h({value:fl})],T.prototype,"drawingMode",null),a([h({constructOnly:!0})],T.prototype,"elevationDrawSurface",void 0),a([h({constructOnly:!0})],T.prototype,"elevationInfo",void 0),a([h({constructOnly:!0,type:An})],T.prototype,"labelOptions",void 0),a([h({constructOnly:!0})],T.prototype,"geometryType",void 0),a([h({constructOnly:!0})],T.prototype,"hasM",void 0),a([h({constructOnly:!0})],T.prototype,"hasZ",void 0),a([h()],T.prototype,"cursor",void 0),a([h()],T.prototype,"effectiveCursor",null),a([h()],T.prototype,"loading",void 0),a([h({constructOnly:!0})],T.prototype,"manipulators",void 0),a([h({constructOnly:!0})],T.prototype,"drawSurface",void 0),a([h({constructOnly:!0})],T.prototype,"segmentLabels",void 0),a([h({constructOnly:!0})],T.prototype,"snappingManager",void 0),a([h({constructOnly:!0})],T.prototype,"snappingVisualizer",void 0),a([h()],T.prototype,"snapToSceneEnabled",void 0),a([h({readOnly:!0})],T.prototype,"cursorVertex",null),a([h({readOnly:!0})],T.prototype,"visualizationCursorVertex",null),a([h()],T.prototype,"committableVertex",null),a([h()],T.prototype,"firstVertex",void 0),a([h()],T.prototype,"lastVertex",void 0),a([h()],T.prototype,"secondToLastVertex",void 0),a([h()],T.prototype,"updating",null),a([h({constructOnly:!0})],T.prototype,"view",void 0),T=a([x("esri.views.draw.DrawOperation")],T);let ug=class{constructor(t,e=!1,n=0){this.view=t,this.hasZ=e,this.defaultZ=n,this.mapToScreen=s=>t.toScreen(s),this.screenToMap=e?s=>{const o=t.toMap(s);return o.z=n,o}:s=>t.toMap(s)}constrainZ(t){const{defaultZ:e}=this;return this.hasZ&&t.z!==e&&((t=oa(t)).z=e),t}};new de;let ai=class extends S{constructor(t){super(t),this._visualElementGraphics={regularVertices:null,activeVertex:null,activeEdge:null},this.activeFillSymbol=null,this.type="draw-2d",this._visualElementSymbols={outline:t.activeLineSymbol??nu,regularVertices:t.regularVerticesSymbol??su,activeVertex:t.activeVertexSymbol??ou,fill:t.activeFillSymbol},t.activeVertexSymbol||this.addHandles(U(()=>{var e,n;return(n=(e=this.view)==null?void 0:e.effectiveTheme)==null?void 0:n.accentColor},e=>{var s;if(!e)return;const n=this._visualElementSymbols.activeVertex.clone().set({color:e});(s=this._visualElementGraphics.activeVertex)==null||s.set("symbol",n),this._visualElementSymbols={...this._visualElementSymbols,activeVertex:n}},rs))}normalizeCtorArgs(t){const e={...t};return delete e.activeFillSymbol,delete e.activeVertexSymbol,delete e.regularVerticesSymbol,delete e.activeLineSymbol,e}initializeGraphic(t){return this._visualElementSymbols.fill!=null&&(t.symbol=this._visualElementSymbols.fill),this.internalGraphicsLayer.graphics.sort(Xi),q()}makeDrawOperation(){const{defaultZ:t,hasZ:e,view:n}=this;return this._createOrUpdateGraphic(null),new T({view:n,manipulators:this.manipulators,geometryType:Of(this.geometryType),drawingMode:this.mode,hasZ:e,defaultZ:t,snapToSceneEnabled:this.snapToScene,drawSurface:new ug(n,e,t),hasM:!1,snappingManager:this.snappingManager,snappingVisualizer:new eu(this.internalGraphicsLayer),graphic:this.graphic,cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(t){if(this.geometryType==="point")return q();const[e,n]=t,s=new C({x:e,y:n,spatialReference:this.view.spatialReference});return this._visualElementGraphics.activeVertex!=null?(this._visualElementGraphics.activeVertex.geometry=s,q()):(this._visualElementGraphics.activeVertex=new It({geometry:s,symbol:this._visualElementSymbols.activeVertex,attributes:{displayOrder:2}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeVertex),this.internalGraphicsLayer.graphics.sort(Xi),q(()=>{this._visualElementGraphics.activeVertex!=null&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeVertex),this._visualElementGraphics.activeVertex=ft(this._visualElementGraphics.activeVertex))}))}onCursorEdgeChanged(t){return this._visualElementGraphics.activeEdge!=null?(this._visualElementGraphics.activeEdge.geometry=t,q()):(this._visualElementGraphics.activeEdge=new It({geometry:t,symbol:this._visualElementSymbols.outline,attributes:{displayOrder:0}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeEdge),this.internalGraphicsLayer.graphics.sort(Xi),q(()=>{this._visualElementGraphics.activeEdge!=null&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeEdge),this._visualElementGraphics.activeEdge=ft(this._visualElementGraphics.activeEdge))}))}onRegularVerticesChanged(t){const e=new Rr({points:t,spatialReference:this.view.spatialReference});return this._visualElementGraphics.regularVertices!=null?(this._visualElementGraphics.regularVertices.geometry=e,q()):(this._visualElementGraphics.regularVertices=new It({geometry:e,symbol:this._visualElementSymbols.regularVertices,attributes:{displayOrder:1}}),this.internalGraphicsLayer.add(this._visualElementGraphics.regularVertices),this.internalGraphicsLayer.graphics.sort(Xi),q(()=>{this._visualElementGraphics.regularVertices!=null&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.regularVertices),this._visualElementGraphics.regularVertices=ft(this._visualElementGraphics.regularVertices))}))}};function Xi(i,t){var e,n;return(((e=i.attributes)==null?void 0:e.displayOrder)??-1/0)-(((n=t.attributes)==null?void 0:n.displayOrder)??-1/0)}a([h()],ai.prototype,"activeFillSymbol",void 0),a([h({readOnly:!0})],ai.prototype,"type",void 0),a([h({constructOnly:!0,nonNullable:!0})],ai.prototype,"view",void 0),ai=a([x("esri.views.2d.interactive.editingTools.draw.DrawGraphicTool2D")],ai);let To=class{get hovering(){return this.someManipulator(t=>t.hovering)}get grabbing(){return this.someManipulator(t=>t.grabbing)}get dragging(){return this.someManipulator(t=>t.dragging)}hasManipulator(t){return this.someManipulator(e=>e===t)}someManipulator(t){let e=!1;return this.forEachManipulator(n=>{!e&&t(n)&&(e=!0)}),e}};var Mi;(function(i){i[i.TRANSLATE_XY=0]="TRANSLATE_XY",i[i.SCALE=1]="SCALE",i[i.ROTATE=2]="ROTATE"})(Mi||(Mi={}));function Rl(i){let t=0,e=0,n=0;return i?(i.type==="cim"&&i.data.symbol&&"symbolLayers"in i.data.symbol&&i.data.symbol.symbolLayers&&i.data.symbol.symbolLayers.map(s=>{s.type==="CIMVectorMarker"&&s.anchorPoint&&(Math.abs(s.anchorPoint.x)>t&&(t=s.anchorPoint.x),Math.abs(s.anchorPoint.y)>e&&(e=s.anchorPoint.y),s.size!=null&&s.size>n&&(n=s.size))}),t=Ge(t),e=Ge(e),n=Ge(n),{offsetX:t,offsetY:e,size:n}):{offsetX:t,offsetY:e,size:n}}let W=class extends it{set graphic(t){this._circleCollisionCache=null,this._originalSymbol=t.symbol,this._set("graphic",t),this.attachSymbolChanged()}get elevationInfo(){const{layer:t}=this.graphic,e=t&&"elevationInfo"in t?t.elevationInfo:null,n=Th(this.graphic),s=e?e.offset:0;return new ch({mode:n,offset:s})}set focusedSymbol(t){t!==this._get("focusedSymbol")&&(this._set("focusedSymbol",t),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(t){t!==this._get("grabbing")&&(this._set("grabbing",t),this._updateGraphicSymbol())}set hovering(t){t!==this._get("hovering")&&(this._set("hovering",t),this._updateGraphicSymbol())}set selected(t){t!==this._get("selected")&&(this._set("selected",t),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:t?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}constructor(t){super(t),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new ke.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(t){const e=this.graphic;if(e.visible===!1)return null;const n=e.geometry;if(n==null)return null;const s=this._get("focusedSymbol"),o=s??e.symbol;return this.view.type==="2d"?this._intersectDistance2D(this.view,t,n,o):this._intersectDistance3D(this.view,t,e)}attach(){this.attachSymbolChanged(),this.layer!=null&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this.layer!=null&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=U(()=>{var t;return(t=this.graphic)==null?void 0:t.symbol},t=>{t!=null&&t!==this.focusedSymbol&&t!==this._originalSymbol&&(this._originalSymbol=t,this._focused&&this.focusedSymbol!=null&&(this.graphic.symbol=this.focusedSymbol))},qs)}detachSymbolChanged(){this._graphicSymbolChangedHandle!=null&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&this.focusedSymbol!=null?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(t,e,n,s){var l,c;if((s=s||hh(n))==null)return null;const o=1;let r=this._circleCollisionCache;if(n.type==="point"&&s.type==="cim"&&((l=s.data.symbol)==null?void 0:l.type)==="CIMPointSymbol"&&s.data.symbol.symbolLayers){const{offsetX:u,offsetY:p,size:d}=Rl(s),_=Io(e,$r),f=d/2,m=t.toScreen(n),y=m.x+u,w=m.y+p;return sn(_,[y,w])<f*f?o:null}if(n.type!=="point"||s.type!=="simple-marker")return qh(e,n,t)?o:null;if(r==null||!r.originalPoint.equals(n)){const u=n,p=t.spatialReference;if(uh(u.spatialReference,p)){const d=We(u,p);r={originalPoint:u.clone(),mapPoint:d,radiusPx:Ge(s.size)},this._circleCollisionCache=r}}if(r!=null){const u=Io(e,$r),p=(c=t.toScreen)==null?void 0:c.call(t,r.mapPoint);if(!p)return null;const d=r.radiusPx,_=p.x+Ge(s.xoffset),f=p.y-Ge(s.yoffset);return sn(u,[_,f])<d*d?o:null}return null}_intersectDistance3D(t,e,n){const s=t.toMap(e,{include:[n]});return s&&Bh(s,wr,t.renderSpatialReference)?pe(wr,t.state.camera.eye):null}};a([h({constructOnly:!0,nonNullable:!0})],W.prototype,"graphic",null),a([h()],W.prototype,"elevationInfo",null),a([h({constructOnly:!0,nonNullable:!0})],W.prototype,"view",void 0),a([h({value:null})],W.prototype,"focusedSymbol",null),a([h({constructOnly:!0})],W.prototype,"layer",void 0),a([h()],W.prototype,"interactive",void 0),a([h()],W.prototype,"selectable",void 0),a([h()],W.prototype,"grabbable",void 0),a([h({value:!1})],W.prototype,"grabbing",null),a([h()],W.prototype,"dragging",void 0),a([h()],W.prototype,"hovering",null),a([h({value:!1})],W.prototype,"selected",null),a([h()],W.prototype,"cursor",void 0),W=a([x("esri.views.interactive.GraphicManipulator")],W);const wr=g(),$r=ph();let Vl=class extends To{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._manipulator=this._createManipulator(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphic=null}forEachManipulator(t){t(this._manipulator,Mi.TRANSLATE_XY)}createDragPipeline(t,e){let n=null,s=null,o=0,r=0,l=0;const{offsetX:c,offsetY:u,size:p}=Rl(this._graphic.symbol);return He(this._manipulator,(d,_)=>{_.next(f=>{if(f.action==="start"){const m=t();n=m.editGeometryOperations,s=m.constraints}return f}).next($o(this._view)).next(f=>{const{x:m,y,z:w}=f.mapEnd;if(s&&(m+c<s.xmin||y+u-p<s.ymin||m+c>s.xmax||y+u-p>s.ymax))return f;(f.action==="start"||o===0&&r===0&&l===0)&&(o=f.mapStart.x,r=f.mapStart.y,l=f.mapStart.z);const b=m-o,$=y-r,P=w-l;o=m,r=y,l=w;const K=f.action==="start"?I.NEW_STEP:I.ACCUMULATE_STEPS,Q=n.move(b,$,P,K);return e(f,Q),f})})}_createManipulator(){const t=this._view,e=this._graphic;return new W({view:t,graphic:e,selectable:!0,cursor:"move"})}};const zt={up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",toggleOpacity:"t",shift:"Shift",primaryKey:zr},pg=1,dg=10,Tr=new _i("#009af2");let Bt=class extends B{constructor(i){super(i),this._isOpacityToggled=!1,this._isModifierActive=!1,this._factor=1,this._initialControlPoints=null,this._graphicsLayer=new Qs({internal:!0,listMode:"hide",visible:!1,effect:"drop-shadow(0px, 0px, 3px)"}),this._undoStack=[],this._redoStack=[],this._sharedUndoStack=[],this._sharedRedoStack=[],this._highlightHandle=null,this.activeHandle=0,this.type="reshape"}initialize(){this._initialize()}destroy(){const{map:i}=this.view;this._controlPointManipulations.forEach(t=>t.destroy()),this._controlPointEditGeometryOperations.forEach(t=>t.destroy()),i.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=ft(this._graphicsLayer),this._georeference=null,this._controlPointGraphics=null,this._controlPointManipulations=null,this._graphicsLayer=null,this._controlPointEditGeometryOperations=null,this._undoStack=null,this._redoStack=null,this._initialControlPoints=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _hasValidSpatialReference(){return Us(this.view.spatialReference)}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){const i=this._undoStack[this._undoStack.length-1];return i!=null&&this._controlPointEditGeometryOperations[i].canUndo}canRedo(){const i=this._redoStack[this._redoStack.length-1];return i!=null&&this._controlPointEditGeometryOperations[i].canRedo}undo(){if(this._undoStack.length>0){const i=this._undoStack.pop();this._controlPointEditGeometryOperations[i].undo(),this.updateGraphics(),this._redoStack.push(i)}}redo(){if(this._redoStack.length>0){const i=this._redoStack.pop();this._controlPointEditGeometryOperations[i].redo(),this.updateGraphics(),this._undoStack.push(i)}}refresh(){const{mediaElement:i}=this;if(i.georeference==null)return;const t=i.georeference;t.type==="control-points"&&t.coords!=null&&(this._georeference=t,this._georeference.controlPoints.forEach(({mapPoint:e},n)=>{const s=this._controlPointEditGeometryOperations[n],o=s.data.components[0].vertices[0];s.setVertexPosition(o,s.data.coordinateHelper.pointToVector(e))}),this.updateGraphics())}reset(){this._georeference.controlPoints=this._initialControlPoints,this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const i=this._georeference,t=i.controlPoints,e=t[0].mapPoint.spatialReference,n=this._hasValidSpatialReference;this._georeference.controlPoints=this._controlPointEditGeometryOperations.map((s,o)=>{const r=s.data.geometry;return this._controlPointGraphics[o].geometry=r,{mapPoint:We(r,e),sourcePoint:n?t[o].sourcePoint:i.toSource(r)}})}updateActiveHandle(i){if(this.activeHandle===i)return;const t=this._controlPointGraphics[this.activeHandle].symbol.clone();Lo(t,this.view.effectiveTheme.accentColor),this._controlPointGraphics[this.activeHandle].symbol=t;const e=this._controlPointGraphics[i].symbol.clone();Lo(e,Tr),this._controlPointGraphics[i].symbol=e,this.activeHandle=i,this.view.surface===document.activeElement&&this.highlightActiveHandle()}async highlightActiveHandle(){this.removeHighlightActiveHandle();const i=await this.view.whenLayerView(this._graphicsLayer);this._highlightHandle=i.highlight(this._controlPointGraphics[this.activeHandle])}removeHighlightActiveHandle(){this._highlightHandle&&this._highlightHandle.remove()}setSharedUndoStack(i){this._sharedUndoStack=i}setSharedRedoStack(i){this._sharedRedoStack=i}async _initialize(){const{view:i,mediaElement:t}=this;if(t.georeference==null)return;const e=t.georeference;e.type==="control-points"&&e.coords!=null&&(this._georeference=e,this._initialControlPoints=this._georeference.controlPoints,i.map.addMany([this._graphicsLayer]),i.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._controlPointEditGeometryOperations=this._georeference.controlPoints.map(({mapPoint:n})=>wo.fromGeometry(We(n,i.spatialReference),xi.Local)),this._controlPointGraphics=this._controlPointEditGeometryOperations.map((n,s)=>new It({symbol:new di({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,colorLocked:!0,anchorPoint:{x:0,y:-15.75},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:9,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:84.3,ymax:84.3},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[83.2,32.5],[84.3,40.7],[83.8,48.9],[81.7,56.9],[78.1,64.3],[73,70.9],[66.9,76.4],[59.7,80.5],[51.9,83.2],[43.7,84.3],[35.4,83.8],[27.4,81.7],[20,78],[13.4,73],[7.9,66.8],[3.8,59.7],[1.1,51.9],[0,43.7],[.5,35.4],[2.6,27.4],[6.3,20],[11.3,13.4],[17.5,7.9],[24.7,3.8],[32.5,1.1],[39.8,.1],[47.1,.3],[54.3,1.8],[61.1,4.5],[67.4,8.4],[72.9,13.3],[77.4,19.1],[80.9,25.5],[83.2,32.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[84.3,0],[84.3,84.3],[0,84.3],[0,0]]]}},rotation:0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-11.25},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:22.5,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:197.7,ymax:294.7},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[98.9,0],[119.4,23.2],[139.4,49.3],[156.8,75.2],[171.2,100.8],[182.4,125.3],[190.6,148.8],[195.7,171.4],[197.7,192.9],[197.7,195.8],[197.7,200.3],[197.6,202.5],[197.5,204.8],[197.3,207.1],[197,209.4],[196.7,211.7],[196.4,214.1],[196,216.4],[195.5,218.7],[195,221.1],[194.4,223.4],[193.7,225.8],[193,228.1],[192.2,230.5],[191.4,232.8],[190.5,235.1],[189.5,237.5],[188.5,239.7],[187.4,242],[186.2,244.3],[185,246.5],[183.7,248.7],[182.4,250.9],[181,253.1],[179.5,255.2],[178,257.3],[176.4,259.4],[174.7,261.4],[173.1,263.3],[171.3,265.3],[169.5,267.2],[167.7,269],[165.8,270.8],[163.9,272.5],[161.9,274.2],[159.9,275.8],[157.8,277.4],[155.7,278.9],[153.6,280.4],[151.4,281.7],[149.2,283.1],[147,284.4],[144.8,285.6],[142.5,286.7],[140.3,287.8],[138,288.8],[135.7,289.8],[133.4,290.7],[131,291.5],[128.7,292.3],[126.4,293],[124,293.6],[121.7,294.2],[119.4,294.7],[117,295.2],[114.7,295.6],[112.4,296],[110.1,296.3],[107.8,296.5],[105.5,296.7],[103.3,296.8],[101.1,296.9],[98.8,296.9],[83.1,295.7],[67.8,292],[53.3,285.9],[39.9,277.5],[28.1,267.2],[18,255.1],[10,241.5],[4.2,226.9],[.9,211.5],[0,195.8],[.1,192.9],[2.1,171.4],[7.2,148.8],[15.4,125.3],[26.6,100.8],[41,75.2],[58.4,49.3],[78.4,23.2],[98.9,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:s===this.activeHandle?Tr.toArray():this.view.effectiveTheme.accentColor.toArray()}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[197.7,0],[197.7,294.7],[0,294.7],[0,0]]]}},rotation:0}],haloSize:1,scaleX:1,angleAlignment:"Display",angle:0}}}),geometry:n.data.geometry})),this._graphicsLayer.graphics.addMany([...this._controlPointGraphics]),this._controlPointManipulations=this._controlPointGraphics.map(n=>new Vl({tool:this,view:i,graphic:n})),this.addHandles([...this._controlPointManipulations.map((n,s)=>n.createDragPipeline(this._getInfo.bind(this,s),(o,r)=>{o.action==="start"&&(this._undoStack.push(s),this._redoStack=[],this._sharedUndoStack.push({tool:this,operation:r}),this._sharedRedoStack.length=0),this.updateGraphics()})),U(()=>this.view.scale,()=>this.active?this.updateGraphics():null)]),this._controlPointManipulations.forEach((n,s)=>{const o=r=>{this.addHandles([r.events.on(["click","grab-changed"],l=>this.updateActiveHandle(s))])};n.forEachManipulator(o)}),this.addHandles([i.on("key-down",n=>{i.activeTool===this&&(n.key!==zt.shift||n.repeat||(this._isModifierActive=!0,n.stopPropagation()),n.key!==zt.toggleOpacity||n.repeat||(t.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled,n.stopPropagation()),n.key!==zt.primaryKey||n.repeat||(this._factor=dg,n.stopPropagation()),this._isModifierActive&&(n.key===zt.up&&(this._move(0,this._factor),n.stopPropagation()),n.key===zt.down&&(this._move(0,-this._factor),n.stopPropagation()),n.key===zt.left&&(this._move(-this._factor,0),n.stopPropagation()),n.key===zt.right&&(this._move(this._factor,0),n.stopPropagation())))}),i.on("key-up",n=>{i.activeTool===this&&(n.key===zt.shift&&(this._isModifierActive=!1,n.stopPropagation()),n.key===zt.primaryKey&&(this._factor=pg,n.stopPropagation()))})]))}async _loadProjectionEngine(){const i=this._georeference.controlPoints[0].mapPoint;return Xr(i.spatialReference,this.view.spatialReference)}_getInfo(i){return{editGeometryOperations:this._controlPointEditGeometryOperations[i],constraints:this._hasValidSpatialReference?null:{xmin:0,ymin:0,xmax:this._georeference.width,ymax:this._georeference.height}}}_move(i,t){const e=this._controlPointEditGeometryOperations[this.activeHandle].move(i*this.view.resolution,t*this.view.resolution,0,I.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:e}),this._sharedRedoStack.length=0,this.updateGraphics()}};a([h()],Bt.prototype,"_hasValidSpatialReference",null),a([h()],Bt.prototype,"activeHandle",void 0),a([h({constructOnly:!0,nonNullable:!0})],Bt.prototype,"mediaElement",void 0),a([h({readOnly:!0})],Bt.prototype,"type",void 0),a([h({constructOnly:!0})],Bt.prototype,"view",void 0),Bt=a([x("esri.views.2d.interactive.editingTools.ControlPointsTransformTool")],Bt);function Al(i,t){i.action==="start"?t.cursor="grabbing":t.cursor="grab"}class fg{constructor(){this._lastDragEvent=null,this.next=new Si,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&this._lastDragEvent!=null){const e={...this._lastDragEvent,action:"update"};t&&this._adjustScaleFactors(e),this.next.execute(e)}this._enabled=t}createDragEventPipelineStep(){return this._lastDragEvent=null,t=>(this._lastDragEvent=t.action!=="end"?{...t}:null,this._enabled&&this._adjustScaleFactors(t),t)}_adjustScaleFactors(t){const e=t.direction[0]!==0&&t.direction[1]!==0?Math.max(Math.abs(t.factor1),Math.abs(t.factor2)):t.direction[0]===0?Math.abs(t.factor2):Math.abs(t.factor1);t.factor1=t.factor1<0?-e:e,t.factor2=t.factor2<0?-e:e}}let gg=class{constructor(){this._lastDragEvent=null,this.next=new Si,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&this._lastDragEvent!=null){const e={...this._lastDragEvent,action:"update"};t&&this._adjustRotateAngle(e),this.next.execute(e)}this._enabled=t}createDragEventPipelineStep(){return this._lastDragEvent=null,t=>(this._lastDragEvent=t.action!=="end"?{...t}:null,this._enabled&&this._adjustRotateAngle(t),t)}_adjustRotateAngle(t){const e=Kr(t.rotateAngle);t.rotateAngle=Br(5*Math.round(e/5))}};function mg(i,t,e,n=!1){const s=Math.atan2(t.y-e.y,t.x-e.x)-Math.atan2(i.y-e.y,i.x-e.x),o=Math.atan2(Math.sin(s),Math.cos(s));return n?o:Kr(o)}function Ol(i,t){return yg(i,t,!1)}function yg(i,t,e){if(i instanceof yl){if(i.operation instanceof xl)return _g(i.operation,t,e),!0;if(i.operation instanceof $l)return vg(i.operation,t,e),!0;if(i.operation instanceof In)return bg(i.operation,t,e),!0}return!1}function _g(i,t,e=!1){const n=e?-1:1,s=ue(n*i.dx,n*i.dy,n*i.dz);pt(t.origin,t.origin,s),bn(t)}function vg(i,t,e=!1){const n=e?-i.angle:i.angle;Go(t.basis1,t.basis1,zo,n),Go(t.basis2,t.basis2,zo,n),bn(t)}function bg(i,t,e=!1){const n=e?1/i.factor1:i.factor1,s=e?1/i.factor2:i.factor2;fe(t.basis1,t.basis1,n),fe(t.basis2,t.basis2,s),on(t.origin,t.origin,i.origin,i.axis1,n),on(t.origin,t.origin,i.origin,i.axis2,s),bn(t)}function xg(i,t,e,n){n||(n=Ti());const s=qt(ii.get(),i[1],-i[0]),o=qt(ii.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=qt(ii.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),l=ii.get();t.components.forEach(p=>p.vertices.forEach(({pos:d})=>{qt(l,ye(i,d),ye(s,d)),dh(o,o,l),fh(r,r,l)}));const c=1e-6,u=qt(ii.get(),r[0]-o[0]<c?e/2:0,r[1]-o[1]<c?e/2:0);return j(o,o,u),Nn(r,r,u),Do(n.basis1,i,(r[0]-o[0])/2),Do(n.basis2,s,(r[1]-o[1])/2),qt(n.origin,o[0]*i[0]+o[1]*s[0],o[0]*i[1]+o[1]*s[1]),Nn(n.origin,n.origin,n.basis1),Nn(n.origin,n.origin,n.basis2),bn(n),n}class wg extends To{constructor(t){super(),this._handles=new Qr,this._originCache=g(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._snapRotation=t.snapRotation,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",e=>Al(e,this._manipulator))]),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this._handles.destroy(),this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._snapRotation=null,this._graphic=null,this._handles=null,this._originCache=null}forEachManipulator(t){t(this._manipulator,Mi.ROTATE)}createDragPipeline(t,e){let n=null,s=null;return He(this._manipulator,(o,r)=>{r.next(l=>{if(l.action==="start"){o.cursor="grabbing";const c=t();n=c.plane,s=c.editGeometryOperations}return l}).next($o(this._view)).next(l=>({...l,rotateAngle:mg(l.mapStart,l.mapEnd,{x:n.origin[0],y:n.origin[1]},!0)})).next(this._snapRotation.createDragEventPipelineStep(),this._snapRotation.next).next(l=>{const c=lt(this._originCache,n.origin),u=l.action==="start"?I.NEW_STEP:I.ACCUMULATE_STEPS,p=s.rotate(c,l.rotateAngle,u,ot.REPLACE);return Ol(p,n),e(l,p),l}).next(l=>(l.action==="end"&&(o.cursor="grab"),l))})}_createManipulator(){const t=this._view,e=this._graphic;return new W({view:t,graphic:e,selectable:!0,cursor:"grab"})}}const es=10,Er=1e-6,$g=.3;function Sr(i){const t=wi(i.basis1),e=wi(i.basis2);return $g*Math.min(t,e)}class Tg extends To{constructor(t){super(),this._handles=new Qr,this._planeStart=Ti(),this._displayPlaneStart=Ti(),this._originCache=g(),this._axisCache=L(),this._renderStartCache=g(),this._renderEndCache=g(),this._resizeOriginCache=g(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._direction=t.direction,this._preserveAspectRatio=t.preserveAspectRatio,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",e=>Al(e,this._manipulator))]),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this._handles.destroy(),this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._graphic=null,this._manipulator=null,this._direction=null,this._handles=null,this._planeStart=null,this._displayPlaneStart=null,this._originCache=null,this._axisCache=null,this._renderStartCache=null,this._renderEndCache=null,this._resizeOriginCache=null,this._preserveAspectRatio=null}forEachManipulator(t){t(this._manipulator,Mi.SCALE)}createDragPipeline(t,e){let n=null,s=null,o=null,r=0,l=null,c=null;const u=this._planeStart,p=this._displayPlaneStart,d=this._direction;return He(this._manipulator,(_,f)=>{f.next(m=>{if(m.action==="start"){_.cursor="grabbing";const y=t();n=y.plane,s=y.displayPlane,o=y.editGeometryOperations,r=es*this._view.resolution,Qi(n,u),Qi(s,p);const w=Zr(o.data.spatialReference);l=w?w.valid[1]-w.valid[0]-3*es*this._view.resolution:null}return m}).next($o(this._view)).next(m=>{const y=lt(this._renderStartCache,[m.mapStart.x,m.mapStart.y,0]),w=lt(this._renderEndCache,[m.mapEnd.x,m.mapEnd.y,0]),b=lt(this._resizeOriginCache,p.origin);G(b,b,p.basis1,-d[0]),G(b,b,p.basis2,-d[1]),Tt(w,w,b),Tt(y,y,b);const $=d[0]!==0&&d[1]!==0,P=Sr(p),K=Sr(s)/P,Q=(ht,ei)=>{if(ht===0)return 1;let Gt=wi(ei),ie=.5*ht*Z(ei,w)/Gt;const xe=ie<0?-1:1;$&&(ie+=(Gt-.5*ht*Z(ei,y)/Gt)*xe*K);const Ln=Gt<1.5*r?1:Er;return Gt=Math.max(Gt-r,Er),xe>0&&(ie-=es*this._view.resolution),xe*Math.max(xe*(ie/Gt),Ln)},Y=Q(d[0],p.basis1),mt=Q(d[1],p.basis2);return{...m,direction:d,factor1:Y,factor2:mt}}).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(m=>{const y=lt(this._originCache,u.origin);G(y,y,u.basis1,-d[0]),G(y,y,u.basis2,-d[1]);const w=qt(this._axisCache,u.basis1[0],u.basis1[1]);Xs(w,w);const b=o.data.allVertices,$=m.action==="start"?I.NEW_STEP:I.ACCUMULATE_STEPS,P=o.scaleVertices(b,y,w,m.factor1,m.factor2,$,ot.REPLACE);return l&&l<o.data.geometry.extent.width&&c?o.updateVertices(b,c):(Qi(u,n),Ol(P,n),c=P.operation,e(m,P)),m}).next(m=>(m.action==="end"&&(_.cursor="grab"),m))})}_createManipulator(){return new W({view:this._view,graphic:this._graphic,selectable:!0,cursor:"grab"})}}function Eg(i){return(i==null?void 0:i.type)==="graphic"}function Sg(i){return i.find(Eg)??null}const Mg=80,Pg=10,kg=30,Cg=[[1,1],[1,-1],[-1,-1],[-1,1],[1,0],[0,-1],[-1,0],[0,1]],Mr=1,Rg=10;let _t=class extends B{constructor(i){super(i),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._planeCache=Ti(),this._displayPlaneCache=Ti(),this._mainAxisCache=L(),this._rotationHandleCache=g(),this._cornerA=g(),this._cornerB=g(),this._cornerC=g(),this._cornerD=g(),this._avgAB=g(),this._avgBC=g(),this._avgCD=g(),this._avgDA=g(),this._preserveAspectRatio=new fg,this._snapRotation=new gg,this._graphicsLayer=new Qs({internal:!0,listMode:"hide",visible:!1}),this._sharedUndoStack=[],this._sharedRedoStack=[],this._isOpacityToggled=!1,this._factor=Mr,this.preserveAspectRatio=null,this.snapRotation=null,this.type="transform"}initialize(){this._initialize()}destroy(){const{map:i}=this.view;this._dragManipulation.destroy(),this._rotateManipulation.destroy(),this._scaleManipulations.forEach(t=>t.destroy()),this._editGeometryOperations.destroy(),i.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=ft(this._graphicsLayer),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._preserveAspectRatio=null,this._snapRotation=null,this._planeCache=null,this._displayPlaneCache=null,this._rotationHandleCache=null,this._mainAxisCache=null,this._cornerA=null,this._cornerB=null,this._cornerC=null,this._cornerD=null,this._avgAB=null,this._avgBC=null,this._avgCD=null,this._avgDA=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _plane(){const i=this._graphic.geometry;if(i==null)return null;const t=this._editGeometryOperations.data,e=t.components[0].edges[0],n=j(this._mainAxisCache,e.leftVertex.pos,e.rightVertex.pos);Xs(n,n);let s=Mg*this.view.resolution;const o=this.view.spatialReference;return Qe(o,i.spatialReference)&&(s*=vi(o)/vi(i.spatialReference)),xg(n,t,s,this._planeCache)}get _displayPlane(){const i=this._plane;if(!i)return null;const t=this._displayPlaneCache;Qi(i,t);const e=Pg*this.view.resolution;return fe(t.basis1,t.basis1,1+e/wi(t.basis1)),fe(t.basis2,t.basis2,1+e/wi(t.basis2)),t}get _backgroundGraphicGeometry(){const i=this._displayPlane;if(!i)return null;const t=this.view.spatialReference;return this._updateDisplayPlaneConrers(i),new De({spatialReference:t,rings:[[this._cornerA,this._cornerB,this._cornerC,this._cornerD,this._cornerA]]})}get _rotateGraphicGeometry(){const i=this._plane;if(!i)return null;const t=this._rotationHandleCache;return le(t,i.basis1),fe(t,t,kg*this.view.resolution),pt(t,t,i.origin),pt(t,t,i.basis1),new C({x:t[0],y:t[1],spatialReference:this.view.spatialReference})}get _scaleGraphicGeometries(){const i=this._displayPlane;if(!i)return[];const t=this.view.spatialReference;this._updateDisplayPlaneConrers(i);const{_cornerA:e,_cornerB:n,_cornerC:s,_cornerD:o}=this,r=Se(this._avgAB,e,n,.5),l=Se(this._avgBC,n,s,.5),c=Se(this._avgCD,s,o,.5),u=Se(this._avgDA,o,e,.5);return[new C({x:e[0],y:e[1],spatialReference:t}),new C({x:n[0],y:n[1],spatialReference:t}),new C({x:s[0],y:s[1],spatialReference:t}),new C({x:o[0],y:o[1],spatialReference:t}),new C({x:r[0],y:r[1],spatialReference:t}),new C({x:l[0],y:l[1],spatialReference:t}),new C({x:c[0],y:c[1],spatialReference:t}),new C({x:u[0],y:u[1],spatialReference:t})]}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this._editGeometryOperations.undo(),this.updateGraphics()}redo(){this._editGeometryOperations.redo(),this.updateGraphics()}refresh(){const{view:i,target:t}=this,e="georeference"in t?t.georeference.coords:t.geometry,n=this._editGeometryOperations,s=n.data.components[0].vertices,o=dn.fromGeometry(We(e,i.spatialReference),xi.Local).components[0].vertices;s.forEach((r,l)=>{n.setVertexPosition(r,o[l].pos)}),this.updateGraphics()}reset(){const{target:i}=this;if("georeference"in i){const t=i.georeference;t.type==="control-points"&&(t.controlPoints=this._initialControlPoints)}else i.geometry=this._initialGeometry;this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const i=this._editGeometryOperations.data.geometry;"georeference"in this.target&&(this.target.georeference.coords=i),this._graphic.geometry=i,this._backgroundGraphic.geometry=this._backgroundGraphicGeometry,this._rotateGraphic.geometry=this._rotateGraphicGeometry,this._scaleGraphicGeometries.forEach((t,e)=>{this._scaleGraphics[e].geometry=t})}setSharedUndoStack(i){this._sharedUndoStack=i}setSharedRedoStack(i){this._sharedRedoStack=i}async _initialize(){const{view:i,target:t}=this;if("georeference"in t){const s=t.georeference;this._graphic=new It({geometry:s.coords}),this._initialControlPoints=s.type==="control-points"?s.controlPoints:null}else this._graphic=t,this._initialGeometry=t.geometry;i.map.addMany([this._graphicsLayer]),i.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._editGeometryOperations=wo.fromGeometry(We(this._graphic.geometry,i.spatialReference),xi.Local),this._backgroundGraphic=new It({symbol:new gh({color:"transparent",outline:{type:"simple-line",color:i.effectiveTheme.accentColor,width:2}}),geometry:this._backgroundGraphicGeometry}),this._rotateGraphic=new It({symbol:new Ne({color:Uo(i.effectiveTheme.accentColor),outline:{type:"simple-line",color:i.effectiveTheme.accentColor,width:1}}),geometry:this._rotateGraphicGeometry}),this._scaleGraphics=this._scaleGraphicGeometries.map(s=>new It({symbol:new Ne({size:6,style:"square",color:Uo(i.effectiveTheme.accentColor),outline:{type:"simple-line",color:i.effectiveTheme.accentColor,width:1}}),geometry:s})),this._graphicsLayer.graphics.addMany([this._backgroundGraphic,this._rotateGraphic,...this._scaleGraphics]),this._dragManipulation=new Vl({tool:this,view:i,graphic:this._graphic}),this._rotateManipulation=new wg({tool:this,view:i,graphic:this._rotateGraphic,snapRotation:this._snapRotation}),this._scaleManipulations=this._scaleGraphics.map((s,o)=>new Tg({tool:this,view:i,graphic:s,direction:Cg[o],preserveAspectRatio:this._preserveAspectRatio})),this.addHandles([this._dragManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),this._rotateManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),...this._scaleManipulations.map(s=>s.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this))),U(()=>this.view.scale,()=>this.active?this.updateGraphics():null),i.on("click",async s=>{if(i.activeTool!=null&&i.activeTool!==this)return;const o=mh(s),r=[];i.map.allLayers.forEach(u=>{u.type!=="vector-tile"&&u.type!=="imagery"||r.push(u)});const l=await this.view.hitTest(o,{exclude:r}),c=l.results;if(c.length===0)i.activeTool=null;else{const u=Sg(l.results),p="georeference"in t,d=c.map(f=>f.type==="media"?f.element:null).filter(Boolean),_=new Set([...this._graphicsLayer.graphics,p?null:t].filter(Boolean));p&&d.includes(t)||u!=null&&_.has(u.graphic)?i.activeTool==null&&(i.activeTool=this):i.activeTool=null}})]);const e=s=>{this.addHandles(s.events.on("grab-changed",o=>{"georeference"in t&&(o.action==="start"?t.opacity*=.5:o.action==="end"&&(t.opacity*=2))}))};this._dragManipulation.forEachManipulator(e),this._rotateManipulation.forEachManipulator(e),this._scaleManipulations.forEach(s=>s.forEachManipulator(e));const n=new Pp;n.addToggle(kt.preserveAspectRatio,()=>{this.preserveAspectRatio==null&&(this._preserveAspectRatio.enabled=!this._preserveAspectRatio.enabled)}),n.addToggle(kt.rotateIncrements,()=>{this.snapRotation==null&&(this._snapRotation.enabled=!this._snapRotation.enabled)}),n.add(kt.toggleOpacity,()=>{"georeference"in t&&(t.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled)}),n.addToggle(kt.factorModifier,s=>this._factor=s.type==="key-down"?Rg:Mr),n.add(kt.scaleUp,()=>this._scale(this._factor)),n.add(kt.scaleDown,()=>this._scale(-this._factor)),n.add(kt.moveUp,()=>this._move(0,this._factor)),n.add(kt.moveDown,()=>this._move(0,-this._factor)),n.add(kt.moveLeft,()=>this._move(-this._factor,0)),n.add(kt.moveRight,()=>this._move(this._factor,0)),this.addHandles([i.on("key-down",s=>{i.activeTool===this&&n.dispatch(i.inputManager,s)}),i.on("key-up",s=>{i.activeTool===this&&n.dispatch(i.inputManager,s)})])}async _loadProjectionEngine(){const i=this._graphic.geometry;return Xr(i.spatialReference,this.view.spatialReference)}_updateDisplayPlaneConrers(i){const{basis1:t,basis2:e,origin:n}=i,s=this._cornerA;pt(s,n,t),pt(s,s,e);const o=this._cornerB;pt(o,n,t),Tt(o,o,e);const r=this._cornerC;Tt(r,n,t),Tt(r,r,e);const l=this._cornerD;Tt(l,n,t),pt(l,l,e)}_getInfo(){return{editGeometryOperations:this._editGeometryOperations,plane:this._plane,displayPlane:this._displayPlane}}_updateGraphics(i,t){i.action==="start"&&(this._sharedUndoStack.push({tool:this,operation:t}),this._sharedRedoStack.length=0),this.updateGraphics()}_scale(i){var o;const t=this._editGeometryOperations,e=(o=t.data.geometry.extent)==null?void 0:o.width,n=(e+i*this.view.resolution)/e,s=t.scale(this._plane.origin,yh,n,n,I.NEW_STEP,ot.REPLACE);this._sharedUndoStack.push({tool:this,operation:s}),this._sharedRedoStack.length=0,this.updateGraphics()}_move(i,t){const e=this._editGeometryOperations.move(i*this.view.resolution,t*this.view.resolution,0,I.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:e}),this._sharedRedoStack.length=0,this.updateGraphics()}};a([h()],_t.prototype,"_plane",null),a([h()],_t.prototype,"_backgroundGraphicGeometry",null),a([h()],_t.prototype,"_rotateGraphicGeometry",null),a([h()],_t.prototype,"_scaleGraphicGeometries",null),a([h()],_t.prototype,"preserveAspectRatio",void 0),a([h()],_t.prototype,"snapRotation",void 0),a([h({constructOnly:!0,nonNullable:!0})],_t.prototype,"target",void 0),a([h({readOnly:!0})],_t.prototype,"type",void 0),a([h({constructOnly:!0})],_t.prototype,"view",void 0),_t=a([x("esri.views.2d.interactive.editingTools.TransformTool")],_t);const Ki={redo:"r",undo:"z"};let ne=class extends it{constructor(i){super(i),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=[],this._sharedRedoStack=[],this._originalOpacity=null,this.activeHandle=0}initialize(){const{view:i,mediaElement:t,preserveAspectRatio:e,snapRotation:n,advancedMode:s}=this;this._originalOpacity=t.opacity,this._transformTool=new _t({target:t,view:i,preserveAspectRatio:e,snapRotation:n}),this._controlPointsTransformTool=new Bt({mediaElement:t,view:i}),this._advancedModeTransformTool=new Bt({mediaElement:s.mediaElement,view:s.view}),this._transformTool.setSharedUndoStack(this._sharedUndoStack),this._transformTool.setSharedRedoStack(this._sharedRedoStack),this._controlPointsTransformTool.setSharedUndoStack(this._sharedUndoStack),this._controlPointsTransformTool.setSharedRedoStack(this._sharedRedoStack),this._advancedModeTransformTool.setSharedUndoStack(this._sharedUndoStack),this._advancedModeTransformTool.setSharedRedoStack(this._sharedRedoStack);const o=t.georeference,r=s.mediaElement.georeference;s.view.tools.addMany([this._advancedModeTransformTool]),"controlPoints"in r&&"controlPoints"in o&&this.addHandles([s.view.on("key-down",l=>{l.key===Ki.undo&&this.canUndo()&&(this.undo(),l.stopPropagation()),l.key===Ki.redo&&this.canRedo()&&(this.redo(),l.stopPropagation())}),s.view.on("focus",async l=>{this._controlPointsTransformTool.removeHighlightActiveHandle(),this._advancedModeTransformTool.highlightActiveHandle()}),U(()=>r.controlPoints,l=>{var c;o.controlPoints=l.map(({sourcePoint:u},p)=>({sourcePoint:u,mapPoint:o.controlPoints[p].mapPoint})),(c=this._activeTool)==null||c.refresh()}),U(()=>this._controlPointsTransformTool.activeHandle,l=>{this._advancedModeTransformTool.updateActiveHandle(l),this.activeHandle=l}),U(()=>this._advancedModeTransformTool.activeHandle,l=>{this._controlPointsTransformTool.updateActiveHandle(l),this.activeHandle=l})]),this.addHandles([i.on("key-down",l=>{l.key===Ki.undo&&this.canUndo()&&(this.undo(),l.stopPropagation()),l.key===Ki.redo&&this.canRedo()&&(this.redo(),l.stopPropagation())}),i.on("focus",async l=>{this._advancedModeTransformTool.removeHighlightActiveHandle(),this._controlPointsTransformTool.highlightActiveHandle()})]),i.tools.addMany([this._transformTool,this._controlPointsTransformTool]),i.activeTool=this._transformTool,this._activeTool=this._transformTool,i.focus()}destroy(){var i,t;(i=this._transformTool)==null||i.destroy(),(t=this._controlPointsTransformTool)==null||t.destroy(),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=null,this._sharedRedoStack=null}canUndo(){return this._sharedUndoStack.length>0}canRedo(){return this._sharedRedoStack.length>0}undo(){var i;if(this._sharedUndoStack.length>0){const{tool:t,operation:e}=this._sharedUndoStack.pop();t!==this._activeTool&&t.refresh(),e.undo(),t.updateGraphics(),this._sharedRedoStack.push({tool:t,operation:e}),this._activeTool!==t&&((i=this._activeTool)==null||i.refresh())}}redo(){var i;if(this._sharedRedoStack.length>0){const{tool:t,operation:e}=this._sharedRedoStack.pop();t!==this._activeTool&&t.refresh(),e.apply(),t.updateGraphics(),this._sharedUndoStack.push({tool:t,operation:e}),this._activeTool!==t&&((i=this._activeTool)==null||i.refresh())}}refresh(){this._activeTool.refresh()}reset(){this._activeTool.reset(),this._advancedModeTransformTool.reset()}async enableAdvancedMode(){this.view.activeTool=this._controlPointsTransformTool,this._activeTool=this._controlPointsTransformTool,this._activeTool.refresh(),await this.advancedMode.view.when(),this.advancedMode.view.activeTool=this._advancedModeTransformTool,this._originalOpacity=this._controlPointsTransformTool.mediaElement.opacity,this._controlPointsTransformTool.mediaElement.opacity=.25*this._originalOpacity}disableAdvancedMode(){this.view.activeTool=this._transformTool,this._activeTool=this._transformTool,this._activeTool.refresh(),this.advancedMode.view.activeTool=null,this._controlPointsTransformTool.mediaElement.opacity=this._originalOpacity}};a([h()],ne.prototype,"activeHandle",void 0),a([h({constructOnly:!0})],ne.prototype,"advancedMode",void 0),a([h()],ne.prototype,"preserveAspectRatio",void 0),a([h()],ne.prototype,"snapRotation",void 0),a([h({constructOnly:!0,nonNullable:!0})],ne.prototype,"mediaElement",void 0),a([h({constructOnly:!0})],ne.prototype,"view",void 0),ne=a([x("esri.views.2d.interactive.editingTools.MediaTransformToolsWrapper")],ne);export{Bt as ControlPointsTransformTool,ai as DrawGraphicTool2D,ne as MediaTransformToolsWrapper,_t as TransformTool};
