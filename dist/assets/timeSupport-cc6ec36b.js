import{Q as C,hj as j,aA as Z,dK as D,a4 as y,a5 as g,a6 as J,S as V,b1 as z,hk as B,hl as K,a0 as k,ci as b,_ as E,hm as L,hn as W,ho as Y,hp as H,s as $,ae as x,cm as Q}from"./index-001ef34f.js";import{d as X,h as P,b as ee,P as G,$ as te,H as re,U as ie,K as M}from"./featureConversionUtils-c245f2d8.js";import{t as S}from"./OptimizedGeometry-33b2eb0d.js";import{f as I,g as F}from"./projectionSupport-69b17fb5.js";const ne=new C({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),_=Object.freeze({}),A=new S,se=new S,v=new S,m={esriGeometryPoint:G,esriGeometryPolyline:te,esriGeometryPolygon:re,esriGeometryMultipoint:ie};function be(e,t,r,i=e.hasZ,n=e.hasM){if(t==null)return null;const l=e.hasZ&&i,s=e.hasM&&n;if(r){const a=P(v,t,e.hasZ,e.hasM,"esriGeometryPoint",r,i,n);return G(a,l,s)}return G(t,l,s)}function h(e,t,r,i,n,l,s=t,a=r){var R,p,d;const o=t&&s,u=r&&a,c=i!=null?"coords"in i?i:i.geometry:null;if(c==null)return null;if(n){let f=X(se,c,t,r,e,n,s,a);return l&&(f=P(v,f,o,u,e,l)),((R=m[e])==null?void 0:R.call(m,f,o,u))??null}if(l){const f=P(v,c,t,r,e,l,s,a);return((p=m[e])==null?void 0:p.call(m,f,o,u))??null}return ee(A,c,t,r,s,a),((d=m[e])==null?void 0:d.call(m,A,o,u))??null}async function xe(e,t,r){const{outFields:i,orderByFields:n,groupByFieldsForStatistics:l,outStatistics:s}=e;if(i)for(let a=0;a<i.length;a++)i[a]=i[a].trim();if(n)for(let a=0;a<n.length;a++)n[a]=n[a].trim();if(l)for(let a=0;a<l.length;a++)l[a]=l[a].trim();if(s)for(let a=0;a<s.length;a++)s[a].onStatisticField&&(s[a].onStatisticField=s[a].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),le(e,t,r)}async function le(e,t,r){var l;if(!e)return null;let{where:i}=e;if(e.where=i=i&&i.trim(),(!i||/^1 *= *1$/.test(i)||t&&t===i)&&(e.where=null),!e.geometry)return e;let n=await oe(e);if(e.distance=0,e.units=null,e.spatialRel==="esriSpatialRelEnvelopeIntersects"){const{spatialReference:s}=e.geometry;n=j(n),n.spatialReference=s}if(n){await I(n.spatialReference,r),n=ae(n,r);const s=(await Z(D(n)))[0];if(s==null)throw _;const a="quantizationParameters"in e&&((l=e.quantizationParameters)==null?void 0:l.tolerance)||"maxAllowableOffset"in e&&e.maxAllowableOffset||0,o=a&&O(n,r)?{densificationStep:8*a}:void 0,u=s.toJSON(),c=await F(u,u.spatialReference,r,o);if(!c)throw _;c.spatialReference=r,e.geometry=c}return e}function O(e,t){if(!e)return!1;const r=e.spatialReference;return(y(e)||g(e)||J(e))&&!V(r,t)&&!z(r,t)}function ae(e,t){const r=e.spatialReference;return O(e,t)&&y(e)?{spatialReference:r,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}async function oe(e){const{distance:t,units:r}=e,i=e.geometry;if(t==null||"vertexAttributes"in i)return i;const n=i.spatialReference,l=r?ne.fromJSON(r):B(n),s=n&&(K(n)||k(n))?i:await I(n,b).then(()=>F(i,b));return(await ue())(s.spatialReference,s,t,l)}async function ue(){return(await E(()=>import("./geometryEngineJSON-060fc1d2.js"),["assets/geometryEngineJSON-060fc1d2.js","assets/geometryEngineBase-091d7fdf.js","assets/index-001ef34f.js","assets/index-0e712e80.css","assets/geometryEngineJSON-3a8dcd59.js","assets/json-48e3ea08.js"])).geodesicBuffer}function Me(e){return e&&T in e?JSON.parse(JSON.stringify(e,ce)):e}const T="_geVersion",ce=(e,t)=>e!==T?t:void 0;function fe(e){return e==="mesh"?L:W(e)}function U(e,t){return e?t?4:3:t?3:2}function me(e,t,r,i){return q(e,t,r,i.coords[0],i.coords[1])}function pe(e,t,r,i,n,l){const s=U(n,l),{coords:a,lengths:o}=i;if(!o)return!1;for(let u=0,c=0;u<o.length;u++,c+=s)if(!q(e,t,r,a[c],a[c+1]))return!1;return!0}function q(e,t,r,i,n){if(!e)return!1;const l=U(t,r),{coords:s,lengths:a}=e;let o=!1,u=0;for(const c of a)o=ye(o,s,l,u,c,i,n),u+=c*l;return o}function ye(e,t,r,i,n,l,s){let a=e,o=i;for(let u=i,c=i+n*r;u<c;u+=r){o=u+r,o===c&&(o=i);const R=t[u],p=t[u+1],d=t[o],f=t[o+1];(p<s&&f>=s||f<s&&p>=s)&&R+(s-p)/(f-p)*(d-R)<l&&(a=!a)}return a}const w="feature-store:unsupported-query",Re={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},N={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function Se(e){return e!=null&&N.spatialRelationship[e]===!0}function de(e){return e!=null&&N.queryGeometry[Q(e)]===!0}function he(e){return e!=null&&N.layerGeometry[e]===!0}function ge(){return E(()=>import("./geometryEngineJSON-060fc1d2.js"),["assets/geometryEngineJSON-060fc1d2.js","assets/geometryEngineBase-091d7fdf.js","assets/index-001ef34f.js","assets/index-0e712e80.css","assets/geometryEngineJSON-3a8dcd59.js","assets/json-48e3ea08.js"])}function _e(e,t,r,i,n){if(g(t)&&r==="esriGeometryPoint"&&(e==="esriSpatialRelIntersects"||e==="esriSpatialRelContains")){const l=M(new S,t,!1,!1);return Promise.resolve(s=>me(l,!1,!1,s))}if(g(t)&&r==="esriGeometryMultipoint"){const l=M(new S,t,!1,!1);if(e==="esriSpatialRelContains")return Promise.resolve(s=>pe(l,!1,!1,s,i,n))}if(y(t)&&r==="esriGeometryPoint"&&(e==="esriSpatialRelIntersects"||e==="esriSpatialRelContains"))return Promise.resolve(l=>Y(t,h(r,i,n,l)));if(y(t)&&r==="esriGeometryMultipoint"&&e==="esriSpatialRelContains")return Promise.resolve(l=>H(t,h(r,i,n,l)));if(y(t)&&e==="esriSpatialRelIntersects"){const l=fe(r);return Promise.resolve(s=>l(t,h(r,i,n,s)))}return ge().then(l=>{const s=l[Re[e]].bind(null,t.spatialReference,t);return a=>s(h(r,i,n,a))})}async function Ae(e,t,r){const{spatialRel:i,geometry:n}=e;if(n){if(!Se(i))throw new $(w,"Unsupported query spatial relationship",{query:e});if(x(n.spatialReference)&&x(r)){if(!de(n))throw new $(w,"Unsupported query geometry type",{query:e});if(!he(t))throw new $(w,"Unsupported layer geometry type",{query:e});if(e.outSR)return I(e.geometry&&e.geometry.spatialReference,e.outSR)}}}function Ee(e){if(y(e))return!0;if(g(e)){for(const t of e.rings)if(t.length!==5||t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1;return!0}return!1}async function Fe(e,t){if(!e)return null;const r=t.featureAdapter,{startTimeField:i,endTimeField:n}=e;let l=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;if(i&&n)await t.forEach(a=>{const o=r.getAttribute(a,i),u=r.getAttribute(a,n);o==null||isNaN(o)||(l=Math.min(l,o)),u==null||isNaN(u)||(s=Math.max(s,u))});else{const a=i||n;await t.forEach(o=>{const u=r.getAttribute(o,a);u==null||isNaN(u)||(l=Math.min(l,u),s=Math.max(s,u))})}return{start:l,end:s}}function Oe(e,t,r){var o;if(!t||!e)return null;const{startTimeField:i,endTimeField:n}=e;if(!i&&!n)return null;const{start:l,end:s}=t;if(l===null&&s===null)return null;if(l===void 0&&s===void 0)return Pe();const a=((o=r.getAttributeAsTimestamp)==null?void 0:o.bind(r))??r.getAttribute.bind(r);return i&&n?$e(a,i,n,l,s):we(a,i||n,l,s)}function $e(e,t,r,i,n){return i!=null&&n!=null?l=>{const s=e(l,t),a=e(l,r);return(s==null||s<=n)&&(a==null||a>=i)}:i!=null?l=>{const s=e(l,r);return s==null||s>=i}:n!=null?l=>{const s=e(l,t);return s==null||s<=n}:void 0}function we(e,t,r,i){return r!=null&&i!=null&&r===i?n=>e(n,t)===r:r!=null&&i!=null?n=>{const l=e(n,t);return l>=r&&l<=i}:r!=null?n=>e(n,t)>=r:i!=null?n=>e(n,t)<=i:void 0}function Pe(){return()=>!1}export{be as G,Ee as I,_ as M,h as P,Me as Z,xe as a,Ae as b,Oe as n,Fe as t,_e as v,le as z};
