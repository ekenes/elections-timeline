import{bP as F,bQ as Nn,_ as _n,R as B,bR as I,aj as O,O as Tn,bC as on,aV as T,aH as vn,bS as Cn,s as wn,bT as z,bU as C,bV as ln,bW as zn,bX as Wn,g as Mn,bY as cn}from"./index-b8632133.js";var en;function Rn(n,t,e){return!Cn(n,t,e)}function L(n,t,e){const o=Rn(n,t,e);if(o&&!F())throw new wn("rasterprojectionhelper-project","projection engine is not loaded");return o}(function(n){n[n.None=0]="None",n[n.North=1]="North",n[n.South=2]="South",n[n.Both=3]="Both"})(en||(en={}));const fn=(n,t,e,o=0)=>{if(e[0]===1)return[0,0];let r=1,i=-1,s=1,f=-1;for(let u=0;u<n.length;u+=2)isNaN(n[u])||(r=r>n[u]?n[u]:r,i=i>n[u]?i:n[u],s=s>n[u+1]?n[u+1]:s,f=f>n[u+1]?f:n[u+1]);const{cols:a,rows:l}=t,c=(i-r)/a/e[0],w=(f-s)/l/e[1],g=2*o;let x=0,h=!1,p=[0,0];for(let u=0;u<a-3;u++){for(let R=0;R<l-3;R++){const m=u*l*2+2*R,y=(n[m]+n[m+4]+n[m+4*l]+n[m+4*l+4])/4,d=(n[m+1]+n[m+5]+n[m+4*l+1]+n[m+4*l+5])/4,M=Math.abs((y-n[m+2*l+2])/c),b=Math.abs((d-n[m+2*l+3])/w);if(M+b>x&&(x=M+b,p=[M,b]),g&&x>g){h=!0;break}}if(h)break}return p},In={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},q=32,J=4,Q=J,Z=new Map,nn=new Map,X=500;let K=null;async function Jn(){K&&F()||(F()||await Nn(),K=await _n(()=>import("./geometryEngine-9d2af6de.js"),["assets/geometryEngine-9d2af6de.js","assets/index-b8632133.js","assets/index-d85835aa.css","assets/geometryEngineBase-542d31fe.js","assets/_commonjsHelpers-2f3e7994.js","assets/hydrated-b32e3c5f.js"]))}function Ln(n,t,e){return L(n.spatialReference,t),e?cn(t,n.spatialReference,n):cn(n.spatialReference,t,n)}function Xn(n,t,e,o=null){const r=n.spatialReference;if(!r||!t||r.equals(t))return n;L(r,t,o);const i=e.center,s=new B({xmin:i.x-n.x/2,xmax:i.x+n.x/2,ymin:i.y-n.y/2,ymax:i.y+n.y/2,spatialReference:r}),f=I(s,t,o),a=v(t);return f==null||a!=null&&f.width>=a?Y(n,r,t):{x:f.width,y:f.height}}function Y(n,t,e){const o=O(t)/O(e);return{x:n.x*o,y:n.y*o}}function un(n,t,e){const{spatialReference:o}=e;if(!o||!t||o.equals(t))return n;if(o.isGeographic&&t.isGeographic)return Y(n,o,t);if(L(o,t),!K)throw new wn("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:r,y:i}=n;const s=(r+i)/2*O(o);let f=1;s>30&&(f=30/s,r*=f,i*=f);const a=256,l=r*a/2,c=i*a/2,{x:w,y:g}=e.center,x=[];for(let S=0;S<=a;S++)x.push([w-l,g-c+S*i]);for(let S=1;S<=a;S++)x.push([w-l+S*r,g+c]);for(let S=1;S<=a;S++)x.push([w+l,g+c-S*i]);for(let S=1;S<a;S++)x.push([w+l-S*r,g-c]);x.push(x[0]);const h=new on({rings:[x],spatialReference:o}),p=I(h,t);if(!p)return Y(n,o,t);const u=p.extent,R=v(t);if(u==null||R!=null&&u.width>=R)return Y(n,o,t);const m=K.planarArea(p),y=r*i*a*a,d=Math.sqrt(m/y)/f,M={x:u.width/f/a,y:u.height/f/a},b={x:r*d,y:i*d},E=M.x*M.y;return Math.abs(E-b.x*b.y)/E<.1?M:b}function N(n,t=.01){return O(n)?t/O(n):0}function xn(n,t,e=null,o=!0){const r=n.spatialReference;if(r.equals(t))return n;L(r,t,e);const i=I(n,t,e);return o&&i&&bn([n],[i],r,t),i}function bn(n,t,e,o){const r=V(e,!0),i=V(o,!0),s=N(e,X),f=N(o,X);if(s&&r!=null&&i!=null)for(let a=0;a<n.length;a++){const l=t[a];if(!l)continue;const{x:c}=n[a],{x:w}=l;w>=i[1]-f&&Math.abs(c-r[0])<s?l.x-=i[1]-i[0]:w<=i[0]+f&&Math.abs(c-r[1])<s&&(l.x+=i[1]-i[0])}}function On(n){const{inSR:t,outSR:e,datumTransformation:o,preferPE:r}=n;if(t.equals(e)){const{points:i}=sn(n,null);return i}return t.isWebMercator&&e.isWGS84||t.isWGS84&&e.isWebMercator?jn(n):L(t,e,o)&&r&&(t.isGeographic||$(t)!=null)?hn(n):$n(n)}function $n(n){const{points:t}=sn(n,null),{inSR:e,outSR:o,datumTransformation:r}=n,i=t.map(f=>new T(f[0],f[1],e)),s=I(i,o,r);return r&&bn(i,s,e,o),s.map(f=>f?[f.x,f.y]:[NaN,NaN])}function hn(n){const{inSR:t,outSR:e,datumTransformation:o}=n,r=$(t),{points:i,mask:s}=sn(n,r);if(!t.isGeographic){const a=t.wkid?z.coordsys(t.wkid):z.fromString(t.isGeographic?C.PE_TYPE_GEOGCS:C.PE_TYPE_PROJCS,t.wkt2||t.wkt);ln.projToGeog(a,i.length,i)}if(o!=null&&o.steps.length){let a;if(e.isGeographic&&(a=i.map(([c])=>c>179.9955?1:c<-179.9955?-1:0)),o.steps.forEach(c=>{const w=c.wkid?z.geogtran(c.wkid):z.fromString(C.PE_TYPE_GEOGTRAN,c.wkt);zn.geogToGeog(w,i.length,i,null,c.isInverse?C.PE_TRANSFORM_2_TO_1:C.PE_TRANSFORM_1_TO_2)}),a)for(let c=0;c<i.length;c++){const w=a[c],g=i[c][0],x=g>179.9955?1:g<-179.9955?-1:0;w&&x&&w!==x&&(i[c][0]=w>0?g+360:g-360)}}if(!e.isGeographic){const a=$(e,!0),l=a!=null&&a.isEnvelope?[a.bbox[1],a.bbox[3]]:[-90,90];An(i,l);const c=e.wkid?z.coordsys(e.wkid):z.fromString(e.isGeographic?C.PE_TYPE_GEOGCS:C.PE_TYPE_PROJCS,e.wkt2||e.wkt);ln.geogToProj(c,i.length,i)}let f=i;if(s&&i.length!==s.length){f=[];for(let a=0,l=0;a<s.length;a++)s[a]?f.push(i[l++]):f.push([NaN,NaN])}return f}function jn(n){const{cols:t,rows:e,xres:o,yres:r,usePixelCenter:i,inSR:s,outSR:f}=n;let{xmin:a,ymax:l}=n;i&&(a+=o/2,l-=r/2);const c=[],w=[],g=Math.max(t,e);for(let h=0;h<g;h++){const p=a+o*Math.min(t,h),u=l-r*Math.min(e,h),R=I(new T({x:p,y:u,spatialReference:s}),f);h<=t&&c.push(R.x),h<=e&&w.push(R.y)}const x=[];for(let h=0;h<t;h++)for(let p=0;p<e;p++)x.push([c[h],w[p]]);return x}function $(n,t=!1){let e=n.wkid||n.wkt2||n.wkt;if(!e||n.isGeographic)return null;if(e=String(e),Z.has(e)){const s=Z.get(e);return t?s==null?void 0:s.gcs:s==null?void 0:s.pcs}const o=n.wkid?z.coordsys(n.wkid):z.fromString(n.isGeographic?C.PE_TYPE_GEOGCS:C.PE_TYPE_PROJCS,n.wkt2||n.wkt),r=mn(o,N(n,1e-4)),i=mn(o,0,!0);return Z.set(e,{pcs:r,gcs:i}),t?i:r}function mn(n,t=0,e=!1){const o=Wn.generate(n),r=e?n.horizonGcsGenerate():n.horizonPcsGenerate();if(!o||!(r!=null&&r.length))return null;let i=!1,s=r.find(u=>u.getInclusive()===1&&u.getKind()===1);if(!s){if(s=r.find(u=>u.getInclusive()===1&&u.getKind()===0),!s)return null;i=!0}const f=e?0:(o.getNorthPoleLocation()===2?1:0)|(o.getSouthPoleLocation()===2?2:0),a=o.isPannableRectangle(),l=s.getCoord();if(i)return{isEnvelope:i,isPannable:a,vertices:l,coef:null,bbox:[l[0][0]-t,l[0][1]-t,l[1][0]+t,l[1][1]+t],poleLocation:f};let c=0;const w=[];let[g,x]=l[0],[h,p]=l[0];for(let u=0,R=l.length;u<R;u++){c++,c===R&&(c=0);const[m,y]=l[u],[d,M]=l[c];if(M===y)w.push([m,d,y,M,2]);else{const b=(d-m)/(M-y||1e-4),E=m-b*y;y<M?w.push([b,E,y,M,0]):w.push([b,E,M,y,1])}g=g<m?g:m,x=x<y?x:y,h=h>m?h:m,p=p>y?p:y}return{isEnvelope:!1,isPannable:a,vertices:l,coef:w,bbox:[g,x,h,p],poleLocation:f}}function sn(n,t){const e=[],{cols:o,rows:r,xres:i,yres:s,usePixelCenter:f}=n;let{xmin:a,ymax:l}=n;if(f&&(a+=i/2,l-=s/2),t==null){for(let x=0;x<o;x++)for(let h=0;h<r;h++)e.push([a+i*x,l-s*h]);return{points:e}}const c=new Uint8Array(o*r);if(t.isEnvelope){const{bbox:[x,h,p,u]}=t;for(let R=0,m=0;R<o;R++){const y=a+i*R,d=t.isPannable||y>=x&&y<=p;for(let M=0;M<r;M++,m++){const b=l-s*M;d&&b>=h&&b<=u&&(e.push([y,b]),c[m]=1)}}return{points:e,mask:c}}const w=t.coef,g=[];for(let x=0;x<r;x++){const h=l-s*x,p=[],u=[];for(let m=0;m<w.length;m++){const[y,d,M,b,E]=w[m];if(h===M&&M===b)p.push(y),p.push(d),u.push(2),u.push(2);else if(h>=M&&h<=b){const S=y*h+d;p.push(S),u.push(E)}}let R=p;if(p.length>2){let m=u[0]===2?0:u[0],y=p[0];R=[];for(let d=1;d<u.length;d++)u[d]===2&&d!==u.length-1||(u[d]!==m&&(R.push(m===0?Math.min(y,p[d-1]):Math.max(y,p[d-1])),m=u[d],y=p[d]),d===u.length-1&&R.push(u[d]===0?Math.min(y,p[d]):Math.max(y,p[d])));R.sort((d,M)=>d-M)}else p[0]>p[1]&&(R=[p[1],p[0]]);g.push(R)}for(let x=0,h=0;x<o;x++){const p=a+i*x;for(let u=0;u<r;u++,h++){const R=l-s*u,m=g[u];if(m.length===2)p>=m[0]&&p<=m[1]&&(e.push([p,R]),c[h]=1);else if(m.length>2){let y=!1;for(let d=0;d<m.length;d+=2)if(p>=m[d]&&p<=m[d+1]){y=!0;break}y&&(e.push([p,R]),c[h]=1)}}}return{points:e,mask:c}}function An(n,t){const[e,o]=t;for(let r=0;r<n.length;r++){const i=n[r][1];(i<e||i>o)&&(n[r]=[NaN,NaN])}}function Sn(n,t){const e=v(n[0].spatialReference);if(n.length<2||e==null||(t=t??N(n[0].spatialReference),(n=n.filter(f=>f.width>t)).length===1))return n[0];let{xmin:o,xmax:r,ymin:i,ymax:s}=n[0];for(let f=1;f<n.length;f++){const a=n[f];r=a.xmax+e*f,i=Math.min(i,a.ymin),s=Math.max(s,a.ymax)}return new B({xmin:o,xmax:r,ymin:i,ymax:s,spatialReference:n[0].spatialReference})}function Pn(n,t,e=null,o=!0){const r=n.spatialReference;if(r.equals(t))return n;const i=Gn(n),s=v(r,!0),f=v(t);if(i===0||s==null||f==null){const l=pn(n,t,e,o);if(s==null&&f!=null&&Math.abs(l.width-f)<N(t)&&F()){const c=$(r);if(c!=null&&c.poleLocation===en.None&&n.width<(c.bbox[2]-c.bbox[0])/2)return Bn(n,t)||l}return l}const a=n.clone().normalize();if(a.length===1&&n.xmax<s&&n.xmax-s/2>N(r)){const{xmin:l,xmax:c}=n;for(let w=0;w<=i;w++){const g=w===0?l:-s/2,x=w===i?c-s*w:s/2;a[w]=new B({xmin:g,xmax:x,ymin:n.ymin,ymax:n.ymax,spatialReference:r})}}return Sn(a.map(l=>pn(l,t,e,o)).filter(Tn))}function Kn(n,t,e){if(n.type==="extent"){const{xmin:o,ymin:r,xmax:i,ymax:s,spatialReference:f}=n;n=new on({rings:[[[o,s],[i,s],[i,r],[o,r],[o,s]]],spatialReference:f})}return n.spatialReference.equals(t)?n:(L(n.spatialReference,t,e),I(n,t,e))}function Bn(n,t){const e=v(t);if(e==null)return null;let{xmin:o,ymin:r,xmax:i,ymax:s}=n;const f=n.spatialReference,a=new on({spatialReference:f,rings:[[[o,r],[i,r],[i,s],[o,s],[o,r]]]}),l=I(a,t);if(l.rings.length!==2||!l.rings[0].length||!l.rings[1].length)return null;const{rings:c}=l,w=N(f),g=new B({spatialReference:t});for(let x=0;x<2;x++){o=i=c[x][0][0],r=s=c[x][0][1];for(let h=0;h<c[x].length;h++)o=o>c[x][h][0]?c[x][h][0]:o,i=i<c[x][h][0]?c[x][h][0]:i,r=r>c[x][h][1]?c[x][h][1]:r,s=s<c[x][h][1]?c[x][h][1]:s;if(x===0)g.ymin=r,g.ymax=s,g.xmin=o,g.xmax=i;else if(g.ymin=Math.min(g.ymin,r),g.ymax=Math.max(g.ymax,s),Math.abs(i-e/2)<w)g.xmin=o,g.xmax=g.xmax+e;else{if(!(Math.abs(o+e/2)<w))return null;g.xmax=i+e}}return g}function pn(n,t,e=null,o=!0,r=!0){const i=n.spatialReference;if(i.equals(t)||!t)return n;L(i,t,e);const s=I(n,t,e);if(r&&t.isWebMercator&&s&&(s.ymax=Math.min(20037508342787e-6,s.ymax),s.ymin=Math.max(-20037508342787e-6,s.ymin),s.ymin>=s.ymax))return null;if(!o||!s)return s;const f=V(i,!0),a=V(t,!0);if(f==null||a==null)return s;const l=N(i,.001),c=N(i,X),w=N(t,.001);if(Math.abs(s.xmin-a[0])<w&&Math.abs(s.xmax-a[1])<w){const g=Math.abs(n.xmin-f[0]),x=Math.abs(f[1]-n.xmax);if(g<l&&x>c){s.xmin=a[0];const h=[];h.push(new T(n.xmax,n.ymin,i)),h.push(new T(n.xmax,(n.ymin+n.ymax)/2,i)),h.push(new T(n.xmax,n.ymax,i));const p=h.map(u=>xn(u,t,e)).filter(u=>!isNaN(u==null?void 0:u.x)).map(u=>u.x);s.xmax=Math.max.apply(null,p)}if(x<l&&g>c){s.xmax=a[1];const h=[];h.push(new T(n.xmin,n.ymin,i)),h.push(new T(n.xmin,(n.ymin+n.ymax)/2,i)),h.push(new T(n.xmin,n.ymax,i));const p=h.map(u=>xn(u,t,e)).filter(u=>!isNaN(u==null?void 0:u.x)).map(u=>u.x);s.xmin=Math.min.apply(null,p)}}else{const g=N(t,.001);Math.abs(s.xmin-a[0])<g&&(s.xmin=a[0]),Math.abs(s.xmax-a[1])<g&&(s.xmax=a[1])}return s}function v(n,t=!1){if(!n)return null;const e=t?20037508342787e-6:20037508342788905e-9;return n.isWebMercator?2*e:n.wkid&&n.isGeographic?360:2*In[n.wkid]||null}function V(n,t=!1){if(n.isGeographic)return[-180,180];const e=v(n,t);return e!=null?[-e/2,e/2]:null}function gn(n,t,e,o){let r=(n-t)/e;return r-Math.floor(r)!=0?r=Math.floor(r):o&&(r-=1),r}function Gn(n,t=!1){const e=v(n.spatialReference);if(e==null)return 0;const o=t?0:-(e/2),r=N(n.spatialReference),i=!t&&Math.abs(n.xmax-e/2)<r?e/2:n.xmax,s=!t&&Math.abs(n.xmin+e/2)<r?-e/2:n.xmin;return gn(i,o,e,!0)-gn(s,o,e,!1)}function Vn(n){const t=n.storageInfo.origin.x,e=v(n.spatialReference,!0);if(e==null)return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const o=e/2,{nativePixelSize:r,storageInfo:i,extent:s}=n,{maximumPyramidLevel:f,blockWidth:a,pyramidScalingFactor:l}=i;let c=r.x;const w=[],g=n.transform!=null&&n.transform.type==="gcs-shift",x=t+(g?0:o),h=g?e-t:o-t;for(let p=0;p<=f;p++){const u=(s.xmax-t)/c/a,R=u-Math.floor(u)==0?u:Math.ceil(u),m=h/c/a,y=m-Math.floor(m)==0?m:Math.ceil(m),d=Math.floor(x/c/a),M=Math.round(x/c)%a,b=(a-Math.round(h/c)%a)%a;w.push({resolutionX:c,blockWidth:a,datasetColumnCount:R,worldColumnCountFromOrigin:y,leftMargin:M,rightPadding:b,originColumnOffset:d}),c*=l}return{originX:t,halfWorldWidth:o,pyramidsInfo:w,hasGCSSShiftTransform:g}}function Yn(n){if(!n||n.isGeographic)return n;const t=String(n.wkid||n.wkt2||n.wkt);let e;return nn.has(t)?e=nn.get(t):(e=(n.wkid?z.coordsys(n.wkid):z.fromString(C.PE_TYPE_PROJCS,n.wkt2||n.wkt)).getGeogcs().getCode(),nn.set(t,e)),new Mn({wkid:e})}function Dn(n){const t=n.isAdaptive&&n.spacing==null;let e=n.spacing||[q,q],o=tn(n),r={cols:o.size[0]+1,rows:o.size[1]+1};const i=o.outofBoundPointCount>0&&o.outofBoundPointCount<o.offsets.length/2;let s=o.outofBoundPointCount===o.offsets.length/2||t&&i?[0,0]:fn(o.offsets,r,e,Q);const f=(s[0]+s[1])/2,a=n.projectedExtent.spatialReference,l=n.srcBufferExtent.spatialReference;if(t&&(i||f>Q)&&(Rn(a,l,n.datumTransformation)&&(a.isGeographic||$(a)),e=[J,J],o=tn({...n,spacing:e}),r={cols:o.size[0]+1,rows:o.size[1]+1},s=fn(o.offsets,r,e,Q)),o.error=s,e[0]>1&&(o.coefficients=yn(o.offsets,r,i)),n.includeGCSGrid&&!a.isGeographic&&!a.isWebMercator)if(l.isGeographic)o.gcsGrid={offsets:o.offsets,coefficients:o.coefficients,spacing:e};else{const c=$(a);if(c!=null&&!c.isEnvelope){const w=Yn(a),g=Pn(n.projectedExtent,w),{offsets:x}=tn({...n,srcBufferExtent:g,spacing:e}),h=yn(x,r,i);o.gcsGrid={offsets:x,coefficients:h,spacing:e}}}return o}function tn(n){const{projectedExtent:t,srcBufferExtent:e,pixelSize:o,datumTransformation:r,rasterTransform:i}=n,s=t.spatialReference,f=e.spatialReference,a=L(s,f),{xmin:l,ymin:c,xmax:w,ymax:g}=t,x=v(f),h=x!=null&&(n.hasWrapAround||(i==null?void 0:i.type)==="gcs-shift"),p=n.spacing||[q,q],u=p[0]*o.x,R=p[1]*o.y,m=p[0]===1,y=Math.ceil((w-l)/u-.1/p[0])+(m?0:1),d=Math.ceil((g-c)/R-.1/p[1])+(m?0:1),M=On({cols:y,rows:d,xmin:l,ymax:g,xres:u,yres:R,inSR:s,outSR:f,datumTransformation:r,preferPE:p[0]<=J,usePixelCenter:m}),b=[];let E,S=0;const j=m?-1:NaN,{xmin:P,xmax:G,ymax:_,width:D,height:U}=e,kn=N(f,X),En=x!=null&&P>0&&G>x/2;let rn=!1;if(a){const W=$(s);rn=W!=null&&W.poleLocation>0}for(let W=0;W<y;W++){const H=[];for(let A=0;A<d;A++){let k=M[W*d+A];if(h&&k[0]>G&&k[0]>x/2-kn?k[0]-=x:h&&W===0&&k[0]<0&&En&&!i&&(k[0]+=x),!k||isNaN(k[0])||isNaN(k[1]))b.push(j),b.push(j),H.push(null),S++;else{if(i){const an=i.inverseTransform(new T({x:k[0],y:k[1],spatialReference:f}));k=[an.x,an.y]}H.push(k),W>0&&h&&E[A]&&k[0]<E[A][0]&&(k[0]+=x,rn&&k[0]>G&&k[0]>x&&(k[0]-=x)),b.push((k[0]-P)/D),b.push((_-k[1])/U)}}E=H}return{offsets:b,error:null,coefficients:null,outofBoundPointCount:S,spacing:p,size:m?[y,d]:[y-1,d-1]}}function yn(n,t,e){const{cols:o,rows:r}=t,i=new Float32Array((o-1)*(r-1)*2*6),s=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),f=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let a=0;a<o-1;a++){for(let l=0;l<r-1;l++){let c=a*r*2+2*l;const w=n[c],g=n[c+1],x=n[c+2],h=n[c+3];c+=2*r;const p=n[c],u=n[c+1],R=n[c+2],m=n[c+3];let y=0,d=12*(l*(o-1)+a);for(let M=0;M<3;M++)i[d++]=s[y++]*w+s[y++]*x+s[y++]*R;y=0;for(let M=0;M<3;M++)i[d++]=s[y++]*g+s[y++]*h+s[y++]*m;y=0;for(let M=0;M<3;M++)i[d++]=f[y++]*w+f[y++]*p+f[y++]*R;y=0;for(let M=0;M<3;M++)i[d++]=f[y++]*g+f[y++]*u+f[y++]*m}if(e)for(let l=0;l<i.length;l++)isNaN(i[l])&&(i[l]=-1)}return i}function Fn(n,t){const e=n.clone().normalize();return e.length===1?e[0]:Sn(e,t)}function Un(n){const{spatialReference:t}=n,e=vn(t);if(!e)return n;const[o,r]=e.valid,i=r-o;let s=0;if(n.xmin<o){const f=o-n.xmin;s=Math.ceil(f/i)}else if(n.xmin>r){const f=n.xmin-r;s=-Math.ceil(f/i)}return new B({spatialReference:n.spatialReference,xmin:n.xmin+s*i,ymin:n.ymin,xmax:n.xmax+s*i,ymax:n.ymax})}function Hn(n,t,e){var h;const{storageInfo:o,pixelSize:r}=t;let i=0,s=!1;const{pyramidResolutions:f}=o,a=((h=o.tileInfo.format)==null?void 0:h.toLowerCase())==="mixed"?Math.max(1,Math.min(3,o.tileInfo.dpi/96)):1,l=(n.x+n.y)/2/a;if(f!=null&&f.length){const p=f[f.length-1],u=(p.x+p.y)/2,R=(r.x+r.y)/2;if(l<=R)i=0;else if(l>=u)i=f.length,s=l/u>8;else{let y,d=R;for(let M=1;M<=f.length;M++){if(y=(f[M-1].x+f[M-1].y)/2,l<=y){l===y?i=M:e==="down"?(i=M-1,s=l/d>8):i=e==="up"||l-d>y-l||l/d>2?M:M-1;break}d=y}}const m=i===0?r:f[i-1];return s&&Math.min(m.x,m.y)*O(t.spatialReference)>19567&&(s=!1),{pyramidLevel:i,pyramidResolution:new T({x:m.x,y:m.y,spatialReference:t.spatialReference}),excessiveReading:s}}const c=Math.log(n.x/r.x)/Math.LN2,w=Math.log(n.y/r.y)/Math.LN2,g=t.storageInfo.maximumPyramidLevel||0;i=e==="down"?Math.floor(Math.min(c,w)):e==="up"?Math.ceil(Math.max(c,w)):Math.round((c+w)/2),i<0?i=0:i>g&&(s=i>g+3,i=g);const x=2**i;return{pyramidLevel:i,pyramidResolution:new T({x:x*t.nativePixelSize.x,y:x*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:s}}function dn(n,t){const{pixelSize:e,extent:o}=n,r=Ln(o,t,!1);return Pn(Fn(o,(e.x+e.y)/16),t,r)}function Qn(n,t,e){var j;const o=(e==null?void 0:e.tileSize)??512,r=(e==null?void 0:e.alignGlobalDatasetWithAGOL)??!0,i=!!(e!=null&&e.limitToSrcResolution),{extent:s,spatialReference:f,pixelSize:a}=n,l=un(a,t,s);if(l==null)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const c=(l.x+l.y)/2,w=O(t),g=c*w*96*39.37,x=t.isGeographic?256/o*2958287637958547e-7:256/o*591657527591555e-6;let h=n.dataType==="vector-magdir"||n.dataType==="vector-uv";const p=dn(n,t),u=Math.min(Math.ceil(Math.log(Math.min(n.width,n.height)/32)/Math.LN2),Math.ceil(Math.log(x/2/g)/Math.LN2));if(!h&&r&&(t.isGeographic||t.isWebMercator)){const P=v(t);if(h=Gn(p)>0||P!=null&&p.width>P/4,!h&&P!=null){let G=-1;if(u<3)G=2**u*c*o;else if(n.storageInfo){const{maximumPyramidLevel:D=0,pyramidScalingFactor:U=2}=n.storageInfo;G=U**D*c*o}const _=Math.ceil(P/G);h=_===1||_===2&&P/2-p.xmax<G}}let R,m=g;const y=1.001,d=Math.min(2,Math.max(1.414,((j=n.storageInfo)==null?void 0:j.pyramidScalingFactor)||2));if(h){m=x;const P=t.isGeographic?1341104507446289e-21:.29858214164761665,G=P*(96*w*39.37),_=t.isGeographic?4326:3857;R=un({x:P,y:P},f,dn(n,new Mn({wkid:_}))),R.x*=m/G,R.y*=m/G}else{R={x:a.x,y:a.y};let P=0;for(;m<x*(y/2)&&P<u;)P++,m*=d,R.x*=d,R.y*=d;Math.max(m,x)/Math.min(m,x)<=y&&(m=x)}const M=[m],b=[{x:R.x,y:R.y}],E=70.5310735,S=Math.min(E,g)/y;for(;m>=S;)m/=d,R.x/=d,R.y/=d,M.push(m),b.push({x:R.x,y:R.y});if(i){const P=.001*a.x;let G=b.findIndex(_=>_.x>=a.x-P&&_.x<=a.x+P);G>-1?(b.length=G+1,M.length=G+1):(G=b.findIndex(_=>_.x<=a.x+P),G>0&&(b.length=G,M.length=G))}return{projectedPixelSize:l,scales:M,srcResolutions:b,isCustomTilingScheme:!h}}export{Xn as C,Kn as D,xn as I,Pn as K,v as V,Un as a,dn as c,Gn as e,Qn as f,Dn as i,Ln as j,Hn as l,Vn as t,Jn as v,Rn as w};
