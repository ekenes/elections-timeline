{"version":3,"file":"projection-6e790ef4.js","sources":["../../node_modules/@arcgis/core/geometry/support/meshUtils/projection.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{hasScaling as r,deg2rad as t}from\"../../../core/mathUtils.js\";import{normalFromMat4 as o,fromMat4 as e}from\"../../../core/libs/gl-matrix-2/math/mat3.js\";import{create as n}from\"../../../core/libs/gl-matrix-2/factories/mat3f64.js\";import{multiply as i,equals as c,invert as a}from\"../../../core/libs/gl-matrix-2/math/mat4.js\";import{IDENTITY as f,create as s}from\"../../../core/libs/gl-matrix-2/factories/mat4f64.js\";import{t as l,n as m,e as u}from\"../../../chunks/vec32.js\";import{ZEROS as p,create as T}from\"../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{canProjectWithoutEngine as y}from\"../../projection.js\";import{getSphericalPCPF as A}from\"../../spatialReferenceEllipsoidUtils.js\";import{computeTranslationToOriginAndRotation as d}from\"../../projection/computeTranslationToOriginAndRotation.js\";import{projectBuffer as P}from\"../../projection/projectBuffer.js\";import{newDoubleArray as g,copyInto as j}from\"../DoubleArray.js\";import{earth as M}from\"../Ellipsoid.js\";import{isCGCS2000 as h,isMars as N,isMoon as R}from\"../spatialReferenceUtils.js\";import{y2lat as O}from\"../webMercatorUtils.js\";import{BufferViewVec3f as F,BufferViewVec3f64 as E}from\"../buffer/BufferView.js\";import{t as _,n as b,a as x}from\"../../../chunks/vec3.js\";import{t as C}from\"../../../chunks/vec4.js\";const L=\"Projection may be possible after calling projection.load().\";function S(r,t,o,e){r.error(`Failed to project from (wkid:${t.wkid}) to (wkid:${o.wkid}).${e?\" \":\"\"}${e}`)}function v(r,t,o,e,n){return I(z.TO_PCPF,F.fromTypedArray(r),D.NORMAL,E.fromTypedArray(t),E.fromTypedArray(o),e,F.fromTypedArray(n))?n:null}function k(r,t,o,e,n){return I(z.FROM_PCPF,F.fromTypedArray(r),D.NORMAL,E.fromTypedArray(t),E.fromTypedArray(o),e,F.fromTypedArray(n))?n:null}function w(r,t,o){return P(r,t,0,o,A(t),0,r.length/3)?o:null}function G(r,t,o){return P(r,A(o),0,t,o,0,r.length/3)?t:null}function V(t,e,n){return o(or,n),_(e,t,or),r(or)&&b(e,e),e}function B(t,o,n){return e(or,n),C(o,t,or),r(or)&&b(o,o,4),o}function U(r,o,e,n){const i=o===D.NORMAL;return W(r,o,e,((r,o)=>{const e=Math.cos(t(r));o[0]=i?e:1/e,o[1]=1}),n)}function $(r,t,o,e){const n=t===D.NORMAL;return W(r,t,o,((r,t)=>{const o=Math.cosh(-r/M.radius);t[0]=1,t[1]=n?o:1/o}),e)}function W(r,t,o,e,n){const i=t===D.NORMAL?3:4,c=[0,0];for(let a=0,f=1;a<r.length;a+=i,f+=3){e(o[f],c);const t=r[a]*c[0],s=r[a+1]*c[1],l=r[a+2],m=1/Math.sqrt(t*t+s*s+l*l);n[a]=t*m,n[a+1]=s*m,n[a+2]=l*m,4===i&&(n[a+3]=r[a+3])}return n}function Y(r,t,o,e,n){if(!I(z.TO_PCPF,F.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),D.TANGENT,E.fromTypedArray(t),E.fromTypedArray(o),e,F.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let i=3;i<r.length;i+=4)n[i]=r[i];return n}function q(r,t,o,e,n){if(!I(z.FROM_PCPF,F.fromTypedArray(r,16),D.TANGENT,E.fromTypedArray(t),E.fromTypedArray(o),e,F.fromTypedArray(n,16)))return null;for(let i=3;i<r.length;i+=4)n[i]=r[i];return n}var D,z;function H(r,t,n,i,c){switch(d(i,n,tr,i),r===z.FROM_PCPF&&a(tr,tr),t){case D.NORMAL:return o(c,tr);case D.TANGENT:return e(c,tr)}}function I(r,t,o,e,n,i,c){if(!t)return;const a=e.count,f=A(i);if(X(i))for(let s=0;s<a;s++)n.getVec(s,Z),t.getVec(s,rr),l(rr,rr,H(r,o,Z,f,or)),c.setVec(s,rr);else for(let s=0;s<a;s++){n.getVec(s,Z),t.getVec(s,rr);const i=O(e.get(s,1));let a=Math.cos(i);o===D.TANGENT!=(r===z.TO_PCPF)&&(a=1/a),H(r,o,Z,f,or),r===z.TO_PCPF?(or[0]*=a,or[1]*=a,or[2]*=a,or[3]*=a,or[4]*=a,or[5]*=a):(or[0]*=a,or[3]*=a,or[6]*=a,or[1]*=a,or[4]*=a,or[7]*=a),l(rr,rr,or),m(rr,rr),c.setVec(s,rr)}return c}function J(r){return\"local\"===r.vertexSpace.type?K(r):Q(r)}function K({vertexSpace:r,transform:t,inSpatialReference:o,outSpatialReference:e,localMode:n,outPositions:c,positions:a}){const s=r.origin??p,l=null!=r.origin?t?.localMatrix??f:f,m=A(o),u=e.isWebMercator&&n||!y(o,m)?o:m;d(o,s,tr,u),i(tr,tr,l);const T=c??g(a.length);return x(T,a,tr),P(T,u,0,T,e,0,T.length/3),T}function Q({vertexSpace:r,transform:t,outPositions:o,positions:e,inSpatialReference:n,outSpatialReference:i}){const a=null!=r.origin?t?.localMatrix??f:f,s=o??g(e.length);c(a,f)?j(s,e):x(s,e,a);const l=r.origin??p;if(!u(l,p)){const[r,t,o]=l;for(let e=0;e<s.length;e+=3)s[e]+=r,s[e+1]+=t,s[e+2]+=o}return P(s,n,0,s,i,0,s.length/3)?s:null}function X(r){return r.isWGS84||h(r)||N(r)||R(r)}!function(r){r[r.NORMAL=0]=\"NORMAL\",r[r.TANGENT=1]=\"TANGENT\"}(D||(D={})),function(r){r[r.TO_PCPF=0]=\"TO_PCPF\",r[r.FROM_PCPF=1]=\"FROM_PCPF\"}(z||(z={}));const Z=T(),rr=T(),tr=s(),or=n();export{D as VectorType,L as loadProjectErrorMessage,S as logProjectionError,J as project,G as projectFromPCPF,k as projectNormalFromPCPF,v as projectNormalToPCPF,q as projectTangentFromPCPF,Y as projectTangentToPCPF,w as projectToPCPF,V as transformNormal,B as transformTangent,U as transformVectorENUPlateCarree,$ as transformVectorWMPlateCarree};\n"],"names":["L","S","t","o","e","v","n","I","z","F","D","E","k","w","P","A","G","V","or","_","r","b","B","C","U","i","W","$","M","c","a","f","s","l","m","Y","q","H","d","tr","X","Z","rr","O","J","K","Q","p","u","y","T","g","x","j","h","N","R"],"mappings":"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","x_google_ignoreList":[0]}