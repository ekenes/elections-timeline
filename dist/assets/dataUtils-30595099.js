import{r as W,q as z,fq as Dt,w as Rt,S as Lt,s as Nt,a8 as Et,$ as Z,aT as jt,a7 as nt,a1 as qt,bK as Gt,B as Ot,lk as vt,ge as Wt}from"./index-c2b82012.js";let Ut=class{constructor(e=null,n=null,l=null){this.minValue=e,this.maxValue=n,this.noDataValue=l}};const Xt=9999999e31,zt=2e-7,Jt={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};function rt(t){return Jt[t]??[-34028234663852886e22,34028234663852886e22]}function Ae(t,e){return t==null||e==null?"s32":t<0?t>=-128&&e<128?"s8":t>=-32768&&e<32768?"s16":"s32":e<256?"u8":e<65536?"u16":"u32"}function Ht(t){return((t==null?void 0:t.startsWith("s"))||(t==null?void 0:t.startsWith("u")))??!1}function be(t,e,n,l){let[r,i]=rt(n);const s=Ht(n);return s&&(r-=1e-5,i+=1e-5),s?n.startsWith("u")?Kt(t,e,l,[r,i]):Qt(t,e,l,[r,i]):Yt(t,e,l,[r,i])}function ve(t,e){for(let n=0;n<e.length;n++)e[n]&&isNaN(t[n])&&(e[n]=0,t[n]=0)}function Kt(t,e,n,l){const[r,i]=l;for(let s=0;s<e.length;s++)if(e[s]){const c=t[s];c<r||c>i?e[s]=0:n[s]=c+.5|0}}function Qt(t,e,n,l){const[r,i]=l;for(let s=0;s<e.length;s++)if(e[s]){const c=t[s];c<r||c>i?e[s]=0:n[s]=c+(c>0?.5:-.5)|0}}function Yt(t,e,n,l){const[r,i]=l;for(let s=0;s<e.length;s++)if(e[s]){const c=t[s];c<r||c>i?e[s]=0:n[s]=c}}function Ue(t,e,n){var p,u;if(t.depthCount&&t.depthCount>1)return;const{pixels:l,statistics:r,pixelType:i}=t,s=l[0].length,c=t.bandMasks??[],h=t.mask??new Uint8Array(s).fill(255),o=i==="f32"||i==="f64",a=rt(i);let f=!1;for(let d=0;d<l.length;d++){const m=typeof e=="number"?e:e[d];if(m==null)continue;const x=((p=r==null?void 0:r[d])==null?void 0:p.minValue)??a[0],w=((u=r==null?void 0:r[d])==null?void 0:u.maxValue)??a[1];if(x>m+Number.EPSILON||w<m-Number.EPSILON)continue;const A=c[d]||h.slice(),k=l[d],M=n==null?void 0:n.customFloatTolerance;if(o&&M!==0){let g=M;g||(g=Math.abs(m)>=Xt?zt*Math.abs(m):i==="f32"?2**-23:Number.EPSILON);for(let y=0;y<k.length;y++)A[y]&&Math.abs(k[y]-m)<g&&(k[y]=0,A[y]=0,h[y]=0,f=!0)}else for(let g=0;g<k.length;g++)A[g]&&k[g]===m&&(k[g]=0,A[g]=0,h[g]=0,f=!0);c[d]=A}f&&(t.bandMasks=t.bandMasks||t.pixels.length>1?c:null,t.mask=h),f&&"updateStatistics"in t&&t.updateStatistics()}var K;let q=K=class extends Lt{static createEmptyBand(t,e){return new(K.getPixelArrayConstructor(t))(e)}static combineBandMasks(t){if(t.length<2)return t[0];const e=t[0].length,n=new Uint8Array(e).fill(255);for(let l=0;l<t.length;l++){const r=t[l];for(let i=0;i<e;i++)r[i]||(n[i]=0)}return n}static getPixelArrayConstructor(t){let e;switch(t){case"u1":case"u2":case"u4":case"u8":e=Uint8Array;break;case"u16":e=Uint16Array;break;case"u32":e=Uint32Array;break;case"s8":e=Int8Array;break;case"s16":e=Int16Array;break;case"s32":e=Int32Array;break;case"f32":case"c64":case"c128":case"unknown":e=Float32Array;break;case"f64":e=Float64Array}return e}constructor(t){super(t),this.width=null,this.height=null,this.pixelType="f32",this.validPixelCount=null,this.mask=null,this.maskIsAlpha=!1,this.premultiplyAlpha=!1,this.statistics=null,this.depthCount=1}castPixelType(t){if(!t)return"f32";let e=t.toLowerCase();return["u1","u2","u4"].includes(e)?e="u8":["unknown","u8","s8","u16","s16","u32","s32","f32","f64"].includes(e)||(e="f32"),e}getPlaneCount(){var t;return(t=this.pixels)==null?void 0:t.length}addData(t){if(!t.pixels||t.pixels.length!==this.width*this.height)throw new Nt("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]),this.statistics||(this.statistics=[]),this.pixels.push(t.pixels),this.statistics.push(t.statistics??new Ut)}getAsRGBA(){const t=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case"s8":case"s16":case"u16":case"s32":case"u32":case"f32":case"f64":this._fillFromNon8Bit(t);break;default:this._fillFrom8Bit(t)}return new Uint8ClampedArray(t)}getAsRGBAFloat(){const t=new Float32Array(this.width*this.height*4);return this._fillFrom32Bit(t),t}updateStatistics(){if(!this.pixels)return;this.statistics=this.pixels.map(n=>Zt(n,this.mask));const t=this.mask;let e=0;if(t!=null)for(let n=0;n<t.length;n++)t[n]&&e++;else e=this.width*this.height;this.validPixelCount=e}clamp(t){if(!t||t==="f64"||t==="f32"||!this.pixels)return;const[e,n]=rt(t),l=this.pixels,r=this.width*this.height,i=l.length;let s,c,h;const o=[];for(let a=0;a<i;a++){h=K.createEmptyBand(t,r),s=l[a];for(let f=0;f<r;f++)c=s[f],h[f]=c>n?n:c<e?e:c;o.push(h)}this.pixels=o,this.pixelType=t}extractBands(t){var f;const{pixels:e,statistics:n}=this;if(t==null||t.length===0||!e||e.length===0)return this;const l=e.length,r=t.some(p=>p>=e.length),i=l===t.length&&!t.some((p,u)=>p!==u);if(r||i)return this;const s=((f=this.bandMasks)==null?void 0:f.length)===l?t.map(p=>this.bandMasks[p]):void 0;let{mask:c,validPixelCount:h}=this;const{width:o,height:a}=this;return s!=null&&s.length&&(c=K.combineBandMasks(s),h=c.filter(p=>!!p).length),new K({pixelType:this.pixelType,width:o,height:a,mask:c,bandMasks:s,validPixelCount:h,maskIsAlpha:this.maskIsAlpha,pixels:t.map(p=>e[p]),statistics:n&&t.map(p=>n[p])})}clone(){const t=new K({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});let e;this.mask!=null&&(t.mask=new Uint8Array(this.mask)),this.bandMasks&&(t.bandMasks=this.bandMasks.map(l=>new Uint8Array(l)));const n=K.getPixelArrayConstructor(this.pixelType);if(this.pixels&&this.pixels.length>0){t.pixels=[];const l=!!this.pixels[0].slice;for(e=0;e<this.pixels.length;e++)t.pixels[e]=l?this.pixels[e].slice():new n(this.pixels[e])}if(this.statistics)for(t.statistics=[],e=0;e<this.statistics.length;e++)t.statistics[e]=Et(this.statistics[e]);return t.premultiplyAlpha=this.premultiplyAlpha,t}_fillFrom8Bit(t){const{mask:e,maskIsAlpha:n,premultiplyAlpha:l,pixels:r}=this;if(!t||!(r!=null&&r.length))return void Z.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");let i,s,c,h;i=s=c=r[0],r.length>=3?(s=r[1],c=r[2]):r.length===2&&(s=r[1]);const o=new Uint32Array(t),a=this.width*this.height;if(i.length===a)if(e!=null&&e.length===a)if(n)for(h=0;h<a;h++){const f=e[h];if(f){const p=f/255;o[h]=l?f<<24|c[h]*p<<16|s[h]*p<<8|i[h]*p:f<<24|c[h]<<16|s[h]<<8|i[h]}}else for(h=0;h<a;h++)e[h]&&(o[h]=255<<24|c[h]<<16|s[h]<<8|i[h]);else for(h=0;h<a;h++)o[h]=255<<24|c[h]<<16|s[h]<<8|i[h];else Z.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.")}_fillFromNon8Bit(t){const{pixels:e,mask:n,statistics:l}=this;if(!t||!(e!=null&&e.length))return void Z.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");const r=this.pixelType;let i=1,s=0,c=1;if(l&&l.length>0){for(const m of l)if(m.minValue!=null&&(s=Math.min(s,m.minValue)),m.maxValue!=null&&m.minValue!=null){const x=m.maxValue-m.minValue;c=Math.max(c,x)}i=255/c}else{let m=255;r==="s8"?(s=-128,m=127):r==="u16"?m=65535:r==="s16"?(s=-32768,m=32767):r==="u32"?m=4294967295:r==="s32"?(s=-2147483648,m=2147483647):r==="f32"?(s=-34e38,m=34e38):r==="f64"&&(s=-Number.MAX_VALUE,m=Number.MAX_VALUE),i=255/(m-s)}const h=new Uint32Array(t),o=this.width*this.height;let a,f,p,u,d;if(a=f=p=e[0],a.length!==o)return Z.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(e.length>=2)if(f=e[1],e.length>=3&&(p=e[2]),n!=null&&n.length===o)for(u=0;u<o;u++)n[u]&&(h[u]=255<<24|(p[u]-s)*i<<16|(f[u]-s)*i<<8|(a[u]-s)*i);else for(u=0;u<o;u++)h[u]=255<<24|(p[u]-s)*i<<16|(f[u]-s)*i<<8|(a[u]-s)*i;else if(n!=null&&n.length===o)for(u=0;u<o;u++)d=(a[u]-s)*i,n[u]&&(h[u]=255<<24|d<<16|d<<8|d);else for(u=0;u<o;u++)d=(a[u]-s)*i,h[u]=255<<24|d<<16|d<<8|d}_fillFrom32Bit(t){const{pixels:e,mask:n}=this;if(!t||!(e!=null&&e.length))return Z.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let l,r,i,s;l=r=i=e[0],e.length>=3?(r=e[1],i=e[2]):e.length===2&&(r=e[1]);const c=this.width*this.height;if(l.length!==c)return Z.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let h=0;if(n!=null&&n.length===c)for(s=0;s<c;s++)t[h++]=l[s],t[h++]=r[s],t[h++]=i[s],t[h++]=1&n[s];else for(s=0;s<c;s++)t[h++]=l[s],t[h++]=r[s],t[h++]=i[s],t[h++]=1}};function Zt(t,e){let n=1/0,l=-1/0;const r=t.length;let i,s=0;if(e!=null)for(i=0;i<r;i++)e[i]&&(s=t[i],n=s<n?s:n,l=s>l?s:l);else for(i=0;i<r;i++)s=t[i],n=s<n?s:n,l=s>l?s:l;return new Ut(n,l)}W([z({json:{write:!0}})],q.prototype,"width",void 0),W([z({json:{write:!0}})],q.prototype,"height",void 0),W([z({json:{write:!0}})],q.prototype,"pixelType",void 0),W([Dt("pixelType")],q.prototype,"castPixelType",null),W([z({json:{write:!0}})],q.prototype,"validPixelCount",void 0),W([z({json:{write:!0}})],q.prototype,"mask",void 0),W([z({json:{write:!0}})],q.prototype,"maskIsAlpha",void 0),W([z({json:{write:!0}})],q.prototype,"pixels",void 0),W([z()],q.prototype,"premultiplyAlpha",void 0),W([z({json:{write:!0}})],q.prototype,"statistics",void 0),W([z({json:{write:!0}})],q.prototype,"depthCount",void 0),W([z({json:{write:!0}})],q.prototype,"noDataValues",void 0),W([z({json:{write:!0}})],q.prototype,"bandMasks",void 0),q=K=W([Rt("esri.layers.support.PixelBlock")],q);const _=q;var gt,xt;(function(t){t[t.matchAny=0]="matchAny",t[t.matchAll=1]="matchAll"})(gt||(gt={})),function(t){t[t.bestMatch=0]="bestMatch",t[t.fail=1]="fail"}(xt||(xt={}));const $e=6;function R(t){return t!=null&&t.declaredClass==="esri.layers.support.PixelBlock"&&t.pixels&&t.pixels.length>0}function Pe(t){var a;if(!(t!=null&&t.length)||t.some(f=>!R(f)))return null;if(t.length===1)return((a=t[0])==null?void 0:a.clone())??null;const e=t,{width:n,height:l,pixelType:r}=e[0];if(e.some(f=>f.width!==n||f.height!==l))return null;const i=e.map(({mask:f})=>f).filter(f=>f!=null);let s=null;i.length&&(s=new Uint8Array(n*l),s.set(i[0]),i.length>1&&Pt(i.slice(1),s));const c=[];e.forEach(({pixels:f})=>c.push(...f));const h=e.map(({statistics:f})=>f).filter(f=>f==null?void 0:f.length),o=[];return h.forEach(f=>o.push(...f)),new _({pixelType:r,width:n,height:l,mask:s,pixels:c,statistics:o.length?o:null})}function Te(t){if(!t)return;const e=t.colormap;if(!e||e.length===0)return;const n=e.sort((f,p)=>f[0]-p[0]);let l=0;n[0][0]<0&&(l=n[0][0]);const r=Math.max(256,n[n.length-1][0]-l+1),i=new Uint8Array(4*r),s=[];let c,h=0,o=0;const a=n[0].length===5;if(r>65536)return n.forEach(f=>{s[f[0]-l]=a?f.slice(1):f.slice(1).concat([255])}),{indexed2DColormap:s,offset:l,alphaSpecified:a};if(t.fillUnspecified)for(c=n[o],h=c[0]-l;h<r;h++)i[4*h]=c[1],i[4*h+1]=c[2],i[4*h+2]=c[3],i[4*h+3]=a?c[4]:255,h===c[0]-l&&(c=o===n.length-1?c:n[++o]);else for(h=0;h<n.length;h++)c=n[h],o=4*(c[0]-l),i[o]=c[1],i[o+1]=c[2],i[o+2]=c[3],i[o+3]=a?c[4]:255;return{indexedColormap:i,offset:l,alphaSpecified:a}}function Ie(t,e){if(!R(t)||!e||!e.indexedColormap&&!e.indexed2DColormap)return t;const n=t.clone(),l=n.pixels;let r=n.mask;const i=n.width*n.height;if(l.length!==1)return t;const{indexedColormap:s,indexed2DColormap:c,offset:h,alphaSpecified:o}=e;let a=0;const f=l[0],p=new Uint8Array(f.length),u=new Uint8Array(f.length),d=new Uint8Array(f.length);let m,x=0;if(s){const w=s.length-1;if(r!=null)for(a=0;a<i;a++)r[a]&&(x=4*(f[a]-h),x<h||x>w?r[a]=0:(p[a]=s[x],u[a]=s[x+1],d[a]=s[x+2],r[a]=s[x+3]));else{for(r=new Uint8Array(i),a=0;a<i;a++)x=4*(f[a]-h),x<h||x>w?r[a]=0:(p[a]=s[x],u[a]=s[x+1],d[a]=s[x+2],r[a]=s[x+3]);n.mask=r}}else if(c)if(r!=null)for(a=0;a<i;a++)r[a]&&(m=c[f[a]],p[a]=m[0],u[a]=m[1],d[a]=m[2],r[a]=m[3]);else{for(r=new Uint8Array(i),a=0;a<i;a++)m=c[f[a]],p[a]=m[0],u[a]=m[1],d[a]=m[2],r[a]=m[3];n.mask=r}return n.pixels=[p,u,d],n.statistics=null,n.pixelType="u8",n.maskIsAlpha=o,n}function Be(t,e){if(!R(t))return null;const{pixels:n,mask:l}=t,r=n.length;let i=e.lut;const{offset:s}=e;i&&i[0].length===1&&(i=n.map(()=>i));const c=[],h=e.outputPixelType||"u8";for(let a=0;a<r;a++){const f=$t(n[a],l,i[a],s||0,h);c.push(f)}const o=new _({width:t.width,height:t.height,pixels:c,mask:l,pixelType:h});return o.updateStatistics(),o}function $t(t,e,n,l,r){const i=t.length,s=_.createEmptyBand(r,i);if(e)for(let c=0;c<i;c++)e[c]&&(s[c]=n[t[c]-l]);else for(let c=0;c<i;c++)s[c]=n[t[c]-l];return s}function Se(t,e){if(!R(t))return null;const n=t.clone(),{pixels:l}=n,r=n.width*n.height,i=e.length,s=Math.floor(i/2),c=e[Math.floor(s)],h=l[0];let o,a,f,p,u,d,m=!1;const x=new Uint8Array(r),w=new Uint8Array(r),A=new Uint8Array(r);let k=n.mask;const M=e[0].mappedColor.length===4;for(k||(k=new Uint8Array(r),k.fill(M?255:1),n.mask=k),u=0;u<r;u++)if(k[u]){for(o=h[u],m=!1,d=s,a=c,f=0,p=i-1;p-f>1;){if(o===a.value){m=!0;break}o>a.value?f=d:p=d,d=Math.floor((f+p)/2),a=e[Math.floor(d)]}m||(o===e[f].value?(a=e[f],m=!0):o===e[p].value?(a=e[p],m=!0):o<e[f].value?(m=!1,a=null):o>e[f].value&&(o<e[p].value?(a=e[f],m=!0):p===i-1?(m=!1,a=null):(a=e[p],m=!0))),m?(x[u]=a.mappedColor[0],w[u]=a.mappedColor[1],A[u]=a.mappedColor[2],k[u]=a.mappedColor[3]):x[u]=w[u]=A[u]=k[u]=0}return n.pixels=[x,w,A],n.mask=k,n.pixelType="u8",n.maskIsAlpha=M,n}function Ce(t,e){if(!R(t))return null;const{width:n,height:l}=t,{inputRanges:r,outputValues:i,outputPixelType:s,noDataRanges:c,allowUnmatched:h,isLastInputRangeInclusive:o}=e,a=t.pixels[0],f=_.createEmptyBand(s,a.length),p=t.mask,u=new Uint8Array(n*l);p?u.set(p):u.fill(255);const d=t.pixelType.startsWith("f")?1e-6:0,m=r.map(M=>M-d);m[0]=r[0],m[m.length-1]=r[r.length-1]+(o?1e-6:0);const x=r.length/2,[w,A]=rt(s);for(let M=0;M<l;M++)for(let g=0;g<n;g++){const y=M*n+g;if(u[y]){const v=a[y];let b=!1;for(let P=x-1;P>=0;P--)if(v===m[2*P]||v>m[2*P]&&v<m[2*P+1]){f[y]=i[P],b=!0;break}b||(h?f[y]=v>A?A:v<w?w:v:u[y]=0)}}const k=c==null?void 0:c.length;if(k)for(let M=0;M<l;M++)for(let g=0;g<n;g++){const y=M*n+g;if(!p||p[y]){const v=a[y];for(let b=0;b<k;b+=2)if(v>=c[b]&&v<=c[b+1]){f[y]=0,u[y]=0;break}}}return new _({width:n,height:l,pixelType:s,pixels:[f],mask:u})}function wt(t,e,n,l){const r=n!=null&&n.length>=2?new Set(n):null,i=(n==null?void 0:n.length)===1?n[0]:null,s=!!(e!=null&&e.length);for(let c=0;c<t.length;c++)if(l[c]){const h=t[c];if(s){let o=!1;for(let a=0;a<e.length;a+=2)if(h>=e[a]&&h<=e[a+1]){o=!0;break}o||(l[c]=0)}l[c]&&(h===i||r!=null&&r.has(h))&&(l[c]=0)}}function yt(t,e){const n=t[0].length;for(let l=0;l<n;l++)if(e[l]){let r=!1;for(let i=0;i<t.length;i++)if(t[i][l]){r=!0;break}r||(e[l]=0)}}function Pt(t,e){const n=t[0].length;for(let l=0;l<n;l++)if(e[l]){let r=!1;for(let i=0;i<t.length;i++)if(t[i][l]===0){r=!0;break}r&&(e[l]=0)}}function Fe(t,e){if(!R(t))return null;const{width:n,height:l,pixels:r}=t,i=n*l,s=new Uint8Array(i);t.mask?s.set(t.mask):s.fill(255);const c=r.length,{includedRanges:h,noDataValues:o,outputPixelType:a,matchAll:f,lookups:p}=e;if(p){const u=[];for(let d=0;d<c;d++){const m=p[d],x=$t(r[d],s,m.lut,m.offset||0,"u8");u.push(x)}u.length===1?s.set(u[0]):f?yt(u,s):Pt(u,s)}else if(f){const u=[];for(let d=0;d<c;d++){const m=new Uint8Array(i);m.set(s),wt(r[d],h==null?void 0:h.slice(2*d,2*d+2),o==null?void 0:o[d],m),u.push(m)}u.length===1?s.set(u[0]):yt(u,s)}else for(let u=0;u<c;u++)wt(r[u],h==null?void 0:h.slice(2*u,2*u+2),o==null?void 0:o[u],s);return new _({width:n,height:l,pixelType:a,pixels:r,mask:s})}function Ve(t){const{srcPixelType:e,inputRanges:n,outputValues:l,allowUnmatched:r,noDataRanges:i,isLastInputRangeInclusive:s,outputPixelType:c}=t;if(e!=="u8"&&e!=="s8"&&e!=="u16"&&e!=="s16")return null;const h=e.includes("16")?65536:256,o=e.includes("s")?-h/2:0,a=_.createEmptyBand(c,h),f=new Uint8Array(h);r&&f.fill(255);const[p,u]=rt(c);if(n!=null&&n.length&&(l!=null&&l.length)){const m=n.map(x=>x-1e-6);m[0]=n[0],s&&(m[m.length-1]=n[n.length-1]);for(let x=0;x<m.length;x++){const w=l[x]>u?u:l[x]<p?p:l[x],A=Math.ceil(m[2*x]-o),k=Math.floor(m[2*x+1]-o);for(let M=A;M<=k;M++)a[M]=w,f[M]=255}}if(i!=null&&i.length)for(let d=0;d<i.length;d++){const m=Math.ceil(i[2*d]-o),x=Math.floor(i[2*d+1]-o);for(let w=m;w<=x;w++)f[w]=0}return{lut:a,offset:o,mask:f}}function _e(t,e,n){if(t!=="u8"&&t!=="s8"&&t!=="u16"&&t!=="s16")return null;const l=t.includes("16")?65536:256,r=t.includes("s")?-l/2:0,i=new Uint8Array(l);if(e)for(let s=0;s<e.length;s++){const c=Math.ceil(e[2*s]-r),h=Math.floor(e[2*s+1]-r);for(let o=c;o<=h;o++)i[o]=255}else i.fill(255);if(n)for(let s=0;s<n.length;s++)i[n[s]-r]=0;return{lut:i,offset:r}}function te(t,e,n,l,r,i,s,c){return{xmin:r<=n*t?0:r<n*t+t?r-n*t:t,ymin:i<=l*e?0:i<l*e+e?i-l*e:e,xmax:r+s<=n*t?0:r+s<n*t+t?r+s-n*t:t,ymax:i+c<=l*e?0:i+c<l*e+e?i+c-l*e:e}}function De(t,e){if(!t||t.length===0)return null;const n=t.find(d=>d.pixelBlock);if((n==null?void 0:n.pixelBlock)==null)return null;const l=(n.extent.xmax-n.extent.xmin)/n.pixelBlock.width,r=(n.extent.ymax-n.extent.ymin)/n.pixelBlock.height,i=.01*Math.min(l,r),s=t.sort((d,m)=>Math.abs(d.extent.ymax-m.extent.ymax)>i?m.extent.ymax-d.extent.ymax:Math.abs(d.extent.xmin-m.extent.xmin)>i?d.extent.xmin-m.extent.xmin:0),c=Math.min.apply(null,s.map(d=>d.extent.xmin)),h=Math.min.apply(null,s.map(d=>d.extent.ymin)),o=Math.max.apply(null,s.map(d=>d.extent.xmax)),a=Math.max.apply(null,s.map(d=>d.extent.ymax)),f={x:Math.round((e.xmin-c)/l),y:Math.round((a-e.ymax)/r)},p={width:Math.round((o-c)/l),height:Math.round((a-h)/r)},u={width:Math.round((e.xmax-e.xmin)/l),height:Math.round((e.ymax-e.ymin)/r)};return Math.round(p.width/n.pixelBlock.width)*Math.round(p.height/n.pixelBlock.height)!==s.length||f.x<0||f.y<0||p.width<u.width||p.height<u.height?null:{extent:e,pixelBlock:ee(s.map(d=>d.pixelBlock),p,{clipOffset:f,clipSize:u})}}function ft(t,e,n,l,r,i){const{width:s,height:c}=n.block,{x:h,y:o}=n.offset,{width:a,height:f}=n.mosaic,p=te(s,c,l,r,h,o,a,f);let u=0,d=0;if(i){const m=i.hasGCSSShiftTransform?360:i.halfWorldWidth??0,x=s*i.resolutionX,w=i.startX+l*x;w<m&&w+x>m?d=i.rightPadding:w>=m&&(u=i.leftMargin-i.rightPadding,d=0)}if(p.xmax-=d,typeof e!="number")for(let m=p.ymin;m<p.ymax;m++){const x=(r*c+m-o)*a+(l*s-h)+u,w=m*s;for(let A=p.xmin;A<p.xmax;A++)t[x+A]=e[w+A]}else for(let m=p.ymin;m<p.ymax;m++){const x=(r*c+m-o)*a+(l*s-h)+u;for(let w=p.xmin;w<p.xmax;w++)t[x+w]=e}}function ee(t,e,n={}){var T;const{clipOffset:l,clipSize:r,alignmentInfo:i,blockWidths:s}=n;if(s)return ne(t,e,{blockWidths:s});const c=t.find($=>R($));if(c==null)return null;const h=r?r.width:e.width,o=r?r.height:e.height,a=c.width,f=c.height,p=e.width/a,u=e.height/f,d={offset:l||{x:0,y:0},mosaic:r||e,block:{width:a,height:f}},m=c.pixelType,x=_.getPixelArrayConstructor(m),w=c.pixels.length,A=[];let k,M;for(let $=0;$<w;$++){M=new x(h*o);for(let U=0;U<u;U++)for(let I=0;I<p;I++){const C=t[U*p+I];R(C)&&(k=C.pixels[$],ft(M,k,d,I,U,i))}A.push(M)}const g=t.some($=>$==null||$.mask!=null&&$.mask.length>0),y=t.some($=>($==null?void 0:$.bandMasks)&&$.bandMasks.length>1),v=g?new Uint8Array(h*o):void 0,b=y?[]:void 0;if(v){for(let $=0;$<u;$++)for(let U=0;U<p;U++){const I=t[$*p+U],C=I!=null?I.mask:null;ft(v,C??(I?255:0),d,U,$,i)}if(b)for(let $=0;$<w;$++){const U=new Uint8Array(h*o);for(let I=0;I<u;I++)for(let C=0;C<p;C++){const S=t[I*p+C],B=((T=S==null?void 0:S.bandMasks)==null?void 0:T[$])??(S==null?void 0:S.mask);ft(U,B??(S?255:0),d,C,I,i)}b.push(U)}}const P=new _({width:h,height:o,pixels:A,pixelType:m,bandMasks:b,mask:v});return P.updateStatistics(),P}function ne(t,e,n){var x;const l=t.find(w=>w!=null);if(l==null)return null;const r=t.some(w=>w==null||!!w.mask),{width:i,height:s}=e,c=r?new Uint8Array(i*s):null,{blockWidths:h}=n,o=[],a=l.getPlaneCount(),f=_.getPixelArrayConstructor(l.pixelType);if(r)for(let w=0,A=0;w<t.length;A+=h[w],w++){const k=t[w];if(!R(k))continue;const M=k.mask;for(let g=0;g<s;g++)for(let y=0;y<h[w];y++)c[g*i+y+A]=M==null?255:M[g*k.width+y]}const p=t.some(w=>(w==null?void 0:w.bandMasks)&&w.bandMasks.length>1),u=p?[]:void 0,d=i*s;for(let w=0;w<a;w++){const A=new f(d),k=p?new Uint8Array(d):void 0;for(let M=0,g=0;M<t.length;g+=h[M],M++){const y=t[M];if(!R(y))continue;const v=y.pixels[w];if(v!=null){for(let b=0;b<s;b++)for(let P=0;P<h[M];P++)A[b*i+P+g]=v[b*y.width+P];if(k){const b=((x=y.bandMasks)==null?void 0:x[w])??y.mask;for(let P=0;P<s;P++)for(let T=0;T<h[M];T++)k[P*i+T+g]=b?b[P*y.width+T]:255}}}o.push(A),u&&k&&u.push(k)}const m=new _({width:i,height:s,mask:c,bandMasks:u,pixels:o,pixelType:l.pixelType});return m.updateStatistics(),m}function Re(t,e,n){if(!R(t))return null;const{width:l,height:r}=t,i=e.x,s=e.y,c=n.width+i,h=n.height+s;if(i<0||s<0||c>l||h>r||i===0&&s===0&&c===l&&h===r)return t;t.mask||(t.mask=new Uint8Array(l*r));const o=t.mask;for(let a=0;a<r;a++){const f=a*l;for(let p=0;p<l;p++)o[f+p]=a<s||a>=h||p<i||p>=c?0:1}return t.updateStatistics(),t}function ie(t){if(!R(t))return null;const e=t.clone(),{width:n,height:l,pixels:r}=t,i=r[0],s=e.pixels[0],c=t.mask;for(let h=2;h<l-1;h++){const o=new Map;for(let f=h-2;f<h+2;f++)for(let p=0;p<4;p++){const u=f*n+p;lt(o,i[u],c?c[u]:1)}s[h*n]=kt(o),s[h*n+1]=s[h*n+2]=s[h*n];let a=3;for(;a<n-1;a++){let f=(h-2)*n+a+1;lt(o,i[f],c?c[f]:1),f=(h-1)*n+a+1,lt(o,i[f],c?c[f]:1),f=h*n+a+1,lt(o,i[f],c?c[f]:1),f=(h+1)*n+a+1,lt(o,i[f],c?c[f]:1),f=(h-2)*n+a-3,ot(o,i[f],c?c[f]:1),f=(h-1)*n+a-3,ot(o,i[f],c?c[f]:1),f=h*n+a-3,ot(o,i[f],c?c[f]:1),f=(h+1)*n+a-3,ot(o,i[f],c?c[f]:1),s[h*n+a]=kt(o)}s[h*n+a+1]=s[h*n+a]}for(let h=0;h<n;h++)s[h]=s[n+h]=s[2*n+h],s[(l-1)*n+h]=s[(l-2)*n+h];return e.updateStatistics(),e}function kt(t){if(t.size===0)return 0;let e=0,n=-1,l=0;const r=t.keys();let i=r.next();for(;!i.done;)l=t.get(i.value),l>e&&(n=i.value,e=l),i=r.next();return n}function ot(t,e,n){if(n===0)return;const l=t.get(e);l===1?t.delete(e):t.set(e,l-1)}function lt(t,e,n){n!==0&&t.set(e,t.has(e)?t.get(e)+1:1)}function Tt(t,e,n){let{x:l,y:r}=e;const{width:i,height:s}=n;if(l===0&&r===0&&s===t.height&&i===t.width)return t;const{width:c,height:h}=t,o=Math.max(0,r),a=Math.max(0,l),f=Math.min(l+i,c),p=Math.min(r+s,h);if(f<0||p<0||!R(t))return null;l=Math.max(0,-l),r=Math.max(0,-r);const{pixels:u}=t,d=i*s,m=u.length,x=[];for(let M=0;M<m;M++){const g=u[M],y=_.createEmptyBand(t.pixelType,d);for(let v=o;v<p;v++){const b=v*c;let P=(v+r-o)*i+l;for(let T=a;T<f;T++)y[P++]=g[b+T]}x.push(y)}const w=new Uint8Array(d),A=t.mask;for(let M=o;M<p;M++){const g=M*c;let y=(M+r-o)*i+l;for(let v=a;v<f;v++)w[y++]=A?A[g+v]:1}const k=new _({width:n.width,height:n.height,pixelType:t.pixelType,pixels:x,mask:w});return k.updateStatistics(),k}function It(t,e=!0){if(!R(t))return null;const{pixels:n,width:l,height:r,mask:i,pixelType:s}=t,c=[],h=Math.round(l/2),o=Math.round(r/2),a=r-1,f=l-1;for(let u=0;u<n.length;u++){const d=n[u],m=_.createEmptyBand(s,h*o);let x=0;for(let w=0;w<r;w+=2)for(let A=0;A<l;A+=2){const k=d[w*l+A];if(e){const M=A===f?k:d[w*l+A+1],g=w===a?k:d[w*l+A+l],y=A===f?g:w===a?M:d[w*l+A+l+1];m[x++]=(k+M+g+y)/4}else m[x++]=k}c.push(m)}let p=null;if(i!=null){p=new Uint8Array(h*o);let u=0;for(let d=0;d<r;d+=2)for(let m=0;m<l;m+=2){const x=i[d*l+m];if(e){const w=m===f?x:i[d*l+m+1],A=d===a?x:i[d*l+m+l],k=m===f?A:d===a?w:i[d*l+m+l+1];p[u++]=x*w*A*k?1:0}else p[u++]=x}}return new _({width:h,height:o,pixelType:s,pixels:c,mask:p})}function Le(t,e,n=0,l=!0){if(!R(t))return null;const{width:r,height:i}=e;let{width:s,height:c}=t;const h=new Map,o={x:0,y:0},a=1+n;let f=t;for(let p=0;p<a;p++){const u=Math.ceil(s/r),d=Math.ceil(c/i);for(let m=0;m<d;m++){o.y=m*i;for(let x=0;x<u;x++){o.x=x*r;const w=Tt(f,o,e);h.set(`${p}/${m}/${x}`,w)}}p<a-1&&(f=It(f,l)),s=Math.round(s/2),c=Math.round(c/2)}return h}function Ne(t){const{pixelBlock:e,tileSize:n,level:l,row:r,col:i,useBilinear:s}=t;if(!R(e))return null;const{width:c,height:h}=n,o=2**l,a=o*c,f=o*h;let p=Tt(e,{y:r*f,x:i*a},{width:a,height:f});if(!p)return null;for(let u=l;u>0;u--)p=It(p,s);return p}function Bt(t,e,n,l,r=0){const{width:i,height:s}=t,{width:c,height:h}=e,o=l.cols,a=l.rows,f=Math.ceil(c/o-.1/o),p=Math.ceil(h/a-.1/a);let u,d,m,x,w,A,k;const M=f*o,g=M*p*a,y=new Float32Array(g),v=new Float32Array(g),b=new Uint32Array(g),P=new Uint32Array(g);let T,$,U=0;for(let I=0;I<p;I++)for(let C=0;C<f;C++){u=12*(I*f+C),d=n[u],m=n[u+1],x=n[u+2],w=n[u+3],A=n[u+4],k=n[u+5];for(let S=0;S<a;S++){U=(I*a+S)*M+C*o,$=(S+.5)/a;for(let B=0;B<S;B++)T=(B+.5)/o,y[U+B]=(d*T+m*$+x)*i+r,v[U+B]=(w*T+A*$+k)*s+r,b[U+B]=Math.floor(y[U+B]),P[U+B]=Math.floor(v[U+B])}u+=6,d=n[u],m=n[u+1],x=n[u+2],w=n[u+3],A=n[u+4],k=n[u+5];for(let S=0;S<a;S++){U=(I*a+S)*M+C*o,$=(S+.5)/a;for(let B=S;B<o;B++)T=(B+.5)/o,y[U+B]=(d*T+m*$+x)*i+r,v[U+B]=(w*T+A*$+k)*s+r,b[U+B]=Math.floor(y[U+B]),P[U+B]=Math.floor(v[U+B])}}return{offsets_x:y,offsets_y:v,offsets_xi:b,offsets_yi:P,gridWidth:M}}function Ee(t,e){const{coefficients:n,spacing:l}=e,{offsets_x:r,offsets_y:i,gridWidth:s}=Bt(t,t,n,{rows:l[0],cols:l[1]}),{width:c,height:h}=t,o=new Float32Array(c*h),a=180/Math.PI;for(let f=0;f<h;f++)for(let p=0;p<c;p++){const u=f*s+p,d=f===0?u:u-s,m=f===h-1?u:u+s,x=r[d]-r[m],w=i[m]-i[d];if(isNaN(x)||isNaN(w))o[f*c+p]=90;else{let A=Math.atan2(w,x)*a;A=(360+A)%360,o[f*c+p]=A}}return o}function je(t,e,n,l,r="nearest"){if(!R(t))return null;r==="majority"&&(t=ie(t));const{pixels:i,mask:s,bandMasks:c,pixelType:h}=t,o=t.width,a=t.height,f=_.getPixelArrayConstructor(h),p=i.length,{width:u,height:d}=e;let m=!1;for(let U=0;U<n.length;U+=3)n[U]===-1&&n[U+1]===-1&&n[U+2]===-1&&(m=!0);const{offsets_x:x,offsets_y:w,offsets_xi:A,offsets_yi:k,gridWidth:M}=Bt({width:o,height:a},e,n,l,r==="majority"?.5:0);let g;const y=(U,I,C,S)=>{const B=U instanceof Float32Array||U instanceof Float64Array?0:.5;for(let F=0;F<d;F++){g=F*M;for(let V=0;V<u;V++){if(x[g]<0||w[g]<0)U[F*u+V]=0;else if(S)U[F*u+V]=I[A[g]+k[g]*o];else{const E=Math.floor(x[g]),O=Math.floor(w[g]),L=Math.ceil(x[g]),G=Math.ceil(w[g]),X=x[g]-E,H=w[g]-O;if(!C||C[E+O*o]&&C[L+O*o]&&C[E+G*o]&&C[L+G*o]){const et=(1-X)*I[E+O*o]+X*I[L+O*o],Q=(1-X)*I[E+G*o]+X*I[L+G*o];U[F*u+V]=(1-H)*et+H*Q+B}else U[F*u+V]=I[A[g]+k[g]*o]}g++}}},v=[];let b;const P=(c==null?void 0:c.length)===p,T=[];for(let U=0;U<p;U++){if(P){const I=new Uint8Array(u*d);y(I,c[U],c[U],!0),T.push(I)}b=new f(u*d),y(b,i[U],P?c[U]:s,r==="nearest"||r==="majority"),v.push(b)}const $=new _({width:u,height:d,pixelType:h,pixels:v,bandMasks:P?T:void 0});if(s!=null)$.mask=new Uint8Array(u*d),y($.mask,s,s,!0);else if(m){$.mask=new Uint8Array(u*d);for(let U=0;U<u*d;U++)$.mask[U]=x[U]<0||w[U]<0?0:1}return $.updateStatistics(),$}const tt=new Map;tt.set("meter-per-second",1),tt.set("kilometer-per-hour",.277778),tt.set("knots",.514444),tt.set("feet-per-second",.3048),tt.set("mile-per-hour",.44704);const pt=180/Math.PI,dt=5,ht=new jt({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function mt(t,e){return tt.get(t)/tt.get(e)||1}function St(t){return(450-t)%360}function Ct(t,e="geographic"){const[n,l]=t,r=Math.sqrt(n*n+l*l);let i=Math.atan2(l,n)*pt;return i=(360+i)%360,e==="geographic"&&(i=St(i)),[r,i]}function Ft(t,e="geographic"){let n=t[1];e==="geographic"&&(n=St(n)),n%=360;const l=t[0];return[l*Math.cos(n/pt),l*Math.sin(n/pt)]}function qe(t,e,n,l="geographic"){if(!R(t)||n==null)return t;const r=e==="vector-magdir"?t.clone():Mt(t,e),i=r.pixels[1];for(let s=0;s<i.length;s++)i[s]=l==="geographic"?(i[s]+n[s]+270)%360:(i[s]+360-n[s])%360;return e==="vector-magdir"?r:Mt(r,"vector-magdir")}function Mt(t,e,n="geographic",l=1){if(!R(t))return t;const{pixels:r,width:i,height:s}=t,c=i*s,h=r[0],o=r[1],a=t.pixelType.startsWith("f")?t.pixelType:"f32",f=_.createEmptyBand(a,c),p=_.createEmptyBand(a,c);let u=0;for(let m=0;m<s;m++)for(let x=0;x<i;x++)e==="vector-uv"?([f[u],p[u]]=Ct([h[u],o[u]],n),f[u]*=l):([f[u],p[u]]=Ft([h[u],o[u]],n),f[u]*=l,p[u]*=l),u++;const d=new _({pixelType:a,width:t.width,height:t.height,mask:t.mask,validPixelCount:t.validPixelCount,maskIsAlpha:t.maskIsAlpha,pixels:[f,p]});return d.updateStatistics(),d}function Ge(t,e,n=1){if(n===1||!R(t))return t;const l=t.clone(),{pixels:r,width:i,height:s}=l,c=r[0],h=r[1];let o=0;for(let a=0;a<s;a++)for(let f=0;f<i;f++)e==="vector-uv"?(c[o]*=n,h[o]*=n):c[o]*=n,o++;return l.updateStatistics(),l}function Oe(t,e,n,l,r){if(r==null||!r.spatialReference.equals(t.spatialReference))return{extent:t,width:Math.round(e/l),height:Math.round(n/l),resolution:t.width/e};const i=r.xmin,s=r.ymax,c=(t.xmax-t.xmin)/e*l,h=(t.ymax-t.ymin)/n*l,o=(c+h)/2;return t.xmin=i+Math.floor((t.xmin-i)/c)*c,t.xmax=i+Math.ceil((t.xmax-i)/c)*c,t.ymin=s+Math.floor((t.ymin-s)/h)*h,t.ymax=s+Math.ceil((t.ymax-s)/h)*h,{extent:t,width:Math.round(t.width/c),height:Math.round(t.height/h),resolution:o}}const se=Vt(0,0,0);function Vt(t=0,e=0,n=Math.PI,l=!0){l&&(n=(2*Math.PI-n)%(2*Math.PI));const r=l?-1:1,i=13*r,s=-7*r,c=-2*r,h=-16*r,o=21.75,[a,f]=j(0,e+i,n,o),[p,u]=j(t-5.5,e+s,n,o),[d,m]=j(t+5.5,e+s,n,o),[x,w]=j(t-1.5,e+c,n,o),[A,k]=j(t+1.5,e+c,n,o),[M,g]=j(t-1.5,e+h,n,o),[y,v]=j(t+1.5,e+h,n,o);return[a,f,p,u,x,w,A,k,d,m,M,g,y,v]}function le(t=0,e=Math.PI,n=!0){n&&(e=(2*Math.PI-e)%(2*Math.PI));const l=10,r=n?-1:1,i=5*r,s=20*r,c=25*r,h=45,o=0,a=0,f=2,p=0,u=f*r,d=n?1:-1,m=l/2*d;let[x,w]=[o+m,a-s],[A,k]=[x+f*d,w],[M,g]=[A-p*d,k+u],[y,v]=[o-m,a-c],[b,P]=[y+p*d,v-u],T=Math.ceil(t/dt),$=Math.floor(T/10);T-=8*$;const U=[],I=[];for(let X=0;X<T/2;X++,$--){$<=0&&T%2==1&&X===(T-1)/2&&(y=o,b=y+p*d,v=(v+w)/2,P=v-u);const[H,et]=j(y,v,e,h);if($>0){const[Q,it]=j(A,v,e,h),[st,D]=j(x,w,e,h);U.push(Q),U.push(it),U.push(H),U.push(et),U.push(st),U.push(D)}else{const[Q,it]=j(A,k,e,h),[st,D]=j(M,g,e,h),[N,ct]=j(b,P,e,h);I.push(H),I.push(et),I.push(N),I.push(ct),I.push(st),I.push(D),I.push(Q),I.push(it)}v+=i,w+=i,k+=i,g+=i,P+=i}const[C,S]=j(o+m,a+s,e,h),B=(l/2+f)*d,[F,V]=j(o+B,a+s,e,h),[E,O]=j(o+m,a-c,e,h),[L,G]=j(o+B,a-c,e,h);return{pennants:U,barbs:I,shaft:[C,S,F,V,E,O,L,G]}}function j(t,e,n,l=1){const r=Math.sqrt(t*t+e*e)/l,i=(2*Math.PI+Math.atan2(e,t))%(2*Math.PI);return[r,(2*Math.PI+i-n)%(2*Math.PI)]}const at=[0,1,3,6,10,16,21,27,33,40,47,55,63],re=[0,.5,1,1.5,2],oe=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function Y(t,e,n,l){const r=mt(l||"knots",n);let i;for(i=1;i<e.length;i++)if(i===e.length-1){if(t<e[i]*r)break}else if(t<=e[i]*r)break;return Math.min(i-1,e.length-2)}function ae(t,e,n,l,r){let i=0;switch(e){case"beaufort_kn":i=Y(t,at,"knots",n);break;case"beaufort_km":i=Y(t,at,"kilometer-per-hour",n);break;case"beaufort_ft":i=Y(t,at,"feet-per-second",n);break;case"beaufort_m":i=Y(t,at,"meter-per-second",n);break;case"classified_arrow":i=Y(t,r??[],l,n);break;case"ocean_current_m":i=Y(t,re,"meter-per-second",n);break;case"ocean_current_kn":i=Y(t,oe,"knots",n)}return i}function he(t,e){const{style:n,inputUnit:l,outputUnit:r,breakValues:i}=e,s=ht.fromJSON(l),c=ht.fromJSON(r),h=7*6,o=15;let a=0,f=0;const{width:p,height:u,mask:d}=t,m=t.pixels[0],x=t.pixels[1],w=d!=null?d.filter(g=>g>0).length:p*u,A=new Float32Array(w*h),k=new Uint32Array(o*w),M=e.invertDirection?Vt(0,0,0,!1):se;for(let g=0;g<u;g++)for(let y=0;y<p;y++){const v=g*p+y;if(!d||d[g*p+y]){const b=(x[v]+360)%360/180*Math.PI,P=ae(m[v],n,s,c,i);for(let $=0;$<M.length;$+=2)A[a++]=(y+.5)/p,A[a++]=(g+.5)/u,A[a++]=M[$],A[a++]=M[$+1]+b,A[a++]=P,A[a++]=m[v];const T=7*(a/h-1);k[f++]=T,k[f++]=T+1,k[f++]=T+2,k[f++]=T+0,k[f++]=T+4,k[f++]=T+3,k[f++]=T+0,k[f++]=T+2,k[f++]=T+3,k[f++]=T+2,k[f++]=T+5,k[f++]=T+3,k[f++]=T+5,k[f++]=T+6,k[f++]=T+3}}return{vertexData:A,indexData:k}}const ut=[];function ce(t,e){if(ut.length===0)for(let u=0;u<30;u++)ut.push(le(5*u,0,!e.invertDirection));const n=mt(ht.fromJSON(e.inputUnit),"knots"),{width:l,height:r,mask:i}=t,s=t.pixels[0],c=t.pixels[1],h=6,o=[],a=[];let f=0,p=0;for(let u=0;u<r;u++)for(let d=0;d<l;d++){const m=u*l+d,x=s[m]*n;if((!i||i[u*l+d])&&x>=dt){const w=(c[m]+360)%360/180*Math.PI,{pennants:A,barbs:k,shaft:M}=ut[Math.min(Math.floor(x/5),29)];if(A.length+k.length===0)continue;let g=o.length/h;const y=(d+.5)/l,v=(u+.5)/r;for(let b=0;b<A.length;b+=2)o[f++]=y,o[f++]=v,o[f++]=A[b],o[f++]=A[b+1]+w,o[f++]=0,o[f++]=x;for(let b=0;b<k.length;b+=2)o[f++]=y,o[f++]=v,o[f++]=k[b],o[f++]=k[b+1]+w,o[f++]=0,o[f++]=x;for(let b=0;b<M.length;b+=2)o[f++]=y,o[f++]=v,o[f++]=M[b],o[f++]=M[b+1]+w,o[f++]=0,o[f++]=x;for(let b=0;b<A.length/6;b++)a[p++]=g,a[p++]=g+1,a[p++]=g+2,g+=3;for(let b=0;b<k.length/8;b++)a[p++]=g,a[p++]=g+1,a[p++]=g+2,a[p++]=g+1,a[p++]=g+2,a[p++]=g+3,g+=4;a[p++]=g+0,a[p++]=g+1,a[p++]=g+2,a[p++]=g+1,a[p++]=g+3,a[p++]=g+2,g+=4}}return{vertexData:new Float32Array(o),indexData:new Uint32Array(a)}}function fe(t,e){let l=0,r=0;const{width:i,height:s,mask:c}=t,h=t.pixels[0],o=[],a=[],f=mt(ht.fromJSON(e.inputUnit),"knots"),p=e.style==="wind_speed"?dt:Number.MAX_VALUE;for(let u=0;u<s;u++)for(let d=0;d<i;d++){const m=h[u*i+d]*f;if((!c||c[u*i+d])&&m<p){for(let w=0;w<4;w++)o[l++]=(d+.5)/i,o[l++]=(u+.5)/s,o[l++]=w<2?-.5:.5,o[l++]=w%2==0?-.5:.5,o[l++]=0,o[l++]=m;const x=4*(l/24-1);a[r++]=x,a[r++]=x+1,a[r++]=x+2,a[r++]=x+1,a[r++]=x+2,a[r++]=x+3}}return{vertexData:new Float32Array(o),indexData:new Uint32Array(a)}}function We(t,e){return e.style==="simple_scalar"?fe(t,e):e.style==="wind_speed"?ce(t,e):he(t,e)}function Xe(t,e,n,l=[0,0],r=.5){const{width:i,height:s,mask:c}=t,[h,o]=t.pixels,[a,f]=l,p=Math.round((i-a)/n),u=Math.round((s-f)/n),d=p*u,m=new Float32Array(d),x=new Float32Array(d),w=new Uint8Array(d),A=e==="vector-uv";for(let M=0;M<u;M++)for(let g=0;g<p;g++){let y=0;const v=M*p+g,b=Math.max(0,M*n+f),P=Math.max(0,g*n+a),T=Math.min(s,b+n),$=Math.min(i,P+n);for(let U=b;U<T;U++)for(let I=P;I<$;I++){const C=U*i+I;if(!c||c[C]){y++;const S=A?[h[C],o[C]]:[h[C],(360+o[C])%360],[B,F]=A?S:Ft(S);m[v]+=B,x[v]+=F}}if(y>=(T-b)*($-P)*(1-r)){w[v]=1;const[U,I]=Ct([m[v]/y,x[v]/y]);m[v]=U,x[v]=I}else w[v]=0,m[v]=0,x[v]=0}const k=new _({width:p,height:u,pixels:[m,x],mask:w});return k.updateStatistics(),k}const J=()=>Z.getLogger("esri.views.2d.engine.flow.dataUtils"),ue=10;async function ze(t,e,n,l){const r=performance.now(),i=pe(e,n),s=performance.now(),c=me(e,i,n.width,n.height),h=performance.now(),o=xe(c,!0),a=performance.now(),f=t==="Streamlines"?we(o,ue):ye(o),p=performance.now();return nt("esri-2d-profiler")&&(J().info("I.1","_createFlowFieldFromData (ms)",Math.round(s-r)),J().info("I.2","_getStreamlines (ms)",Math.round(h-s)),J().info("I.3","createAnimatedLinesData (ms)",Math.round(a-h)),J().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(p-a)),J().info("I.5","createFlowMesh (ms)",Math.round(p-r)),J().info("I.6","Mesh size (bytes)",f.vertexData.buffer.byteLength+f.indexData.buffer.byteLength)),await Promise.resolve(),qt(l),f}function pe(t,e){const n=ge(e.data,e.width,e.height,t.smoothing);return t.interpolate?(l,r)=>{const i=Math.floor(l),s=Math.floor(r);if(i<0||i>=e.width)return[0,0];if(s<0||s>=e.height)return[0,0];const c=l-i,h=r-s,o=i,a=s,f=i<e.width-1?i+1:i,p=s<e.height-1?s+1:s,u=n[2*(a*e.width+o)],d=n[2*(a*e.width+f)],m=n[2*(p*e.width+o)],x=n[2*(p*e.width+f)],w=n[2*(a*e.width+o)+1],A=n[2*(a*e.width+f)+1];return[(u*(1-h)+m*h)*(1-c)+(d*(1-h)+x*h)*c,(w*(1-h)+n[2*(p*e.width+o)+1]*h)*(1-c)+(A*(1-h)+n[2*(p*e.width+f)+1]*h)*c]}:(l,r)=>{const i=Math.round(l),s=Math.round(r);return i<0||i>=e.width||s<0||s>=e.height?[0,0]:[n[2*(s*e.width+i)],n[2*(s*e.width+i)+1]]}}function de(t,e,n,l,r,i,s,c,h){const o=[];let a=n,f=l,p=0,[u,d]=e(a,f);u*=t.velocityScale,d*=t.velocityScale;const m=Math.sqrt(u*u+d*d);let x,w;o.push({x:a,y:f,t:p,speed:m});for(let A=0;A<t.verticesPerLine;A++){let[k,M]=e(a,f);k*=t.velocityScale,M*=t.velocityScale;const g=Math.sqrt(k*k+M*M);if(g<t.minSpeedThreshold)return o;const y=k/g,v=M/g;if(a+=y*t.segmentLength,f+=v*t.segmentLength,p+=t.segmentLength/g,Math.acos(y*x+v*w)>t.maxTurnAngle)return o;if(t.collisions){const b=Math.round(a*h),P=Math.round(f*h);if(b<0||b>s-1||P<0||P>c-1)return o;const T=i[P*s+b];if(T!==-1&&T!==r)return o;i[P*s+b]=r}o.push({x:a,y:f,t:p,speed:g}),x=y,w=v}return o}function me(t,e,n,l){const r=[],i=new vt,s=1/Math.max(t.lineCollisionWidth,1),c=Math.round(n*s),h=Math.round(l*s),o=new Int32Array(c*h);for(let f=0;f<o.length;f++)o[f]=-1;const a=[];for(let f=0;f<l;f+=t.lineSpacing)for(let p=0;p<n;p+=t.lineSpacing)a.push({x:p,y:f,sort:i.getFloat()});a.sort((f,p)=>f.sort-p.sort);for(const{x:f,y:p}of a)if(i.getFloat()<t.density){const u=de(t,e,f,p,r.length,o,c,h,s);if(u.length<2)continue;r.push(u)}return r}function ge(t,e,n,l){if(l===0)return t;const r=Math.round(3*l),i=new Array(2*r+1);let s=0;for(let o=-r;o<=r;o++){const a=Math.exp(-o*o/(l*l));i[o+r]=a,s+=a}for(let o=-r;o<=r;o++)i[o+r]/=s;const c=new Float32Array(t.length);for(let o=0;o<n;o++)for(let a=0;a<e;a++){let f=0,p=0;for(let u=-r;u<=r;u++){if(a+u<0||a+u>=e)continue;const d=i[u+r];f+=d*t[2*(o*e+(a+u))],p+=d*t[2*(o*e+(a+u))+1]}c[2*(o*e+a)]=f,c[2*(o*e+a)+1]=p}const h=new Float32Array(t.length);for(let o=0;o<e;o++)for(let a=0;a<n;a++){let f=0,p=0;for(let u=-r;u<=r;u++){if(a+u<0||a+u>=n)continue;const d=i[u+r];f+=d*c[2*((a+u)*e+o)],p+=d*c[2*((a+u)*e+o)+1]}h[2*(a*e+o)]=f,h[2*(a*e+o)+1]=p}return h}function xe(t,e){const n=new vt,l=t.reduce((h,o)=>h+o.length,0),r=new Float32Array(4*l),i=new Array(t.length);let s=0,c=0;for(const h of t){const o=s;for(const a of h)r[4*s]=a.x,r[4*s+1]=a.y,r[4*s+2]=a.t,r[4*s+3]=a.speed,s++;i[c++]={startVertex:o,numberOfVertices:h.length,totalTime:h[h.length-1].t,timeSeed:e?n.getFloat():0}}return{lineVertices:r,lineDescriptors:i}}function we(t,e){const{lineVertices:l,lineDescriptors:r}=t;let i=0,s=0;for(const u of r)i+=2*u.numberOfVertices,s+=6*(u.numberOfVertices-1);const c=new Float32Array(i*9),h=new Uint32Array(s);let o=0,a=0;function f(){h[a++]=o-2,h[a++]=o,h[a++]=o-1,h[a++]=o,h[a++]=o+1,h[a++]=o-1}function p(u,d,m,x,w,A,k,M){const g=o*9;let y=0;c[g+y++]=u,c[g+y++]=d,c[g+y++]=1,c[g+y++]=m,c[g+y++]=A,c[g+y++]=k,c[g+y++]=x/2,c[g+y++]=w/2,c[g+y++]=M,o++,c[g+y++]=u,c[g+y++]=d,c[g+y++]=-1,c[g+y++]=m,c[g+y++]=A,c[g+y++]=k,c[g+y++]=-x/2,c[g+y++]=-w/2,c[g+y++]=M,o++}for(const u of r){const{totalTime:d,timeSeed:m}=u;let x=null,w=null,A=null,k=null,M=null,g=null;for(let y=0;y<u.numberOfVertices;y++){const v=l[4*(u.startVertex+y)],b=l[4*(u.startVertex+y)+1],P=l[4*(u.startVertex+y)+2],T=l[4*(u.startVertex+y)+3];let $=null,U=null,I=null,C=null;if(y>0){$=v-x,U=b-w;const S=Math.sqrt($*$+U*U);if($/=S,U/=S,y>1){let B=$+M,F=U+g;const V=Math.sqrt(B*B+F*F);B/=V,F/=V;const E=Math.min(1/(B*$+F*U),e);B*=E,F*=E,I=-F,C=B}else I=-U,C=$;I!==null&&C!==null&&(p(x,w,A,I,C,d,m,T),f())}x=v,w=b,A=P,M=$,g=U,k=T}p(x,w,A,-g,M,d,m,k)}return{vertexData:c,indexData:h}}function ye(t){const{lineVertices:r,lineDescriptors:i}=t;let s=0,c=0;for(const S of i){const B=S.numberOfVertices-1;s+=4*B*2,c+=6*B*2}const h=new Float32Array(s*16),o=new Uint32Array(c);let a,f,p,u,d,m,x,w,A,k,M,g,y,v,b=0,P=0;function T(){o[P++]=b-8,o[P++]=b-7,o[P++]=b-6,o[P++]=b-7,o[P++]=b-5,o[P++]=b-6,o[P++]=b-4,o[P++]=b-3,o[P++]=b-2,o[P++]=b-3,o[P++]=b-1,o[P++]=b-2}function $(S,B,F,V,E,O,L,G,X,H,et,Q,it,st){const D=b*16;let N=0;for(const ct of[1,2])for(const _t of[1,2,3,4])h[D+N++]=S,h[D+N++]=B,h[D+N++]=F,h[D+N++]=V,h[D+N++]=L,h[D+N++]=G,h[D+N++]=X,h[D+N++]=H,h[D+N++]=ct,h[D+N++]=_t,h[D+N++]=it,h[D+N++]=st,h[D+N++]=E/2,h[D+N++]=O/2,h[D+N++]=et/2,h[D+N++]=Q/2,b++}function U(S,B){let F=A+M,V=k+g;const E=Math.sqrt(F*F+V*V);F/=E,V/=E;const O=A*F+k*V;F/=O,V/=O;let L=M+y,G=g+v;const X=Math.sqrt(L*L+G*G);L/=X,G/=X;const H=M*L+g*G;L/=H,G/=H,$(a,f,p,u,-V,F,d,m,x,w,-G,L,S,B),T()}function I(S,B,F,V,E,O){if(A=M,k=g,M=y,g=v,A==null&&k==null&&(A=M,k=g),d!=null&&m!=null){y=S-d,v=B-m;const L=Math.sqrt(y*y+v*v);y/=L,v/=L}A!=null&&k!=null&&U(E,O),a=d,f=m,p=x,u=w,d=S,m=B,x=F,w=V}function C(S,B){A=M,k=g,M=y,g=v,A==null&&k==null&&(A=M,k=g),A!=null&&k!=null&&U(S,B)}for(const S of i){a=null,f=null,p=null,u=null,d=null,m=null,x=null,w=null,A=null,k=null,M=null,g=null,y=null,v=null;const{totalTime:B,timeSeed:F}=S;for(let V=0;V<S.numberOfVertices;V++)I(r[4*(S.startVertex+V)],r[4*(S.startVertex+V)+1],r[4*(S.startVertex+V)+2],r[4*(S.startVertex+V)+3],B,F);C(B,F)}return{vertexData:h,indexData:o}}function At(t,e){const n=e.pixels,{width:l,height:r}=e,i=new Float32Array(l*r*2),s=e.mask||new Uint8Array(l*r*2);if(e.mask||s.fill(255),t==="vector-uv")for(let c=0;c<l*r;c++)i[2*c]=n[0][c],i[2*c+1]=-n[1][c];else if(t==="vector-magdir")for(let c=0;c<l*r;c++){const h=n[0][c],o=Wt(n[1][c]),a=Math.cos(o-Math.PI/2),f=Math.sin(o-Math.PI/2);i[2*c]=a*h,i[2*c+1]=f*h}return{data:i,mask:s,width:l,height:r}}async function Je(t,e,n,l,r,i){const s=performance.now(),c=Gt(e.spatialReference);if(!c){const M=await bt(t,e,n,l,r,i);return nt("esri-2d-profiler")&&J().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-s)),nt("esri-2d-profiler")&&J().info("I.9","Number of parts",1),M}const[h,o]=c.valid,a=o-h,f=Math.ceil(e.width/a),p=e.width/f,u=Math.round(n/f);let d=e.xmin;const m=[],x=performance.now();for(let M=0;M<f;M++){const g=new Ot({xmin:d,xmax:d+p,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference});m.push(bt(t,g,u,l,r,i)),d+=p}const w=await Promise.all(m);nt("esri-2d-profiler")&&J().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-x)),nt("esri-2d-profiler")&&J().info("I.9","Number of parts",w.length);const A={data:new Float32Array(n*l*2),mask:new Uint8Array(n*l),width:n,height:l};let k=0;for(const M of w){for(let g=0;g<M.height;g++)for(let y=0;y<M.width;y++)k+y>=n||(A.data[2*(g*n+k+y)]=M.data[2*(g*M.width+y)],A.data[2*(g*n+k+y)+1]=M.data[2*(g*M.width+y)+1],A.mask[g*n+k+y]=M.mask[g*M.width+y]);k+=M.width}return nt("esri-2d-profiler")&&J().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-s)),A}async function bt(t,e,n,l,r,i){var o;const s={requestProjectedLocalDirections:!0,signal:i};if(r!=null&&(s.timeExtent=r),t.type==="imagery"){await t.load({signal:i});const a=t.rasterInfo.dataType,f=await t.fetchImage(e,n,l,s);return((o=f==null?void 0:f.pixelData)==null?void 0:o.pixelBlock)==null?{data:new Float32Array(n*l*2),mask:new Uint8Array(n*l),width:n,height:l}:At(a,f.pixelData.pixelBlock)}await t.load({signal:i});const c=t.serviceRasterInfo.dataType,h=await t.fetchPixels(e,n,l,s);return(h==null?void 0:h.pixelBlock)==null?{data:new Float32Array(n*l*2),mask:new Uint8Array(n*l),width:n,height:l}:At(c,h.pixelBlock)}export{_e as A,$e as B,Fe as C,je as D,Ne as E,Ve as F,$t as G,Ce as H,De as M,Tt as P,Ee as R,Xe as S,Re as T,ee as U,Le as W,fe as _,Ue as a,Ae as b,Je as c,We as d,ht as e,Mt as f,_ as g,mt as h,Ut as i,rt as j,Ie as k,Ct as l,Oe as m,Se as n,R as o,Ge as p,Be as q,Te as r,ze as s,ve as t,qe as u,be as v,Ht as w,Pe as x,xt as y,gt as z};
