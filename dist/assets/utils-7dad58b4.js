import{O as a,dG as d,bM as h,gk as y,gl as g,gm as M,_ as S,gn as C}from"./index-001ef34f.js";import{f as I,u as z,M as L,y as j,m as x}from"./utils-e297161f.js";function P(o){const t=[];return m(I(o),t),t.length?new a(z(t[0])):null}function m(o,t){var e;if(!o)return;let l;l=o.type==="CIMTextSymbol"?o.symbol:o;const r=o.type==="CIMPolygonSymbol";if(l!=null&&l.symbolLayers){for(const n of l.symbolLayers)if(!(n.colorLocked||r&&(L(n)||j(n)&&n.markerPlacement&&x(n.markerPlacement))))switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor&&p(t,n.tintColor);break;case"CIMVectorMarker":(e=n.markerGraphics)==null||e.forEach(c=>{m(c.symbol,t)});break;case"CIMSolidStroke":case"CIMSolidFill":p(t,n.color);break;case"CIMHatchFill":m(n.lineSymbol,t)}}}function p(o,t){for(const l of o)if(l.join(".")===t.join("."))return;o.push(t)}new d(1e3);new a([128,128,128]);const _=new a("white");function U(o,t){if(!o)return null;let l=null;return h(o)?l=$(o):y(o)&&(l=o.type==="cim"?P(o):o.color?new a(o.color):null),l?s(l,t):null}function $(o){const t=o.symbolLayers;if(!t)return null;let l=null;return t.forEach(r=>{var e;r.type==="object"&&((e=r.resource)!=null&&e.href)||(l=r.type==="water"?r.color:r.material?r.material.color:null)}),l?new a(l):null}function s(o,t){if(t==null||o==null)return o;const l=o.toRgba();return l[3]=l[3]*t,new a(l)}function v(o,t,l){const r=o.symbolLayers;if(!r)return;const e=n=>s(t=t??n??(l!=null?_:null),l);r.forEach(n=>{var c;if(n.type!=="object"||!((c=n.resource)!=null&&c.href)||t)if(n.type==="water")n.color=e(n.color);else{const f=n.material!=null?n.material.color:null,i=e(f);n.material==null?n.material=new C({color:i}):n.material.color=i,l!=null&&"outline"in n&&n.outline!=null&&n.outline.color!=null&&(n.outline.color=s(n.outline.color,l))}})}function E(o,t,l){(t=t??o.color)&&(o.color=s(t,l)),l!=null&&"outline"in o&&o.outline&&o.outline.color&&(o.outline.color=s(o.outline.color,l))}function q(o,t,l){o&&(t||l!=null)&&(t&&(t=new a(t)),h(o)?v(o,t,l):y(o)&&E(o,t,l))}async function O(o,t){const l=o.symbolLayers;l&&await g(l,async r=>R(r,t))}async function R(o,t){switch(o.type){case"extrude":D(o,t);break;case"icon":case"line":case"text":F(o,t);break;case"path":T(o,t);break;case"object":await G(o,t)}}function F(o,t){const l=w(t);l!=null&&(o.size=l)}function w(o){for(const t of o)if(typeof t=="number")return t;return null}function D(o,t){o.size=typeof t[2]=="number"?t[2]:0}async function G(o,t){const{resourceSize:l,symbolSize:r}=await V(o),e=k(t,l,r);o.width=u(t[0],r[0],l[0],e),o.depth=u(t[1],r[1],l[1],e),o.height=u(t[2],r[2],l[2],e)}function T(o,t){const l=k(t,M,[o.width,void 0,o.height]);o.width=u(t[0],o.width,1,l),o.height=u(t[2],o.height,1,l)}function k(o,t,l){for(let r=0;r<3;r++){const e=o[r];switch(e){case"symbol-value":{const n=l[r];return n!=null?n/t[r]:1}case"proportional":break;default:if(e&&t[r])return e/t[r]}}return 1}async function V(o){const{computeObjectLayerResourceSize:t}=await S(()=>import("./symbolLayerUtils-d1e05e4f.js"),["assets/symbolLayerUtils-d1e05e4f.js","assets/index-001ef34f.js","assets/index-0e712e80.css"]),l=await t(o,10),{width:r,height:e,depth:n}=o,c=[r,n,e];let f=1;for(let i=0;i<3;i++){const b=c[i];if(b!=null){f=b/l[i];break}}for(let i=0;i<3;i++)c[i]==null&&(c[i]=l[i]*f);return{resourceSize:l,symbolSize:c}}function u(o,t,l,r){switch(o){case"proportional":return l*r;case"symbol-value":return t??l;default:return o}}function A(o,t){const l=w(t);if(l!=null)switch(o.type){case"simple-marker":o.size=l;break;case"picture-marker":{const r=o.width/o.height;r>1?(o.width=l,o.height=l*r):(o.width=l*r,o.height=l);break}case"simple-line":o.width=l;break;case"text":o.font.size=l}}async function B(o,t){if(o&&t)return h(o)?O(o,t):void(y(o)&&A(o,t))}function J(o,t,l){if(o&&t!=null)if(h(o)){const r=o.symbolLayers;r&&r.forEach(e=>{if(e&&e.type==="object")switch(l){case"tilt":e.tilt=t;break;case"roll":e.roll=t;break;default:e.heading=t}})}else y(o)&&(o.type!=="simple-marker"&&o.type!=="picture-marker"&&o.type!=="text"||(o.angle=t))}async function K(o,t){return await o.fetchSymbol(t)||o.fetchCIMSymbol(t)}export{J as D,K as N,B as R,U as h,q as k};
