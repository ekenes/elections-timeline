{"version":3,"mappings":"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","names":["A","e","U","t","r","C","o","I","D","a","i","O","S","x","we","P","d","T","E","Y","ye","W","M","_a","R","s","f","u","ce","Z","G","w","k","$","B","N","K","F","H","J","q","z","Q","X","y","h","ee","ae","ie","ne","se","le","pe","te","oe","c","re","fe","g","j","me","l","__vitePreload","b","n","_","ue","m","de","v","p","_e","he","ge"],"sources":["../../node_modules/@arcgis/core/webdoc/support/webdocSaveUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{MultiOriginJSONSupport as t}from\"../../core/MultiOriginJSONSupport.js\";import{whenOnce as o}from\"../../core/reactiveUtils.js\";import{hasSameCanonicalPortal as r,urlToObject as a}from\"../../core/urlUtils.js\";import{updateOrigins as i}from\"../../core/accessorSupport/originUtils.js\";import n from\"../../geometry/SpatialReference.js\";import{equals as s}from\"../../geometry/support/spatialReferenceUtils.js\";import{webMercatorToGeographic as l}from\"../../geometry/support/webMercatorUtils.js\";import{isServerOrServicesAGOLUrl as p}from\"../../layers/support/arcgisLayerUrl.js\";import{isLayerWithFeatureLayerSource as c,isFeatureCollectionLayer as m}from\"../../layers/support/layerUtils.js\";import u from\"../../portal/Portal.js\";import f from\"../../portal/PortalItem.js\";import{createForItemWrite as d}from\"../../portal/support/jsonContext.js\";import{typeKeyword as w,removeTypeKeyword as y,addTypeKeyword as h,hasTypeKeyword as g}from\"../../portal/support/portalItemUtils.js\";import{project as _}from\"../../rest/geometryService/project.js\";import b from\"../../rest/support/ProjectParameters.js\";import{hasDeveloperBasemapLayer as j,findSpatialReference as R,isDeveloperBasemapLayer as v}from\"../../support/basemapUtils.js\";import{saveResources as P}from\"./resourceUtils.js\";import{validateSaveAPIKey as W}from\"./saveAPIKeyUtils.js\";import{beforeSave as I,evaluateWriteErrors as S}from\"./saveUtils.js\";const A=[\"NatGeo_World_Map\",\"Ocean_Basemap\",\"USA_Topo_Maps\",\"World_Imagery\",\"World_Street_Map\",\"World_Terrain_Base\",\"World_Topo_Map\",\"World_Hillshade\",\"Canvas/World_Light_Gray_Base\",\"Canvas/World_Light_Gray_Reference\",\"Canvas/World_Dark_Gray_Base\",\"Canvas/World_Dark_Gray_Reference\",\"Ocean/World_Ocean_Base\",\"Ocean/World_Ocean_Reference\",\"Reference/World_Boundaries_and_Places\",\"Reference/World_Reference_Overlay\",\"Reference/World_Transportation\"].map((e=>e.toLowerCase()));async function U(e,t,r){r??={},C(e,t),await o((()=>!t.updatingFromView)),await t.load(),await V(t),await I(t),await D(e,t);const a=t.portalItem,{json:i,jsonContext:n}=await O(t,a);return S(n,{errorName:`${e.name}:save`},r),await x(t,a),await we(e,t,a,i,n),await Promise.all([t.updateItemThumbnail(),P(t.resourceReferences,n)]),a}async function O(e,t){const o=d(t,\"web-map\",!0),r=e.write({},o);return await Promise.all(o.resources.pendingOperations),{json:r,jsonContext:o}}async function T(e,t,r,a){a??={};const i=E(e,r);await o((()=>!t.updatingFromView)),await t.load(),await V(t),await I(t),await D(e,t);const{json:n,jsonContext:s}=await O(t,i);S(s,{errorName:`${e.name}:save`},a),await Y(t,i);const l=t.getThumbnailState();return await ye(e,t,i,n,s,a)&&(t.resourceReferences.portalItem=i),t.restoreThumbnailFromState(l),await Promise.all([t.updateItemThumbnail(),P(t.resourceReferences,s)]),i}function C(t,o){if(!o.portalItem)throw new e(`${t.name}:portal-item-not-set`,\"Portal item to save to has not been set on the WebMap\");W(o.portalItem),M(t,o.portalItem)}function M(t,o){if(o.type!==t.itemType)throw new e(`${t.name}:portal-item-wrong-type`,`Portal item needs to have type \"${t.itemType}\"`)}async function D(t,r){if(!r.basemap?.baseLayers.length)throw new e(`${t.name}:save`,\"Map does not have a valid basemap with a base layer.\");let a=null;if(await o((()=>{const e=R(r.initialViewProperties,r.basemap);return a=e.spatialReference,!e.updating})),!s(a,r.initialViewProperties.spatialReference))throw new e(`${t.name}:save`,\"The spatial reference of the basemap is not compatible with the one from the map.\",{expected:r.initialViewProperties.spatialReference,actual:a})}function E(e,t){let o=f.from(t);return o.id&&(o=o.clone(),o.id=null),o.type||(o.type=e.itemType),o.portal||(o.portal=u.getDefault()),W(o),M(e,o),o}function V(e){const t=[];return e.basemap&&t.push(e.basemap.load()),e.ground&&t.push(e.ground.load()),Promise.allSettled(t).then((()=>{}))}async function x(e,t){t.extent=await ce(e.portalItem,e.initialViewProperties.viewpoint.targetGeometry),await Z(e,t)}const G=w.JSAPI,L=\"CollectorDisabled\",k=\"Collector\",$=\"Data Editing\",B=\"OfflineDisabled\",N=\"Offline\",K=\"Workforce Project\",F=\"Workforce Worker\",H=\"Workforce Dispatcher\",J=\"Offline Map Areas\",q=\"FieldMapsDisabled\",z=w.DEVELOPER_BASEMAP,Q=\"UtilityNetwork\",X=\"IPS\";async function Y(e,t){y(t,L),y(t,q),y(t,w.METADATA),y(t,B),y(t,J),y(t,H),y(t,K),y(t,F),await x(e,t)}async function Z(e,t){h(t,G),await ee(e),ae(e,t),ie(e,t),ne(e,t),se(e,t),le(e,t),pe(e,t),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter(((e,t,o)=>o.indexOf(e)===t)))}function ee(e){const t=te(e).map((e=>e.load())).toArray();return Promise.allSettled(t).then((()=>{}))}function te(e){return e.allLayers.concat(e.allTables)}function oe(e){return te(e).some((e=>e.loaded&&c(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled&&(\"subtype-group\"!==e.type||e.sublayers.some((e=>e.editingEnabled)))))}function re(e){return te(e).filter((e=>\"group\"!==e.type)).every((t=>t.loaded&&fe(e,t)))}function ae(e,t){g(t,L)||g(t,K)||g(t,F)||g(t,H)||!oe(e)?y(t,k):h(t,k)}function ie(e,t){oe(e)?h(t,$):y(t,$)}function ne(e,t){!g(t,B)&&re(e)?h(t,N):y(t,N)}function se(e,t){j(e.basemap)?h(t,z):y(t,z)}function le(e,t){e.utilityNetworks?.length?h(t,Q):y(t,Q)}function pe(e,t){e.ipsInfo?h(t,X):y(t,X)}async function ce(e,t){const o=t.clone().normalize();let r;if(o.length>1)for(const a of o)r?a.width>r.width&&(r=a):r=a;else r=o[0];return me(e,r)}async function me(e,t){const o=t.spatialReference;if(o.isWGS84)return t.clone();if(o.isWebMercator)return l(t);const{getGeometryServiceURL:r}=await import(\"../../portal/support/geometryServiceUtils.js\"),a=await r(e),i=new b({geometries:[t],outSpatialReference:n.WGS84});return(await _(a,i))[0]}function ue(e){return m(e)||\"map-notes\"===e.type||\"route\"===e.type}function fe(e,t){return c(t)&&t.capabilities.operations.supportsSync||ue(t)&&!t.portalItem||(\"tile\"===t.type||\"vector-tile\"===t.type)&&(t.capabilities.operations.supportsExportTiles||de(t)||v(t))&&t.spatialReference.equals(e.initialViewProperties.spatialReference)}function de(e){return\"tile\"===e.type&&(p(e.url)&&A.some((t=>e.url?.toLowerCase().includes(\"/\"+t+\"/\"))))}async function we(e,t,o,r,a){await o.update({data:r}),_e(e,t,o,r,a)}async function ye(t,o,r,a,i,n){const s=o.portalItem,l={item:s,authenticated:!(!s?.id||!s.portal.user)},p=r.portal;await p.signIn();const{copyAllowed:c,itemReloaded:m}=await he(l,p);if(l.authenticated||=m,!c)throw new e(`${t.name}:save-as-copy-not-allowed`,\"Owner of this map does not allow others to save a copy\");const u=await ge(r,l,a,n);return o.portalItem=r,_e(t,o,r,a,i),u}async function he(e,t){const{item:o,authenticated:r}=e;return o?.id&&o.typeKeywords?.includes(\"useOnly\")?o.portal.portalHostname!==t.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(r||await o.reload(),{copyAllowed:\"admin\"===o.itemControl||\"update\"===o.itemControl,itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}async function ge(e,t,o,a){const i=e.portal,{item:n}=t,{folder:s,copyAllResources:l}=a;let p=!1;if(l&&n?.id&&r(n.portal.url,i.url)&&parseInt(n.portal.currentVersion,10)>=2023){const{total:e}=await n.fetchResources();p=!!e}if(p){const t=await n.copy({copyResources:\"all\",folder:s});e.id=t.id,e.portal=t.portal;const r=e.toJSON();await e.load(),e.read(r),await e.update({data:o})}else await(i.user?.addItem({item:e,folder:s,data:o}));return p}function _e(e,o,r,n,s){t.prototype.read.call(o,{version:n.version,authoringApp:n.authoringApp,authoringAppVersion:n.authoringAppVersion},{origin:e.origin,ignoreDefaults:!0,url:r.itemUrl?a(r.itemUrl):void 0}),i(s),o.resourceInfo=n}export{O as createJSON,U as save,T as saveAs};\n"],"file":"assets/webdocSaveUtils-8ab364bc.js"}