import{im as Nt,io as tt,ip as Lt,iq as Bt,ir as f,d as It,g4 as Vt,is as O,it as jt,hV as gt,aI as v,aH as Gt,aM as yt,q as m,aL as zt,v as $t,iu as Ht,iv as Wt,iw as qt,cx as Dt,hf as Ut,t as C,ix as Kt,aK as mt,cw as b,iy as Yt,iz as ht,ib as et,iA as Jt,n as At,eD as z,iB as rt,ep as nt,eo as ot,iC as kt,cf as Qt,iD as Xt,b_ as Zt,b$ as te,hd as W,iE as Pt,iF as at,iG as ee,cC as re,b0 as ne,iH as oe,iI as ae,g9 as ie,iJ as se}from"./index-10102046.js";import{e as Ft}from"./mat3f64-221ce671.js";import{e as x,o as V}from"./mat4f64-1413b4a7.js";import{c as w}from"./spatialReferenceEllipsoidUtils-27912cea.js";import{m as le,t as it,o as ce}from"./MeshLocalVertexSpace-21667a21.js";import{m as ue}from"./MeshGeoreferencedRelativeVertexSpace-063d4e82.js";import{v as K,y as fe,x as pe}from"./quat-a1c1817e.js";import{e as Q}from"./quatf64-3363c48e.js";import{n as d,s as Tt,r as E}from"./vec32-61be0e61.js";import{i as F,T}from"./BufferView-676ae9bd.js";function Ct(t,e,r){const n=Math.sin(t),o=Math.cos(t),a=Math.sin(e),s=Math.cos(e),i=r;return i[0]=-n,i[4]=-a*o,i[8]=s*o,i[12]=0,i[1]=o,i[5]=-a*n,i[9]=s*n,i[13]=0,i[2]=0,i[6]=s,i[10]=a,i[14]=0,i[3]=0,i[7]=0,i[11]=0,i[15]=1,i}function ge(t,e,r){return Ct(t,e,r),Nt(r,r),r}function H(t,e,r,n){if(t==null||n==null)return!1;const o=tt(t,Lt),a=tt(n,Bt);if(o===a&&!st(a)&&(o!==f.UNKNOWN||It(t,n)))return Vt(r,e),!0;if(st(a)){const s=O[o][f.LON_LAT],i=O[f.LON_LAT][a];return s!=null&&i!=null&&(s(e,0,A,0),i(A,0,P,0),Ct(S*A[0],S*A[1],r),r[12]=P[0],r[13]=P[1],r[14]=P[2],!0)}if((a===f.WEB_MERCATOR||a===f.PLATE_CARREE)&&(o===f.WGS84||o===f.CGCS2000&&a===f.PLATE_CARREE||o===f.SPHERICAL_ECEF||o===f.WEB_MERCATOR)){const s=O[o][f.LON_LAT],i=O[f.LON_LAT][a];return s!=null&&i!=null&&(s(e,0,A,0),i(A,0,P,0),o===f.SPHERICAL_ECEF?ge(S*A[0],S*A[1],r):jt(r),r[12]=P[0],r[13]=P[1],r[14]=P[2],!0)}return!1}function st(t){return t===f.SPHERICAL_ECEF||t===f.SPHERICAL_MARS_PCPF||t===f.SPHERICAL_MOON_PCPF}const S=gt(1),A=v(),P=v();let j=class extends Gt(yt){constructor(){super({}),this.type="georeferenced",this.isRelative=!1,this.isGeoreferenced=!0}};m([zt({georeferenced:"georeferenced"},{readOnly:!0})],j.prototype,"type",void 0),j=m([$t("esri.geometry.support.MeshGeoreferencedVertexSpace")],j);const ye=j;function _(t=Rt){return[t[0],t[1],t[2],t[3]]}function G(t,e,r=_()){return Dt(r,t),r[3]=e,r}function lt(t,e,r=_()){return K(N,t,Y(t)),K(ct,e,Y(e)),fe(N,ct,N),me(r,Ut(pe(r,N)))}function ke(t,e,r,n=_()){return G(Ht,t,L),G(Wt,e,ut),G(qt,r,ft),lt(L,ut,L),lt(L,ft,n),n}function Qe(t){return t}function $e(t){return t[3]}function Y(t){return gt(t[3])}function me(t,e){return t[3]=e,t}const Rt=[0,0,1,0],N=Q(),ct=Q();_();const L=_(),ut=_(),ft=_();var J;let $=J=class extends yt{constructor(t){super(t),this.translation=v(),this.rotationAxis=Kt(Rt),this.rotationAngle=0,this.scale=mt(1,1,1)}get rotation(){return G(this.rotationAxis,this.rotationAngle)}set rotation(t){this.rotationAxis=b(t),this.rotationAngle=$e(t)}get localMatrix(){const t=x();return K(pt,this.rotation,Y(this.rotation)),Yt(t,pt,this.translation,this.scale),t}get localMatrixInverse(){return ht(x(),this.localMatrix)}applyLocal(t,e){return et(e,t,this.localMatrix)}applyLocalInverse(t,e){return et(e,t,this.localMatrixInverse)}equals(t){return this===t||t!=null&&Jt(this.localMatrix,t.localMatrix)}clone(){const t={translation:b(this.translation),rotationAxis:b(this.rotationAxis),rotationAngle:this.rotationAngle,scale:b(this.scale)};return new J(t)}};m([C({type:[Number],nonNullable:!0,json:{write:!0}})],$.prototype,"translation",void 0),m([C({type:[Number],nonNullable:!0,json:{write:!0}})],$.prototype,"rotationAxis",void 0),m([C({type:Number,nonNullable:!0,json:{write:!0}})],$.prototype,"rotationAngle",void 0),m([C({type:[Number],nonNullable:!0,json:{write:!0}})],$.prototype,"scale",void 0),m([C()],$.prototype,"rotation",null),m([C()],$.prototype,"localMatrix",null),m([C()],$.prototype,"localMatrixInverse",null),$=J=m([$t("esri.geometry.support.MeshTransform")],$);const pt=Q(),he=$;function _t(t,e){return t.isGeographic||t.isWebMercator&&((e==null?void 0:e.geographic)??!0)}function Xe(t,e,r){const n=!t.isGeoreferenced;(r==null?void 0:r.geographic)!=null&&r.geographic!==n&&At.getLogger(e).warnOnce(`Specifying the 'geographic' parameter (${r.geographic}) for a Mesh vertex space of type "${t.type}" is not supported. This parameter will be ignored.`)}const q=At.getLogger("esri.geometry.support.meshUtils.normalProjection");function Ae(t,e,r,n,o){return U(n)?(D(h.TO_PCPF,F.fromTypedArray(t),T.fromTypedArray(e),T.fromTypedArray(r),n,F.fromTypedArray(o)),o):(q.error("Cannot convert spatial reference to PCPF"),o)}function Pe(t,e,r,n,o){return U(n)?(D(h.FROM_PCPF,F.fromTypedArray(t),T.fromTypedArray(e),T.fromTypedArray(r),n,F.fromTypedArray(o)),o):(q.error("Cannot convert to spatial reference from PCPF"),o)}function Fe(t,e,r){return z(t,e,0,r,w(e),0,t.length/3),r}function Te(t,e,r){return z(t,w(r),0,e,r,0,t.length/3),e}function Ce(t,e,r){return W(u,r),d(e,t,u),Pt(u)||Tt(e,e),e}function Re(t,e,r){if(W(u,r),d(e,t,u,4),Pt(u)||Tt(e,e,4),t!==e)for(let n=3;n<t.length;n+=4)e[n]=t[n];return e}function _e(t,e,r,n,o){if(!U(n))return q.error("Cannot convert spatial reference to PCPF"),o;D(h.TO_PCPF,F.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),T.fromTypedArray(e),T.fromTypedArray(r),n,F.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT));for(let a=3;a<t.length;a+=4)o[a]=t[a];return o}function de(t,e,r,n,o){if(!U(n))return q.error("Cannot convert to spatial reference from PCPF"),o;D(h.FROM_PCPF,F.fromTypedArray(t,16),T.fromTypedArray(e),T.fromTypedArray(r),n,F.fromTypedArray(o,16));for(let a=3;a<t.length;a+=4)o[a]=t[a];return o}function D(t,e,r,n,o,a){if(!e)return;const s=r.count,i=w(o);if(dt(o))for(let l=0;l<s;l++)n.getVec(l,B),e.getVec(l,y),H(i,B,I,i),rt(u,I),t===h.FROM_PCPF&&nt(u,u),ot(y,y,u),a.setVec(l,y);else for(let l=0;l<s;l++){n.getVec(l,B),e.getVec(l,y),H(i,B,I,i),rt(u,I);const c=kt(r.get(l,1));let p=Math.cos(c);t===h.TO_PCPF&&(p=1/p),u[0]*=p,u[1]*=p,u[2]*=p,u[3]*=p,u[4]*=p,u[5]*=p,t===h.FROM_PCPF&&nt(u,u),ot(y,y,u),Qt(y,y),a.setVec(l,y)}return a}function U(t){return dt(t)||Me(t)}function dt(t){return t.isWGS84||Xt(t)||Zt(t)||te(t)}function Me(t){return t.isWebMercator}var h;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(h||(h={}));const B=v(),y=v(),I=x(),u=Ft();function X(t,e,r){return _t(e.spatialReference,r)?Oe(t,e,r):we(t,e,r)}function Mt(t,e=V){const{position:r,normal:n,tangent:o}=t;return{position:E(new Float64Array(r.length),r,e),normal:n!=null?Ce(n,new Float32Array(n.length),e):null,tangent:o!=null?Re(o,new Float32Array(o.length),e):null}}function xt(t,e,r,n){const{position:o,normal:a,tangent:s}=t;return e.isRelative?X(Mt(t,r==null?void 0:r.localMatrix),e.getOriginPoint(n),{geographic:!e.isGeoreferenced}):{position:o,normal:a,tangent:s}}function xe(t,e,r){if(r!=null&&r.useTransform){const{position:n,normal:o,tangent:a}=t,{x:s,y:i,z:l}=e,c=mt(s,i,l??0);return{vertexAttributes:{position:n,normal:o,tangent:a},vertexSpace:r.geographic??1?new le({origin:c}):new ue({origin:c}),transform:new he}}return{vertexAttributes:X(t,e,r),vertexSpace:new ye,transform:null}}function k(t,e,r){return _t(e.spatialReference,r)?Le(t,e,r):Et(t,e,r)}function Ee(t,e,r,n,o){if(!e.isRelative)return k(t,n,o);const{spatialReference:a}=n,s=xt(t,e,r,a);return n.equals(e.getOriginPoint(a))?Et(s,n,o):k(s,n,o)}function ve({positions:t,transform:e,vertexSpace:r,inSpatialReference:n,outSpatialReference:o,outPositions:a}){const s=r.isRelative?r.origin:at,i=r.isRelative?(e==null?void 0:e.localMatrix)??V:V;if(r.isGeoreferenced){const g=a??it(t.length);if(ee(i,V)?ce(g,t):E(g,t,i),!re(s,at)){const[Ot,bt,St]=s;for(let M=0;M<g.length;M+=3)g[M]+=Ot,g[M+1]+=bt,g[M+2]+=St}return z(g,n,0,g,o,0,g.length/3),g}let l=n;const c=w(n);ne(n,c)&&(l=c),H(n,s,R,l),oe(R,R,i);const p=a??it(t.length);return E(p,t,R),z(p,l,0,p,o,0,p.length/3),p}function we(t,e,r){const n=new Float64Array(t.position.length),o=t.position,a=e.x,s=e.y,i=e.z??0,l=Z(r?r.unit:null,e.spatialReference);for(let c=0;c<o.length;c+=3)n[c]=o[c]*l+a,n[c+1]=o[c+1]*l+s,n[c+2]=o[c+2]*l+i;return{position:n,normal:t.normal,tangent:t.tangent}}function Oe(t,e,r){const n=e.spatialReference,o=vt(e,r,R),a=new Float64Array(t.position.length),s=be(t.position,o,n,a),i=W(wt,o);return{position:s,normal:Se(s,a,t.normal,i,n),tangent:Ne(s,a,t.tangent,i,n)}}function be(t,e,r,n){E(n,t,e);const o=new Float64Array(t.length);return Te(n,o,r)}function Se(t,e,r,n,o){if(r==null)return null;const a=new Float32Array(r.length);return d(a,r,n),Pe(a,t,e,o,a),a}function Ne(t,e,r,n,o){if(r==null)return null;const a=new Float32Array(r.length);d(a,r,n,4);for(let s=3;s<a.length;s+=4)a[s]=r[s];return de(a,t,e,o,a),a}function Et(t,e,r){const n=new Float64Array(t.position.length),o=t.position,a=e.x,s=e.y,i=e.z??0,l=Z(r?r.unit:null,e.spatialReference);for(let c=0;c<o.length;c+=3)n[c]=(o[c]-a)/l,n[c+1]=(o[c+1]-s)/l,n[c+2]=(o[c+2]-i)/l;return{position:n,normal:t.normal,tangent:t.tangent}}function Le(t,e,r){const n=e.spatialReference;vt(e,r,R);const o=ht(je,R),a=new Float64Array(t.position.length),s=Be(t.position,n,o,a),i=W(wt,o);return{position:s,normal:Ie(t.normal,t.position,a,n,i),tangent:Ve(t.tangent,t.position,a,n,i)}}function vt(t,e,r){H(t.spatialReference,[t.x,t.y,t.z??0],r,w(t.spatialReference));const n=Z(e?e.unit:null,t.spatialReference);return ae(r,r,[n,n,n]),r}function Be(t,e,r,n){const o=Fe(t,e,n),a=new Float64Array(o.length);return E(a,o,r),a}function Ie(t,e,r,n,o){if(t==null)return null;const a=Ae(t,e,r,n,new Float32Array(t.length));return d(a,a,o),a}function Ve(t,e,r,n,o){if(t==null)return null;const a=_e(t,e,r,n,new Float32Array(t.length));return d(a,a,o,4),a}function Z(t,e){if(t==null)return 1;const r=ie(e);return 1/se(r,"meters",t)}const R=x(),je=x(),wt=Ft(),Ze=Object.freeze(Object.defineProperty({__proto__:null,applyTransform:Mt,georeference:X,georeferenceApplyTransform:xt,georeferenceByTransform:xe,project:ve,ungeoreference:k,ungeoreferenceByTransform:Ee},Symbol.toStringTag,{value:"Module"}));export{xe as B,k as D,Ee as E,ve as I,H as L,he as N,Te as O,_e as R,X as U,Mt as V,Pe as _,_ as a,lt as b,Ze as c,ke as g,Fe as h,Ae as j,Qe as l,Xe as o,ye as p,xt as q,_t as r,de as v,Y as w};
