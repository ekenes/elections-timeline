{"version":3,"file":"OverlayContainer-f183d578.js","sources":["../../node_modules/@arcgis/core/views/2d/engine/webgl/OverlayContainer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{identity as t,multiply as e,translate as r,scale as s,rotate as o}from\"../../../../core/libs/gl-matrix-2/math/mat3.js\";import{create as i}from\"../../../../core/libs/gl-matrix-2/factories/mat3f32.js\";import{fromValues as a}from\"../../../../core/libs/gl-matrix-2/factories/vec2f32.js\";import{fromValues as n}from\"../../../../core/libs/gl-matrix-2/factories/vec3f32.js\";import{normalizeMapX as l}from\"../../../../geometry/support/normalizeUtils.js\";import{getInfo as c}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{getWorldWidth as p}from\"../../viewpointUtils.js\";import{brushes as m}from\"../brushes.js\";import{WGLDrawPhase as d}from\"./enums.js\";import h from\"./WGLContainer.js\";class f extends h{constructor(){super(...arguments),this._viewStateId=-1,this._dvsMat3=i()}get dvsMat3(){return this._dvsMat3}beforeRender(t){this._updateMatrices(t),this._updateOverlays(t,this.children);for(const e of this.children)e.beforeRender(t)}prepareRenderPasses(t){const e=t.registerRenderPass({name:\"overlay\",brushes:[m.overlay],target:()=>this.children,drawPhase:d.MAP});return[...super.prepareRenderPasses(t),e]}_updateMatrices(i){const{state:c}=i,{id:p,size:m,pixelRatio:d,resolution:h,rotation:f,viewpoint:u,displayMat3:M}=c;if(this._viewStateId===p)return;const v=Math.PI/180*f,g=d*m[0],_=d*m[1];this._localOrigin=u.targetGeometry.clone();const{x:y,y:b}=this._localOrigin,x=l(y,c.spatialReference);this._localOrigin.x=x,this._localOrigin.y=b;const j=h*g,w=h*_,R=t(this._dvsMat3);e(R,R,M),r(R,R,a(g/2,_/2)),s(R,R,n(g/j,-_/w,1)),o(R,R,-v),this._viewStateId=p}_updateOverlays(t,e){const{state:r}=t,{rotation:s,spatialReference:o,worldScreenWidth:i,size:a,viewpoint:n}=r,l=this._localOrigin;let m,d=0;const h=c(o);if(h&&o.isWrappable){const t=a[0],e=a[1],l=180/Math.PI*s,c=Math.abs(Math.cos(l)),f=Math.abs(Math.sin(l)),u=Math.round(t*c+e*f),[M,v]=h.valid,g=p(o),{x:_,y}=n.targetGeometry,b=[_,y],x=[0,0];r.toScreen(x,b);const j=[0,0];let w;w=u>i?.5*i:.5*u;const R=Math.floor((_+.5*g)/g),O=M+R*g,P=v+R*g,I=[x[0]+w,0];r.toMap(j,I),j[0]>P&&(d=g),I[0]=x[0]-w,r.toMap(j,I),j[0]<O&&(d=-g),m={worldWidth:g,xBounds:[M,v]}}for(const c of e)c.updateDrawCoords(l,d,o,m)}}export{f as default};\n"],"names":["f","h","i","t","e","m","d","c","p","M","v","g","_","y","b","x","l","j","w","R","r","a","s","n","o","u","O","P","I"],"mappings":"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","x_google_ignoreList":[0]}