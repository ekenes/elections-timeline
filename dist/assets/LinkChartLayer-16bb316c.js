import{dz as fr,s as _,n as s,q as p,t as R,b4 as ke,aB as se,a9 as Vt,K as gr,_ as at,e9 as ot,dy as Tt,aG as Wt,ay as xe,a8 as ye,aF as Re,m as Ee,X as ve,aX as wr,av as ge,e6 as Kt,c4 as De,aP as st,aH as Ge,kU as xt,fS as Gt,fa as _r,eW as br,b6 as Zt,b7 as Xt,cA as Tr,kV as Er,eI as me,d9 as Rt,z as Je,eY as kr,e_ as Mr,w as Cr,x as Ir,f5 as Lr,ba as er,V as St,cr as vr}from"./index-d2e37ef9.js";import{p as ue}from"./geohashUtils-77d8429b.js";import{r as le}from"./featureConversionUtils-844127df.js";import{a as $t,t as Nt}from"./OptimizedGeometry-33b2eb0d.js";import{m as Dr}from"./FeatureStore-c0530409.js";import{e as xr}from"./QueryEngine-3935dd1e.js";import{c as Gr,o as Ve}from"./clientSideDefaults-37f6cacd.js";import"./OptimizedFeatureSet-1d1ac4b9.js";import"./BoundsStore-159f4782.js";import"./PooledRBush-fdc8ab15.js";import"./projectionSupport-7d3f1ff4.js";import"./json-48e3ea08.js";import"./timeSupport-fd5b8c3a.js";import"./normalizeUtils-04844d03.js";import"./normalizeUtilsCommon-a51f3cb3.js";import"./utils-6996243e.js";import"./WhereClause-add4a98b.js";import"./executionError-c92d3b85.js";import"./QueryEngineCapabilities-85c4f1d0.js";import"./quantizationUtils-45b758fa.js";import"./utils-122e19dd.js";import"./generateRendererUtils-454ca4ba.js";const Rr="ESRI__DESTINATION_ID",Sr="ESRI__ORIGIN_ID";let We=class pe{constructor(){this._featureLookup=new Map}static getInstance(){return pe.instance||(pe.instance=new pe),pe.instance}static resetInstance(){pe.instance&&(pe.instance=null)}deleteFromStore(t){t.forEach(r=>{this._featureLookup.delete(r)})}readFromStoreByList(t){const r=[];return t.forEach(n=>{const i=this.readFromStoreById(n);i&&r.push(i)}),r}readFromStoreById(t){return this._featureLookup.get(t)??null}writeToStore(t,r,n){const i=[];return t.forEach(a=>{if(!a||!a.id)return;a.properties||(a.properties=[]);let o,l=null;if(n&&a.properties[n]&&(l=le(a.properties[n])),"originId"in a&&"destinationId"in a&&(a.properties[Sr]=a.originId,a.properties[Rr]=a.destinationId),a.properties[r]=a.id,a.id&&this._featureLookup.has(a.id)&&this._featureLookup.get(a.id).attributes){const d=this._featureLookup.get(a.id),u=JSON.parse(JSON.stringify(Object.assign(d.attributes,a.properties)));n&&a.properties[n]&&(u[n]=fr(a.properties[n])),o=new $t(l?JSON.parse(JSON.stringify(l)):d!=null&&d.geometry?JSON.parse(JSON.stringify(d.geometry)):null,u,null,a.properties[r])}else o=new $t(l?JSON.parse(JSON.stringify(l)):null,a.properties,null,a.properties[r]);this._featureLookup.set(a.id,o),i.push(o)}),i}};const $r=e=>{if(!e.spatialReference.isWGS84)throw new _("knowledge-graph:layer-support-utils","The extentToInBoundsRings function only supports WGS84 spatial references.");let t;return t=e.xmax>180&&e.xmin<180?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[180,e.ymax],[180,e.ymin],[e.xmin,e.ymin]],[[-180,e.ymin],[-180,e.ymax],[e.xmax-360,e.ymax],[e.xmax-360,e.ymin],[-180,e.ymin]]]:e.xmax>180&&e.xmin>180?[[[e.xmin-360,e.ymin],[e.xmin-360,e.ymax],[e.xmax-360,e.ymax],[e.xmax-360,e.ymin],[e.xmin-360,e.ymin]]]:e.xmax>-180&&e.xmin<-180?[[[e.xmin+360,e.ymin],[e.xmin+360,e.ymax],[180,e.ymax],[180,e.ymin],[e.xmin+360,e.ymin]],[[-180,e.ymin],[-180,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[-180,e.ymin]]]:e.xmax<-180&&e.xmin<-180?[[[e.xmin+360,e.ymin],[e.xmin+360,e.ymax],[e.xmax+360,e.ymax],[e.xmax+360,e.ymin],[e.xmin+360,e.ymin]]]:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]],t};let Fe=class extends ke{constructor(t){super(t),this.resultRows=[]}};s([p()],Fe.prototype,"resultRows",void 0),Fe=s([R("esri.rest.knowledgeGraph.GraphQueryResult")],Fe);const Pt=Fe;let je=class extends ke{constructor(t){super(t),this.resultRowsStream=new ReadableStream}};s([p()],je.prototype,"resultRowsStream",void 0),je=s([R("esri.rest.knowledgeGraph.GraphQueryResult")],je);const Ft=je;let ae=class extends se{constructor(t){super(t),this.name=null,this.unique=null,this.ascending=null,this.description=null,this.fieldNames=null}};s([p({type:String,json:{write:!0}})],ae.prototype,"name",void 0),s([p({type:Boolean,json:{write:!0}})],ae.prototype,"unique",void 0),s([p({type:Boolean,json:{write:!0}})],ae.prototype,"ascending",void 0),s([p({type:String,json:{write:!0}})],ae.prototype,"description",void 0),s([p({type:[String],json:{write:!0}})],ae.prototype,"fieldNames",void 0),ae=s([R("esri.rest.knowledgeGraph.FieldIndex")],ae);const tr=ae;let q=class extends se{constructor(t){super(t),this.name=null,this.alias=null,this.fieldType=null,this.geometryType=null,this.hasM=null,this.hasZ=null,this.nullable=null,this.editable=null,this.required=null,this.defaultVisibility=null,this.systemMaintained=null,this.role=null,this.defaultValue=null}};s([p({type:String,json:{write:!0}})],q.prototype,"name",void 0),s([p({type:String,json:{write:!0}})],q.prototype,"alias",void 0),s([p({type:String,json:{write:!0}})],q.prototype,"fieldType",void 0),s([p({type:String,json:{write:!0}})],q.prototype,"geometryType",void 0),s([p({type:Boolean,json:{write:!0}})],q.prototype,"hasM",void 0),s([p({type:Boolean,json:{write:!0}})],q.prototype,"hasZ",void 0),s([p({type:Boolean,json:{write:!0}})],q.prototype,"nullable",void 0),s([p({type:Boolean,json:{write:!0}})],q.prototype,"editable",void 0),s([p({type:Boolean,json:{write:!0}})],q.prototype,"required",void 0),s([p({type:Boolean,json:{write:!0}})],q.prototype,"defaultVisibility",void 0),s([p({type:Boolean,json:{write:!0}})],q.prototype,"systemMaintained",void 0),s([p()],q.prototype,"role",void 0),s([p({type:Object,json:{type:String,write:{writer:(e,t)=>{t.defaultValue=e!=null?e.toString():null}}}})],q.prototype,"defaultValue",void 0),q=s([R("esri.rest.knowledgeGraph.GraphProperty")],q);const rr=q;let ie=class extends se{constructor(t){super(t),this.name=null,this.alias=null,this.role=null,this.strict=null,this.properties=null,this.fieldIndexes=null}};s([p({type:String,json:{write:!0}})],ie.prototype,"name",void 0),s([p({type:String,json:{write:!0}})],ie.prototype,"alias",void 0),s([p({type:String,json:{write:!0}})],ie.prototype,"role",void 0),s([p({type:Boolean,json:{write:!0}})],ie.prototype,"strict",void 0),s([p({type:[rr],json:{write:!0}})],ie.prototype,"properties",void 0),s([p({type:[tr],json:{write:!0}})],ie.prototype,"fieldIndexes",void 0),ie=s([R("esri.rest.knowledgeGraph.GraphObjectType")],ie);const nr=ie;let lt=class extends nr{constructor(t){super(t)}};lt=s([R("esri.rest.knowledgeGraph.EntityType")],lt);const Et=lt;let Oe=class extends nr{constructor(t){super(t),this.endPoints=[]}};s([p()],Oe.prototype,"endPoints",void 0),Oe=s([R("esri.rest.knowledgeGraph.RelationshipType")],Oe);const kt=Oe;let W=class extends se{constructor(t){super(t),this.timestamp=null,this.spatialReference=null,this.strict=null,this.objectIdField=null,this.globalIdField=null,this.arcgisManaged=null,this.identifierInfo=null,this.searchIndexes=null,this.entityTypes=null,this.relationshipTypes=null}};s([p({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.timestamp=e==null?void 0:e.getTime()}}}})],W.prototype,"timestamp",void 0),s([p({type:Vt,json:{write:!0}})],W.prototype,"spatialReference",void 0),s([p({type:Boolean,json:{write:!0}})],W.prototype,"strict",void 0),s([p({type:String,json:{write:!0}})],W.prototype,"objectIdField",void 0),s([p({type:String,json:{write:!0}})],W.prototype,"globalIdField",void 0),s([p()],W.prototype,"arcgisManaged",void 0),s([p()],W.prototype,"identifierInfo",void 0),s([p()],W.prototype,"searchIndexes",void 0),s([p({type:[Et],json:{write:!0}})],W.prototype,"entityTypes",void 0),s([p({type:[kt],json:{write:!0}})],W.prototype,"relationshipTypes",void 0),W=s([R("esri.rest.knowledgeGraph.DataModel")],W);const ir=W;let F=class extends se{constructor(t){super(t),this.capabilities=[],this.supportsSearch=!1,this.supportedQueryFormats=[],this.allowGeometryUpdates=!1,this.searchMaxRecordCount=null,this.serviceCapabilities=null,this.maxRecordCount=null,this.description="",this.copyrightText="",this.units="",this.spatialReference=null,this.currentVersion=null,this.dateFieldsTimeReference=null,this.serviceItemId="",this.supportsDocuments=!1,this.dataEditingNotSupported=!1,this.schemaEditingNotSupported=!1}};s([p({type:[String],json:{write:!0}})],F.prototype,"capabilities",void 0),s([p({type:Boolean,json:{write:!0}})],F.prototype,"supportsSearch",void 0),s([p({type:[String],json:{write:!0}})],F.prototype,"supportedQueryFormats",void 0),s([p({type:Boolean,json:{write:!0}})],F.prototype,"allowGeometryUpdates",void 0),s([p({type:Number,json:{write:!0}})],F.prototype,"searchMaxRecordCount",void 0),s([p({type:Object,json:{write:!0}})],F.prototype,"serviceCapabilities",void 0),s([p({type:Number,json:{write:!0}})],F.prototype,"maxRecordCount",void 0),s([p({type:String,json:{write:!0}})],F.prototype,"description",void 0),s([p({type:String,json:{write:!0}})],F.prototype,"copyrightText",void 0),s([p({type:String,json:{write:!0}})],F.prototype,"units",void 0),s([p({type:Object,json:{write:!0}})],F.prototype,"spatialReference",void 0),s([p({type:Number,json:{write:!0}})],F.prototype,"currentVersion",void 0),s([p({type:Object,json:{write:!0}})],F.prototype,"dateFieldsTimeReference",void 0),s([p({type:String,json:{write:!0}})],F.prototype,"serviceItemId",void 0),s([p({type:Boolean,json:{write:!0}})],F.prototype,"supportsDocuments",void 0),s([p({type:Boolean,json:{write:!0}})],F.prototype,"dataEditingNotSupported",void 0),s([p({type:Boolean,json:{write:!0}})],F.prototype,"schemaEditingNotSupported",void 0),F=s([R("esri.rest.knowledgeGraph.ServiceDefinition")],F);const ar=F;let we=class extends se{constructor(t){super(t),this.dataModel=null,this.serviceDefinition=null}};s([p({type:String,json:{write:!0}})],we.prototype,"url",void 0),s([p({type:ir,json:{write:!0}})],we.prototype,"dataModel",void 0),s([p({type:ar,json:{write:!0}})],we.prototype,"serviceDefinition",void 0),we=s([R("esri.rest.knowledgeGraph.KnowledgeGraph")],we);const Nr=we,jt="esri/rest/knowledgeGraph/wasmInterface/";let Ke;async function oe(){const e=Ke;if(e)return e;const t=gr("wasm-simd");return Ke=Pr(t),Ke}async function Pr(e){if(e){const{default:r}=await at(()=>import("./arcgis-knowledge-client-core-simd-5c5b4516.js"),["assets/arcgis-knowledge-client-core-simd-5c5b4516.js","assets/index-d2e37ef9.js","assets/index-0e712e80.css"]).then(n=>n.a);return r({locateFile:n=>ot(jt+n)})}const{default:t}=await at(()=>import("./arcgis-knowledge-client-core-71dd9b01.js"),["assets/arcgis-knowledge-client-core-71dd9b01.js","assets/index-d2e37ef9.js","assets/index-0e712e80.css"]).then(r=>r.a);return t({locateFile:r=>ot(jt+r)})}function or(e,t){const r=new t.ArrayValue;return r.deleteLater(),e.forEach(n=>{r.add_value(Ct(n,t))}),r}function sr(e,t){const r=new t.ObjectValue;r.deleteLater();for(const[n,i]of Object.entries(e))r.set_key_value(n,Ct(i,t));return r}function Mt(e,t){if(e instanceof Wt)return Ar(e,t);if(e instanceof xe)return zr(e,t);if(e instanceof ye||e instanceof Re)return Or(e,t);throw new _("knowledge-graph:unsupported-geometry","Only Point, Multipoint, Polyline, and Polygon geometry are supported by ArcGIS Knowledge",{geometry:e})}function Fr(e,t){t.input_quantization_parameters={xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function jr(e,t,r){if(!e.extent)throw new _("knowledge-graph:illegal-output-quantization","The Output quantization provided to the encoder had an illegal value as part of its extent",e.extent);if(!e.quantizeMode)throw new _("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal mode setting",e.quantizeMode);if(!e.tolerance)throw new _("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal tolerance setting",e.quantizeMode);t.output_quantization_parameters={extent:{xmax:e.extent.xmax,ymax:e.extent.ymax,xmin:e.extent.xmin,ymin:e.extent.ymin},quantize_mode:r.esriQuantizeMode[e.quantizeMode],tolerance:e.tolerance}}function Ct(e,t){if(e==null)return"";if(typeof e!="object"||e instanceof Date)return e;if(e instanceof Tt)return Mt(e,t);if(Array.isArray(e)){const r=new t.ArrayValue;return r.deleteLater(),e.forEach(n=>{r.add_value(Ct(n,t))}),r}return sr(e,t)}function Or(e,t){const r=new t.GeometryValue;r.deleteLater(),r.has_z=e.hasZ,r.has_m=e.hasM;const n=[],i=[];let a=[];e instanceof ye?(r.geometry_type=t.esriGeometryType.esriGeometryPolyline,a=e.paths):e instanceof Re&&(r.geometry_type=t.esriGeometryType.esriGeometryPolygon,a=e.rings);let o=0,l=0;return a.forEach(d=>{let u=0;d.forEach(y=>{u++,y.forEach(f=>{n[l]=f,l++})}),i[o]=u,o++}),r.coords=new Float64Array(n),r.lengths=new Uint32Array(i),r}function Ar(e,t){const r=new t.GeometryValue;r.deleteLater(),r.geometry_type=r.geometry_type=t.esriGeometryType.esriGeometryMultipoint,r.has_z=e.hasZ,r.has_m=e.hasM;const n=[],i=[];i[0]=e.points.length;let a=0;return e.points.forEach(o=>{o.forEach(l=>{n[a]=l,a++})}),r.coords=new Float64Array(n),r.lengths=new Uint32Array(i),r}function zr(e,t){const r=new t.GeometryValue;r.deleteLater(),r.geometry_type=t.esriGeometryType.esriGeometryPoint,r.has_z=e.hasZ,r.has_m=e.hasM;const n=[],i=[];i[0]=1,n[0]=e.x,n[1]=e.y;let a=2;return e.hasZ&&(n[a]=e.z,a++),e.hasM&&(n[a]=e.m,a++),r.coords=new Float64Array(n),r.lengths=new Uint32Array(i),r}let Ae=class extends se{constructor(t){super(t),this.properties=null}};s([p({json:{write:!0}})],Ae.prototype,"properties",void 0),Ae=s([R("esri.rest.knowledgeGraph.GraphObject")],Ae);const It=Ae;let Le=class extends It{constructor(t){super(t),this.typeName=null,this.id=null}};s([p({type:String,json:{write:!0}})],Le.prototype,"typeName",void 0),s([p({type:String,json:{write:!0}})],Le.prototype,"id",void 0),Le=s([R("esri.rest.knowledgeGraph.GraphNamedObject")],Le);const lr=Le;let ze=class extends lr{constructor(t){super(t),this.layoutGeometry=null}};s([p({type:xe,json:{write:!0}})],ze.prototype,"layoutGeometry",void 0),ze=s([R("esri.rest.knowledgeGraph.Entity")],ze);const pr=ze;let _e=class extends lr{constructor(t){super(t),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};s([p({type:String,json:{write:!0}})],_e.prototype,"originId",void 0),s([p({type:String,json:{write:!0}})],_e.prototype,"destinationId",void 0),s([p({type:ye,json:{write:!0}})],_e.prototype,"layoutGeometry",void 0),_e=s([R("esri.rest.Relationship.Relationship")],_e);const dr=_e;function $e(e,t){if(!e.typeName)throw new _("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits");if(e instanceof pr){const r=new t.EntityValue;r.deleteLater(),r.type_name=e.typeName;for(const[n,i]of Object.entries(e.properties))r.set_key_value(n,Ot(i,t));return e.id&&r.set_id(e.id),r}if(e instanceof dr){const r=new t.RelationshipValue;r.deleteLater(),r.type_name=e.typeName;for(const[n,i]of Object.entries(e.properties))r.set_key_value(n,Ot(i,t));return e.id&&r.set_id(e.id),e.originId&&e.destinationId&&r.set_related_entity_ids(e.originId,e.destinationId),r}throw new _("knowledge-graph:applyEdits-encoding-failure","Could not determine the type of a named graph object passed to the encoder")}function Qr(e){return{xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function Ot(e,t){return e==null?"":typeof e!="object"||e instanceof Date?e:e instanceof Tt?Mt(e,t):""}let de=class extends ke{constructor(t){super(t),this.name=null,this.supportedCategory=null,this.analyzers=[],this.searchProperties=new Map}};s([p()],de.prototype,"name",void 0),s([p()],de.prototype,"supportedCategory",void 0),s([p()],de.prototype,"analyzers",void 0),s([p()],de.prototype,"searchProperties",void 0),de=s([R("esri.rest.knowledgeGraph.SearchIndex")],de);const Ur=de;var qe,Ye,Be,pt,dt,ut,ht;(function(e){e[e.Regular=0]="Regular",e[e.Provenance=1]="Provenance",e[e.Document=2]="Document"})(qe||(qe={})),function(e){e[e.esriFieldTypeSmallInteger=0]="esriFieldTypeSmallInteger",e[e.esriFieldTypeInteger=1]="esriFieldTypeInteger",e[e.esriFieldTypeSingle=2]="esriFieldTypeSingle",e[e.esriFieldTypeDouble=3]="esriFieldTypeDouble",e[e.esriFieldTypeString=4]="esriFieldTypeString",e[e.esriFieldTypeDate=5]="esriFieldTypeDate",e[e.esriFieldTypeOID=6]="esriFieldTypeOID",e[e.esriFieldTypeGeometry=7]="esriFieldTypeGeometry",e[e.esriFieldTypeBlob=8]="esriFieldTypeBlob",e[e.esriFieldTypeRaster=9]="esriFieldTypeRaster",e[e.esriFieldTypeGUID=10]="esriFieldTypeGUID",e[e.esriFieldTypeGlobalID=11]="esriFieldTypeGlobalID",e[e.esriFieldTypeXML=12]="esriFieldTypeXML",e[e.esriFieldTypeBigInteger=13]="esriFieldTypeBigInteger"}(Ye||(Ye={})),function(e){e[e.esriGeometryNull=0]="esriGeometryNull",e[e.esriGeometryPoint=1]="esriGeometryPoint",e[e.esriGeometryMultipoint=2]="esriGeometryMultipoint",e[e.esriGeometryPolyline=3]="esriGeometryPolyline",e[e.esriGeometryPolygon=4]="esriGeometryPolygon",e[e.esriGeometryEnvelope=5]="esriGeometryEnvelope",e[e.esriGeometryAny=6]="esriGeometryAny",e[e.esriGeometryMultiPatch=7]="esriGeometryMultiPatch"}(Be||(Be={})),function(e){e[e.esriMethodHintUNSPECIFIED=0]="esriMethodHintUNSPECIFIED",e[e.esriUUIDESRI=1]="esriUUIDESRI",e[e.esriUUIDRFC4122=2]="esriUUIDRFC4122"}(pt||(pt={})),function(e){e[e.esriTypeUNSPECIFIED=0]="esriTypeUNSPECIFIED",e[e.esriTypeEntity=1]="esriTypeEntity",e[e.esriTypeRelationship=2]="esriTypeRelationship",e[e.esriTypeBoth=4]="esriTypeBoth"}(dt||(dt={})),function(e){e[e.esriGraphPropertyUNSPECIFIED=0]="esriGraphPropertyUNSPECIFIED",e[e.esriGraphPropertyRegular=1]="esriGraphPropertyRegular",e[e.esriGraphPropertyDocumentName=2]="esriGraphPropertyDocumentName",e[e.esriGraphPropertyDocumentTitle=3]="esriGraphPropertyDocumentTitle",e[e.esriGraphPropertyDocumentUrl=4]="esriGraphPropertyDocumentUrl",e[e.esriGraphPropertyDocumentText=5]="esriGraphPropertyDocumentText",e[e.esriGraphPropertyDocumentKeywords=6]="esriGraphPropertyDocumentKeywords",e[e.esriGraphPropertyDocumentContentType=7]="esriGraphPropertyDocumentContentType",e[e.esriGraphPropertyDocumentMetadata=8]="esriGraphPropertyDocumentMetadata",e[e.esriGraphPropertyDocumentFileExtension=9]="esriGraphPropertyDocumentFileExtension"}(ut||(ut={})),function(e){e[e.esriIdentifierInfoTypeUNSPECIFIED=0]="esriIdentifierInfoTypeUNSPECIFIED",e[e.esriIdentifierInfoTypeDatabaseNative=1]="esriIdentifierInfoTypeDatabaseNative",e[e.esriIdentifierInfoTypeUniformProperty=2]="esriIdentifierInfoTypeUniformProperty"}(ht||(ht={}));function qr(e){var t,r,n,i,a,o,l,d,u,y,f;return e.deleteLater(),new ir({timestamp:e.timestamp,spatialReference:new Vt(e.spatial_reference),strict:e.strict,objectIdField:e.objectid_property,globalIdField:e.globalid_property,arcgisManaged:e.arcgis_managed,identifierInfo:{identifierMappingInfo:{identifierInfoType:ht[(n=(r=(t=e.identifier_info)==null?void 0:t.identifier_mapping_info)==null?void 0:r.identifier_info_type)==null?void 0:n.value],databaseNativeIdentifier:(a=(i=e.identifier_info)==null?void 0:i.identifier_mapping_info)==null?void 0:a.database_native_identifier,uniformPropertyIdentifier:{identifierPropertyName:(d=(l=(o=e.identifier_info)==null?void 0:o.identifier_mapping_info)==null?void 0:l.uniform_property_identifier)==null?void 0:d.identifier_property_name}},identifierGenerationInfo:{uuidMethodHint:pt[(f=(y=(u=e.identifier_info)==null?void 0:u.identifier_generation_info)==null?void 0:y.uuid_method_hint)==null?void 0:f.value]}},searchIndexes:en(e.search_indexes),entityTypes:Vr(e.entity_types),relationshipTypes:Xr(e.relationship_types)})}function Yr(e){return e.deleteLater(),new Et(ur(e))}function Br(e){return e.deleteLater(),new tr({name:e.name,unique:e.unique,ascending:e.ascending,description:e.description,fieldNames:Wr(e.fields)})}function ur(e){return{name:e.name,alias:e.alias,role:qe[e.role.value]?qe[e.role.value]:null,strict:e.strict,properties:Kr(e.properties),fieldIndexes:Zr(e.field_indexes)}}function Hr(e){return e.deleteLater(),new rr({alias:e.alias,name:e.name,fieldType:Ye[e.field_type.value]?Ye[e.field_type.value]:null,geometryType:Be[e.geometry_type.value]?Be[e.geometry_type.value]:null,hasM:e.has_m,hasZ:e.has_z,nullable:e.nullable,editable:e.editable,required:e.required,defaultVisibility:e.default_visibility,systemMaintained:e.system_maintained,role:ut[e.role.value],defaultValue:e.default_value})}function Jr(e){e.deleteLater();const t=ur(e),r=[];for(let n=0;n<e.end_points.size();n++){const i=e.end_points.get(n);r.push({originEntityType:i.origin_entity_type,destinationEntityType:i.dest_entity_type})}return new kt(Object.assign({endPoints:r},t))}function Vr(e){const t=[];for(let r=0;r<e.size();r++)t.push(Yr(e.get(r)));return t}function Wr(e){const t=[];for(let r=0;r<e.size();r++)t.push(e.get(r));return t}function Kr(e){const t=[];for(let r=0;r<e.size();r++)t.push(Hr(e.get(r)));return t}function Zr(e){const t=[];for(let r=0;r<e.size();r++)t.push(Br(e.get(r)));return t}function Xr(e){const t=[];for(let r=0;r<e.size();r++)t.push(Jr(e.get(r)));return t}function en(e){const t=[];for(let r=0;r<e.size();r++){const n=new Ur,i=e.get(0);n.name=i.name,n.supportedCategory=dt[i.supported_category.value];const a=i.analyzers.size();for(let o=0;o<a;o++)n.analyzers.push({name:i.analyzers.get(o).name});for(let o=0;o<i.search_properties.keys().size();o++){const l=i.search_properties.keys().get(o),d=i.search_properties.get(l),u=[];for(let y=0;y<d.property_names.size();y++)u.push(d.property_names.get(y));n.searchProperties.set(l,{propertyNames:u})}t.push(n)}return t}let ct=class extends It{constructor(t){super(t)}};ct=s([R("esri.rest.knowledgeGraph.ObjectValue")],ct);const tn=ct;let Qe=class extends se{constructor(t){super(t),this.path=null}};s([p({type:[It],json:{write:!0}})],Qe.prototype,"path",void 0),Qe=s([R("esri.rest.knowledgeGraph.Path")],Qe);const rn=Qe;var Z;(function(e){e[e.ESRI_GEOMETRY_NULL=0]="ESRI_GEOMETRY_NULL",e[e.ESRI_GEOMETRY_POINT=1]="ESRI_GEOMETRY_POINT",e[e.ESRI_GEOMETRY_MULTIPOINT=2]="ESRI_GEOMETRY_MULTIPOINT",e[e.ESRI_GEOMETRY_POLYLINE=3]="ESRI_GEOMETRY_POLYLINE",e[e.ESRI_GEOMETRY_POLYGON=4]="ESRI_GEOMETRY_POLYGON",e[e.ESRI_GEOMETRY_ENVELOPE=5]="ESRI_GEOMETRY_ENVELOPE",e[e.ESRI_GEOMETRY_ANY=6]="ESRI_GEOMETRY_ANY",e[e.ESRI_GEOMETRY_MULTI_PATCH=7]="ESRI_GEOMETRY_MULTI_PATCH"})(Z||(Z={}));var he,At;(function(e){e[e.OBJECT=0]="OBJECT",e[e.ENTITY=1]="ENTITY",e[e.RELATIONSHIP=2]="RELATIONSHIP",e[e.PATH=3]="PATH",e[e.ARRAY=4]="ARRAY"})(he||(he={})),function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(At||(At={}));function nn(e){const t={},r=Lt(e,t),n=e.lengths,i=e.coords,a=n[0];t.points=[];let o=0;for(let l=0;l<a;l++){const d=[];for(let u=0;u<r;u++)d[u]=i[o],o++;t.points.push(d)}return new Wt(t)}function an(e){const t={};let r=2;Lt(e,t);const n=e.coords;return t.x=n[0],t.y=n[1],e.has_z&&(t.z=n[r],r++),e.has_m&&(t.m=n[r]),new xe(t)}function on(e){return new ye(hr(e))}function sn(e){return new Re(hr(e))}function hr(e){const t={},r=Lt(e,t),n=e.lengths,i=e.coords;let a="";if(e.geometry_type.value===Z.ESRI_GEOMETRY_POLYGON)a="rings";else{if(e.geometry_type.value!==Z.ESRI_GEOMETRY_POLYLINE)throw new _("KnowledgeGraph:illegal-geometry-type","Illegal Geometry type for multipath conversion");a="paths"}t[a]=[];let o=0;return n.forEach(l=>{const d=[];for(let u=0;u<l;u++){const y=[];for(let f=0;f<r;f++)y[f]=i[o],o++;d.push(y)}t[a].push(d)}),t}function Lt(e,t){let r=2;return e.has_z?(t.hasZ=e.has_z,r++):t.hasZ=!1,e.has_m?(t.hasM=e.has_m,r++):t.hasM=!1,r}const Ne=Ee.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),ln={decodedWasmObjToQueryResponseObj:(e,t)=>{if(e==null)return null;if(typeof e!="object"||"getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case Z.ESRI_GEOMETRY_POINT:return an(e);case Z.ESRI_GEOMETRY_MULTIPOINT:return nn(e);case Z.ESRI_GEOMETRY_POLYLINE:return on(e);case Z.ESRI_GEOMETRY_POLYGON:return sn(e);case Z.ESRI_GEOMETRY_ENVELOPE:case Z.ESRI_GEOMETRY_MULTI_PATCH:return Ne.warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;case Z.ESRI_GEOMETRY_NULL:case Z.ESRI_GEOMETRY_ANY:default:return Ne.warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return Ne.warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case he.OBJECT:return dn(e,t);case he.ENTITY:return cr(e,t);case he.RELATIONSHIP:return yr(e,t);case he.PATH:return un(e,t);case he.ARRAY:return pn(e,t);default:return Ne.warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}};function pn(e,t){const r=[],n=e.count();for(let i=0;i<n;i++){const a=e.get_value_at(i);r.push(vt(a,t))}return r}function vt(e,t){return ln.decodedWasmObjToQueryResponseObj(e,t)}function cr(e,t){const r=e.type_name,n=Dt(e,t),i=e.get_id();return new pr(Object.assign({typeName:r,id:i},n))}function Dt(e,t){const r={},n=e.key_count();for(let i=0;i<n;i++)r[e.get_key_at(i)]=vt(e.get_value_at(i),t);return{properties:r}}function dn(e,t){return new tn(Dt(e,t))}function un(e,t){const r=e.entity_count(),n=e.relationship_count(),i=[];for(let a=0;a<r;a++)i.push(cr(e.get_entity_at(a),t)),a<n&&i.push(yr(e.get_relationship_at(a),t));return new rn({path:i})}function yr(e,t){const r=e.type_name,n=Dt(e,t);return new dr(Object.assign({typeName:r,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},n))}let be=class extends ke{constructor(t){super(t),this.hasError=null,this.error=null,this.editResults=[]}};s([p()],be.prototype,"hasError",void 0),s([p()],be.prototype,"error",void 0),s([p()],be.prototype,"editResults",void 0),be=s([R("esri.rest.knowledgeGraph.GraphApplyEdits")],be);const hn=be;function cn(e){const t=new hn;t.hasError=e.has_error(),t.hasError&&(t.error={errorCode:e.error.error_code,errorMessage:e.error.error_message});const r=e.get_edit_results_count();for(let n=0;n<r;n++){const i=e.get_edit_results_at(n),a=e.get_edit_results_type_name_at(n),o=[],l=[],d=[],u=i.get_add_results_count(),y=i.get_update_results_count(),f=i.get_delete_results_count();for(let g=0;g<u;g++){const h=i.get_add_result_at(g);o.push({id:h.id,error:{errorCode:h.error.error_code,errorMessage:h.error.error_message}})}for(let g=0;g<y;g++){const h=i.get_update_result_at(g);l.push({id:h.id,error:{errorCode:h.error.error_code,errorMessage:h.error.error_message}})}for(let g=0;g<f;g++){const h=i.get_delete_result_at(g);d.push({id:h.id,error:{errorCode:h.error.error_code,errorMessage:h.error.error_message}})}t.editResults.push({typeName:a,adds:o,updates:l,deletes:d})}return t}const Se={fetchKnowledgeGraph:async e=>{const t=new Nr({url:e}),r=[];return r.push(He(t)),r.push(mn(t)),await Promise.all(r),t},refreshDataModel:async e=>{e.dataModel=await mr(e)},refreshServiceDefinition:async e=>{var r,n;const t=(await ve(e.url,{query:{f:"json"}})).data;return t.capabilities=(r=t==null?void 0:t.capabilities)==null?void 0:r.split(","),t.supportedQueryFormats=(n=t==null?void 0:t.supportedQueryFormats)==null?void 0:n.split(","),e.serviceDefinition=new ar(t),e.serviceDefinition},executeQueryStreaming:async(e,t,r)=>{const n=`${e.url}/graph/query`;await et(e);const i=await tt(n,r);i.data.body=await wn(t,e);const a=await Xe(i.data.url,i.data);if(e.dataModel)return new Ft({resultRowsStream:await zt(a,e.dataModel)});throw new _("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")},executeApplyEdits:async(e,t,r)=>{var a;if((a=e.serviceDefinition)!=null&&a.dataEditingNotSupported)throw new _("knowledge-graph:data-editing-not-supported","The Knowledge Graph Service definition indicated that data editing is not supported");const n=`${e.url}/graph/applyEdits`;await et(e);const i=await tt(n,r);return i.data.body=await gn(t,e),bn(await Xe(i.data.url,i.data))},executeQuery:async(e,t,r)=>{var l;const n=`${e.url}/graph/query`,i=await ve(n,{responseType:"array-buffer",query:{f:"pbf",openCypherQuery:t.openCypherQuery,...r==null?void 0:r.query},signal:r==null?void 0:r.signal,timeout:r==null?void 0:r.timeout}),a=(l=i.getHeader)==null?void 0:l.call(i,"content-type"),o=i.data;if(a!=null&&a.includes("application/x-protobuf")){const d=new(await oe()).GraphQueryDecoder;if(d.deleteLater(),e.dataModel)return new Pt({resultRows:yt(d,o,e.dataModel)});throw new _("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new _("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:a,data:i.data})},executeSearch:async(e,t,r)=>{var d;const n=t.typeCategoryFilter,i=`${e.url}/graph/search`,a=await ve(i,{responseType:"array-buffer",query:{f:"pbf",searchQuery:`"${t.searchQuery}"`,typeCategoryFilter:n,...r==null?void 0:r.query},signal:r==null?void 0:r.signal,timeout:r==null?void 0:r.timeout}),o=(d=a.getHeader)==null?void 0:d.call(a,"content-type"),l=a.data;if(o!=null&&o.includes("application/x-protobuf")){const u=new(await oe()).GraphQueryDecoder;if(u.deleteLater(),e.dataModel)return new Pt({resultRows:yt(u,l,e.dataModel)});throw new _("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new _("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:o,data:a.data})},executeSearchStreaming:async(e,t,r)=>{const n=`${e.url}/graph/search`;await et(e);const i=await tt(n,r);i.data.body=await _n(t);const a=await Xe(i.data.url,i.data);if(e.dataModel)return new Ft({resultRowsStream:await zt(a,e.dataModel)});throw new _("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")},_fetchWrapper:async(e,t)=>fetch(e,t)};async function Ze(e,t,r){return Se.executeQueryStreaming(e,t,r)}async function yn(e){return Se.fetchKnowledgeGraph(e)}async function He(e){return Se.refreshDataModel(e)}async function mn(e){return Se.refreshServiceDefinition(e)}async function Xe(e,t){return Se._fetchWrapper(e,t)}async function et(e){var r;((r=wr)==null?void 0:r.findCredential(e.url))||(e.dataModel?await mr(e):await He(e))}function Ce(e,t,r){if(e.error_code!==0)throw new _(t,r,{errorCode:e.error_code,errorMessage:e.error_message})}function fn(e,t,r,n){t==null?r.set_param_key_value(e,""):typeof t!="object"||t instanceof Date?r.set_param_key_value(e,t):t instanceof Tt?r.set_param_key_value(e,Mt(t,n)):t instanceof Array?r.set_param_key_value(e,or(t,n)):r.set_param_key_value(e,sr(t,n))}async function gn(e,t){var o,l,d,u,y,f,g,h,E;if(t.dataModel||await He(t),!t.dataModel)throw new _("knowledge-graph:data-model-undefined","Encoding could not proceed because a data model was not provided and it could not be determined from the service");const r=await oe(),n=!!((o=e.options)!=null&&o.cascadeDelete),i=new r.GraphApplyEditsEncoder(r.SpatialReferenceUtil.WGS84(),(l=e.options)!=null&&l.inputQuantizationParameters?Qr((d=e.options)==null?void 0:d.inputQuantizationParameters):r.InputQuantizationUtil.WGS84_lossless());i.deleteLater(),i.cascade_delete=n;try{let w;(u=e.entityAdds)==null||u.forEach(c=>{w=i.add_entity($e(c,r)),Ce(w,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),(y=e.relationshipAdds)==null||y.forEach(c=>{if(!c.originId||!c.destinationId)throw new _("knowledge-graph:relationship-origin-destination-missing","When adding a new relationship, you must provide both an origin and destination id on the appropriate class property");w=i.add_relationship($e(c,r)),Ce(w,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),(f=e.entityUpdates)==null||f.forEach(c=>{if(!c.id)throw new _("knowledge-graph:entity-id-missing","When updating an entity or relationship, you must specify the id on the class level property");w=i.update_entity($e(c,r)),Ce(w,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),(g=e.relationshipUpdates)==null||g.forEach(c=>{if(!c.id)throw new _("knowledge-graph:relationship-id-missing","When updating an entity or relationship, you must specify the id on the class level property");w=i.update_relationship($e(c,r)),Ce(w,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),(h=e.entityDeletes)==null||h.forEach(c=>{var L;if(!c.typeName)throw new _("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");const b=i.make_delete_helper(c.typeName,!0);b.deleteLater(),(L=c.ids)==null||L.forEach(Q=>{b.delete_by_id(Q)})}),(E=e.relationshipDeletes)==null||E.forEach(c=>{var L;if(!c.typeName)throw new _("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");const b=i.make_delete_helper(c.typeName,!1);(L=c.ids)==null||L.forEach(Q=>{b.delete_by_id(Q)})}),i.encode()}catch(w){throw new _("knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed",{error:w})}const a=i.get_encoding_result();return Ce(a.error,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed"),a.get_byte_buffer()}async function wn(e,t){var a,o;const r=await oe(),n=new r.GraphQueryRequestEncoder;if(n.deleteLater(),n.output_spatial_reference=r.SpatialReferenceUtil.WGS84(),n.open_cypher_query=e.openCypherQuery,e.bindParameters)for(const[l,d]of Object.entries(e.bindParameters))fn(l,d,n,r);if(e.bindGeometryQuantizationParameters)Fr(e.bindGeometryQuantizationParameters,n);else{if(t.dataModel||await He(t),((o=(a=t.dataModel)==null?void 0:a.spatialReference)==null?void 0:o.wkid)!==4326)throw new _("knowledge-graph:SR-quantization-mismatch","If the DataModel indicates a coordinate system other than WGS84, inputQuantizationParameters must be provided to the query encoder");n.input_quantization_parameters=r.InputQuantizationUtil.WGS84_lossless()}e.outputQuantizationParameters&&jr(e.outputQuantizationParameters,n,r);try{n.encode()}catch(l){throw new _("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{error:l})}const i=n.get_encoding_result();if(i.error.error_code!==0)throw new _("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{errorCode:i.error.error_code,errorMessage:i.error.error_message});return i.get_byte_buffer()}async function _n(e){var i;const t=await oe(),r=new t.GraphSearchRequestEncoder;if(r.deleteLater(),r.search_query=e.searchQuery,r.type_category_filter=t.esriNamedTypeCategory[e.typeCategoryFilter],e.returnSearchContext===!0&&(r.return_search_context=e.returnSearchContext),e.start!=null&&e.start>0&&(r.start_index=e.start),e.num!=null&&(r.max_num_results=e.num),e.idsFilter!=null&&Array.isArray(e.idsFilter)&&e.idsFilter.length>0)try{r.set_ids_filter(or(e.idsFilter,t))}catch(a){throw new _("knowledge-graph:ids-format-error","Attempting to set ids filter failed.  This is usually caused by an incorrectly formatted UUID string",{error:a})}(i=e.namedTypesFilter)==null||i.forEach(a=>{r.add_named_type_filter(a)});try{r.encode()}catch(a){throw new _("knowledge-graph:search-encoding-failed","Attempting to encode the search failed",{error:a})}const n=r.get_encoding_result();if(n.error.error_code!==0)throw new _("knowledge-graph:search-encoding-failed","Attempting to get encoding result from the query failed",{errorCode:n.error.error_code,errorMessage:n.error.error_message});return n.get_byte_buffer()}async function tt(e,t){return ve(e,{responseType:"native-request-init",method:"post",query:{f:"pbf",...t==null?void 0:t.query},body:"x",headers:{"Content-Type":"application/octet-stream"},signal:t==null?void 0:t.signal,timeout:t==null?void 0:t.timeout})}async function bn(e){const t=e.headers.get("content-type");if(t!=null&&t.includes("application/x-protobuf")){const r=await e.arrayBuffer(),n=new(await oe()).GraphApplyEditsDecoder;return n.deleteLater(),n.decode(new Uint8Array(r)),cn(n)}throw new _("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:t,data:e.text()})}function yt(e,t,r){e.push_buffer(new Uint8Array(t));const n=[];let i=0;for(;e.next_row();){i||(i=e.get_header_keys().size());const a=new Array(i);for(let o=0;o<i;o++){const l=e.get_value(o);a[o]=vt(l,r)}n.push(a)}if(e.has_error())throw new _("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:e.error.error_code,errorMessage:e.error.error_message});return n}async function zt(e,t){var n;const r=e.headers.get("content-type");if(e.headers.get("content-length")&&Ee.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("Found `Content-Length` header when expecting a streaming HTTP response! Please investigate whether all intermediate HTTP proxies and/or load balancers are configured such that they don't forcefully buffer the entire response before returning it to the client. A valid HTTP streaming response should use Chunked Transfer Encoding and not have a Content Length defined."),r==null?void 0:r.includes("application/x-protobuf")){const i=(n=e.body)==null?void 0:n.getReader(),a=new(await oe()).GraphQueryDecoder;return a.deleteLater(),new ReadableStream({async start(o){try{return l()}catch(d){i==null||i.releaseLock(),o.error(new _("knowledge-graph:stream-decoding-error","The server returned a valid response, but there was an error decoding the response stream",{error:d})),o.close()}function l(){return i==null?void 0:i.read().then(({done:d,value:u})=>{if(d){let f;if(a.has_error()&&(f=new _("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:a.error.error_code,errorMessage:a.error.error_message})),i.releaseLock(),f)throw o.error(f),f;return void o.close()}const y=yt(a,u,t);return y.length>0&&o.enqueue(y),l()})}}})}throw new _("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:r,data:e.text()})}async function mr(e){var a;const t=`${e.url}/dataModel/queryDataModel`,r=await ve(t,{responseType:"array-buffer",query:{f:"pbf"}}),n=(a=r.getHeader)==null?void 0:a.call(r,"content-type"),i=r.data;if(n!=null&&n.includes("application/x-protobuf")){const o=(await oe()).decode_data_model_from_protocol_buffer(new Uint8Array(i));if(!o)throw new _("knowledge-graph:data-model-decode-failure","The server responded to the data model query, but the response failed to be decoded.  This typically occurs when the Knowledge JS API (4.26 or later) is used with an unsupported backend (11.0 or earlier)");return qr(o)}throw new _("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:n,data:r.data})}let Ue=class extends ke{constructor(t){super(t),this.openCypherQuery=""}};s([p()],Ue.prototype,"openCypherQuery",void 0),Ue=s([R("esri.rest.knowledgeGraph.GraphQuery")],Ue);const Tn=Ue;let Te=class extends Tn{constructor(t){super(t),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null}};s([p()],Te.prototype,"bindParameters",void 0),s([p()],Te.prototype,"bindGeometryQuantizationParameters",void 0),s([p()],Te.prototype,"outputQuantizationParameters",void 0),Te=s([R("esri.rest.knowledgeGraph.GraphQueryStreaming")],Te);const Pe=Te,x="ESRI__ID",Ie="ESRI__ORIGIN_ID",rt="ESRI__DESTINATION_ID",j="ESRI__LAYOUT_GEOMETRY",ce=12,Qt=Ee.getLogger("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager");let te=class extends ke{constructor(t){var n,i,a;super(t),this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.memberIdTypeLookup=new Map,this._processingCacheUpdatesLookup=new Map;const r=new Map;(n=t.knowledgeGraph.dataModel.entityTypes)==null||n.forEach(o=>{var l,d;o.name&&(r.set(o.name,"entity"),this._processingCacheUpdatesLookup.set(o.name,[]),t.inclusionModeDefinition&&!((l=t.inclusionModeDefinition)!=null&&l.generateAllSublayers)||this.entityTypeNames.add(o.name),(d=o.properties)==null||d.forEach(u=>{u.geometryType&&u.geometryType!=="esriGeometryNull"&&this.geographicLookup.set(o.name,{name:u.name??"",geometryType:u.geometryType})}))}),(i=t.knowledgeGraph.dataModel.relationshipTypes)==null||i.forEach(o=>{var l,d;o.name&&(r.set(o.name,"relationship"),this._processingCacheUpdatesLookup.set(o.name,[]),t.inclusionModeDefinition&&!((l=t.inclusionModeDefinition)!=null&&l.generateAllSublayers)||this.relationshipTypeNames.add(o.name),(d=o.properties)==null||d.forEach(u=>{u.geometryType&&u.geometryType!=="esriGeometryNull"&&this.geographicLookup.set(o.name,{name:u.name??"",geometryType:u.geometryType})}))}),(a=t.inclusionModeDefinition)==null||a.namedTypeDefinitions.forEach((o,l)=>{var u,y;if(r.get(l)==="entity")this.entityTypeNames.add(l);else{if(r.get(l)!=="relationship")return Qt.warn(`A named type, ${l}, was in the inclusion list that wasn't in the data model and will be removed`),void((u=t.inclusionModeDefinition)==null?void 0:u.namedTypeDefinitions.delete(l));this.relationshipTypeNames.add(l)}const d=new Map;(y=o.members)==null||y.forEach(f=>{this.memberIdTypeLookup.set(f.id,l);const g=this.getById(f.id);g&&d.set(f.id,g)}),this.sublayerCaches.set(l,d)})}addToLayer(t){t.forEach(({typeName:r,id:n})=>{if(!this.inclusionModeDefinition)throw new _("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(r)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(r)){const i=this.inclusionModeDefinition.namedTypeDefinitions.get(r);i.members||(i.members=new Map),i.members.set(n,{id:n}),this.memberIdTypeLookup.set(n,r)}}else{const i=new Map;i.set(n,{id:n}),this.inclusionModeDefinition.namedTypeDefinitions.set(r,{useAllData:!1,members:i}),this.memberIdTypeLookup.set(n,r)}})}getById(t){return We.getInstance().readFromStoreById(t)}async getData(t,r,n){var a,o;if(r.objectType.name&&((a=this.inclusionModeDefinition)!=null&&a.namedTypeDefinitions)&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(r.objectType.name))return[];let i;if(i=t||new ge({where:"1=1",outFields:["*"]}),r.parentCompositeLayer.type==="link-chart"){const l=r.parentCompositeLayer,d=this._processingCacheUpdatesLookup.get(r.objectType.name??""),u=i.outFields,y=i.geometry;let f="",g="";y&&y.extent&&(f=ue(y.extent.ymin,y.extent.xmin,ce),g=ue(y.extent.ymax,y.extent.xmax,ce)),u&&u.length===1&&u[0]===x&&i.where==="1=1"||await Promise.all(d??[]);const h=this.sublayerCaches.has(r.objectType.name??"")?Array.from((o=this.sublayerCaches.get(r.objectType.name))==null?void 0:o.values()):[],E=[];return h.forEach(w=>{if(w.geometry=l.linkChartDiagramLookup.get(w.attributes[r.objectIdField]),w.attributes[j]=w.geometry,f&&g){const c=l.linkChartGeohashLookup.get(w.attributes[r.objectIdField]);c?c>=f&&c<=g&&E.push(w):E.push(w)}else E.push(w)}),E}return this.retrieveDataFromService(i,r,n)}async getConnectedRecordIds(t){const r=[],n=[],i=new Map;return t.forEach(a=>{var o;if(this.memberIdTypeLookup.has(a)){const l=this.memberIdTypeLookup.get(a);if(!this.entityTypeNames.has(l))return;i.has(l)?(o=i.get(l))==null||o.push(a):i.set(l,[a])}}),i.forEach((a,o)=>{const l=`MATCH (n:${o})-[r]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]`,d=new Promise(u=>{(async()=>{const y=(await Ze(this.knowledgeGraph,new Pe({openCypherQuery:l,bindParameters:{ids:a}}))).resultRowsStream.getReader();try{for(;;){const{done:f,value:g}=await y.read();if(f)break;for(let h=0;h<g.length;h++){const E=g[h];r.push({id:E[0],typeName:E[1]}),r.push({id:E[2],typeName:E[3]})}}}catch(f){if(f.name!=="AbortError")throw f;Qt.info("Request aborted as expected")}})().then(()=>{u()})});n.push(d)}),await Promise.all(n),r}async refreshCacheContent(t,r,n,i=!0){var u,y,f,g,h,E,w;const a=We.getInstance(),o=[],l=new Map,d=new Map;(u=this.knowledgeGraph.dataModel.entityTypes)==null||u.forEach(c=>{c.name&&d.set(c.name,c)}),(y=this.knowledgeGraph.dataModel.relationshipTypes)==null||y.forEach(c=>{c.name&&d.set(c.name,c)}),t||this.inclusionModeDefinition?t?t.forEach(c=>{var b;if(this.memberIdTypeLookup.has(c)){const L=this.memberIdTypeLookup.get(c);l.has(L)?(b=l.get(L))==null||b.push(c):l.set(L,[c])}}):(g=(f=this.inclusionModeDefinition)==null?void 0:f.namedTypeDefinitions)==null||g.forEach((c,b)=>{c.useAllData?l.set(b,null):c.members&&c.members.forEach(L=>{var Q;l.has(b)&&l.get(b)!==null?(Q=l.get(b))==null||Q.push(L.id):l.set(b,[L.id])})}):((h=this.knowledgeGraph.dataModel.entityTypes)==null||h.forEach(c=>{c.name&&l.set(c.name,null)}),(E=this.knowledgeGraph.dataModel.entityTypes)==null||E.forEach(c=>{c.name&&l.set(c.name,null)}));for(const[c,b]of l){const L=new Promise(Q=>{(async()=>{var K,M,S,B,Me,$,I;const J=new Set,X=[];let m,C="",v=!1;if(r||((M=(K=d.get(c))==null?void 0:K.properties)==null||M.forEach(G=>{G.name&&J.add(G.name)})),n&&this.geographicLookup.has(c)){const G=(S=this.geographicLookup.get(c))==null?void 0:S.name;G&&J.add(G)}if(this.entityTypeNames.has(c))C=`MATCH (n:${c}) ${b?"WHERE id(n) IN $ids ":""}return ID(n)`,J.forEach(G=>{C+=`, n.${G}`,X.push(G)});else{if(!this.relationshipTypeNames.has(c))throw new _("knowledge-graph:layer-data-manager",`The graph type of ${c} could not be determined. Was this type set in the KG data model and inclusion definition?`);v=!0,C=`MATCH ()-[n:${c}]->() ${b?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,J.forEach(G=>{C+=`, n.${G}`,X.push(G)})}m=new Pe(b?{openCypherQuery:C,bindParameters:{ids:b}}:{openCypherQuery:C});const ee=(await Ze(this.knowledgeGraph,m)).resultRowsStream.getReader();for(;;){const{done:G,value:U}=await ee.read();if(G)break;const z=[];for(let D=0;D<U.length;D++){const T=U[D];let A=0,V=0;const ne={properties:{}};for(ne.id=T[A],A++,V++,v&&(ne.originId=T[A],A++,V++,ne.destinationId=T[A],A++,V++,Gt(this.nodeConnectionsLookup,ne.originId,()=>new Set).add(ne.id),Gt(this.nodeConnectionsLookup,ne.destinationId,()=>new Set).add(ne.id));A<T.length;A++)ne.properties[X[A-V]]=T[A];z.push(ne)}const P=a.writeToStore(z,x,(B=this.geographicLookup.get(c))==null?void 0:B.name);this.sublayerCaches.has(c)||this.sublayerCaches.set(c,new Map),i&&!((Me=this.inclusionModeDefinition)!=null&&Me.namedTypeDefinitions.has(c))&&(($=this.inclusionModeDefinition)==null||$.namedTypeDefinitions.set(c,{useAllData:!1,members:new Map})),i&&!((I=this.inclusionModeDefinition)!=null&&I.namedTypeDefinitions.get(c).members)&&(this.inclusionModeDefinition.namedTypeDefinitions.get(c).members=new Map);const O=this.sublayerCaches.get(c);P.forEach(D=>{var T,A;O==null||O.set(D.attributes[x],D),i&&!((T=this.inclusionModeDefinition)!=null&&T.namedTypeDefinitions.get(c).members.has(D.attributes[x]))&&((A=this.inclusionModeDefinition)==null||A.namedTypeDefinitions.get(c).members.set(D.attributes[x],{id:D.attributes[x]}),this.memberIdTypeLookup.set(D.attributes[x],c))})}})().then(()=>{Q(null)})});o.push(L),(w=this._processingCacheUpdatesLookup.get(c))==null||w.push(L)}await Promise.all(o)}removeFromLayer(t){var i;const r=new Set,n=t.map(a=>a.id);for(const a of t)r.add(a.typeName),this.memberIdTypeLookup.delete(a.id),(i=this.inclusionModeDefinition)==null||i.namedTypeDefinitions.forEach(o=>{var l;(l=o.members)!=null&&l.has(a.id)&&o.members.delete(a.id)});r.forEach(a=>{var o;(o=this.sublayerCaches.get(a))==null||o.forEach((l,d)=>{var u;n.includes(d)&&((u=this.sublayerCaches.get(a))==null||u.delete(d))})})}async retrieveDataFromService(t,r,n){var w,c,b,L,Q,k,J,X,m,C,v,ee,K,M,S,B,Me;const i=We.getInstance(),a=new Set,o=[];let l,d="",u=[];const y=r.graphType==="relationship",f=(b=(c=(w=this.inclusionModeDefinition)==null?void 0:w.namedTypeDefinitions)==null?void 0:c.get(r.objectType.name))==null?void 0:b.useAllData,g=r.parentCompositeLayer.sublayerIdsCache.get(r.objectType.name);let h=!f&&g?Array.from(g).sort():null;if((k=(Q=(L=this.inclusionModeDefinition)==null?void 0:L.namedTypeDefinitions)==null?void 0:Q.get(r.objectType.name))!=null&&k.useAllData)(m=(X=(J=this.inclusionModeDefinition)==null?void 0:J.namedTypeDefinitions)==null?void 0:X.get(r.objectType.name))!=null&&m.useAllData&&t.objectIds!=null&&(h=t.objectIds);else if(t.objectIds!=null&&h&&h.length>0){const $=t.objectIds;t.objectIds=h.filter(I=>$.includes(I))}else if(t.objectIds!=null)h=t.objectIds;else{if((C=this.inclusionModeDefinition)!=null&&C.namedTypeDefinitions.has(r.objectType.name)&&(!((v=this.inclusionModeDefinition.namedTypeDefinitions.get(r.objectType.name))!=null&&v.members)||((K=(ee=this.inclusionModeDefinition.namedTypeDefinitions.get(r.objectType.name))==null?void 0:ee.members)==null?void 0:K.size)<1))return t.objectIds=[],[];t.objectIds=h}if(t.outFields!=null){const $=t.outFields;$.includes("*")?r.fields.forEach(I=>{a.add(I.name)}):$.forEach(I=>{I!==x&&I!==r.geometryFieldName&&a.add(I)})}if(t.geometry!=null){const $=t.geometry;let I;const G=r.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,U=G==null?void 0:G.spatialReference,z=(M=G==null?void 0:G.serviceCapabilities)==null?void 0:M.geometryCapabilities;let P=z==null?void 0:z.geometryMaxBoundingRectangleSizeX,O=z==null?void 0:z.geometryMaxBoundingRectangleSizeY;if((S=$==null?void 0:$.extent)!=null&&S.spatialReference&&!((B=$.spatialReference)!=null&&B.isWGS84)?(await Kt($.extent.spatialReference,De),I=st($.extent,De)):I=$.extent,P&&O&&U){if(U.wkid!==4326){const D=new Ge({spatialReference:U,xmax:P,ymax:O}),T=st(D,De);P=T.xmax,O=T.ymax}if(I.xmax-I.xmin>P)throw new _("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${P}° latitude, limit exceeded`);if(I.ymax-I.ymin>O)throw new _("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${O}° longitude, limit exceeded`)}if(t.where!=null&&t.where!=="1=1"){const D=await xt(t.where.toUpperCase(),r.fieldsIndex);r.fields.forEach(T=>{D.fieldNames.includes(T.name)&&a.add(T.name)})}d=y?`Match ()-[n:${r.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${r.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${r.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${r.geometryFieldName}) return ID(n)`,r.geometryFieldName&&a.add(r.geometryFieldName),a.forEach(D=>{d+=`, n.${D}`,o.push(D)}),l=new Pe({openCypherQuery:d,bindParameters:{param_filter_geom:new Re({rings:$r(I)})}})}else{let $="";if(t.where!=null&&t.where!=="1=1"){const U=await xt(t.where,r.fieldsIndex);r.fields.forEach(T=>{U.fieldNames.includes(T.name)&&a.add(T.name)});const z=["column-reference","string","number","binary-expression"],P=["=","<","<=","<>",">",">=","AND","OR","LIKE"];let O=!1;const D=T=>{if(T.type==="column-reference")return`n.${T.column}`;if(T.type==="string")return`'${T.value}'`;if(T.type==="number")return`${T.value}`;if(T.type==="binary-expression"&&z.includes(T.left.type)&&z.includes(T.right.type)&&P.includes(T.operator))return`${D(T.left)} ${T.operator} ${D(T.right)}`;if(T.type==="binary-expression"&&T.operator==="LIKE"){let A="";if(T.left.type==="function"&&T.left.args.value[0].type==="column-reference")A+=`lower(n.${T.left.args.value[0].column})`;else{if(T.left.type!=="column-reference")return O=!0,"";A+=`lower(n.${T.left.column})`}if(A+=" CONTAINS (",T.right.type!=="string")return O=!0,"";{let V=T.right.value;V.charAt(0)==="%"&&(V=V.slice(1)),V.charAt(V.length-1)==="%"&&(V=V.slice(0,-1)),A+=`'${V.toLowerCase()}')`}return A}return O=!0,""};$=D(U.parseTree),O&&($="")}let I="";I=y?`Match ()-[n:${r.objectType.name}]->()`:`Match (n:${r.objectType.name})`;let G=!1;h&&(G=!0,I+=" WHERE ID(n) IN $ids"),$&&(I+=G?" AND":" WHERE",I+=` ${$}`),I+=" return ID(n)",y&&(I+=", id(startNode(n)), id(endNode(n))"),t.returnGeometry&&r.geometryFieldName&&a.add(r.geometryFieldName),a.forEach(U=>{I+=`, n.${U}`,o.push(U)}),l=new Pe(h?{openCypherQuery:I,bindParameters:{ids:h}}:{openCypherQuery:I})}const E=(await Ze(r.parentCompositeLayer.dataManager.knowledgeGraph,l,n)).resultRowsStream.getReader();for(;;){const{done:$,value:I}=await E.read();if($)break;const G=[];for(let U=0;U<I.length;U++){const z=I[U];let P=0,O=0;const D={properties:{}};for(D.id=z[P],P++,O++,y&&(D.originId=z[P],P++,O++,D.destinationId=z[P],P++,O++);P<z.length;P++)D.properties[o[P-O]]=z[P];G.push(D)}u=u.concat(i.writeToStore(G,x,(Me=r.parentCompositeLayer.dataManager.geographicLookup.get(r.objectType.name))==null?void 0:Me.name))}return u}};s([p()],te.prototype,"knowledgeGraph",void 0),s([p()],te.prototype,"inclusionModeDefinition",void 0),s([p()],te.prototype,"entityTypeNames",void 0),s([p()],te.prototype,"relationshipTypeNames",void 0),s([p()],te.prototype,"geographicLookup",void 0),s([p()],te.prototype,"sublayerCaches",void 0),s([p()],te.prototype,"nodeConnectionsLookup",void 0),s([p()],te.prototype,"memberIdTypeLookup",void 0),te=s([R("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager")],te);const Ut=_r(),En=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return s([p(Ut.fields)],t.prototype,"fields",void 0),s([p(Ut.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=s([R("esri.layers.knowledgeGraphLayer.KnowledgeGraphSublayerBase")],t),t};let N=class extends br(En(Zt(Xt(Tr(er))))){constructor(e){var t,r,n,i,a;if(super(e),this.capabilities=Gr(!1,!1),this.definitionExpression="",this.displayField="",this.elevationInfo=null,this.geometryType=null,this.geometryFieldName=null,this.graphType=null,this.hasM=!1,this.hasZ=!1,this.labelsVisible=null,this.labelingInfo=null,this.objectIdField=x,this.objectType=null,this.parentCompositeLayer=null,this.popupTemplate=null,this.source={openPorts:()=>this.load().then(()=>{const o=new MessageChannel;return new Er(o.port1,{channel:o,client:{queryFeatures:(l,d={})=>{const u=ge.fromJSON(l);return this.queryFeaturesJSON(u,d)}}}),[o.port2]})},this.type="knowledge-graph-sublayer",e.parentCompositeLayer.type==="link-chart")e.graphType==="relationship"?this.geometryType="polyline":this.geometryType="point",this.geometryFieldName=j;else if((t=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name))!=null&&t.geometryType&&((r=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name))==null?void 0:r.geometryType)!=="esriGeometryNull"){const o=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name);this.geometryFieldName=(o==null?void 0:o.name)??null,this.geometryType=o!=null&&o.geometryType?me.fromJSON(o.geometryType):null;const l=o==null?void 0:o.name,d=l?(n=e.objectType.properties)==null?void 0:n[l]:null;d?(this.hasM=d.hasM??!1,this.hasZ=d.hasZ??!1):(this.hasM=!1,this.hasZ=!1)}else this.geometryType=null;(i=e.objectType.properties)==null||i.forEach(o=>{let l=null,d=o.fieldType;d==="esriFieldTypeOID"&&(d="esriFieldTypeInteger"),this.fields.push(Rt.fromJSON({name:o.name,type:d,alias:o.alias,defaultValue:l,editable:o.editable,nullable:o.nullable}))}),this.fields.push(Rt.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1})),this._set("fields",[...this.fields]),(a=e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel)!=null&&a.spatialReference&&(this.spatialReference=e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel.spatialReference),e.parentCompositeLayer.type==="link-chart"?e.graphType==="relationship"?this.renderer=Je(Ve(me.toJSON("polyline")).renderer):this.renderer=Je(Ve(me.toJSON("point")).renderer):this.renderer=Je(Ve(me.toJSON(this.geometryType)).renderer)}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){kr(e,this.fieldsIndex),this._set("renderer",e)}createPopupTemplate(e){return Mr(this,e)}createQuery(){return new ge({where:"1=1",outFields:["*"]})}getField(e){for(let t=0;t<this.fields.length;t++)if(this.fields[t].name===e)return this.fields[t];throw new Error("Field not found")}getFieldDomain(e,t){return null}async queryFeatures(e,t){const{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(e),i=Cr.fromJSON(await n.executeQuery(r.toJSON(),t==null?void 0:t.signal));return i.features.forEach(a=>{a.sourceLayer=this}),i}async queryFeaturesJSON(e,t){const{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(e);return await n.executeQuery(r.toJSON(),t==null?void 0:t.signal)}async queryFeatureCount(e,t){const{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(e);return n.executeQueryForCount(r.toJSON(),t==null?void 0:t.signal)}async queryExtent(e={},t){var l,d,u,y;const r={...e,returnGeometry:!0},{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(r),a=await i.executeQueryForExtent(n.toJSON(),t==null?void 0:t.signal);let o;return o=((l=a.extent)==null?void 0:l.xmin)!=null&&((d=a.extent)==null?void 0:d.xmax)!=null&&((u=a.extent)==null?void 0:u.ymin)!=null&&((y=a.extent)==null?void 0:y.ymax)!=null?new Ge(a.extent):new Ge,{count:a.count,extent:o}}async queryObjectIds(e,t){const r=ge.from(e);let n;if(this.parentCompositeLayer.type==="link-chart"&&this._cachedQueryEngine)n=this._cachedQueryEngine;else{const i=await this.parentCompositeLayer.dataManager.getData(r,this,t);n=this.loadQueryEngine(i)}return n.executeQueryForIds(r.toJSON(),t==null?void 0:t.signal)}loadQueryEngine(e){const t=new Dr({geometryType:me.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),r=new xr({fields:this.fields.map(n=>n.toJSON()),geometryType:me.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:t});return r.featureStore.addMany(e),r}async refreshCachedQueryEngine(){const e=await this.parentCompositeLayer.dataManager.getData(new ge({where:"1=1",outFields:[x]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}async _setupQueryObjects(e,t){var a;const r=ge.from(e),n=r.geometry;let i;if(n&&!((a=n.spatialReference)!=null&&a.isWGS84)&&(await Kt(n.spatialReference,De),r.geometry=st(n instanceof Re||n instanceof ye?n:n.extent,De)),this.parentCompositeLayer.type==="link-chart"&&this._cachedQueryEngine)i=this._cachedQueryEngine;else{const o=await this.parentCompositeLayer.dataManager.getData(r,this,t);i=this.loadQueryEngine(o)}return{resolvedQuery:r,queryEngine:i}}};s([p()],N.prototype,"capabilities",void 0),s([p({readOnly:!0})],N.prototype,"defaultPopupTemplate",null),s([p()],N.prototype,"definitionExpression",void 0),s([p()],N.prototype,"displayField",void 0),s([p()],N.prototype,"elevationInfo",void 0),s([p()],N.prototype,"geometryType",void 0),s([p()],N.prototype,"geometryFieldName",void 0),s([p()],N.prototype,"graphType",void 0),s([p()],N.prototype,"hasM",void 0),s([p()],N.prototype,"hasZ",void 0),s([p()],N.prototype,"labelsVisible",void 0),s([p()],N.prototype,"labelingInfo",void 0),s([p()],N.prototype,"objectIdField",void 0),s([p()],N.prototype,"objectType",void 0),s([p()],N.prototype,"parentCompositeLayer",void 0),s([p({type:Ir,json:{name:"popupInfo",write:!0}})],N.prototype,"popupTemplate",void 0),s([p({types:Lr,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],N.prototype,"renderer",null),s([p()],N.prototype,"source",void 0),s([p({json:{read:!1}})],N.prototype,"type",void 0),N=s([R("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],N);const nt=N;let it,H=null;function kn(){return it||(it=at(()=>import("./lclayout-3209e41e.js"),["assets/lclayout-3209e41e.js","assets/index-d2e37ef9.js","assets/index-0e712e80.css"]).then(e=>e.l).then(({default:e})=>e({locateFile:t=>ot(`esri/libs/linkchartlayout/${t}`)})).then(e=>{Mn(e)}),it)}function Mn(e){H=e}var re;function fe(e,t,r,n,i,a){const o=r.length,l=i.length,d=Float64Array.BYTES_PER_ELEMENT,u=Uint32Array.BYTES_PER_ELEMENT,y=Uint8Array.BYTES_PER_ELEMENT,f=16,g=f-1+o*(y+2*d)+l*(2*u),h=H._malloc(g);try{const E=h+f-h%f,w=E+o*d,c=w+o*d,b=c+l*u,L=b+l*u,Q=()=>[H.HEAPF64.subarray(E>>3,(E>>3)+o),H.HEAPF64.subarray(w>>3,(w>>3)+o),H.HEAPU32.subarray(c>>2,(c>>2)+l),H.HEAPU32.subarray(b>>2,(b>>2)+l),H.HEAPU8.subarray(L,L+o)],[k,J,X,m,C]=Q();k.set(r),J.set(n),X.set(i),m.set(a),C.set(t);const v=e(o,L,E,w,l,c,b),[ee,K,M,S,B]=Q();return r.set(ee),n.set(K),i.set(M),a.set(S),t.set(B),v}finally{H._free(h)}}(function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot"})(re||(re={}));const qt=2,Yt=1,Bt=-1;var mt,ft,gt,wt,_t,bt,Ht,Jt;(function(e){function t(){return H.getMinIdealEdgeLength()}function r(n,i,a,o,l,d=qt,u=Yt,y=Bt){return fe((f,g,h,E,w,c,b)=>H.applyForceDirectedLayout(f,g,h,E,w,c,b,d,u,y),n,i,a,o,l)}e.getMinIdealEdgeLength=t,e.apply=r})(mt||(mt={})),function(e){function t(r,n,i,a,o,l=qt,d=Yt,u=Bt){return fe((y,f,g,h,E,w,c)=>H.applyCommunityLayout(y,f,g,h,E,w,c,l,d,u),r,n,i,a,o)}e.apply=t}(ft||(ft={})),function(e){function t(r,n,i,a,o){return fe(H.applySimpleLayout,r,n,i,a,o)}e.apply=t}(gt||(gt={})),function(e){function t(r,n,i,a,o){return fe(H.applyHierarchicalLayout,r,n,i,a,o)}e.apply=t}(wt||(wt={})),function(e){function t(r,n,i,a,o){return fe(H.applyRadialTreeLayout,r,n,i,a,o)}e.apply=t}(_t||(_t={})),function(e){function t(r,n,i,a,o){return fe(H.applySmartTreeLayout,r,n,i,a,o)}e.apply=t}(bt||(bt={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(Ht||(Ht={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(Jt||(Jt={}));const Cn=(e,t,r)=>(e.has(t)||e.set(t,r()),e.get(t));let Y=class extends Zt(Xt(er)){constructor(e){if(super(e),this.dataPreloadedInLocalCache=!1,this.defaultLinkChartConfig=null,this._currentLinkChartConfig={layoutMode:"RADIAL_TREE",xScaleFactor:1,yScaleFactor:1},this._graphTypeLookup=new Map,this.knowledgeGraph=null,this.layers=new St,this.linkChartDiagramLookup=new Map,this.linkChartExtent=new Ge({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),this.linkChartGeohashLookup=new Map,this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.sublayerIdsCache=new Map,this.tables=new St,this.type="link-chart",this._originalInclusionList=e.inclusionModeDefinition,e.dataPreloadedInLocalCache&&!e.inclusionModeDefinition)throw new _("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it")}normalizeCtorArgs(e){return{url:e.url,title:e.title,dataPreloadedInLocalCache:e.dataPreloadedInLocalCache,defaultLinkChartConfig:e.defaultLinkChartConfig}}_initializeLayerProperties(e){var a,o,l,d,u,y;if(!this.title&&this.url){const f=this.url.split("/");this.title=f[f.length-2]}const t=new Set;let r=[],n=[];if(e.inclusionModeDefinition&&(!e.inclusionModeDefinition.namedTypeDefinitions||e.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new _("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");(a=e.knowledgeGraph.dataModel.entityTypes)==null||a.forEach(f=>{f.name&&this._graphTypeLookup.set(f.name,f)}),(o=e.knowledgeGraph.dataModel.relationshipTypes)==null||o.forEach(f=>{f.name&&this._graphTypeLookup.set(f.name,f)}),(l=e.inclusionModeDefinition)!=null&&l.generateAllSublayers?(r=e.knowledgeGraph.dataModel.entityTypes??[],n=e.knowledgeGraph.dataModel.relationshipTypes??[]):(d=e.inclusionModeDefinition)!=null&&d.namedTypeDefinitions&&((u=e.inclusionModeDefinition)==null?void 0:u.namedTypeDefinitions.size)>0?(y=e.inclusionModeDefinition)==null||y.namedTypeDefinitions.forEach((f,g)=>{var h,E;if(!this._graphTypeLookup.get(g))return Ee.getLogger(this).warn(`A named type, ${g}, was in the inclusion list that wasn't in the data model and will be removed`),void((h=e.inclusionModeDefinition)==null?void 0:h.namedTypeDefinitions.delete(g));this._graphTypeLookup.get(g)instanceof kt||"strictOrigin"in this._graphTypeLookup.get(g)?t.has(g)||(t.add(g),n.push(this._graphTypeLookup.get(g))):this._graphTypeLookup.get(g)instanceof Et||"properties"in this._graphTypeLookup.get(g)?t.has(g)||(t.add(g),r.push(this._graphTypeLookup.get(g))):(Ee.getLogger(this).warn(`A named type, ${g}, was in the inclusion list that wasn't properly modeled and will be removed`),(E=e.inclusionModeDefinition)==null||E.namedTypeDefinitions.delete(g))}):(r=e.knowledgeGraph.dataModel.entityTypes??[],n=e.knowledgeGraph.dataModel.relationshipTypes??[]);const i=new te({knowledgeGraph:e.knowledgeGraph,inclusionModeDefinition:e.inclusionModeDefinition});this.knowledgeGraph=e.knowledgeGraph,this.memberEntityTypes=r,this.memberRelationshipTypes=n,this.dataManager=i}load(e){return this.addResolvingPromise(new Promise(t=>{yn(this.url).then(r=>{var n,i,a,o,l,d;if(this._initializeLayerProperties({knowledgeGraph:r,inclusionModeDefinition:this._originalInclusionList}),(i=(n=this.dataManager.inclusionModeDefinition)==null?void 0:n.namedTypeDefinitions)!=null&&i.size||(this.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},(a=this.dataManager.knowledgeGraph.dataModel.entityTypes)==null||a.forEach(u=>{var y;u.name&&((y=this.dataManager.inclusionModeDefinition)==null||y.namedTypeDefinitions.set(u.name,{useAllData:!0}))}),(o=this.dataManager.knowledgeGraph.dataModel.relationshipTypes)==null||o.forEach(u=>{var y;u.name&&((y=this.dataManager.inclusionModeDefinition)==null||y.namedTypeDefinitions.set(u.name,{useAllData:!0}))})),this.dataPreloadedInLocalCache)this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1),(l=this.dataManager.inclusionModeDefinition)==null||l.namedTypeDefinitions.forEach(u=>{var y;u.useAllData=!1,(y=u.members)==null||y.forEach(f=>{let g;g=f.linkChartLocation instanceof Nt?f.linkChartLocation:f.linkChartLocation?le(f.linkChartLocation):null,this.linkChartDiagramLookup.set(f.id,g),g&&g.coords.length===2&&g.lengths.length===0?this.linkChartGeohashLookup.set(f.id,ue(g.coords[1],g.coords[0],ce)):this.linkChartGeohashLookup.set(f.id,"")}),this.addResolvingPromise(this._initializeDiagram().then(async()=>{this.layers.forEach(async f=>{await f.refreshCachedQueryEngine()}),this.tables.forEach(async f=>{await f.refreshCachedQueryEngine()})}))});else{const u=((d=this.defaultLinkChartConfig)==null?void 0:d.layoutMode)==="GEOGRAPHIC";this.addResolvingPromise(this.dataManager.refreshCacheContent(void 0,!1,u,!0).then(async()=>{vr(e);const y=[],f=[];this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1,this.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach(g=>{g.useAllData=!1})),await this._initializeDiagram(),this.layers.forEach(g=>{f.push(g.refreshCachedQueryEngine()),y.push(new Promise(h=>{g.on("layerview-create",()=>{h(null)})}))}),this.tables.forEach(g=>{f.push(g.refreshCachedQueryEngine())}),await Promise.all(f)}))}t(null)})})),Promise.resolve(this)}async addRecords(e){await this._handleNewRecords(e)}async removeRecords(e,{cascadeRemoveRelationships:t=!0,recalculateLayout:r=!1}={cascadeRemoveRelationships:!0,recalculateLayout:!1}){var a,o,l,d,u,y,f,g;let n=[];for(const h of e)((l=(o=(a=this.dataManager.inclusionModeDefinition)==null?void 0:a.namedTypeDefinitions)==null?void 0:o.get(h.typeName))==null?void 0:l.useAllData)===!1&&((f=(y=(u=(d=this.dataManager.inclusionModeDefinition)==null?void 0:d.namedTypeDefinitions)==null?void 0:u.get(h.typeName))==null?void 0:y.members)!=null&&f.has(h.id))&&n.push(h);if(t){const h=new Set,E=[];for(const w of n)if(this.dataManager.nodeConnectionsLookup.has(w.id))for(const c of this.dataManager.nodeConnectionsLookup.get(w.id))h.add(c);for(const w of h)this.dataManager.memberIdTypeLookup.has(w)&&E.push({id:w,typeName:this.dataManager.memberIdTypeLookup.get(w)});n=n.concat(E)}this.dataManager.removeFromLayer(n);for(const h of n)(g=this.sublayerIdsCache.get(h.typeName))==null||g.delete(h.id),this.linkChartDiagramLookup.delete(h.id);r&&await this.calculateLinkChartLayout(this._currentLinkChartConfig.layoutMode,{xScaleFactor:this._currentLinkChartConfig.xScaleFactor,yScaleFactor:this._currentLinkChartConfig.xScaleFactor});const i=[];return this.layers.forEach(h=>{i.push(h.refreshCachedQueryEngine())}),await Promise.all(i),this.layers.forEach(h=>{h.emit("refresh",{dataChanged:!0})}),n}async expand(e){const t=await this.dataManager.getConnectedRecordIds(e),r=t.filter(n=>{var i;return!((i=this.sublayerIdsCache.get(n.typeName))!=null&&i.has(n.id))});return await this._handleNewRecords(t),{records:r}}loadLayerAssumingLocalCache(){var e,t;this.memberRelationshipTypes.forEach(r=>{const n=new nt({objectType:r,parentCompositeLayer:this,graphType:"relationship",title:r.name});n.geometryType?this.layers.push(n):this.tables.push(n),this.dataManager.sublayerCaches.has(r.name)||this.dataManager.sublayerCaches.set(r.name,new Map)}),this.memberEntityTypes.forEach(r=>{const n=new nt({objectType:r,parentCompositeLayer:this,graphType:"entity",title:r.name});n.geometryType?this.layers.push(n):this.tables.push(n),this.dataManager.sublayerCaches.has(r.name)||this.dataManager.sublayerCaches.set(r.name,new Map)}),(e=this.dataManager.inclusionModeDefinition)!=null&&e.namedTypeDefinitions&&((t=this.dataManager.inclusionModeDefinition)==null||t.namedTypeDefinitions.forEach((r,n)=>{var a;const i=Cn(this.sublayerIdsCache,n,()=>new Set);(a=r.members)==null||a.forEach(o=>{if(i.add(o.id),o.linkChartLocation)if(o.linkChartLocation instanceof Nt)this.linkChartDiagramLookup.set(o.id,o.linkChartLocation),o.linkChartLocation.coords.length===2&&o.linkChartLocation.lengths.length===0?this.linkChartGeohashLookup.set(o.id,ue(o.linkChartLocation.coords[1],o.linkChartLocation.coords[0],ce)):this.linkChartGeohashLookup.set(o.id,"");else{const l=le(o.linkChartLocation);this.linkChartDiagramLookup.set(o.id,o.linkChartLocation?l:null),"x"in o.linkChartLocation&&"y"in o.linkChartLocation?this.linkChartGeohashLookup.set(o.id,ue(o.linkChartLocation.x,o.linkChartLocation.y,ce)):this.linkChartGeohashLookup.set(o.id,"")}})}))}async calculateLinkChartLayout(e="RADIAL_TREE",t){const r=[],n=[];this.dataManager.sublayerCaches.forEach((m,C)=>{this.dataManager.entityTypeNames.has(C)?m.forEach(v=>{r.push({typeName:C,feature:v})}):this.dataManager.relationshipTypeNames.has(C)&&m.forEach(v=>{n.push({typeName:C,feature:v})})}),this.linkChartDiagramLookup=new Map;const i=new Map,a=new Map,o=new Map,l=new Map,d=new Uint8Array(r.length),u=new Float64Array(r.length),y=new Float64Array(r.length),f=new Uint32Array(n.length),g=new Uint32Array(n.length),h=[],E="FORCE_DIRECTED",w=(t==null?void 0:t.xScaleFactor)??1,c=(t==null?void 0:t.yScaleFactor)??1,b=new Ge({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7});let L,Q="FORCE_DIRECTED",k=0,J=0;switch(Q=e==="GEOGRAPHIC"?E:e,Q){case"FORCE_DIRECTED":L=mt.apply;break;case"COMMUNITY":L=ft.apply;break;case"HIERARCHICAL":L=wt.apply;break;case"RADIAL_TREE":L=_t.apply;break;case"SMART_TREE":L=bt.apply;break;default:L=gt.apply}r.forEach(({typeName:m,feature:C})=>{var v,ee,K;if((v=t==null?void 0:t.lockedNodeLocations)!=null&&v.has(C.attributes[x])){e==="GEOGRAPHIC"&&this.dataManager.geographicLookup.has(m)?d[k]=re.IsGeographic:d[k]=re.None;const M=t.lockedNodeLocations.get(C.attributes[x]);u[k]=M.x,y[k]=M.y}else if(e==="GEOGRAPHIC"&&this.dataManager.geographicLookup.has(m)){d[k]=re.IsGeographic;let M=null;const S=C.attributes[this.dataManager.geographicLookup.get(m).name];switch((ee=this.dataManager.geographicLookup.get(m))==null?void 0:ee.geometryType){case"esriGeometryPoint":u[k]=S==null?void 0:S.x,y[k]=S==null?void 0:S.y;break;case"esriGeometryPolygon":M=S==null?void 0:S.centroid,(M==null?void 0:M.x)!=null&&(M==null?void 0:M.y)!=null?(u[k]=M.x,y[k]=M.y):d[k]=re.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":M=(K=S==null?void 0:S.extent)==null?void 0:K.center,(M==null?void 0:M.x)!=null&&(M==null?void 0:M.y)!=null?(u[k]=M.x,y[k]=M.y):d[k]=re.IsMovable;break;default:d[k]=re.IsMovable}(u[k]==null||y[k]==null||Number.isNaN(u[k])||Number.isNaN(y[k]))&&(d[k]=re.IsMovable,u[k]=0,y[k]=0)}else d[k]=re.IsMovable,u[k]=0,y[k]=0;l.set(C.attributes[x],k),h[k]={feature:C,typeName:m},k++});let X=!1;if(n.forEach(m=>{const C=l.get(m.feature.attributes[Ie]),v=l.get(m.feature.attributes[rt]);C!==void 0&&v!==void 0?(f[J]=C,g[J]=v,J++):(X=!0,this.linkChartDiagramLookup.set(m.feature.attributes[Ie],null),this.linkChartGeohashLookup.set(m.feature.attributes[Ie],null))}),X&&Ee.getLogger(this).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null"),await kn(),!L(d,u,y,f,g))throw new _("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");for(let m=0;m<h.length;m++){if(d[m]===re.IsMovable&&(u[m]=u[m]*w,y[m]=y[m]*c),y[m]>84.9999&&(y[m]=84.9999),y[m]<-84.9999&&(y[m]=-84.9999),u[m]>179.9999&&(u[m]=179.9999),u[m]<-179.9999&&(u[m]=-179.9999),h[m].feature.attributes[j]=new xe(u[m],y[m]),i.has(h[m].typeName)){const v=i.get(h[m].typeName);v==null||v.set(h[m].feature.attributes[x],h[m].feature)}else{const v=new Map;v.set(h[m].feature.attributes[x],h[m].feature),i.set(h[m].typeName,v)}o.set(h[m].feature.attributes[x],h[m].feature);const C=le(h[m].feature.attributes[j]);this.linkChartDiagramLookup.set(h[m].feature.attributes[x],h[m].feature.attributes[j]?C:null),this.linkChartGeohashLookup.set(h[m].feature.attributes[x],ue(h[m].feature.attributes[j].y,h[m].feature.attributes[j].x,ce)),h[m].feature.attributes[j].x<b.xmin&&(b.xmin=h[m].feature.attributes[j].x),h[m].feature.attributes[j].x>b.xmax&&(b.xmax=h[m].feature.attributes[j].x),h[m].feature.attributes[j].y<b.ymin&&(b.ymin=h[m].feature.attributes[j].y),h[m].feature.attributes[j].y>b.ymax&&(b.ymax=h[m].feature.attributes[j].y)}return this.linkChartExtent.xmin=b.xmin,this.linkChartExtent.xmax=b.xmax,this.linkChartExtent.ymin=b.ymin,this.linkChartExtent.ymax=b.ymax,n.forEach(m=>{var M,S;const C=(M=h[l.get(m.feature.attributes[Ie])])==null?void 0:M.feature.attributes[j],v=(S=h[l.get(m.feature.attributes[rt])])==null?void 0:S.feature.attributes[j];if(!C||!v)return;const ee=new ye({paths:[[C.x,C.y],[v.x,v.y]]});if(m.feature.attributes[j]=ee,a.has(m.typeName)){const B=a.get(m.typeName);B==null||B.set(m.feature.attributes[x],m.feature)}else{const B=new Map;B.set(m.feature.attributes[x],m.feature),a.set(m.typeName,B)}o.set(m.feature.attributes[x],m.feature);const K=le(m.feature.attributes[j]);this.linkChartDiagramLookup.set(m.feature.attributes[x],m.feature.attributes[j]?K:null),this.linkChartGeohashLookup.set(m.feature.attributes[x],"")}),this._currentLinkChartConfig={layoutMode:e,xScaleFactor:w,yScaleFactor:c},{nodes:i,links:a,idMap:o}}async applyNewLinkChartLayout(e="RADIAL_TREE",t){const r=[];await this.calculateLinkChartLayout(e,t),this.layers.forEach(n=>{r.push(n.refreshCachedQueryEngine())}),await Promise.all(r),this.layers.forEach(n=>{n.emit("refresh",{dataChanged:!0})})}getCurrentNodeLocations(){var t,r;const e=new Map;return(r=(t=this.dataManager.inclusionModeDefinition)==null?void 0:t.namedTypeDefinitions)==null||r.forEach(n=>{var i;(i=n==null?void 0:n.members)==null||i.forEach(a=>{const o=a.linkChartLocation;let l;const d=a.id;o&&(l="x"in o?{x:o.x,y:o.y}:{x:o.coords[0],y:o.coords[1]},e.set(d,new xe({x:l.x,y:l.y})))})}),e}async synchronizeInclusionListWithCache(){return new Promise(e=>{var t;(t=this.dataManager.inclusionModeDefinition)==null||t.namedTypeDefinitions.forEach((r,n)=>{if(r.useAllData=!1,r.members&&r.members.size>0){if(!this.dataManager.sublayerCaches.get(n))return;const i=Array.from(this.dataManager.sublayerCaches.get(n).keys());Array.from(r.members.keys()).filter(a=>!i.includes(a)).forEach(a=>{var o;(o=r.members)==null||o.delete(a)})}}),e()})}async refreshLinkChartCache(e){await this.dataManager.refreshCacheContent(e);const t=[];this.layers.forEach(r=>{t.push(r.refreshCachedQueryEngine())}),await Promise.all(t),this.layers.forEach(r=>{r.emit("refresh",{dataChanged:!0})})}async _handleNewRecords(e){const t=[];this.dataManager.addToLayer(e);for(const r of e)this.sublayerIdsCache.has(r.typeName)||(this.sublayerIdsCache.set(r.typeName,new Set),t.push(r.typeName)),this.sublayerIdsCache.get(r.typeName).add(r.id);for(const r of t)if(this._graphTypeLookup.has(r)){const n=this._graphTypeLookup.get(r),i="endPoints"in n?"relationship":"entity",a=new nt({objectType:n,parentCompositeLayer:this,graphType:i,title:r});i==="entity"?this.dataManager.entityTypeNames.add(r):this.dataManager.relationshipTypeNames.add(r),a.geometryType?this.layers.push(a):this.tables.push(a),this.dataManager.sublayerCaches.set(r,new Map)}await this.dataManager.refreshCacheContent(e.map(r=>r.id)),await this.applyNewLinkChartLayout(this._currentLinkChartConfig.layoutMode,{xScaleFactor:this._currentLinkChartConfig.xScaleFactor,yScaleFactor:this._currentLinkChartConfig.xScaleFactor})}async _initializeDiagram(){var e,t;this.defaultLinkChartConfig?this.defaultLinkChartConfig.doNotRecalculateLayout?((t=(e=this.dataManager.inclusionModeDefinition)==null?void 0:e.namedTypeDefinitions)==null||t.forEach(r=>{var n;(n=r==null?void 0:r.members)==null||n.forEach(i=>{const a=i.linkChartLocation;let o;const l=i.id;if(!a)return;o="x"in a?{x:a.x,y:a.y}:{x:a.coords[0],y:a.coords[1]};const d=le(o);this.linkChartDiagramLookup.set(l,d),this.linkChartGeohashLookup.set(l,ue(o.x,o.y,ce)),this.linkChartExtent.xmin>o.x&&(this.linkChartExtent.xmin=o.x),this.linkChartExtent.xmax<o.x&&(this.linkChartExtent.xmax=o.x),this.linkChartExtent.ymin>o.y&&(this.linkChartExtent.ymin=o.y),this.linkChartExtent.ymax<o.y&&(this.linkChartExtent.ymax=o.y)})}),this.memberRelationshipTypes.forEach(r=>{var n;r.name&&((n=this.dataManager.sublayerCaches.get(r.name))==null||n.forEach(i=>{const a=this.linkChartDiagramLookup.get(i.attributes[Ie]),o=this.linkChartDiagramLookup.get(i.attributes[rt]);if(a&&o){const l=le(new ye({paths:[[a.coords[0],a.coords[1]],[o.coords[0],o.coords[1]]]}));this.linkChartDiagramLookup.set(i.attributes[x],l)}else this.linkChartDiagramLookup.set(i.attributes[x],null);this.linkChartGeohashLookup.set(i.attributes[x],"")}))})):await this.calculateLinkChartLayout(this.defaultLinkChartConfig.layoutMode,{xScaleFactor:this.defaultLinkChartConfig.xScaleFactor,yScaleFactor:this.defaultLinkChartConfig.yScaleFactor,lockedNodeLocations:this.getCurrentNodeLocations()}):await this.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:this.getCurrentNodeLocations()})}};s([p()],Y.prototype,"dataPreloadedInLocalCache",void 0),s([p()],Y.prototype,"defaultLinkChartConfig",void 0),s([p()],Y.prototype,"dataManager",void 0),s([p()],Y.prototype,"knowledgeGraph",void 0),s([p()],Y.prototype,"layers",void 0),s([p()],Y.prototype,"linkChartDiagramLookup",void 0),s([p()],Y.prototype,"linkChartExtent",void 0),s([p()],Y.prototype,"linkChartGeohashLookup",void 0),s([p()],Y.prototype,"memberEntityTypes",void 0),s([p()],Y.prototype,"memberRelationshipTypes",void 0),s([p()],Y.prototype,"sublayerIdsCache",void 0),s([p()],Y.prototype,"tables",void 0),s([p({json:{read:!1}})],Y.prototype,"type",void 0),Y=s([R("esri.layers.LinkChartLayer")],Y);const mi=Y;export{mi as default};
