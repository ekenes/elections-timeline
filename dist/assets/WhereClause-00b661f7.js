import{i as tn,b as q,n as Q,m as Nu}from"./TimeOnly-331e1d4a.js";import{hg as ee,bF as Su,K as Qt}from"./index-001ef34f.js";var p;(function(i){i.InvalidFunctionParameters="InvalidFunctionParameters",i.UnsupportedSqlFunction="UnsupportedSqlFunction",i.UnsupportedOperator="UnsupportedOperator",i.UnsupportedSyntax="UnsupportedSyntax",i.UnsupportedIsRhs="UnsupportedIsRhs",i.UnsupportedIsLhs="UnsupportedIsLhs",i.InvalidDataType="InvalidDataType",i.CannotCastValue="CannotCastValue",i.FunctionNotRecognized="FunctionNotRecognized",i.InvalidTime="InvalidTime",i.InvalidParameterCount="InvalidParameterCount",i.InvalidTimeStamp="InvalidTimeStamp",i.InvalidDate="InvalidDate",i.InvalidOperator="InvalidOperator",i.IllegalInterval="IllegalInterval",i.YearMonthIntervals="YearMonthIntervals",i.PrimarySecondaryQualifiers="rimarySecondaryQualifiers",i.MissingStatisticParameters="MissingStatisticParameters"})(p||(p={}));const Ou={[p.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[p.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[p.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[p.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[p.UnsupportedOperator]:"Unsupported operator - {operator}",[p.UnsupportedSyntax]:"Unsupported syntax - {node}",[p.UnsupportedSqlFunction]:"Sql function not found = {function}",[p.InvalidDataType]:"Invalid sql data type",[p.InvalidDate]:"Invalid date encountered",[p.InvalidOperator]:"Invalid operator encountered",[p.InvalidTime]:"Invalid time encountered",[p.IllegalInterval]:"Illegal interval",[p.FunctionNotRecognized]:"Function not recognized",[p.InvalidTimeStamp]:"Invalid timestamp encountered",[p.InvalidParameterCount]:"Invalid parameter count for call to {name}",[p.PrimarySecondaryQualifiers]:"Primary and Secondary SqlInterval qualifiers not supported",[p.YearMonthIntervals]:"Year-Month Intervals not supported",[p.CannotCastValue]:"Cannot cast value to the required data type"};let m=class nn extends Error{constructor(r,s){super(tn(Ou[r],s)),this.declaredRootClass="esri.arcade.featureset.support.sqlerror",Error.captureStackTrace&&Error.captureStackTrace(this,nn)}};var Y;(function(i){i.NeverReach="NeverReach",i.NotImplemented="NotImplemented",i.Cancelled="Cancelled",i.InvalidStatResponse="InvalidStatResponse",i.InvalidRequest="InvalidRequest",i.RequestFailed="RequestFailed",i.MissingFeatures="MissingFeatures",i.AggregationFieldNotFound="AggregationFieldNotFound",i.DataElementsNotFound="DataElementsNotFound"})(Y||(Y={}));const xu={[Y.Cancelled]:"Cancelled",[Y.InvalidStatResponse]:"Invalid statistics response from service",[Y.InvalidRequest]:"Invalid request",[Y.RequestFailed]:"Request failed - {reason}",[Y.MissingFeatures]:"Missing features",[Y.AggregationFieldNotFound]:"Aggregation field not found",[Y.DataElementsNotFound]:"Data elements not found on service",[Y.NeverReach]:"Encountered unreachable logic",[Y.NotImplemented]:"Not implemented"};let Gl=class rn extends Error{constructor(r,s){super(tn(xu[r],s)),this.declaredRootClass="esri.arcade.featureset.support.featureseterror",Error.captureStackTrace&&Error.captureStackTrace(this,rn)}};function Cu(i,r){const s=an[i.toLowerCase()];if(s==null)throw new m(p.FunctionNotRecognized);if(r.length<s.minParams||r.length>s.maxParams)throw new m(p.InvalidParameterCount,{name:i.toUpperCase()});return s.evaluate(r)}function bu(i,r){const s=an[i.toLowerCase()];return s!=null&&r>=s.minParams&&r<=s.maxParams}const an={min:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Math.min.apply(Math,i[0])},max:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Math.max.apply(Math,i[0])},avg:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:on(i[0])},sum:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Au(i[0])},stddev:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Math.sqrt(Wt(i[0]))},count:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:i[0].length},var:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Wt(i[0])}};function on(i){let r=0;for(let s=0;s<i.length;s++)r+=i[s];return r/i.length}function Au(i){let r=0;for(let s=0;s<i.length;s++)r+=i[s];return r}function Wt(i){const r=on(i),s=i.length;let f=0;for(const l of i)f+=(l-r)**2;return s>1?f/(s-1):0}let M=class K{constructor(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0,this.millis=0}static _fixDefaults(r){if(r.precision!==null||r.secondary!==null)throw new m(p.PrimarySecondaryQualifiers)}static _parseSecondsComponent(r,s){if(s.includes(".")){const f=s.split(".");r.second=parseFloat(f[0]),r.millis=parseInt(f[1],10)}else r.second=parseFloat(s)}static createFromMilliseconds(r){const s=new K;return s.second=r/1e3,s}static createFromValueAndQualifer(r,s,f){let l=null;const h=new K;if(h.op=f==="-"?"-":"+",s.type==="interval-period"){K._fixDefaults(s);const v=new RegExp("^[0-9]{1,}$");if(s.period==="year"||s.period==="month")throw new m(p.YearMonthIntervals);if(s.period==="second"){if(!/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(r))throw new m(p.IllegalInterval);K._parseSecondsComponent(h,r)}else{if(!v.test(r))throw new m(p.IllegalInterval);h[s.period]=parseFloat(r)}}else{if(K._fixDefaults(s.start),K._fixDefaults(s.end),s.start.period==="year"||s.start.period==="month"||s.end.period==="year"||s.end.period==="month")throw new m(p.YearMonthIntervals);switch(s.start.period){case"day":switch(s.end.period){case"hour":if(l=new RegExp("^[0-9]{1,} [0-9]{1,}$"),!l.test(r))throw new m(p.IllegalInterval);h[s.start.period]=parseFloat(r.split(" ")[0]),h[s.end.period]=parseFloat(r.split(" ")[1]);break;case"minute":if(l=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),!l.test(r))throw new m(p.IllegalInterval);{h[s.start.period]=parseFloat(r.split(" ")[0]);const v=r.split(" ")[1].split(":");h.hour=parseFloat(v[0]),h.minute=parseFloat(v[1])}break;case"second":if(l=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!l.test(r))throw new m(p.IllegalInterval);{h[s.start.period]=parseFloat(r.split(" ")[0]);const v=r.split(" ")[1].split(":");h.hour=parseFloat(v[0]),h.minute=parseFloat(v[1]),K._parseSecondsComponent(h,v[2])}break;default:throw new m(p.IllegalInterval)}break;case"hour":switch(s.end.period){case"minute":if(l=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),!l.test(r))throw new m(p.IllegalInterval);h.hour=parseFloat(r.split(":")[0]),h.minute=parseFloat(r.split(":")[1]);break;case"second":if(l=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!l.test(r))throw new m(p.IllegalInterval);{const v=r.split(":");h.hour=parseFloat(v[0]),h.minute=parseFloat(v[1]),K._parseSecondsComponent(h,v[2])}break;default:throw new m(p.IllegalInterval)}break;case"minute":if(s.end.period!=="second")throw new m(p.IllegalInterval);if(l=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!l.test(r))throw new m(p.IllegalInterval);{const v=r.split(":");h.minute=parseFloat(v[0]),K._parseSecondsComponent(h,v[1])}break;default:throw new m(p.IllegalInterval)}}return h}valueInMilliseconds(){return(this.op==="-"?-1:1)*(this.millis+1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}};function Gt(i){return Number.isNaN(i)||i===0?i:Math.trunc(i)}class B{constructor(r){this._timeStampOffset=r,this._date=null}toDateTime(){return this._date??(this._date=ee.fromISO(this._timeStampOffset,{setZone:!0})),this._date}get isValid(){return this.toDateTime().isValid}get timezoneOffsetHour(){return Gt(this.toDateTime().offset/60)}get timezoneOffsetMinutes(){return Gt(this.toDateTime().offset%60)}toMilliseconds(){return this.toDateTime().toMillis()}get hour(){return this.toDateTime().hour}get minute(){return this.toDateTime().minute}get second(){return this.toDateTime().second}get day(){return this.toDateTime().day}get month(){return this.toDateTime().month}get year(){return this.toDateTime().year}static fromJSDate(r){return new B(ee.fromJSDate(r).toISO({includeOffset:!0}))}static fromDateTime(r){return new B(r.toISO({includeOffset:!0}))}static fromParts(r,s,f=0,l=0,h=0,v=0,t=0,N=!1,S=0,_=0){const U=`${r.toString().padStart(4,"0")}-${s.toString().padStart(2,"0")}-${f.toString().padStart(2,"0")}`;let J="";v<10&&(J="0");let O=`${l.toString().padStart(2,"0")}:${h.toString().padStart(2,"0")}:${J+v.toString()}`;t!==0&&(O+="."+t.toString().padStart(3,"0"));const C=`${N?"-":"+"}${S.toString().padStart(2,"0")}:${_.toString().padStart(2,"0")}`;return new B(U+"T"+O+C)}toStorageFormat(){return this._timeStampOffset}toString(){return this._timeStampOffset}toSQLValue(){let r=this.toDateTime().toSQL({includeOffset:!0,includeOffsetSpace:!0});return r&&(r=r.replace(".000","")),r}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}addMilliseconds(r){const s=this.toDateTime().plus(r);return B.fromDateTime(s)}}const Eu=/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/,Fu=/^(\d{1,2}):(\d{1,2})$/,Ru=/^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/,sn=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,Du=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$/,Pu=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$/,_u=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$/,$u=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;function Ce(i,r){switch(r){case"system":case"local":case null:return ee.fromJSDate(i);default:return ee.fromJSDate(i).setZone(r)}}function Z(i){return typeof i=="number"}function V(i){return typeof i=="string"||i instanceof String}function ne(i){return i instanceof M}function k(i){return i instanceof Date}function b(i){return i instanceof ee}function A(i){return i instanceof q}function R(i){return i instanceof Q}function E(i){return i instanceof B}function Qe(i){let r=Eu.exec(i);if(r!==null){const[,s,f,l]=r,h=Q.fromParts(parseInt(s,10),parseInt(f,10),parseInt(l,10),0);if(h!==null)return h;throw new m(p.InvalidTime)}if(r=Fu.exec(i),r!==null){const[,s,f]=r,l=Q.fromParts(parseInt(s,10),parseInt(f,10),0,0);if(l!==null)return l;throw new m(p.InvalidTime)}if(r=Ru.exec(i),r!==null){const[,s,f,l,h]=r,v=Q.fromParts(parseInt(s,10),parseInt(f,10),parseInt(l,10),parseInt(h,10));if(v!==null)return v;throw new m(p.InvalidTime)}throw new m(p.InvalidTime)}function be(i,r,s=!1){let f=Du.exec(i);if(f!==null){const[,l,h,v,t,N,S,_]=f,U=ee.fromObject({year:parseInt(l,10),month:parseInt(h,10),day:parseInt(v,10),hour:parseInt(t,10),minute:parseInt(N,10),second:parseInt(S,10),millisecond:_?parseInt(_.replace(".",""),10):0},{zone:r});if(U.isValid===!1)throw new m(p.InvalidTimeStamp);return U}if(f=Pu.exec(i),f!==null){const[,l,h,v,t,N,S,_,U,J,O]=f,C=B.fromParts(parseInt(l,10),parseInt(h,10),parseInt(v,10),parseInt(t,10),parseInt(N,10),parseInt(S,10),_?parseInt(_.replace(".",""),10):0,U==="-",parseInt(J,10),parseInt(O,10));if(C.isValid===!1)throw new m(p.InvalidTimeStamp);return C}if(f=_u.exec(i),f!==null){const[,l,h,v,t,N,S,_,U]=f,J=B.fromParts(parseInt(l,10),parseInt(h,10),parseInt(v,10),parseInt(t,10),parseInt(N,10),0,0,S==="-",parseInt(_,10),parseInt(U,10));if(J.isValid===!1)throw new m(p.InvalidTimeStamp);return J}if(f=$u.exec(i),f!==null){const[,l,h,v,t,N]=f,S=ee.fromObject({year:parseInt(l,10),month:parseInt(h,10),day:parseInt(v,10),hour:parseInt(t,10),minute:parseInt(N,10),second:0},{zone:r});if(S.isValid===!1)throw new m(p.InvalidTimeStamp);return S}if(f=sn.exec(i),f!==null){const[,l,h,v]=f,t=ee.fromObject({year:parseInt(l,10),month:parseInt(h,10),day:parseInt(v,10),hour:0,minute:0,second:0},{zone:r});if(t.isValid===!1)throw new m(p.InvalidTimeStamp);return t}throw new m(p.InvalidTimeStamp)}function un(i,r){const s=sn.exec(i);if(s===null)try{return be(i,r)}catch{throw new m(p.InvalidDate)}const[,f,l,h]=s,v=q.fromParts(parseInt(f,10),parseInt(l,10),parseInt(h,10));if(v===null)throw new m(p.InvalidDate);return v}function ke(i){return!!b(i)||!!E(i)}function Lu(i){return!!b(i)||!!A(i)||!!E(i)||!!R(i)}function Oe(i){if(b(i))return i.toMillis();if(A(i))return i.toNumber();if(E(i))return i.toMilliseconds();throw new m(p.InvalidDataType)}function H(i,r,s,f){if(i==null||r==null)return null;if(Z(i)){if(Z(r))return j(i,r,s);if(V(r))return Mu(i,r,s);if(Lu(r))throw new m(p.InvalidOperator);if(A(r))throw new m(p.InvalidOperator)}else if(V(i)){if(Z(r))return Uu(i,r,s);if(V(r))return Ju(i,r,s);if(b(r))throw new m(p.InvalidOperator);if(A(r))throw new m(p.InvalidOperator);if(R(r))throw new m(p.InvalidOperator);if(E(r))throw new m(p.InvalidOperator)}else if(b(i)){if(ke(r))return j(Oe(i),Oe(r),s);if(V(r))throw new m(p.InvalidOperator);if(A(r))return Zu(i,r,s);if(R(r))throw new m(p.InvalidOperator);if(Z(r))throw new m(p.InvalidOperator)}else if(A(i)){if(E(r))return ku(i,r,s);if(b(r))return zu(i,r,s);if(V(r))throw new m(p.InvalidOperator);if(A(r))return j(i.toNumber(),r.toNumber(),s);if(R(r))throw new m(p.InvalidOperator);if(Z(r))throw new m(p.InvalidOperator)}else if(R(i)){if(R(r))return j(i.toNumber(),r.toNumber(),s);if(V(r))throw new m(p.InvalidOperator);if(Z(r))throw new m(p.InvalidOperator);if(A(r))throw new m(p.InvalidOperator);if(ke(r))throw new m(p.InvalidOperator)}else if(E(i)){if(ke(r))return j(Oe(i),Oe(r),s);if(V(r))throw new m(p.InvalidOperator);if(A(r))return Vu(i,r,s);if(R(r))throw new m(p.InvalidOperator);if(Z(r))throw new m(p.InvalidOperator)}switch(s){case"<>":return i!==r;case"=":return i===r;case">":return i>r;case"<":return i<r;case">=":return i>=r;case"<=":return i<=r}}function j(i,r,s){switch(s){case"<>":return i!==r;case"=":return i===r;case">":return i>r;case"<":return i<r;case">=":return i>=r;case"<=":return i<=r}}function Mu(i,r,s){const f=parseFloat(r);if(!isNaN(f))return j(i,f,s);const l=i.toString();switch(s){case"<>":return l!==r;case"=":return l===r;case">":return l>r;case"<":return l<r;case">=":return l>=r;case"<=":return l<=r}}function Uu(i,r,s){const f=parseFloat(i);if(!isNaN(f))return j(f,r,s);const l=r.toString();switch(s){case"<>":return i!==l;case"=":return i===l;case">":return i>l;case"<":return i<l;case">=":return i>=l;case"<=":return i<=l}}function Ju(i,r,s){switch(s){case"<>":return i!==r;case"=":return i===r;case">":return i>r;case"<":return i<r;case">=":return i>=r;case"<=":return i<=r}}function Zu(i,r,s){const f=r.toDateTimeLuxon(i.zone);return j(i.toMillis(),f.toMillis(),s)}function Vu(i,r,s){const f=r.toDateTimeLuxon(i.toDateTime().zone);return j(i.toMilliseconds(),f.toMillis(),s)}function zu(i,r,s){return j(i.toDateTimeLuxon(r.zone).toMillis(),r.toMillis(),s)}function ku(i,r,s){return j(i.toDateTimeLuxon(r.toDateTime().zone).toMillis(),r.toMilliseconds(),s)}function We(i,r,s){const f=cn[i.toLowerCase()];if(f==null)throw new m(p.FunctionNotRecognized);if(r.length<f.minParams||r.length>f.maxParams)throw new m(p.InvalidParameterCount,{name:i.toUpperCase()});return f.evaluate(r,s)}function Hu(i,r){const s=cn[i.toLowerCase()];return s!=null&&r>=s.minParams&&r<=s.maxParams}function Ae(i){return typeof i=="string"||i instanceof String}function He(i){return!k(i)&&!A(i)&&!b(i)&&!R(i)&&!E(i)}function ln(i){return A(i)||R(i)?i.toString():E(i)?i.toSQLValue():b(i)?i.millisecond===0?i.toFormat("yyyy-LL-dd HH:mm:ss"):i.toSQL({includeOffset:!1}):k(i)?ln(ee.fromJSDate(i)):i.toString()}function qu(i){if(k(i))return q.fromDateJS(i);if(b(i))return q.fromParts(i.year,i.month,i.day);if(A(i))return i;if(R(i))throw new m(p.CannotCastValue);if(E(i)&&q.fromParts(i.year,i.month,i.day)===null)throw new m(p.CannotCastValue);if(Ae(i)){const r=q.fromReader(i);if(r!==null&&r.isValid)return r}throw new m(p.CannotCastValue)}function Yu(i,r,s){if(k(i))return Ce(i,r);if(b(i))return i.setZone(r);if(A(i))return i.toDateTimeLuxon(r);if(R(i))throw new m(p.CannotCastValue);if(E(i))return i;if(Ae(i))return be(i,r,s);throw new m(p.CannotCastValue)}function ju(i){if(k(i))return Q.fromDateJS(i);if(b(i))return Q.fromDateTime(i);if(A(i))throw new m(p.CannotCastValue);if(R(i))return i;if(E(i))return Q.fromSqlTimeStampOffset(i);if(Ae(i))return Qe(i);throw new m(p.CannotCastValue)}const cn={extract:{minParams:2,maxParams:2,evaluate:([i,r])=>{if(r==null)return null;if(k(r))switch(i.toUpperCase()){case"SECOND":return r.getSeconds();case"MINUTE":return r.getMinutes();case"HOUR":return r.getHours();case"DAY":return r.getDate();case"MONTH":return r.getMonth()+1;case"YEAR":return r.getFullYear();case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":return 0}else if(b(r))switch(i.toUpperCase()){case"SECOND":return r.second;case"MINUTE":return r.minute;case"HOUR":return r.hour;case"DAY":return r.day;case"MONTH":return r.month;case"YEAR":return r.year;case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":throw new m(p.InvalidFunctionParameters,{function:"EXTRACT"})}else if(A(r))switch(i.toUpperCase()){case"DAY":return r.day;case"MONTH":return r.month;case"YEAR":return r.year;case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":throw new m(p.InvalidFunctionParameters,{function:"EXTRACT"})}else if(R(r))switch(i.toUpperCase()){case"SECOND":return r.second;case"MINUTE":return r.minute;case"HOUR":return r.hour}else if(E(r))switch(i.toUpperCase()){case"SECOND":return r.second;case"MINUTE":return r.minute;case"HOUR":return r.hour;case"DAY":return r.day;case"MONTH":return r.month;case"YEAR":return r.year;case"TIMEZONE_HOUR":return r.timezoneOffsetHour;case"TIMEZONE_MINUTE":return r.timezoneOffsetMinutes}throw new m(p.InvalidFunctionParameters,{function:"EXTRACT"})}},substring:{minParams:2,maxParams:3,evaluate:i=>{if(i.length===2){const[r,s]=i;return r==null||s==null?null:r.toString().substring(s-1)}if(i.length===3){const[r,s,f]=i;return r==null||s==null||f==null?null:f<=0?"":r.toString().substring(s-1,s+f-1)}}},position:{minParams:2,maxParams:2,evaluate:([i,r])=>i==null||r==null?null:r.indexOf(i)+1},trim:{minParams:2,maxParams:3,evaluate:i=>{const r=i.length===3,s=r?i[1]:" ",f=r?i[2]:i[1];if(s==null||f==null)return null;const l=`(${Su(s)})`;switch(i[0]){case"BOTH":return f.replaceAll(new RegExp(`^${l}*|${l}*$`,"g"),"");case"LEADING":return f.replaceAll(new RegExp(`^${l}*`,"g"),"");case"TRAILING":return f.replaceAll(new RegExp(`${l}*$`,"g"),"")}throw new m(p.InvalidFunctionParameters,{function:"TRIM"})}},abs:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Math.abs(i[0])},ceiling:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Math.ceil(i[0])},floor:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Math.floor(i[0])},log:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Math.log(i[0])},log10:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Math.log(i[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Math.sin(i[0])},cos:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Math.cos(i[0])},tan:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Math.tan(i[0])},asin:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Math.asin(i[0])},acos:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Math.acos(i[0])},atan:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Math.atan(i[0])},sign:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:i[0]>0?1:i[1]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:i=>i[0]==null||i[1]==null?null:i[0]**i[1]},mod:{minParams:2,maxParams:2,evaluate:i=>i[0]==null||i[1]==null?null:i[0]%i[1]},round:{minParams:1,maxParams:2,evaluate:i=>{const r=i[0],s=i.length===2?10**i[1]:1;return r==null?null:Math.round(r*s)/s}},truncate:{minParams:1,maxParams:2,evaluate:i=>i[0]==null?null:i.length===1?parseInt(i[0].toFixed(0),10):parseFloat(i[0].toFixed(i[1]))},char_length:{minParams:1,maxParams:1,evaluate:i=>Ae(i[0])?i[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:i=>{let r="";for(let s=0;s<i.length;s++){if(i[s]==null)return null;r+=i[s].toString()}return r}},lower:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:i[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:i[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:1/0,evaluate:i=>{for(const r of i)if(r!==null)return r;return null}},cosh:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Math.cosh(i[0])},sinh:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Math.sinh(i[0])},tanh:{minParams:1,maxParams:1,evaluate:i=>i[0]==null?null:Math.tanh(i[0])},nullif:{minParams:2,maxParams:2,evaluate:(i,r)=>H(i[0],i[1],"=")?null:i[0]},cast:{minParams:2,maxParams:2,evaluate:(i,r)=>{const s=i[0],f=i[1];if(s===null)return null;switch(f.type){case"integer":{if(!He(s))throw new m(p.CannotCastValue);const l=parseInt(s,10);if(isNaN(l))throw new m(p.CannotCastValue);return l}case"smallint":{if(!He(s))throw new m(p.CannotCastValue);const l=parseInt(s,10);if(isNaN(l))throw new m(p.CannotCastValue);if(l>32767||l<-32767)throw new m(p.CannotCastValue);return l}case"float":case"real":{if(!He(s))throw new m(p.CannotCastValue);const l=parseFloat(s);if(isNaN(l))throw new m(p.CannotCastValue);return l}case"time":return ju(s);case"date":return qu(s);case"timestamp":return Yu(s,r,f.withtimezone===!0);case"varchar":{const l=ln(s);if(l.length>f.size)throw new m(p.CannotCastValue);return l}default:throw new m(p.InvalidDataType)}}}};function fn(i,r,s,f){if(i==="||")return We("concat",[r,s],f);if(r===null||s===null)return null;if(Z(r)){if(Z(s))return Ge(r,s,i);if(ne(s))return tl(r,s,i);if(R(s))return fl();if(A(s))return pl();if(E(s))return cl();if(b(s))return ul();if(V(s))return dl(r,s,i);throw new m(p.InvalidOperator)}if(A(r)){if(Z(s))return ol(r,s,i);if(ne(s))return nl(r,s,i);if(R(s))return Tl();if(A(s))return yl(r,s,i);if(E(s))return gl(r,s,i);if(b(s))return Il(r,s,i);if(V(s))return _l();throw new m(p.InvalidOperator)}if(R(r)){if(Z(s))return sl(r,s,i);if(ne(s))return Gu(r,s,i);if(R(s))return El();if(A(s))return bl();if(E(s))return Al();if(b(s))return Cl();if(V(s))return $l();throw new m(p.InvalidOperator)}if(ne(r)){if(Z(s))return el(r,s,i);if(ne(s))return Xu(r,s,i);if(R(s))return Qu(r,s,i);if(A(s))return Wu(r,s,i);if(E(s))return Ku(r,s,i);if(b(s))return Bu(r,s,i);if(V(s))return vl();throw new m(p.InvalidOperator)}if(b(r)){if(Z(s))return il(r,s,i);if(ne(s))return rl(r,s,i);if(R(s))return Pl();if(A(s))return Rl(r,s,i);if(E(s))return Dl(r,s,i);if(b(s))return Fl(r,s,i);if(V(s))return Ll();throw new m(p.InvalidOperator)}if(E(r)){if(Z(s))return ll(r,s,i);if(ne(s))return al(r,s,i);if(R(s))return Nl();if(A(s))return Sl(r,s,i);if(E(s))return xl(r,s,i);if(b(s))return Ol(r,s,i);if(V(s))return Ml();throw new m(p.InvalidOperator)}if(V(r)){if(Z(s))return ml(r,s,i);if(ne(s))return wl();if(R(s))return Ul();if(A(s))return Jl();if(E(s))return Vl();if(b(s))return Zl();if(V(s))return hl(r,s,i);throw new m(p.InvalidOperator)}throw new m(p.InvalidOperator)}function Ge(i,r,s){switch(s){case"+":return i+r;case"-":return i-r;case"*":return i*r;case"/":return i/r}throw new m(p.InvalidOperator)}function Bu(i,r,s){switch(s){case"+":return r.plus({milliseconds:i.valueInMilliseconds()});case"-":return i.valueInMilliseconds()-r.toMillis()}throw new m(p.InvalidOperator)}function Qu(i,r,s){if(s==="+")return r.plus("milliseconds",i.valueInMilliseconds());throw new m(p.InvalidOperator)}function Wu(i,r,s){if(s==="+")return r.plus("milliseconds",i.valueInMilliseconds());throw new m(p.InvalidOperator)}function Gu(i,r,s){switch(s){case"+":return i.plus("milliseconds",r.valueInMilliseconds());case"-":return i.plus("milliseconds",-1*r.valueInMilliseconds())}throw new m(p.InvalidOperator)}function Ku(i,r,s){if(s==="+")return r.addMilliseconds(i.valueInMilliseconds());throw new m(p.InvalidOperator)}function Xu(i,r,s){switch(s){case"+":return M.createFromMilliseconds(i.valueInMilliseconds()+r.valueInMilliseconds());case"-":return M.createFromMilliseconds(i.valueInMilliseconds()-r.valueInMilliseconds());case"*":return M.createFromMilliseconds(i.valueInMilliseconds()*r.valueInMilliseconds());case"/":return M.createFromMilliseconds(i.valueInMilliseconds()/r.valueInMilliseconds())}throw new m(p.InvalidOperator)}function el(i,r,s){switch(s){case"+":return M.createFromMilliseconds(i.valueInMilliseconds()+r);case"-":return M.createFromMilliseconds(i.valueInMilliseconds()-r);case"*":return M.createFromMilliseconds(i.valueInMilliseconds()*r);case"/":return M.createFromMilliseconds(i.valueInMilliseconds()/r)}throw new m(p.InvalidOperator)}function tl(i,r,s){switch(s){case"+":return M.createFromMilliseconds(i+r.valueInMilliseconds());case"-":return M.createFromMilliseconds(i-r.valueInMilliseconds());case"*":return M.createFromMilliseconds(i*r.valueInMilliseconds());case"/":return M.createFromMilliseconds(i/r.valueInMilliseconds())}throw new m(p.InvalidOperator)}function nl(i,r,s){switch(s){case"+":return i.plus("milliseconds",r.valueInMilliseconds());case"-":return i.plus("milliseconds",-1*r.valueInMilliseconds())}throw new m(p.InvalidOperator)}function rl(i,r,s){switch(s){case"+":return i.plus({milliseconds:r.valueInMilliseconds()});case"-":return i.minus({milliseconds:r.valueInMilliseconds()})}throw new m(p.InvalidOperator)}function al(i,r,s){switch(s){case"+":return i.addMilliseconds(r.valueInMilliseconds());case"-":return i.addMilliseconds(-1*r.valueInMilliseconds())}throw new m(p.InvalidOperator)}function il(i,r,s){const f=1e3*r*24*60*60;switch(s){case"+":return i.plus({milliseconds:f});case"-":return i.minus({milliseconds:f})}throw new m(p.InvalidOperator)}function ol(i,r,s){const f=1e3*r*24*60*60;switch(s){case"+":return i.plus("milliseconds",f);case"-":return i.plus("milliseconds",-1*f)}throw new m(p.InvalidOperator)}function sl(i,r,s){const f=1e3*r*24*60*60;switch(s){case"+":return i.plus("milliseconds",f);case"-":return i.plus("milliseconds",-1*f)}throw new m(p.InvalidOperator)}function ul(i,r,s){throw new m(p.InvalidOperator)}function ll(i,r,s){const f=1e3*r*24*60*60;switch(s){case"+":return i.addMilliseconds(f);case"-":return i.addMilliseconds(-1*f)}throw new m(p.InvalidOperator)}function cl(i,r,s){throw new m(p.InvalidOperator)}function fl(i,r,s){throw new m(p.InvalidOperator)}function pl(i,r,s){throw new m(p.InvalidOperator)}function dl(i,r,s){const f=parseFloat(r);if(isNaN(f))throw new m(p.InvalidOperator);return Ge(i,f,s)}function ml(i,r,s){const f=parseFloat(i);if(isNaN(f))throw new m(p.InvalidOperator);return Ge(f,r,s)}function hl(i,r,s){if(s==="+")return i+r;throw new m(p.InvalidOperator)}function vl(i,r,s){throw new m(p.InvalidOperator)}function wl(i,r,s){throw new m(p.InvalidOperator)}function Il(i,r,s){if(s==="-")return i.toDateTimeLuxon(r.zone).diff(r).as("days");throw new m(p.InvalidOperator)}function gl(i,r,s){if(s==="-")return i.toDateTimeLuxon(r.toDateTime().zone).diff(r.toDateTime()).as("days");throw new m(p.InvalidOperator)}function yl(i,r,s){if(s==="-")return i.toDateTimeLuxon("UTC").diff(r.toDateTimeLuxon("UTC")).as("days");throw new m(p.InvalidOperator)}function Tl(i,r,s){throw new m(p.InvalidOperator)}function Nl(i,r,s){throw new m(p.InvalidOperator)}function Sl(i,r,s){if(s==="-")return i.toDateTime().diff(r.toDateTimeLuxon(i.toDateTime().zone)).as("days");throw new m(p.InvalidOperator)}function Ol(i,r,s){if(s==="-")return i.toDateTime().diff(r).as("days");throw new m(p.InvalidOperator)}function xl(i,r,s){if(s==="-")return i.toDateTime().diff(r.toDateTime()).as("days");throw new m(p.InvalidOperator)}function Cl(i,r,s){throw new m(p.InvalidOperator)}function bl(i,r,s){throw new m(p.InvalidOperator)}function Al(i,r,s){throw new m(p.InvalidOperator)}function El(i,r,s){throw new m(p.InvalidOperator)}function Fl(i,r,s){if(s==="-")return i.diff(r).as("days");throw new m(p.InvalidOperator)}function Rl(i,r,s){if(s==="-")return i.diff(r.toDateTimeLuxon(i.zone)).as("days");throw new m(p.InvalidOperator)}function Dl(i,r,s){if(s==="-")return i.diff(r.toDateTime()).as("days");throw new m(p.InvalidOperator)}function Pl(i,r,s){throw new m(p.InvalidOperator)}function _l(i,r,s){throw new m(p.InvalidOperator)}function $l(i,r,s){throw new m(p.InvalidOperator)}function Ll(i,r,s){throw new m(p.InvalidOperator)}function Ml(i,r,s){throw new m(p.InvalidOperator)}function Ul(i,r,s){throw new m(p.InvalidOperator)}function Jl(i,r,s){throw new m(p.InvalidOperator)}function Zl(i,r,s){throw new m(p.InvalidOperator)}function Vl(i,r,s){throw new m(p.InvalidOperator)}var Kt,Xt,qe={exports:{}};qe.exports,Xt=function(){function i(l,h){function v(){this.constructor=l}v.prototype=h.prototype,l.prototype=new v}function r(l,h,v,t){var N=Error.call(this,l);return Object.setPrototypeOf&&Object.setPrototypeOf(N,r.prototype),N.expected=h,N.found=v,N.location=t,N.name="SyntaxError",N}function s(l,h,v){return v=v||" ",l.length>h?l:(h-=l.length,l+(v+=v.repeat(h)).slice(0,h))}function f(l,h){var v,t={},N=(h=h!==void 0?h:{}).grammarSource,S={start:vt},_=vt,U="!",J="=",O=">=",C=">",z="<=",P="<>",wn="<",Ke="!=",Ee="+",Fe="-",Xe="||",In="*",gn="/",yn="@",et="'",tt="N'",fe="''",Tn=".",Nn="null",Sn="true",On="false",xn="in",Cn="is",bn="like",An="escape",En="not",Fn="and",Rn="or",Dn="between",Pn="from",_n="for",$n="substring",Ln="extract",Mn="trim",Un="position",Jn="timestamp",Zn="date",Vn="time",zn="leading",kn="trailing",Hn="both",qn="cast",Yn="as",jn="integer",Bn="smallint",Qn="float",Wn="real",Gn="varchar",Kn="to",Xn="interval",er="year",tr="timezone_hour",nr="timezone_minute",rr="month",ar="day",ir="hour",or="minute",sr="second",ur="case",lr="end",cr="when",fr="then",pr="else",dr=",",mr="(",hr=")",nt="`",vr=/^[A-Za-z_\x80-\uFFFF]/,wr=/^[A-Za-z0-9_]/,rt=/^[A-Za-z0-9_.\x80-\uFFFF]/,Ir=/^["]/,at=/^[^']/,gr=/^[0-9]/,yr=/^[eE]/,Tr=/^[+\-]/,Nr=/^[ \t\n\r]/,it=/^[^`]/,Sr=g("!",!1),ot=g("=",!1),Or=g(">=",!1),xr=g(">",!1),Cr=g("<=",!1),br=g("<>",!1),Ar=g("<",!1),Er=g("!=",!1),Re=g("+",!1),De=g("-",!1),Fr=g("||",!1),Rr=g("*",!1),Dr=g("/",!1),Pr=G([["A","Z"],["a","z"],"_",["","￿"]],!1,!1),_r=G([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),st=G([["A","Z"],["a","z"],["0","9"],"_",".",["","￿"]],!1,!1),$r=G(['"'],!1,!1),Lr=g("@",!1),ut=g("'",!1),Mr=g("N'",!1),lt=g("''",!1),ct=G(["'"],!0,!1),Ur=g(".",!1),Jr=G([["0","9"]],!1,!1),Zr=G(["e","E"],!1,!1),Vr=G(["+","-"],!1,!1),zr=g("NULL",!0),kr=g("TRUE",!0),Hr=g("FALSE",!0),qr=g("IN",!0),Yr=g("IS",!0),jr=g("LIKE",!0),Br=g("ESCAPE",!0),Qr=g("NOT",!0),Wr=g("AND",!0),Gr=g("OR",!0),Kr=g("BETWEEN",!0),Xr=g("FROM",!0),ea=g("FOR",!0),ta=g("SUBSTRING",!0),na=g("EXTRACT",!0),ra=g("TRIM",!0),aa=g("POSITION",!0),ia=g("TIMESTAMP",!0),oa=g("DATE",!0),sa=g("TIME",!0),ua=g("LEADING",!0),la=g("TRAILING",!0),ca=g("BOTH",!0),fa=g("CAST",!0),pa=g("AS",!0),da=g("INTEGER",!0),ma=g("SMALLINT",!0),ha=g("FLOAT",!0),va=g("REAL",!0),wa=g("VARCHAR",!0),Ia=g("TO",!0),ga=g("INTERVAL",!0),ya=g("YEAR",!0),Ta=g("TIMEZONE_HOUR",!0),Na=g("TIMEZONE_MINUTE",!0),Sa=g("MONTH",!0),Oa=g("DAY",!0),xa=g("HOUR",!0),Ca=g("MINUTE",!0),ba=g("SECOND",!0),Aa=g("CASE",!0),Ea=g("END",!0),Fa=g("WHEN",!0),Ra=g("THEN",!0),Da=g("ELSE",!0),Pa=g(",",!1),_a=g("(",!1),$a=g(")",!1),La=G([" ","	",`
`,"\r"],!1,!1),ft=g("`",!1),pt=G(["`"],!0,!1),Ma=function(e){return e},Ua=function(e,a){var o={type:"expression-list"},u=Tu(e,a);return o.value=u,o},Ja=function(e,a){return ce(e,a)},Za=function(e,a){return ce(e,a)},Va=function(e){return gu("NOT",e)},za=function(e,a){return a==""||a==null||a==null?e:a.type=="arithmetic"?ce(e,a.tail):Bt(a.op,e,a.right,a.escape)},ka=function(e){return{type:"arithmetic",tail:e}},Ha=function(e,a){return{op:e+"NOT",right:a}},qa=function(e,a){return{op:e,right:a}},Ya=function(e,a,o){return{op:"NOT"+e,right:{type:"expression-list",value:[a,o]}}},ja=function(e,a,o){return{op:e,right:{type:"expression-list",value:[a,o]}}},Ba=function(e){return e[0]+" "+e[2]},Qa=function(e){return e[0]+" "+e[2]},Wa=function(e,a,o){return{op:e,right:a,escape:o.value}},Ga=function(e,a){return{op:e,right:a,escape:""}},Ka=function(e,a){return{op:e,right:a}},Xa=function(e){return{op:e,right:{type:"expression-list",value:[]}}},ei=function(e,a){return{op:e,right:a}},ti=function(e,a){return ce(e,a)},ni=function(e,a){return ce(e,a)},ri=function(e){return e.paren=!0,e},ai=function(e){return/^CURRENT_DATE$/i.test(e)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(e)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:e}},ii=function(e){return{type:"column-reference",table:"",column:e,delimited:!0}},oi=function(e){return e},si=function(e,a){return e+a.join("")},ui=function(e,a){return e+a.join("")},li=function(e){return e},ci=function(e){return e.join("")},fi=function(){return'"'},pi=function(e){return{type:"parameter",value:e[1]}},di=function(e,a){return{type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",value:e},a]}}},mi=function(e,a,o){return{type:"function",name:"substring",args:{type:"expression-list",value:o?[e,a,o[2]]:[e,a]}}},hi=function(e,a){return{type:"function",name:"cast",args:{type:"expression-list",value:[e,a]}}},vi=function(){return{type:"data-type",value:{type:"integer"}}},wi=function(){return{type:"data-type",value:{type:"smallint"}}},Ii=function(){return{type:"data-type",value:{type:"float"}}},gi=function(){return{type:"data-type",value:{type:"real"}}},yi=function(){return{type:"data-type",value:{type:"date"}}},Ti=function(){return{type:"data-type",value:{type:"timestamp"}}},Ni=function(){return{type:"data-type",value:{type:"time"}}},Si=function(e){return{type:"data-type",value:{type:"varchar",size:parseInt(e)}}},Oi=function(e,a,o){return{type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:e??"BOTH"},a,o]}}},xi=function(e,a){return{type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:e??"BOTH"},a]}}},Ci=function(e,a){return{type:"function",name:"position",args:{type:"expression-list",value:[e,a]}}},bi=function(e,a){return{type:"function",name:e,args:a||{type:"expression-list",value:[]}}},Ai=function(e){return{type:"timestamp",value:e.value}},Ei=function(e){return{type:"time",value:e.value}},Fi=function(e,a,o){return{type:"interval",value:a,qualifier:o,op:e}},Ri=function(e,a){return{type:"interval",value:e,qualifier:a,op:""}},Di=function(e,a){return{type:"interval-qualifier",start:e,end:a}},Pi=function(e,a){return{type:"interval-period",period:e.value,precision:a,secondary:null}},_i=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},$i=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},Li=function(e,a){return{type:"interval-period",period:"second",precision:e,secondary:a}},Mi=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}},Ui=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},Ji=function(e,a){return{type:"interval-period",period:e.value,precision:a,secondary:null}},Zi=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},Vi=function(e,a){return{type:"interval-period",period:"second",precision:e,secondary:a}},zi=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}},ki=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},Hi=function(){return{type:"string",value:"day"}},qi=function(){return{type:"string",value:"hour"}},Yi=function(){return{type:"string",value:"minute"}},ji=function(){return{type:"string",value:"month"}},Bi=function(){return{type:"string",value:"year"}},Qi=function(e){return parseFloat(e)},Wi=function(e){return parseFloat(e)},Gi=function(e){return{type:"date",value:e.value}},Ki=function(){return{type:"null",value:null}},Xi=function(){return{type:"boolean",value:!0}},eo=function(){return{type:"boolean",value:!1}},dt=function(){return"'"},to=function(e){return{type:"string",value:e.join("")}},no=function(e,a){return{type:"case-expression",format:"simple",operand:e,clauses:a,else:null}},ro=function(e,a,o){return{type:"case-expression",format:"simple",operand:e,clauses:a,else:o.value}},ao=function(e){return{type:"case-expression",format:"searched",clauses:e,else:null}},io=function(e,a){return{type:"case-expression",format:"searched",clauses:e,else:a.value}},oo=function(e,a){return{type:"when-clause",operand:e,value:a}},so=function(e,a){return{type:"when-clause",operand:e,value:a}},uo=function(e){return{type:"else-clause",value:e}},lo=function(e){return{type:"number",value:e}},co=function(e,a,o){return parseFloat(e+a+o)},fo=function(e,a){return parseFloat(e+a)},po=function(e,a){return parseFloat(e+a)},mo=function(e){return parseFloat(e)},ho=function(e,a){return e[0]+a},vo=function(e){return"."+(e??"")},wo=function(e,a){return e+a},Io=function(e){return e.join("")},go=function(e,a){return"e"+(a===null?"":a)},yo=function(){return"IN"},To=function(){return"IS"},No=function(){return"LIKE"},So=function(){return"ESCAPE"},Oo=function(){return"NOT"},xo=function(){return"AND"},Co=function(){return"OR"},bo=function(){return"BETWEEN"},Ao=function(){return"FROM"},Eo=function(){return"FOR"},Fo=function(){return"SUBSTRING"},Ro=function(){return"EXTRACT"},Do=function(){return"TRIM"},Po=function(){return"POSITION"},_o=function(){return"TIMESTAMP"},$o=function(){return"DATE"},Lo=function(){return"TIME"},Mo=function(){return"LEADING"},Uo=function(){return"TRAILING"},Jo=function(){return"BOTH"},Zo=function(){return"CAST"},Vo=function(){return"AS"},zo=function(){return"INTEGER"},ko=function(){return"SMALLINT"},Ho=function(){return"FLOAT"},qo=function(){return"REAL"},Yo=function(){return"VARCHAR"},jo=function(){return"TO"},Bo=function(){return"INTERVAL"},Qo=function(){return"YEAR"},Wo=function(){return"TIMEZONE_HOUR"},Go=function(){return"TIMEZONE_MINUTE"},Ko=function(){return"MONTH"},Xo=function(){return"DAY"},es=function(){return"HOUR"},ts=function(){return"MINUTE"},ns=function(){return"SECOND"},rs=function(){return"CASE"},as=function(){return"END"},is=function(){return"WHEN"},os=function(){return"THEN"},ss=function(){return"ELSE"},us=function(e){return e},ls=function(e){return e.join("")},n=0,pe=[{line:1,column:1}],W=0,Pe=[],c=0;if("startRule"in h){if(!(h.startRule in S))throw new Error(`Can't start parsing from rule "`+h.startRule+'".');_=S[h.startRule]}function g(e,a){return{type:"literal",text:e,ignoreCase:a}}function G(e,a,o){return{type:"class",parts:e,inverted:a,ignoreCase:o}}function cs(){return{type:"end"}}function mt(e){var a,o=pe[e];if(o)return o;for(a=e-1;!pe[a];)a--;for(o={line:(o=pe[a]).line,column:o.column};a<e;)l.charCodeAt(a)===10?(o.line++,o.column=1):o.column++,a++;return pe[e]=o,o}function ht(e,a,o){var u=mt(e),I=mt(a),T={source:N,start:{offset:e,line:u.line,column:u.column},end:{offset:a,line:I.line,column:I.column}};return o&&N&&typeof N.offset=="function"&&(T.start=N.offset(T.start),T.end=N.offset(T.end)),T}function w(e){n<W||(n>W&&(W=n,Pe=[]),Pe.push(e))}function fs(e,a,o){return new r(r.buildMessage(e,a),e,a,o)}function vt(){var e,a;return e=n,d(),(a=D())!==t?(d(),e=Ma(a)):(n=e,e=t),e}function wt(){var e,a,o,u,I,T,x,F;if(e=n,(a=D())!==t){for(o=[],u=n,I=d(),(T=Se())!==t?(x=d(),(F=D())!==t?u=I=[I,T,x,F]:(n=u,u=t)):(n=u,u=t);u!==t;)o.push(u),u=n,I=d(),(T=Se())!==t?(x=d(),(F=D())!==t?u=I=[I,T,x,F]:(n=u,u=t)):(n=u,u=t);e=Ua(a,o)}else n=e,e=t;return e}function D(){var e,a,o,u,I,T,x,F;if(e=n,(a=_e())!==t){for(o=[],u=n,I=d(),(T=Pt())!==t?(x=d(),(F=_e())!==t?u=I=[I,T,x,F]:(n=u,u=t)):(n=u,u=t);u!==t;)o.push(u),u=n,I=d(),(T=Pt())!==t?(x=d(),(F=_e())!==t?u=I=[I,T,x,F]:(n=u,u=t)):(n=u,u=t);e=Ja(a,o)}else n=e,e=t;return e}function _e(){var e,a,o,u,I,T,x,F;if(e=n,(a=de())!==t){for(o=[],u=n,I=d(),(T=ye())!==t?(x=d(),(F=de())!==t?u=I=[I,T,x,F]:(n=u,u=t)):(n=u,u=t);u!==t;)o.push(u),u=n,I=d(),(T=ye())!==t?(x=d(),(F=de())!==t?u=I=[I,T,x,F]:(n=u,u=t)):(n=u,u=t);e=Za(a,o)}else n=e,e=t;return e}function de(){var e,a,o,u,I;return e=n,(a=le())===t&&(a=n,l.charCodeAt(n)===33?(o=U,n++):(o=t,c===0&&w(Sr)),o!==t?(u=n,c++,l.charCodeAt(n)===61?(I=J,n++):(I=t,c===0&&w(ot)),c--,I===t?u=void 0:(n=u,u=t),u!==t?a=o=[o,u]:(n=a,a=t)):(n=a,a=t)),a!==t?(o=d(),(u=de())!==t?e=Va(u):(n=e,e=t)):(n=e,e=t),e===t&&(e=ps()),e}function ps(){var e,a,o;return e=n,(a=te())!==t?(d(),(o=ds())===t&&(o=null),e=za(a,o)):(n=e,e=t),e}function ds(){var e;return(e=ms())===t&&(e=Is())===t&&(e=vs())===t&&(e=hs())===t&&(e=ws()),e}function ms(){var e,a,o,u,I,T;if(e=[],a=n,o=d(),(u=It())!==t?(I=d(),(T=te())!==t?a=o=[o,u,I,T]:(n=a,a=t)):(n=a,a=t),a!==t)for(;a!==t;)e.push(a),a=n,o=d(),(u=It())!==t?(I=d(),(T=te())!==t?a=o=[o,u,I,T]:(n=a,a=t)):(n=a,a=t);else e=t;return e!==t&&(e=ka(e)),e}function It(){var e;return l.substr(n,2)===O?(e=O,n+=2):(e=t,c===0&&w(Or)),e===t&&(l.charCodeAt(n)===62?(e=C,n++):(e=t,c===0&&w(xr)),e===t&&(l.substr(n,2)===z?(e=z,n+=2):(e=t,c===0&&w(Cr)),e===t&&(l.substr(n,2)===P?(e=P,n+=2):(e=t,c===0&&w(br)),e===t&&(l.charCodeAt(n)===60?(e=wn,n++):(e=t,c===0&&w(Ar)),e===t&&(l.charCodeAt(n)===61?(e=J,n++):(e=t,c===0&&w(ot)),e===t&&(l.substr(n,2)===Ke?(e=Ke,n+=2):(e=t,c===0&&w(Er)))))))),e}function hs(){var e,a,o,u;return e=n,(a=Rt())!==t?(d(),(o=le())!==t?(d(),(u=te())!==t?e=Ha(a,u):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(a=Rt())!==t?(d(),(o=te())!==t?e=qa(a,o):(n=e,e=t)):(n=e,e=t)),e}function vs(){var e,a,o,u,I,T;return e=n,(a=le())!==t?(d(),(o=_t())!==t?(d(),(u=te())!==t?(d(),(I=ye())!==t?(d(),(T=te())!==t?e=Ya(o,u,T):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(a=_t())!==t?(d(),(o=te())!==t?(d(),(u=ye())!==t?(d(),(I=te())!==t?e=ja(a,o,I):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)),e}function gt(){var e,a,o,u,I;return e=n,a=n,(o=le())!==t?(u=d(),(I=Dt())!==t?a=o=[o,u,I]:(n=a,a=t)):(n=a,a=t),a!==t&&(a=Ba(a)),(e=a)===t&&(e=Dt()),e}function $e(){var e,a,o,u,I;return e=n,a=n,(o=le())!==t?(u=d(),(I=Ve())!==t?a=o=[o,u,I]:(n=a,a=t)):(n=a,a=t),a!==t&&(a=Qa(a)),(e=a)===t&&(e=Ve()),e}function ws(){var e,a,o,u;return e=n,(a=gt())!==t?(d(),(o=re())!==t?(d(),Xs()!==t?(d(),(u=Ze())!==t?e=Wa(a,o,u):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(a=gt())!==t?(d(),(o=re())!==t?e=Ga(a,o):(n=e,e=t)):(n=e,e=t)),e}function Is(){var e,a,o,u;return e=n,(a=$e())!==t?(d(),(o=$())!==t?(d(),(u=wt())!==t?(d(),L()!==t?e=Ka(a,u):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(a=$e())!==t?(d(),(o=$())!==t?(d(),(u=L())!==t?e=Xa(a):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(a=$e())!==t?(d(),(o=Je())!==t?e=ei(a,o):(n=e,e=t)):(n=e,e=t))),e}function te(){var e,a,o,u,I,T,x,F;if(e=n,(a=Le())!==t){for(o=[],u=n,I=d(),(T=yt())!==t?(x=d(),(F=Le())!==t?u=I=[I,T,x,F]:(n=u,u=t)):(n=u,u=t);u!==t;)o.push(u),u=n,I=d(),(T=yt())!==t?(x=d(),(F=Le())!==t?u=I=[I,T,x,F]:(n=u,u=t)):(n=u,u=t);e=ti(a,o)}else n=e,e=t;return e}function yt(){var e;return l.charCodeAt(n)===43?(e=Ee,n++):(e=t,c===0&&w(Re)),e===t&&(l.charCodeAt(n)===45?(e=Fe,n++):(e=t,c===0&&w(De)),e===t&&(l.substr(n,2)===Xe?(e=Xe,n+=2):(e=t,c===0&&w(Fr)))),e}function Le(){var e,a,o,u,I,T,x,F;if(e=n,(a=Me())!==t){for(o=[],u=n,I=d(),(T=Tt())!==t?(x=d(),(F=Me())!==t?u=I=[I,T,x,F]:(n=u,u=t)):(n=u,u=t);u!==t;)o.push(u),u=n,I=d(),(T=Tt())!==t?(x=d(),(F=Me())!==t?u=I=[I,T,x,F]:(n=u,u=t)):(n=u,u=t);e=ni(a,o)}else n=e,e=t;return e}function Tt(){var e;return l.charCodeAt(n)===42?(e=In,n++):(e=t,c===0&&w(Rr)),e===t&&(l.charCodeAt(n)===47?(e=gn,n++):(e=t,c===0&&w(Dr))),e}function Me(){var e,a;return(e=_s())===t&&(e=Cs())===t&&(e=bs())===t&&(e=Fs())===t&&(e=Rs())===t&&(e=As())===t&&(e=Ds())===t&&(e=Hs())===t&&(e=gs())===t&&(e=Je())===t&&(e=n,$()!==t?(d(),(a=D())!==t?(d(),L()!==t?e=ri(a):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)),e}function gs(){var e,a;return e=n,(a=ys())!==t&&(a=ai(a)),(e=a)===t&&(e=n,(a=Ns())!==t&&(a=ii(a)),e=a),e}function ys(){var e;return(e=Ts())!==t&&(e=oi(e)),e}function Ts(){var e,a,o,u;if(e=n,(a=Ue())!==t){for(o=[],u=St();u!==t;)o.push(u),u=St();e=si(a,o)}else n=e,e=t;return e}function Nt(){var e,a,o,u;if(e=n,(a=Ue())!==t){for(o=[],u=y();u!==t;)o.push(u),u=y();e=ui(a,o)}else n=e,e=t;return e}function Ue(){var e;return vr.test(l.charAt(n))?(e=l.charAt(n),n++):(e=t,c===0&&w(Pr)),e}function y(){var e;return wr.test(l.charAt(n))?(e=l.charAt(n),n++):(e=t,c===0&&w(_r)),e}function St(){var e;return rt.test(l.charAt(n))?(e=l.charAt(n),n++):(e=t,c===0&&w(st)),e}function Ns(){var e,a;return e=n,me()!==t?(a=Ss(),me()!==t?e=li(a):(n=e,e=t)):(n=e,e=t),e}function Ss(){var e,a;for(e=[],a=Ot();a!==t;)e.push(a),a=Ot();return e=ci(e)}function Ot(){var e;return(e=xs())===t&&(e=Os()),e}function Os(){var e;return e=n,me()!==t&&me()!==t?e=fi():(n=e,e=t),e}function xs(){var e;return rt.test(l.charAt(n))?(e=l.charAt(n),n++):(e=t,c===0&&w(st)),e}function me(){var e;return Ir.test(l.charAt(n))?(e=l.charAt(n),n++):(e=t,c===0&&w($r)),e}function Je(){var e,a,o;return e=n,l.charCodeAt(n)===64?(a=yn,n++):(a=t,c===0&&w(Lr)),a!==t&&(o=Nt())!==t?e=a=[a,o]:(n=e,e=t),e!==t&&(e=pi(e)),e}function Cs(){var e,a,o;return e=n,nu()!==t?(d(),$()!==t?(d(),(a=Ps())!==t?(d(),ze()!==t?(d(),(o=D())!==t?(d(),L()!==t?e=di(a,o):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e}function bs(){var e,a,o,u,I,T,x;return e=n,tu()!==t?(d(),$()!==t?(d(),(a=D())!==t?(d(),ze()!==t?(d(),(o=D())!==t?(d(),u=n,(I=eu())!==t?(T=d(),(x=D())!==t?u=I=[I,T,x,d()]:(n=u,u=t)):(n=u,u=t),u===t&&(u=null),(I=L())!==t?e=mi(a,o,u):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e}function As(){var e,a,o;return e=n,su()!==t?(d(),$()!==t?(d(),(a=D())!==t?(d(),uu()!==t?(d(),(o=Es())!==t?(d(),L()!==t?e=hi(a,o):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e}function Es(){var e,a,o;return e=n,(a=lu())!==t&&(a=vi()),(e=a)===t&&(e=n,(a=cu())!==t&&(a=wi()),(e=a)===t&&(e=n,(a=fu())!==t&&(a=Ii()),(e=a)===t&&(e=n,(a=pu())!==t&&(a=gi()),(e=a)===t&&(e=n,(a=Mt())!==t&&(a=yi()),(e=a)===t&&(e=n,(a=Lt())!==t&&(a=Ti()),(e=a)===t&&(e=n,(a=Ut())!==t&&(a=Ni()),(e=a)===t&&(e=n,(a=du())!==t?(d(),$()!==t?(d(),(o=ae())!==t?(d(),L()!==t?e=Si(o):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)))))))),e}function Fs(){var e,a,o,u;return e=n,$t()!==t?(d(),$()!==t?(d(),(a=xt())===t&&(a=null),d(),(o=D())!==t?(d(),ze()!==t?(d(),(u=D())!==t?(d(),L()!==t?e=Oi(a,o,u):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,$t()!==t?(d(),$()!==t?(d(),(a=xt())===t&&(a=null),d(),(o=D())!==t?(d(),L()!==t?e=xi(a,o):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)),e}function xt(){var e;return(e=au())===t&&(e=iu())===t&&(e=ou()),e}function Rs(){var e,a,o;return e=n,ru()!==t?(d(),$()!==t?(d(),(a=D())!==t?(d(),Ve()!==t?(d(),(o=D())!==t?(d(),L()!==t?e=Ci(a,o):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e}function Ds(){var e,a,o;return e=n,(a=Iu())!==t?(d(),$()!==t?(d(),(o=wt())===t&&(o=null),d(),L()!==t?e=bi(a,o):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e}function Ps(){var e;return(e=Zt())===t&&(e=Vt())===t&&(e=zt())===t&&(e=kt())===t&&(e=Ht())===t&&(e=ie())===t&&(e=hu())===t&&(e=vu()),e}function _s(){var e;return(e=Ze())===t&&(e=js())===t&&(e=ks())===t&&(e=zs())===t&&(e=Vs())===t&&(e=$s())===t&&(e=Ms())===t&&(e=Ls()),e}function $s(){var e,a;return e=n,Lt()!==t?(d(),(a=re())!==t?e=Ai(a):(n=e,e=t)):(n=e,e=t),e}function Ls(){var e,a;return e=n,Ut()!==t?(d(),(a=re())!==t?e=Ei(a):(n=e,e=t)):(n=e,e=t),e}function Ms(){var e,a,o,u;return e=n,Jt()!==t?(d(),l.charCodeAt(n)===45?(a=Fe,n++):(a=t,c===0&&w(De)),a===t&&(l.charCodeAt(n)===43?(a=Ee,n++):(a=t,c===0&&w(Re))),a!==t?(d(),(o=re())!==t?(d(),(u=Ct())!==t?e=Fi(a,o,u):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,Jt()!==t?(d(),(a=re())!==t?(d(),(o=Ct())!==t?e=Ri(a,o):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)),e}function Ct(){var e,a,o;return e=n,(a=Us())!==t?(d(),mu()!==t?(d(),(o=Js())!==t?e=Di(a,o):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=Zs()),e}function Us(){var e,a,o;return e=n,(a=ue())!==t?(d(),$()!==t?(d(),(o=ve())!==t?(d(),L()!==t?e=Pi(a,o):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(a=ue())!==t&&(a=_i(a)),e=a),e}function Js(){var e,a,o,u;return e=n,(a=ue())!==t&&(a=$i(a)),(e=a)===t&&(e=n,(a=ie())!==t?(d(),$()!==t?(d(),(o=ve())!==t?(d(),Se()!==t?(d(),(u=he())!==t?(d(),L()!==t?e=Li(o,u):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(a=ie())!==t?(d(),$()!==t?(d(),(o=ve())!==t?(d(),L()!==t?e=Mi(o):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(a=ie())!==t&&(a=Ui()),e=a))),e}function Zs(){var e,a,o,u;return e=n,(a=ue())!==t?(d(),$()!==t?(d(),(o=he())!==t?(d(),L()!==t?e=Ji(a,o):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(a=ue())!==t&&(a=Zi(a)),(e=a)===t&&(e=n,(a=ie())!==t?(d(),$()!==t?(d(),(o=ve())!==t?(d(),Se()!==t?(d(),(u=he())!==t?(d(),L()!==t?e=Vi(o,u):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(a=ie())!==t?(d(),$()!==t?(d(),(o=he())!==t?(d(),L()!==t?e=zi(o):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(a=ie())!==t&&(a=ki()),e=a)))),e}function ue(){var e,a;return e=n,(a=zt())!==t&&(a=Hi()),(e=a)===t&&(e=n,(a=kt())!==t&&(a=qi()),(e=a)===t&&(e=n,(a=Ht())!==t&&(a=Yi()),(e=a)===t&&(e=n,(a=Vt())!==t&&(a=ji()),(e=a)===t&&(e=n,(a=Zt())!==t&&(a=Bi()),e=a)))),e}function he(){var e;return(e=ae())!==t&&(e=Qi(e)),e}function ve(){var e;return(e=ae())!==t&&(e=Wi(e)),e}function Vs(){var e,a;return e=n,Mt()!==t?(d(),(a=re())!==t?e=Gi(a):(n=e,e=t)):(n=e,e=t),e}function zs(){var e;return(e=Ws())!==t&&(e=Ki()),e}function ks(){var e,a;return e=n,(a=Gs())!==t&&(a=Xi()),(e=a)===t&&(e=n,(a=Ks())!==t&&(a=eo()),e=a),e}function re(){var e;return(e=Ze())===t&&(e=Je()),e}function Ze(){var e,a,o,u,I;if(e=n,l.charCodeAt(n)===39?(a=et,n++):(a=t,c===0&&w(ut)),a===t&&(l.substr(n,2)===tt?(a=tt,n+=2):(a=t,c===0&&w(Mr))),a!==t){for(o=[],u=n,l.substr(n,2)===fe?(I=fe,n+=2):(I=t,c===0&&w(lt)),I!==t&&(I=dt()),(u=I)===t&&(at.test(l.charAt(n))?(u=l.charAt(n),n++):(u=t,c===0&&w(ct)));u!==t;)o.push(u),u=n,l.substr(n,2)===fe?(I=fe,n+=2):(I=t,c===0&&w(lt)),I!==t&&(I=dt()),(u=I)===t&&(at.test(l.charAt(n))?(u=l.charAt(n),n++):(u=t,c===0&&w(ct)));l.charCodeAt(n)===39?(u=et,n++):(u=t,c===0&&w(ut)),u!==t?e=to(o):(n=e,e=t)}else n=e,e=t;return e}function Hs(){var e;return(e=qs())===t&&(e=Ys()),e}function qs(){var e,a,o,u,I;if(e=n,Te()!==t)if(d(),(a=D())!==t){for(d(),o=[],u=Ie();u!==t;)o.push(u),u=Ie();u=d(),(I=Ne())!==t?e=no(a,o):(n=e,e=t)}else n=e,e=t;else n=e,e=t;if(e===t)if(e=n,Te()!==t)if(d(),(a=D())!==t){for(d(),o=[],u=Ie();u!==t;)o.push(u),u=Ie();u=d(),(I=bt())!==t?(d(),Ne()!==t?e=ro(a,o,I):(n=e,e=t)):(n=e,e=t)}else n=e,e=t;else n=e,e=t;return e}function Ys(){var e,a,o,u;if(e=n,Te()!==t){for(d(),a=[],o=we();o!==t;)a.push(o),o=we();o=d(),(u=Ne())!==t?e=ao(a):(n=e,e=t)}else n=e,e=t;if(e===t)if(e=n,Te()!==t){for(d(),a=[],o=we();o!==t;)a.push(o),o=we();o=d(),(u=bt())!==t?(d(),Ne()!==t?e=io(a,u):(n=e,e=t)):(n=e,e=t)}else n=e,e=t;return e}function we(){var e,a,o;return e=n,qt()!==t?(d(),(a=D())!==t?(d(),Yt()!==t?(d(),(o=D())!==t?e=oo(a,o):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e}function Ie(){var e,a,o;return e=n,qt()!==t?(d(),(a=D())!==t?(d(),Yt()!==t?(d(),(o=D())!==t?e=so(a,o):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e}function bt(){var e,a;return e=n,wu()!==t?(d(),(a=D())!==t?e=uo(a):(n=e,e=t)):(n=e,e=t),e}function js(){var e,a,o,u;return e=n,(a=Bs())!==t?(o=n,c++,u=Ue(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=lo(a):(n=e,e=t)):(n=e,e=t),e}function Bs(){var e,a,o,u;return e=n,(a=ge())!==t&&(o=At())!==t&&(u=Et())!==t?e=co(a,o,u):(n=e,e=t),e===t&&(e=n,(a=ge())!==t&&(o=At())!==t?e=fo(a,o):(n=e,e=t),e===t&&(e=n,(a=ge())!==t&&(o=Et())!==t?e=po(a,o):(n=e,e=t),e===t&&(e=n,(a=ge())!==t&&(a=mo(a)),e=a))),e}function ge(){var e,a,o;return(e=ae())===t&&(e=n,l.charCodeAt(n)===45?(a=Fe,n++):(a=t,c===0&&w(De)),a===t&&(l.charCodeAt(n)===43?(a=Ee,n++):(a=t,c===0&&w(Re))),a!==t&&(o=ae())!==t?e=ho(a,o):(n=e,e=t)),e}function At(){var e,a,o;return e=n,l.charCodeAt(n)===46?(a=Tn,n++):(a=t,c===0&&w(Ur)),a!==t?((o=ae())===t&&(o=null),e=vo(o)):(n=e,e=t),e}function Et(){var e,a,o;return e=n,(a=Qs())!==t&&(o=ae())!==t?e=wo(a,o):(n=e,e=t),e}function ae(){var e,a;if(e=[],(a=Ft())!==t)for(;a!==t;)e.push(a),a=Ft();else e=t;return e!==t&&(e=Io(e)),e}function Ft(){var e;return gr.test(l.charAt(n))?(e=l.charAt(n),n++):(e=t,c===0&&w(Jr)),e}function Qs(){var e,a,o;return e=n,yr.test(l.charAt(n))?(a=l.charAt(n),n++):(a=t,c===0&&w(Zr)),a!==t?(Tr.test(l.charAt(n))?(o=l.charAt(n),n++):(o=t,c===0&&w(Vr)),o===t&&(o=null),e=go(a,o)):(n=e,e=t),e}function Ws(){var e,a,o,u;return e=n,l.substr(n,4).toLowerCase()===Nn?(a=l.substr(n,4),n+=4):(a=t,c===0&&w(zr)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=a=[a,o]:(n=e,e=t)):(n=e,e=t),e}function Gs(){var e,a,o,u;return e=n,l.substr(n,4).toLowerCase()===Sn?(a=l.substr(n,4),n+=4):(a=t,c===0&&w(kr)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=a=[a,o]:(n=e,e=t)):(n=e,e=t),e}function Ks(){var e,a,o,u;return e=n,l.substr(n,5).toLowerCase()===On?(a=l.substr(n,5),n+=5):(a=t,c===0&&w(Hr)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=a=[a,o]:(n=e,e=t)):(n=e,e=t),e}function Ve(){var e,a,o,u;return e=n,l.substr(n,2).toLowerCase()===xn?(a=l.substr(n,2),n+=2):(a=t,c===0&&w(qr)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=yo():(n=e,e=t)):(n=e,e=t),e}function Rt(){var e,a,o,u;return e=n,l.substr(n,2).toLowerCase()===Cn?(a=l.substr(n,2),n+=2):(a=t,c===0&&w(Yr)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=To():(n=e,e=t)):(n=e,e=t),e}function Dt(){var e,a,o,u;return e=n,l.substr(n,4).toLowerCase()===bn?(a=l.substr(n,4),n+=4):(a=t,c===0&&w(jr)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=No():(n=e,e=t)):(n=e,e=t),e}function Xs(){var e,a,o,u;return e=n,l.substr(n,6).toLowerCase()===An?(a=l.substr(n,6),n+=6):(a=t,c===0&&w(Br)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=So():(n=e,e=t)):(n=e,e=t),e}function le(){var e,a,o,u;return e=n,l.substr(n,3).toLowerCase()===En?(a=l.substr(n,3),n+=3):(a=t,c===0&&w(Qr)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Oo():(n=e,e=t)):(n=e,e=t),e}function ye(){var e,a,o,u;return e=n,l.substr(n,3).toLowerCase()===Fn?(a=l.substr(n,3),n+=3):(a=t,c===0&&w(Wr)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=xo():(n=e,e=t)):(n=e,e=t),e}function Pt(){var e,a,o,u;return e=n,l.substr(n,2).toLowerCase()===Rn?(a=l.substr(n,2),n+=2):(a=t,c===0&&w(Gr)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Co():(n=e,e=t)):(n=e,e=t),e}function _t(){var e,a,o,u;return e=n,l.substr(n,7).toLowerCase()===Dn?(a=l.substr(n,7),n+=7):(a=t,c===0&&w(Kr)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=bo():(n=e,e=t)):(n=e,e=t),e}function ze(){var e,a,o,u;return e=n,l.substr(n,4).toLowerCase()===Pn?(a=l.substr(n,4),n+=4):(a=t,c===0&&w(Xr)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Ao():(n=e,e=t)):(n=e,e=t),e}function eu(){var e,a,o,u;return e=n,l.substr(n,3).toLowerCase()===_n?(a=l.substr(n,3),n+=3):(a=t,c===0&&w(ea)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Eo():(n=e,e=t)):(n=e,e=t),e}function tu(){var e,a,o,u;return e=n,l.substr(n,9).toLowerCase()===$n?(a=l.substr(n,9),n+=9):(a=t,c===0&&w(ta)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Fo():(n=e,e=t)):(n=e,e=t),e}function nu(){var e,a,o,u;return e=n,l.substr(n,7).toLowerCase()===Ln?(a=l.substr(n,7),n+=7):(a=t,c===0&&w(na)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Ro():(n=e,e=t)):(n=e,e=t),e}function $t(){var e,a,o,u;return e=n,l.substr(n,4).toLowerCase()===Mn?(a=l.substr(n,4),n+=4):(a=t,c===0&&w(ra)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Do():(n=e,e=t)):(n=e,e=t),e}function ru(){var e,a,o,u;return e=n,l.substr(n,8).toLowerCase()===Un?(a=l.substr(n,8),n+=8):(a=t,c===0&&w(aa)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Po():(n=e,e=t)):(n=e,e=t),e}function Lt(){var e,a,o,u;return e=n,l.substr(n,9).toLowerCase()===Jn?(a=l.substr(n,9),n+=9):(a=t,c===0&&w(ia)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=_o():(n=e,e=t)):(n=e,e=t),e}function Mt(){var e,a,o,u;return e=n,l.substr(n,4).toLowerCase()===Zn?(a=l.substr(n,4),n+=4):(a=t,c===0&&w(oa)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=$o():(n=e,e=t)):(n=e,e=t),e}function Ut(){var e,a,o,u;return e=n,l.substr(n,4).toLowerCase()===Vn?(a=l.substr(n,4),n+=4):(a=t,c===0&&w(sa)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Lo():(n=e,e=t)):(n=e,e=t),e}function au(){var e,a,o,u;return e=n,l.substr(n,7).toLowerCase()===zn?(a=l.substr(n,7),n+=7):(a=t,c===0&&w(ua)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Mo():(n=e,e=t)):(n=e,e=t),e}function iu(){var e,a,o,u;return e=n,l.substr(n,8).toLowerCase()===kn?(a=l.substr(n,8),n+=8):(a=t,c===0&&w(la)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Uo():(n=e,e=t)):(n=e,e=t),e}function ou(){var e,a,o,u;return e=n,l.substr(n,4).toLowerCase()===Hn?(a=l.substr(n,4),n+=4):(a=t,c===0&&w(ca)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Jo():(n=e,e=t)):(n=e,e=t),e}function su(){var e,a,o,u;return e=n,l.substr(n,4).toLowerCase()===qn?(a=l.substr(n,4),n+=4):(a=t,c===0&&w(fa)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Zo():(n=e,e=t)):(n=e,e=t),e}function uu(){var e,a,o,u;return e=n,l.substr(n,2).toLowerCase()===Yn?(a=l.substr(n,2),n+=2):(a=t,c===0&&w(pa)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Vo():(n=e,e=t)):(n=e,e=t),e}function lu(){var e,a,o,u;return e=n,l.substr(n,7).toLowerCase()===jn?(a=l.substr(n,7),n+=7):(a=t,c===0&&w(da)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=zo():(n=e,e=t)):(n=e,e=t),e}function cu(){var e,a,o,u;return e=n,l.substr(n,8).toLowerCase()===Bn?(a=l.substr(n,8),n+=8):(a=t,c===0&&w(ma)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=ko():(n=e,e=t)):(n=e,e=t),e}function fu(){var e,a,o,u;return e=n,l.substr(n,5).toLowerCase()===Qn?(a=l.substr(n,5),n+=5):(a=t,c===0&&w(ha)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Ho():(n=e,e=t)):(n=e,e=t),e}function pu(){var e,a,o,u;return e=n,l.substr(n,4).toLowerCase()===Wn?(a=l.substr(n,4),n+=4):(a=t,c===0&&w(va)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=qo():(n=e,e=t)):(n=e,e=t),e}function du(){var e,a,o,u;return e=n,l.substr(n,7).toLowerCase()===Gn?(a=l.substr(n,7),n+=7):(a=t,c===0&&w(wa)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Yo():(n=e,e=t)):(n=e,e=t),e}function mu(){var e,a,o,u;return e=n,l.substr(n,2).toLowerCase()===Kn?(a=l.substr(n,2),n+=2):(a=t,c===0&&w(Ia)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=jo():(n=e,e=t)):(n=e,e=t),e}function Jt(){var e,a,o,u;return e=n,l.substr(n,8).toLowerCase()===Xn?(a=l.substr(n,8),n+=8):(a=t,c===0&&w(ga)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Bo():(n=e,e=t)):(n=e,e=t),e}function Zt(){var e,a,o,u;return e=n,l.substr(n,4).toLowerCase()===er?(a=l.substr(n,4),n+=4):(a=t,c===0&&w(ya)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Qo():(n=e,e=t)):(n=e,e=t),e}function hu(){var e,a,o,u;return e=n,l.substr(n,13).toLowerCase()===tr?(a=l.substr(n,13),n+=13):(a=t,c===0&&w(Ta)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Wo():(n=e,e=t)):(n=e,e=t),e}function vu(){var e,a,o,u;return e=n,l.substr(n,15).toLowerCase()===nr?(a=l.substr(n,15),n+=15):(a=t,c===0&&w(Na)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Go():(n=e,e=t)):(n=e,e=t),e}function Vt(){var e,a,o,u;return e=n,l.substr(n,5).toLowerCase()===rr?(a=l.substr(n,5),n+=5):(a=t,c===0&&w(Sa)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Ko():(n=e,e=t)):(n=e,e=t),e}function zt(){var e,a,o,u;return e=n,l.substr(n,3).toLowerCase()===ar?(a=l.substr(n,3),n+=3):(a=t,c===0&&w(Oa)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=Xo():(n=e,e=t)):(n=e,e=t),e}function kt(){var e,a,o,u;return e=n,l.substr(n,4).toLowerCase()===ir?(a=l.substr(n,4),n+=4):(a=t,c===0&&w(xa)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=es():(n=e,e=t)):(n=e,e=t),e}function Ht(){var e,a,o,u;return e=n,l.substr(n,6).toLowerCase()===or?(a=l.substr(n,6),n+=6):(a=t,c===0&&w(Ca)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=ts():(n=e,e=t)):(n=e,e=t),e}function ie(){var e,a,o,u;return e=n,l.substr(n,6).toLowerCase()===sr?(a=l.substr(n,6),n+=6):(a=t,c===0&&w(ba)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=ns():(n=e,e=t)):(n=e,e=t),e}function Te(){var e,a,o,u;return e=n,l.substr(n,4).toLowerCase()===ur?(a=l.substr(n,4),n+=4):(a=t,c===0&&w(Aa)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=rs():(n=e,e=t)):(n=e,e=t),e}function Ne(){var e,a,o,u;return e=n,l.substr(n,3).toLowerCase()===lr?(a=l.substr(n,3),n+=3):(a=t,c===0&&w(Ea)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=as():(n=e,e=t)):(n=e,e=t),e}function qt(){var e,a,o,u;return e=n,l.substr(n,4).toLowerCase()===cr?(a=l.substr(n,4),n+=4):(a=t,c===0&&w(Fa)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=is():(n=e,e=t)):(n=e,e=t),e}function Yt(){var e,a,o,u;return e=n,l.substr(n,4).toLowerCase()===fr?(a=l.substr(n,4),n+=4):(a=t,c===0&&w(Ra)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=os():(n=e,e=t)):(n=e,e=t),e}function wu(){var e,a,o,u;return e=n,l.substr(n,4).toLowerCase()===pr?(a=l.substr(n,4),n+=4):(a=t,c===0&&w(Da)),a!==t?(o=n,c++,u=y(),c--,u===t?o=void 0:(n=o,o=t),o!==t?e=ss():(n=e,e=t)):(n=e,e=t),e}function Se(){var e;return l.charCodeAt(n)===44?(e=dr,n++):(e=t,c===0&&w(Pa)),e}function $(){var e;return l.charCodeAt(n)===40?(e=mr,n++):(e=t,c===0&&w(_a)),e}function L(){var e;return l.charCodeAt(n)===41?(e=hr,n++):(e=t,c===0&&w($a)),e}function d(){var e,a;for(e=[],a=jt();a!==t;)e.push(a),a=jt();return e}function jt(){var e;return Nr.test(l.charAt(n))?(e=l.charAt(n),n++):(e=t,c===0&&w(La)),e}function Iu(){var e,a,o,u;if(e=n,(a=Nt())!==t&&(a=us(a)),(e=a)===t)if(e=n,l.charCodeAt(n)===96?(a=nt,n++):(a=t,c===0&&w(ft)),a!==t){if(o=[],it.test(l.charAt(n))?(u=l.charAt(n),n++):(u=t,c===0&&w(pt)),u!==t)for(;u!==t;)o.push(u),it.test(l.charAt(n))?(u=l.charAt(n),n++):(u=t,c===0&&w(pt));else o=t;o!==t?(l.charCodeAt(n)===96?(u=nt,n++):(u=t,c===0&&w(ft)),u!==t?e=ls(o):(n=e,e=t)):(n=e,e=t)}else n=e,e=t;return e}function gu(e,a){return{type:"unary-expression",operator:e,expr:a}}function Bt(e,a,o,u){var I={type:"binary-expression",operator:e,left:a,right:o};return u!==void 0&&(I.escape=u),I}function yu(e,a){for(var o=[e],u=0;u<a.length;u++)o.push(a[u][3]);return o}function Tu(e,a,o){return yu(e,a)}function ce(e,a){for(var o=e,u=0;u<a.length;u++)o=Bt(a[u][1],o,a[u][3]);return o}if((v=_())!==t&&n===l.length)return v;throw v!==t&&n<l.length&&w(cs()),fs(Pe,W<l.length?l.charAt(W):null,W<l.length?ht(W,W+1):ht(W,W))}return i(r,Error),r.prototype.format=function(l){var h="Error: "+this.message;if(this.location){var v,t=null;for(v=0;v<l.length;v++)if(l[v].source===this.location.source){t=l[v].text.split(/\r\n|\n|\r/g);break}var N=this.location.start,S=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(N):N,_=this.location.source+":"+S.line+":"+S.column;if(t){var U=this.location.end,J=s("",S.line.toString().length," "),O=t[N.line-1],C=(N.line===U.line?U.column:O.length+1)-N.column||1;h+=`
 --> `+_+`
`+J+` |
`+S.line+" | "+O+`
`+J+" | "+s("",N.column-1," ")+s("",C,"^")}else h+=`
 at `+_}return h},r.buildMessage=function(l,h){var v={literal:function(O){return'"'+N(O.text)+'"'},class:function(O){var C=O.parts.map(function(z){return Array.isArray(z)?S(z[0])+"-"+S(z[1]):S(z)});return"["+(O.inverted?"^":"")+C.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(O){return O.description}};function t(O){return O.charCodeAt(0).toString(16).toUpperCase()}function N(O){return O.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(C){return"\\x0"+t(C)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(C){return"\\x"+t(C)})}function S(O){return O.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(C){return"\\x0"+t(C)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(C){return"\\x"+t(C)})}function _(O){return v[O.type](O)}function U(O){var C,z,P=O.map(_);if(P.sort(),P.length>0){for(C=1,z=1;C<P.length;C++)P[C-1]!==P[C]&&(P[z]=P[C],z++);P.length=z}switch(P.length){case 1:return P[0];case 2:return P[0]+" or "+P[1];default:return P.slice(0,-1).join(", ")+", or "+P[P.length-1]}}function J(O){return O?'"'+N(O)+'"':"end of input"}return"Expected "+U(l)+" but "+J(h)+" found."},{SyntaxError:r,parse:f}},(Kt=qe).exports&&(Kt.exports=Xt());var zl=qe.exports;class kl{static parse(r){return zl.parse(r)}}const Hl=new Set(["current_timestamp","current_date","current_time"]);var X;(function(i){i[i.Date=1]="Date",i[i.DateOnly=2]="DateOnly",i[i.TimeOnly=3]="TimeOnly",i[i.TimeStampOffset=4]="TimeStampOffset"})(X||(X={}));class ql{static makeBool(r){return dn(r)}static featureValue(r,s,f,l,h){return vn(r,s,f,l,h)}static equalsNull(r){return r===null}static applyLike(r,s,f){return Be(r,s,f)}static ensureArray(r){return Ye(r)}static applyIn(r,s){return je(r,s)}static currentDate(r){return q.fromNow(r)}static makeSqlInterval(r,s,f){return M.createFromValueAndQualifer(r,s,f)}static convertInterval(r){return r instanceof M?r.valueInMilliseconds():r}static currentTimestamp(r){return Ce(new Date,r)}static compare(r,s,f,l){return H(s,f,r)}static calculate(r,s,f,l){return fn(r,s,f,l)}static evaluateTime(r){return Qe(r)}static evaluateTimestamp(r,s,f){return be(r,s,f)}static evaluateDate(r,s){return un(r,s)}static evaluateFunction(r,s,f){return We(r,s,f)}static lookup(r,s){const f=s[r];return f===void 0?null:f}static between(r,s,f){return r==null||s[0]==null||s[1]==null?null:H(r,s[0],">=")&&H(r,s[1],"<=")}static notbetween(r,s,f){return r==null||s[0]==null||s[1]==null?null:H(r,s[0],"<")||H(r,s[1],">")}static ternaryNot(r){return xe(r)}static ternaryAnd(r,s){return mn(r,s)}static ternaryOr(r,s){return hn(r,s)}}let Yl=class pn{constructor(r,s,f={timeZone:"UTC"}){this.fieldsIndex=s,this._complextypefields={},this.parameters={},this.timeReferenceZone="UTC",this._hasDateFunctions=void 0,this.configureExpressionTimeZone(f),this.parseTree=kl.parse(r);const{isStandardized:l,isAggregate:h,referencedFieldNames:v}=this._extractExpressionInfo(s);this._referencedFieldNames=v,this.isStandardized=l,this.isAggregate=h}configureExpressionTimeZone(r){this.timeReferenceZone=r.timeZone}static convertValueToStorageFormat(r,s=null){if(s===null)return k(r)?r.getTime():b(r)?r.toMillis():E(r)?r.toStorageFormat():R(r)?r.toStorageString():A(r)?r.toStorageFormat():r;switch(s){case"date":return k(r)?r.getTime():b(r)?r.toMillis():E(r)?r.toMilliseconds():A(r)?r.toNumber():r;case"date-only":return k(r)?q.fromDateJS(r).toString():E(r)?q.fromSqlTimeStampOffset(r).toString():b(r)?q.fromDateTime(r).toString():r;case"time-only":return k(r)?Q.fromDateJS(r).toStorageString():b(r)?Q.fromDateTime(r).toStorageString():E(r)?Q.fromSqlTimeStampOffset(r).toStorageString():R(r)?r.toStorageString():r;case"timestamp-offset":if(k(r))return B.fromJSDate(r).toStorageFormat();if(b(r))return B.fromDateTime(r).toStorageFormat();if(E(r))return r.toStorageFormat()}return r}static create(r,s,f={timeZone:"UTC"}){return new pn(r,s,f)}get fieldNames(){return this._referencedFieldNames}testSet(r,s=oe){const f={};for(const l of this.fieldNames)f[l]=r.map(h=>s.getAttribute(h,l));return!!this._evaluateNode(this.parseTree,{attributes:f},oe)}calculateValue(r,s=oe){const f=this._evaluateNode(this.parseTree,r,s);return f instanceof M?f.valueInMilliseconds()/864e5:f}calculateValueCompiled(r,s=oe){return this.parseTree._compiledVersion!=null?this.parseTree._compiledVersion(r,this.parameters,s,this._complextypefields,this.timeReferenceZone):Qt("esri-csp-restrictions")?this.calculateValue(r,s):(this._compileMe(),this.parseTree._compiledVersion(r,this.parameters,s,this._complextypefields,this.timeReferenceZone))}testFeature(r,s=oe){return!!this._evaluateNode(this.parseTree,r,s)}testFeatureCompiled(r,s=oe){return this.parseTree._compiledVersion!=null?!!this.parseTree._compiledVersion(r,this.parameters,s,this._complextypefields,this.timeReferenceZone):Qt("esri-csp-restrictions")?this.testFeature(r,s):(this._compileMe(),!!this.parseTree._compiledVersion(r,this.parameters,s,this._complextypefields,this.timeReferenceZone))}get hasDateFunctions(){return this._hasDateFunctions!=null||(this._hasDateFunctions=!1,this._visitAll(this.parseTree,r=>{r.type==="current-time"?this._hasDateFunctions=!0:r.type==="function"&&(this._hasDateFunctions=this._hasDateFunctions||Hl.has(r.name.toLowerCase()))})),this._hasDateFunctions}getFunctions(){const r=new Set;return this._visitAll(this.parseTree,s=>{s.type==="function"&&r.add(s.name.toLowerCase())}),Array.from(r)}getExpressions(){const r=new Map;return this._visitAll(this.parseTree,s=>{if(s.type==="function"){const f=s.name.toLowerCase(),l=s.args.value[0];if(l.type==="column-reference"){const h=l.column,v=`${f}-${h}`;r.has(v)||r.set(v,{aggregateType:f,field:h})}}}),[...r.values()]}getVariables(){const r=new Set;return this._visitAll(this.parseTree,s=>{s.type==="parameter"&&r.add(s.value.toLowerCase())}),Array.from(r)}_compileMe(){const r="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","complextypefields","timeReferenceZone",r).bind(ql)}_extractExpressionInfo(r){const s=[],f=new Set;let l=!0,h=!0;return this._visitAll(this.parseTree,v=>{switch(v.type){case"column-reference":{const t=r==null?void 0:r.get(v.column);let N,S;t?N=S=t.name??"":(S=v.column,N=S.toLowerCase()),t&&t.name&&(t.type==="date"||t.type==="esriFieldTypeDate")&&(this._complextypefields[t.name]=X.Date),!(t!=null&&t.name)||t.type!=="date-only"&&t.type!=="esriFieldTypeDateOnly"||(this._complextypefields[t.name]=X.DateOnly),t&&t.name&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")&&(this._complextypefields[t.name]=X.TimeOnly),t&&t.name&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")&&(this._complextypefields[t.name]=X.TimeStampOffset),f.has(N)||(f.add(N),s.push(S)),v.column=S;break}case"function":{const{name:t,args:N}=v,S=N.value.length;l&&(l=Hu(t,S)),h&&(h=bu(t,S));break}}}),{referencedFieldNames:Array.from(s),isStandardized:l,isAggregate:h}}_visitAll(r,s){if(r!=null)switch(s(r),r.type){case"when-clause":this._visitAll(r.operand,s),this._visitAll(r.value,s);break;case"case-expression":for(const f of r.clauses)this._visitAll(f,s);r.format==="simple"&&this._visitAll(r.operand,s),r.else!==null&&this._visitAll(r.else,s);break;case"expression-list":for(const f of r.value)this._visitAll(f,s);break;case"unary-expression":this._visitAll(r.expr,s);break;case"binary-expression":this._visitAll(r.left,s),this._visitAll(r.right,s);break;case"function":this._visitAll(r.args,s)}}evaluateNodeToJavaScript(r){switch(r.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(r.value)+", "+JSON.stringify(r.qualifier)+","+JSON.stringify(r.op)+")";case"case-expression":{let s="";if(r.format==="simple"){const f=this.evaluateNodeToJavaScript(r.operand);s="( ";for(let l=0;l<r.clauses.length;l++)s+=" (this.compare('=',"+f+","+this.evaluateNodeToJavaScript(r.clauses[l].operand)+") ? ("+this.evaluateNodeToJavaScript(r.clauses[l].value)+") : ";r.else!==null?s+=this.evaluateNodeToJavaScript(r.else):s+="null",s+=" )"}else{s="( ";for(let f=0;f<r.clauses.length;f++)s+=" this.makeBool("+this.evaluateNodeToJavaScript(r.clauses[f].operand)+")===true ? ("+this.evaluateNodeToJavaScript(r.clauses[f].value)+") : ";r.else!==null?s+=this.evaluateNodeToJavaScript(r.else):s+="null",s+=" )"}return s}case"parameter":return"this.lookup("+JSON.stringify(r.value.toLowerCase())+",lookups)";case"expression-list":{let s="[";for(const f of r.value)s!=="["&&(s+=","),s+=this.evaluateNodeToJavaScript(f);return s+="]",s}case"unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(r.expr)+")";case"binary-expression":switch(r.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(r.left)+","+this.evaluateNodeToJavaScript(r.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(r.left)+","+this.evaluateNodeToJavaScript(r.right)+" )";case"IS":if(r.right.type!=="null")throw new m(p.UnsupportedIsRhs);return"this.equalsNull("+this.evaluateNodeToJavaScript(r.left)+")";case"ISNOT":if(r.right.type!=="null")throw new m(p.UnsupportedIsRhs);return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(r.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(r.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(r.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(r.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(r.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(r.left)+","+this.evaluateNodeToJavaScript(r.right)+", timeReferenceZone)";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(r.left)+","+this.evaluateNodeToJavaScript(r.right)+", timeReferenceZone)";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(r.left)+","+this.evaluateNodeToJavaScript(r.right)+","+JSON.stringify(r.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(r.left)+","+this.evaluateNodeToJavaScript(r.right)+","+JSON.stringify(r.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(r.operator)+","+this.evaluateNodeToJavaScript(r.left)+","+this.evaluateNodeToJavaScript(r.right)+", timeReferenceZone)";case"*":case"-":case"+":case"/":case"||":return"this.calculate("+JSON.stringify(r.operator)+","+this.evaluateNodeToJavaScript(r.left)+","+this.evaluateNodeToJavaScript(r.right)+", timeReferenceZone)"}throw new m(p.UnsupportedOperator,{operator:r.operator});case"null":case"boolean":case"string":case"number":return JSON.stringify(r.value);case"time":return"this.evaluateTime(JSON.stringify(node.value))";case"date":return"this.evaluateDate(JSON.stringify(node.value), timeReferenceZone)";case"timestamp":return"this.evaluateTimestamp(JSON.stringify(node.value), timeReferenceZone)";case"current-time":return r.mode==="date"?"this.currentDate(timeReferenceZone)":"this.currentTimestamp(timeReferenceZone)";case"column-reference":return"this.featureValue(feature,"+JSON.stringify(r.column)+",complextypefields,attributeAdapter, timeReferenceZone)";case"function":return"this.evaluateFunction("+JSON.stringify(r.name)+","+this.evaluateNodeToJavaScript(r.args)+", timeReferenceZone)"}throw new m(p.UnsupportedSyntax,{node:r.type})}_evaluateNode(r,s,f){let l;switch(r.type){case"interval":{const h=this._evaluateNode(r.value,s,f);return M.createFromValueAndQualifer(h,r.qualifier,r.op)}case"case-expression":if(r.format==="simple"){const h=this._evaluateNode(r.operand,s,f);for(let v=0;v<r.clauses.length;v++)if(H(h,this._evaluateNode(r.clauses[v].operand,s,f),"=",this.timeReferenceZone))return this._evaluateNode(r.clauses[v].value,s,f);if(r.else!==null)return this._evaluateNode(r.else,s,f)}else{for(let h=0;h<r.clauses.length;h++)if(dn(this._evaluateNode(r.clauses[h].operand,s,f)))return this._evaluateNode(r.clauses[h].value,s,f);if(r.else!==null)return this._evaluateNode(r.else,s,f)}return null;case"parameter":return l=this.parameters[r.value.toLowerCase()],k(l)?ee.fromJSDate(l):l instanceof Nu?l.toDateTime():l;case"expression-list":{const h=[];for(const v of r.value)h.push(this._evaluateNode(v,s,f));return h}case"unary-expression":return xe(this._evaluateNode(r.expr,s,f));case"binary-expression":switch(r.operator){case"AND":return mn(this._evaluateNode(r.left,s,f),this._evaluateNode(r.right,s,f));case"OR":return hn(this._evaluateNode(r.left,s,f),this._evaluateNode(r.right,s,f));case"IS":if(r.right.type!=="null")throw new m(p.UnsupportedIsRhs);return this._evaluateNode(r.left,s,f)===null;case"ISNOT":if(r.right.type!=="null")throw new m(p.UnsupportedIsRhs);return this._evaluateNode(r.left,s,f)!==null;case"IN":{const h=Ye(this._evaluateNode(r.right,s,f));return je(this._evaluateNode(r.left,s,f),h)}case"NOT IN":{const h=Ye(this._evaluateNode(r.right,s,f));return xe(je(this._evaluateNode(r.left,s,f),h))}case"BETWEEN":{const h=this._evaluateNode(r.left,s,f),v=this._evaluateNode(r.right,s,f);return h==null||v[0]==null||v[1]==null?null:H(h,v[0],">=",this.timeReferenceZone)&&H(h,v[1],"<=",this.timeReferenceZone)}case"NOTBETWEEN":{const h=this._evaluateNode(r.left,s,f),v=this._evaluateNode(r.right,s,f);return h==null||v[0]==null||v[1]==null?null:H(h,v[0],"<",this.timeReferenceZone)||H(h,v[1],">",this.timeReferenceZone)}case"LIKE":return Be(this._evaluateNode(r.left,s,f),this._evaluateNode(r.right,s,f),r.escape);case"NOT LIKE":return xe(Be(this._evaluateNode(r.left,s,f),this._evaluateNode(r.right,s,f),r.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return H(this._evaluateNode(r.left,s,f),this._evaluateNode(r.right,s,f),r.operator,this.timeReferenceZone);case"-":case"+":case"*":case"/":case"||":return fn(r.operator,this._evaluateNode(r.left,s,f),this._evaluateNode(r.right,s,f),this.timeReferenceZone)}case"null":case"boolean":case"string":case"number":return r.value;case"date":return un(r.value,this.timeReferenceZone);case"timestamp":return be(r.value,this.timeReferenceZone);case"time":return Qe(r.value);case"current-time":return r.mode==="date"?q.fromNow(this.timeReferenceZone):Ce(new Date,this.timeReferenceZone);case"column-reference":return vn(s,r.column,this._complextypefields,f,this.timeReferenceZone);case"data-type":return r.value;case"function":{const h=this._evaluateNode(r.args,s,f);return this.isAggregate?Cu(r.name,h):We(r.name,h,this.timeReferenceZone)}}throw new m(p.UnsupportedSyntax,{node:r.type})}};function dn(i){return i===!0}function Ye(i){return Array.isArray(i)?i:[i]}function xe(i){return i!==null?i!==!0:null}function mn(i,r){return i!=null&&r!=null?i===!0&&r===!0:i!==!1&&r!==!1&&null}function hn(i,r){return i!=null&&r!=null?i===!0||r===!0:i===!0||r===!0||null}function je(i,r){if(i==null)return null;let s=!1;for(const f of r)if(f==null)s=null;else if(i===f){s=!0;break}return s}const en="-[]/{}()*+?.\\^$|";var se;function jl(i,r){const s=r;let f="",l=se.Normal;for(let h=0;h<i.length;h++){const v=i.charAt(h);switch(l){case se.Normal:v===s?l=se.Escaped:en.includes(v)?f+="\\"+v:f+=v==="%"?".*":v==="_"?".":v;break;case se.Escaped:en.includes(v)?f+="\\"+v:f+=v,l=se.Normal}}return new RegExp("^"+f+"$","m")}function Be(i,r,s){return i==null?null:jl(r,s).test(i)}function Bl(i){return i&&typeof i.attributes=="object"}function vn(i,r,s,f,l){const h=f.getAttribute(i,r);return h!=null&&s[r]===X.Date?Ce(new Date(h),l):h!=null&&s[r]===X.DateOnly?q.fromReader(h):h!=null&&s[r]===X.TimeOnly?Q.fromReader(h):h!=null&&s[r]===X.TimeStampOffset?new B(h):h}(function(i){i[i.Normal=0]="Normal",i[i.Escaped=1]="Escaped"})(se||(se={}));const oe={getAttribute:(i,r)=>(Bl(i)?i.attributes:i)[r]},Kl=Object.freeze(Object.defineProperty({__proto__:null,WhereClause:Yl,defaultAttributeAdapter:oe},Symbol.toStringTag,{value:"Module"}));export{Kl as W,Y as a,m as n,B as r,Gl as s,p as t,Yl as x};
