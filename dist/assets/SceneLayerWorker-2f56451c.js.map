{"version":3,"mappings":"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","names":["n","e","t","__vitePreload","i","o","r","a","d","c","l","w","x","j","u","s","_a","f","m","L","y","E","p","b","h","g","I","S","A","_","M","N","P","U","T"],"sources":["../../node_modules/@arcgis/core/libs/i3s/enums.js","../../node_modules/@arcgis/core/libs/i3s/I3SModule.js","../../node_modules/@arcgis/core/views/3d/layers/i3s/I3SNode.js","../../node_modules/@arcgis/core/views/3d/layers/SceneLayerWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nvar n,e;!function(n){n[n.None=0]=\"None\",n[n.Int16=1]=\"Int16\",n[n.Int32=2]=\"Int32\"}(n||(n={})),function(n){n[n.Replace=0]=\"Replace\",n[n.Outside=1]=\"Outside\",n[n.Inside=2]=\"Inside\",n[n.Finished=3]=\"Finished\"}(e||(e={}));export{n as IndexType,e as ModificationType};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{getAssetUrl as t}from\"../../assets.js\";function e(){return n||(n=new Promise((t=>import(\"../../chunks/i3s.js\").then((t=>t.i)).then((({default:e})=>{const n=e({locateFile:i,onRuntimeInitialized:()=>t(n)});delete n.then})))).catch((t=>{throw t}))),n}function i(e){return t(`esri/libs/i3s/${e}`)}let n;export{e as get};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{fromValues as e}from\"../../../../core/libs/gl-matrix-2/factories/vec4f64.js\";import{f as i}from\"../../../../chunks/sphere.js\";import{invalidateMbs as n}from\"./I3SUtil.js\";import{ElevationRange as t}from\"../../support/ElevationRange.js\";class s extends t{constructor(e,n){super(NaN,NaN),this.id=e,this.serviceMbsInIndexSR=n,this.serviceMbsInRenderSR=i(0,0,0,-1)}invalidateServiceBVsInRenderSR(){n(this.serviceMbsInRenderSR),this.serviceObbInRenderSR?.invalidate()}shareServiceBVsInRenderSRWith(e){this.serviceObbInRenderSR=e.serviceObbInRenderSR,this.serviceMbsInRenderSR=e.serviceMbsInRenderSR}}var o,r,a,d,c;!function(e){e[e.Unmodified=0]=\"Unmodified\",e[e.Culled=1]=\"Culled\",e[e.NotChecked=2]=\"NotChecked\"}(o||(o={})),function(e){e[e.Unmodified=0]=\"Unmodified\",e[e.PotentiallyModified=1]=\"PotentiallyModified\",e[e.Culled=2]=\"Culled\",e[e.Unknown=3]=\"Unknown\",e[e.NotChecked=4]=\"NotChecked\"}(r||(r={}));class h extends s{constructor(i,n,t,s,o,d,c,h,l,u){super(i,t),this.index=n,this.childCount=s,this.level=o,this.resources=d,this.version=c,this.lodMetric=h,this.maxError=l,this.numFeatures=u,this.failed=!1,this.cacheState=a.Unknown,this.vertexCount=0,this.memory=0,this.childrenLoaded=0,this.hasModifications=!1,this.imModificationImpact=r.NotChecked,this.elevationAgnosticBoundingVolume=e(0,0,0,-1)}invalidateServiceBVsInRenderSR(){super.invalidateServiceBVsInRenderSR(),this.elevationAgnosticBoundingVolume[3]=-1}}!function(e){e[e.Unknown=0]=\"Unknown\",e[e.Uncached=1]=\"Uncached\",e[e.Cached=2]=\"Cached\"}(a||(a={})),function(e){e[e.None=0]=\"None\",e[e.MaxScreenThreshold=1]=\"MaxScreenThreshold\",e[e.ScreenSpaceRelative=2]=\"ScreenSpaceRelative\",e[e.RemovedFeatureDiameter=3]=\"RemovedFeatureDiameter\",e[e.DistanceRangeFromDefaultCamera=4]=\"DistanceRangeFromDefaultCamera\"}(d||(d={})),function(e){e[e.Hole=0]=\"Hole\",e[e.Leaf=1]=\"Leaf\"}(c||(c={}));class l{constructor(e,i,n,t){this.nodeHasLOD=e,this.isChosen=i,this.lodLevel=n,this.version=t}}export{a as CacheState,d as LodMetric,h as Node,s as NodeBase,o as NodeFilterImpact,r as NodeIMModificationImpact,c as NodeState,l as NodeTraversalState};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{hasScaling as e}from\"../../../core/mathUtils.js\";import r from\"../../../geometry/SpatialReference.js\";import{toFloat64Array as t}from\"../../../geometry/support/DoubleArray.js\";import o from\"../../../geometry/support/MeshGeoreferencedVertexSpace.js\";import n from\"../../../geometry/support/MeshLocalVertexSpace.js\";import{t as s,n as i}from\"../../../chunks/vec3.js\";import{IndexType as a}from\"../../../libs/i3s/enums.js\";import{get as f}from\"../../../libs/i3s/I3SModule.js\";import{NodeIMModificationImpact as c}from\"./i3s/I3SNode.js\";async function l(e){w=await x();const r=[e.geometryBuffer];return{result:j(w,e,r),transferList:r}}async function u(e){w=await x();const r=[e.geometryBuffer],{geometryBuffer:t}=e,o=t.byteLength,n=w._malloc(o),s=new Uint8Array(w.HEAPU8.buffer,n,o);s.set(new Uint8Array(t));const i=w.dracoDecompressPointCloudData(n,s.byteLength);if(w._free(n),i.error.length>0)throw new Error(`i3s.wasm: ${i.error}`);const a=i.featureIds?.length>0?i.featureIds.slice():null,f=i.positions.slice();return a&&r.push(a.buffer),r.push(f.buffer),{result:{positions:f,featureIds:a},transferList:r}}async function m(e){await x(),L(e);const r={buffer:e.buffer};return{result:r,transferList:[r.buffer]}}async function y(e){await x(),E(e)}async function p(e){w=await x(),w.setLegacySchema(e.context,e.jsonSchema)}async function d(e){const{localMatrix:s,origin:i,positions:a,vertexSpace:f,localMode:c}=e,l=r.fromJSON(e.inSpatialReference),u=r.fromJSON(e.outSpatialReference);let m;const[{projectBuffer:y},{initializeProjection:p}]=await Promise.all([import(\"../../../geometry/projection/projectBuffer.js\"),import(\"../../../geometry/projection.js\")]);await p(l,u);const d=[0,0,0];if(!y(i,l,0,d,u,0,1))throw new Error(\"Failed to project\");if(\"georeferenced\"===f.type&&null==f.origin){if(m=new Float64Array(a.length),!y(a,l,0,m,u,0,m.length/3))throw new Error(\"Failed to project\")}else{const e=\"georeferenced\"===f.type?o.fromJSON(f):n.fromJSON(f),{project:r}=await import(\"../../../geometry/support/meshUtils/projection.js\"),i=r({positions:a,transform:s?{localMatrix:s}:void 0,vertexSpace:e,inSpatialReference:l,outSpatialReference:u,localMode:c});if(!i)throw new Error(\"Failed to project\");m=t(i)}const b=m.length,[h,g,w]=d;for(let r=0;r<b;r+=3)m[r]-=h,m[r+1]-=g,m[r+2]-=w;return{result:{projected:m,original:a,projectedOrigin:d},transferList:[m.buffer,a.buffer]}}async function b({normalMatrix:r,normals:t}){const o=new Float32Array(t.length);return s(o,t,r),e(r)&&i(o,o),{result:{transformed:o,original:t},transferList:[o.buffer,t.buffer]}}function h(e){I(e)}let g,w;function E(e){if(!w)return;const r=e.modifications,t=w._malloc(8*r.length),o=new Float64Array(w.HEAPU8.buffer,t,r.length);for(let n=0;n<r.length;++n)o[n]=r[n];w.setModifications(e.context,t,r.length,e.isGeodetic),w._free(t)}function j(e,r,t){const{context:o,globalTrafo:n,mbs:s,obbData:i,elevationOffset:f,geometryBuffer:c,geometryDescriptor:l,indexToVertexProjector:u,vertexToRenderProjector:m}=r,y=e._malloc(c.byteLength),p=33,d=e._malloc(p*Float64Array.BYTES_PER_ELEMENT),b=new Uint8Array(e.HEAPU8.buffer,y,c.byteLength);b.set(new Uint8Array(c));const h=new Float64Array(e.HEAPU8.buffer,d,p);S(h,[NaN,NaN,NaN]);let g=h.byteOffset+3*h.BYTES_PER_ELEMENT,w=new Float64Array(h.buffer,g);S(w,n),g+=16*h.BYTES_PER_ELEMENT,w=new Float64Array(h.buffer,g),S(w,s),g+=4*h.BYTES_PER_ELEMENT,i&&(w=new Float64Array(h.buffer,g),S(w,i));const E=l,j={isDraco:!1,isLegacy:!1,color:r.layouts.some((e=>e.some((e=>\"color\"===e.name)))),normal:r.needNormals&&r.layouts.some((e=>e.some((e=>\"normalCompressed\"===e.name)))),uv0:r.layouts.some((e=>e.some((e=>\"uv0\"===e.name)))),uvRegion:r.layouts.some((e=>e.some((e=>\"uvRegion\"===e.name)))),featureIndex:E.featureIndex},A=e.process(o,!!r.obbData,y,b.byteLength,E,j,d,f,u,m,r.normalReferenceFrame);if(e._free(d),e._free(y),A.error.length>0)throw new Error(`i3s.wasm: ${A.error}`);if(A.discarded)return null;const L=A.componentOffsets.length>0?A.componentOffsets.slice():null,I=A.featureIds.length>0?A.featureIds.slice():null,_=A.anchorIds.length>0?Array.from(A.anchorIds):null,x=A.anchors.length>0?Array.from(A.anchors):null,M=A.interleavedVertedData.slice().buffer,N=A.indicesType===a.Int16?new Uint16Array(A.indices.buffer,A.indices.byteOffset,A.indices.byteLength/2).slice():new Uint32Array(A.indices.buffer,A.indices.byteOffset,A.indices.byteLength/4).slice(),P=A.positions.slice(),U=A.positionIndicesType===a.Int16?new Uint16Array(A.positionIndices.buffer,A.positionIndices.byteOffset,A.positionIndices.byteLength/2).slice():new Uint32Array(A.positionIndices.buffer,A.positionIndices.byteOffset,A.positionIndices.byteLength/4).slice(),T={layout:r.layouts[0],interleavedVertexData:M,indices:N,hasColors:A.hasColors,hasModifications:A.hasModifications,positionData:{data:P,indices:U}};return I&&t.push(I.buffer),L&&t.push(L.buffer),t.push(M),t.push(N.buffer),t.push(P.buffer),t.push(U.buffer),{componentOffsets:L,featureIds:I,anchorIds:_,anchors:x,transformedGeometry:T,obb:A.obb,globalTrafo:n}}function A(e){return 0===e?c.Unmodified:1===e?c.PotentiallyModified:2===e?c.Culled:c.Unknown}function L(e){if(!w)return;const{context:r,buffer:t}=e,o=w._malloc(t.byteLength),n=t.byteLength/Float64Array.BYTES_PER_ELEMENT,s=new Float64Array(w.HEAPU8.buffer,o,n),i=new Float64Array(t);s.set(i),w.filterOBBs(r,o,n),i.set(s),w._free(o)}function I(e){w&&0===w.destroy(e)&&(w=null)}function S(e,r){for(let t=0;t<r.length;++t)e[t]=r[t]}async function _(){w||await x()}function x(){return w?Promise.resolve(w):(g||(g=f().then((e=>(w=e,g=null,w)))),g)}const M={transform:(e,r)=>w&&j(w,e,r),destroy:I};export{h as destroyContext,u as dracoDecompressPointCloudData,m as filterObbsForModifications,L as filterObbsForModificationsSync,_ as initialize,A as interpretObbModificationResults,l as process,d as project,p as setLegacySchema,y as setModifications,E as setModificationsSync,M as test,b as transformNormals};\n"],"file":"assets/SceneLayerWorker-2f56451c.js"}