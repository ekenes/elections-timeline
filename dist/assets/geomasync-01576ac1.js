import{a0 as u,i as h,F as V,v as H,w as K,g as q,a as i,r as s,U as v,X as g,A as J,K as M,G as w,af as G,ag as T,ah as B,h as R,S as cn,ai as fn,aj as un,E as W,ak as dn,N,B as S,al as wn,am as hn,P as Q,an as mn,ao as Z}from"./arcadeUtils-416eab65.js";import{c as P,r as C,b as y}from"./TimeOnly-2246638c.js";import{l as X}from"./portalUtils-ea787ca8.js";import{bB as yn,Y,fb as d,R as U,Q as I,aV as x,bC as j,bD as _,cv as O,b as $,aj as pn}from"./index-b8632133.js";import{disjoint as vn,intersects as gn,touches as Pn,crosses as In,within as An,contains as Fn,overlaps as Rn,equals as bn,relate as Nn,intersect as Sn,union as xn,difference as jn,symmetricDifference as Dn,clip as Ln,cut as Tn,planarArea as nn,geodesicArea as en,planarLength as E,geodesicLength as z,distance as Cn,densify as tn,geodesicDensify as rn,generalize as Un,buffer as Jn,geodesicBuffer as Mn,offset as Zn,rotate as an,simplify as sn,isSimple as En,convexHull as kn,nearestCoordinate as qn,nearestVertex as Bn}from"./geometryEngineAsync-aa79a09d.js";import"./ImmutableArray-d5cad66d.js";import"./number-5b0564e4.js";import"./featureConversionUtils-0d61f1ce.js";async function ln(a,e,t){var r,l;if(!((r=yn)==null?void 0:r.findCredential(a.restUrl)))return null;if(a.loadStatus==="loaded"&&e===""&&((l=a.user)!=null&&l.sourceJSON)&&t===!1)return a.user.sourceJSON;const f={responseType:"json",query:{f:"json"}};if(t&&(f.query.returnUserLicenseTypeExtensions=!0),e===""){const c=await Y(a.restUrl+"/community/self",f);if(c.data){const m=c.data;if(m!=null&&m.username)return m}return null}const n=await Y(a.restUrl+"/community/users/"+e,f);if(n.data){const c=n.data;return c.error?null:c}return null}function A(a,e,t){if(h(a,2,2,e,t),!(a[0]instanceof d&&a[1]instanceof d)){if(!(a[0]instanceof d&&a[1]===null)){if(!(a[1]instanceof d&&a[0]===null)){if(a[0]!==null||a[1]!==null)throw new i(e,s.InvalidParameter,t)}}}}async function on(a,e){if(a.type!=="polygon"&&a.type!=="polyline"&&a.type!=="extent")return 0;let t=1;(a.spatialReference.vcsWkid||a.spatialReference.latestVcsWkid)&&(t=mn(a.spatialReference)/pn(a.spatialReference));let o=0;if(a.type==="polyline")for(const n of a.paths)for(let r=1;r<n.length;r++)o+=Z(n[r],n[r-1],t);else if(a.type==="polygon")for(const n of a.rings){for(let r=1;r<n.length;r++)o+=Z(n[r],n[r-1],t);(n[0][0]!==n[n.length-1][0]||n[0][1]!==n[n.length-1][1]||n[0][2]!==void 0&&n[0][2]!==n[n.length-1][2])&&(o+=Z(n[0],n[n.length-1],t))}else a.type==="extent"&&(o+=2*Z([a.xmin,a.ymin,0],[a.xmax,a.ymin,0],t),o+=2*Z([a.xmin,a.ymin,0],[a.xmin,a.ymax,0],t),o*=2,o+=4*Math.abs(w(a.zmax,0)*t-w(a.zmin,0)*t));const f=new I({hasZ:!1,hasM:!1,spatialReference:a.spatialReference,paths:[[[0,0],[0,o]]]});return E(f,e)}function Yn(a){a.mode==="async"&&(a.functions.disjoint=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>(A(n=u(n),e,t),n[0]===null||n[1]===null||vn(n[0],n[1])))},a.functions.intersects=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>(A(n=u(n),e,t),n[0]!==null&&n[1]!==null&&gn(n[0],n[1])))},a.functions.touches=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>(A(n=u(n),e,t),n[0]!==null&&n[1]!==null&&Pn(n[0],n[1])))},a.functions.crosses=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>(A(n=u(n),e,t),n[0]!==null&&n[1]!==null&&In(n[0],n[1])))},a.functions.within=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>(A(n=u(n),e,t),n[0]!==null&&n[1]!==null&&An(n[0],n[1])))},a.functions.contains=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>(A(n=u(n),e,t),n[0]!==null&&n[1]!==null&&Fn(n[0],n[1])))},a.functions.overlaps=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>(A(n=u(n),e,t),n[0]!==null&&n[1]!==null&&Rn(n[0],n[1])))},a.functions.equals=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>(h(n,2,2,e,t),n[0]===n[1]||(n[0]instanceof d&&n[1]instanceof d?bn(n[0],n[1]):(V(n[0])&&V(n[1])||!!(H(n[0])&&H(n[1])||K(n[0])&&K(n[1])))&&n[0].equals(n[1]))))},a.functions.relate=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{if(n=u(n),h(n,3,3,e,t),n[0]instanceof d&&n[1]instanceof d)return Nn(n[0],n[1],q(n[2]));if(n[0]instanceof d&&n[1]===null||n[1]instanceof d&&n[0]===null||n[0]===null&&n[1]===null)return!1;throw new i(e,s.InvalidParameter,t)})},a.functions.intersection=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>(A(n=u(n),e,t),n[0]===null||n[1]===null?null:Sn(n[0],n[1])))},a.functions.union=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{const r=[];if((n=u(n)).length===0)throw new i(e,s.WrongNumberOfParameters,t);if(n.length===1)if(v(n[0])){const l=u(n[0]);for(let c=0;c<l.length;c++)if(l[c]!==null){if(!(l[c]instanceof d))throw new i(e,s.InvalidParameter,t);r.push(l[c])}}else{if(!g(n[0])){if(n[0]instanceof d)return J(P(n[0]),e.spatialReference);if(n[0]===null)return null;throw new i(e,s.InvalidParameter,t)}{const l=u(n[0].toArray());for(let c=0;c<l.length;c++)if(l[c]!==null){if(!(l[c]instanceof d))throw new i(e,s.InvalidParameter,t);r.push(l[c])}}}else for(let l=0;l<n.length;l++)if(n[l]!==null){if(!(n[l]instanceof d))throw new i(e,s.InvalidParameter,t);r.push(n[l])}return r.length===0?null:xn(r)})},a.functions.difference=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>(A(n=u(n),e,t),n[0]===null?null:n[1]===null?P(n[0]):jn(n[0],n[1])))},a.functions.symmetricdifference=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>(A(n=u(n),e,t),n[0]===null&&n[1]===null?null:n[0]===null?P(n[1]):n[1]===null?P(n[0]):Dn(n[0],n[1])))},a.functions.clip=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{if(n=u(n),h(n,2,2,e,t),!(n[1]instanceof U)&&n[1]!==null)throw new i(e,s.InvalidParameter,t);if(n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return n[1]===null?null:Ln(n[0],n[1])})},a.functions.cut=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{if(n=u(n),h(n,2,2,e,t),!(n[1]instanceof I)&&n[1]!==null)throw new i(e,s.InvalidParameter,t);if(n[0]===null)return[];if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return n[1]===null?[P(n[0])]:Tn(n[0],n[1])})},a.functions.area=function(e,t){return a.standardFunctionAsync(e,t,async(o,f,n)=>{if(h(n,1,2,e,t),(n=u(n))[0]===null)return 0;if(M(n[0])){const r=await n[0].sumArea(C(w(n[1],-1)),!1,e.abortSignal);if(e.abortSignal.aborted)throw new i(e,s.Cancelled,t);return r}if(v(n[0])||g(n[0])){const r=G(n[0],e.spatialReference);return r===null?0:nn(r,C(w(n[1],-1)))}if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return nn(n[0],C(w(n[1],-1)))})},a.functions.areageodetic=function(e,t){return a.standardFunctionAsync(e,t,async(o,f,n)=>{if(h(n,1,2,e,t),(n=u(n))[0]===null)return 0;if(M(n[0])){const r=await n[0].sumArea(C(w(n[1],-1)),!0,e.abortSignal);if(e.abortSignal.aborted)throw new i(e,s.Cancelled,t);return r}if(v(n[0])||g(n[0])){const r=G(n[0],e.spatialReference);return r===null?0:en(r,C(w(n[1],-1)))}if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return en(n[0],C(w(n[1],-1)))})},a.functions.length=function(e,t){return a.standardFunctionAsync(e,t,async(o,f,n)=>{if(h(n,1,2,e,t),(n=u(n))[0]===null)return 0;if(M(n[0])){const r=await n[0].sumLength(y(w(n[1],-1)),!1,e.abortSignal);if(e.abortSignal.aborted)throw new i(e,s.Cancelled,t);return r}if(v(n[0])||g(n[0])){const r=T(n[0],e.spatialReference);return r===null?0:E(r,y(w(n[1],-1)))}if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return E(n[0],y(w(n[1],-1)))})},a.functions.length3d=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{if(h(n,1,2,e,t),(n=u(n))[0]===null)return 0;if(v(n[0])||g(n[0])){const r=T(n[0],e.spatialReference);return r===null?0:r.hasZ===!0?on(r,y(w(n[1],-1))):E(r,y(w(n[1],-1)))}if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return n[0].hasZ===!0?on(n[0],y(w(n[1],-1))):E(n[0],y(w(n[1],-1)))})},a.functions.lengthgeodetic=function(e,t){return a.standardFunctionAsync(e,t,async(o,f,n)=>{if(h(n,1,2,e,t),(n=u(n))[0]===null)return 0;if(M(n[0])){const r=await n[0].sumLength(y(w(n[1],-1)),!0,e.abortSignal);if(e.abortSignal.aborted)throw new i(e,s.Cancelled,t);return r}if(v(n[0])||g(n[0])){const r=T(n[0],e.spatialReference);return r===null?0:z(r,y(w(n[1],-1)))}if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return z(n[0],y(w(n[1],-1)))})},a.functions.distance=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{n=u(n),h(n,2,3,e,t);let r=n[0];(v(n[0])||g(n[0]))&&(r=B(n[0],e.spatialReference));let l=n[1];if((v(n[1])||g(n[1]))&&(l=B(n[1],e.spatialReference)),!(r instanceof d))throw new i(e,s.InvalidParameter,t);if(!(l instanceof d))throw new i(e,s.InvalidParameter,t);return Cn(r,l,y(w(n[2],-1)))})},a.functions.distancegeodetic=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{n=u(n),h(n,2,3,e,t);const r=n[0],l=n[1];if(!(r instanceof x))throw new i(e,s.InvalidParameter,t);if(!(l instanceof x))throw new i(e,s.InvalidParameter,t);const c=new I({paths:[],spatialReference:r.spatialReference});return c.addPath([r,l]),z(c,y(w(n[2],-1)))})},a.functions.densify=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{if(n=u(n),h(n,2,3,e,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);const r=R(n[1]);if(isNaN(r))throw new i(e,s.InvalidParameter,t);if(r<=0)throw new i(e,s.InvalidParameter,t);return n[0]instanceof j||n[0]instanceof I?tn(n[0],r,y(w(n[2],-1))):n[0]instanceof U?tn(j.fromExtent(n[0]),r,y(w(n[2],-1))):n[0]})},a.functions.densifygeodetic=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{if(n=u(n),h(n,2,3,e,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);const r=R(n[1]);if(isNaN(r))throw new i(e,s.InvalidParameter,t);if(r<=0)throw new i(e,s.InvalidParameter,t);return n[0]instanceof j||n[0]instanceof I?rn(n[0],r,y(w(n[2],-1))):n[0]instanceof U?rn(j.fromExtent(n[0]),r,y(w(n[2],-1))):n[0]})},a.functions.generalize=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{if(n=u(n),h(n,2,4,e,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);const r=R(n[1]);if(isNaN(r))throw new i(e,s.InvalidParameter,t);return Un(n[0],r,cn(w(n[2],!0)),y(w(n[3],-1)))})},a.functions.buffer=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{if(n=u(n),h(n,2,3,e,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);const r=R(n[1]);if(isNaN(r))throw new i(e,s.InvalidParameter,t);return r===0?P(n[0]):Jn(n[0],r,y(w(n[2],-1)))})},a.functions.buffergeodetic=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{if(n=u(n),h(n,2,3,e,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);const r=R(n[1]);if(isNaN(r))throw new i(e,s.InvalidParameter,t);return r===0?P(n[0]):Mn(n[0],r,y(w(n[2],-1)))})},a.functions.offset=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{if(n=u(n),h(n,2,6,e,t),n[0]===null)return null;if(!(n[0]instanceof j||n[0]instanceof I))throw new i(e,s.InvalidParameter,t);const r=R(n[1]);if(isNaN(r))throw new i(e,s.InvalidParameter,t);const l=R(w(n[4],10));if(isNaN(l))throw new i(e,s.InvalidParameter,t);const c=R(w(n[5],0));if(isNaN(c))throw new i(e,s.InvalidParameter,t);return Zn(n[0],r,y(w(n[2],-1)),q(w(n[3],"round")).toLowerCase(),l,c)})},a.functions.rotate=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{if(n=u(n),h(n,2,3,e,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);const r=n[0]instanceof U?j.fromExtent(n[0]):n[0],l=R(n[1]);if(isNaN(l))throw new i(e,s.InvalidParameter,t);const c=w(n[2],null);if(c===null)return an(r,l);if(c instanceof x)return an(r,l,c);throw new i(e,s.InvalidParameter,t)})},a.functions.centroid=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{if(n=u(n),h(n,1,1,e,t),n[0]===null)return null;let r=n[0];if((v(n[0])||g(n[0]))&&(r=B(n[0],e.spatialReference)),r===null)return null;if(!(r instanceof d))throw new i(e,s.InvalidParameter,t);return r instanceof x?J(P(r),e.spatialReference):r instanceof j?r.centroid:r instanceof I?fn(r):r instanceof _?un(r):r instanceof U?r.center:null})},a.functions.measuretocoordinate=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{if(n=u(n),h(n,2,2,e,t),n[0]===null)return null;let r=n[0];if((v(n[0])||g(n[0]))&&(r=T(n[0],e.spatialReference)),r===null)return null;if(!(r instanceof d))throw new i(e,s.InvalidParameter,t);if(!(r instanceof I))throw new i(e,s.InvalidParameter,t);if(W(n[1]===!1))throw new i(e,s.InvalidParameter,t);const l=dn(r,n[1]);return l?N.convertObjectToArcadeDictionary(l,S(e),!1,!0):null})},a.functions.pointtocoordinate=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{if(n=u(n),h(n,2,2,e,t),n[0]===null)return null;let r=n[0];if((v(n[0])||g(n[0]))&&(r=T(n[0],e.spatialReference)),r===null)return null;if(!(r instanceof d))throw new i(e,s.InvalidParameter,t);if(!(r instanceof I))throw new i(e,s.InvalidParameter,t);const l=n[1];if(l===null)return null;if(!(l instanceof x))throw new i(e,s.InvalidParameter,t);if(W(n[1]===!1))throw new i(e,s.InvalidParameter,t);const c=wn(r,l);return c?N.convertObjectToArcadeDictionary(c,S(e),!1,!0):null})},a.functions.distancetocoordinate=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{if(n=u(n),h(n,2,2,e,t),n[0]===null)return null;let r=n[0];if((v(n[0])||g(n[0]))&&(r=T(n[0],e.spatialReference)),r===null)return null;if(!(r instanceof d))throw new i(e,s.InvalidParameter,t);if(!(r instanceof I))throw new i(e,s.InvalidParameter,t);if(W(n[1]===!1))throw new i(e,s.InvalidParameter,t);const l=hn(r,n[1]);return l?N.convertObjectToArcadeDictionary(l,S(e),!1,!0):null})},a.functions.multiparttosinglepart=function(e,t){return a.standardFunctionAsync(e,t,async(o,f,n)=>{if(n=u(n),h(n,1,1,e,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);if(n[0]instanceof x)return[J(P(n[0]),e.spatialReference)];if(n[0]instanceof U)return[J(P(n[0]),e.spatialReference)];const r=await sn(n[0]);if(r instanceof j){const l=[],c=[];for(let m=0;m<r.rings.length;m++)if(r.isClockwise(r.rings[m])){const F=O({rings:[r.rings[m]],hasZ:r.hasZ===!0,hasM:r.hasM===!0,spatialReference:r.spatialReference.toJSON()});l.push(F)}else c.push({ring:r.rings[m],pt:r.getPoint(m,0)});for(let m=0;m<c.length;m++)for(let F=0;F<l.length;F++)if(l[F].contains(c[m].pt)){l[F].addRing(c[m].ring);break}return l}if(r instanceof I){const l=[];for(let c=0;c<r.paths.length;c++){const m=O({paths:[r.paths[c]],hasZ:r.hasZ===!0,hasM:r.hasM===!0,spatialReference:r.spatialReference.toJSON()});l.push(m)}return l}if(n[0]instanceof _){const l=[],c=J(P(n[0]),e.spatialReference);for(let m=0;m<c.points.length;m++)l.push(c.getPoint(m));return l}return null})},a.functions.issimple=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{if(n=u(n),h(n,1,1,e,t),n[0]===null)return!0;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return En(n[0])})},a.functions.simplify=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{if(n=u(n),h(n,1,1,e,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return sn(n[0])})},a.functions.convexhull=function(e,t){return a.standardFunctionAsync(e,t,(o,f,n)=>{if(n=u(n),h(n,1,1,e,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,t);return kn(n[0])})},a.functions.getuser=function(e,t){return a.standardFunctionAsync(e,t,async(o,f,n)=>{var m,F;h(n,0,2,e,t);let r=w(n[1],""),l=r===!0;if(r=r===!0||r===!1?"":q(r),n.length===0||n[0]instanceof Q){let D;D=(m=e.services)!=null&&m.portal?e.services.portal:$.getDefault(),n.length>0&&(D=X(n[0],D));const L=await ln(D,r,l);if(L){const b=JSON.parse(JSON.stringify(L));for(const p of["lastLogin","created","modified"])b[p]!==void 0&&b[p]!==null&&(b[p]=new Date(b[p]));return N.convertObjectToArcadeDictionary(b,S(e))}return null}let c=null;if(M(n[0])&&(c=n[0]),c){if(l=!1,r)return null;await c.load();const D=await c.getOwningSystemUrl();if(!D){if(!r){const p=await c.getIdentityUser();return p?N.convertObjectToArcadeDictionary({username:p},S(e)):null}return null}let L;L=(F=e.services)!=null&&F.portal?e.services.portal:$.getDefault(),L=X(new Q(D),L);const b=await ln(L,r,l);if(b){const p=JSON.parse(JSON.stringify(b));for(const k of["lastLogin","created","modified"])p[k]!==void 0&&p[k]!==null&&(p[k]=new Date(p[k]));return N.convertObjectToArcadeDictionary(p,S(e))}return null}throw new i(e,s.InvalidParameter,t)})},a.functions.nearestcoordinate=function(e,t){return a.standardFunctionAsync(e,t,async(o,f,n)=>{if(n=u(n),h(n,2,2,e,t),!(n[0]instanceof d||n[0]===null))throw new i(e,s.InvalidParameter,t);if(!(n[1]instanceof x||n[1]===null))throw new i(e,s.InvalidParameter,t);if(n[0]===null||n[1]===null)return null;const r=await qn(n[0],n[1]);return r===null?null:N.convertObjectToArcadeDictionary({coordinate:r.coordinate,distance:r.distance,sideOfLine:r.distance===0?"straddle":r.isRightSide?"right":"left"},S(e),!1,!0)})},a.functions.nearestvertex=function(e,t){return a.standardFunctionAsync(e,t,async(o,f,n)=>{if(n=u(n),h(n,2,2,e,t),!(n[0]instanceof d||n[0]===null))throw new i(e,s.InvalidParameter,t);if(!(n[1]instanceof x||n[1]===null))throw new i(e,s.InvalidParameter,t);if(n[0]===null||n[1]===null)return null;const r=await Bn(n[0],n[1]);return r===null?null:N.convertObjectToArcadeDictionary({coordinate:r.coordinate,distance:r.distance,sideOfLine:r.distance===0?"straddle":r.isRightSide?"right":"left"},S(e),!1,!0)})})}export{Yn as registerFunctions};
