{"version":3,"file":"utils-7221ceaf.js","sources":["../../node_modules/@arcgis/core/layers/save/utils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{updateOrigins as t}from\"../../core/accessorSupport/originUtils.js\";import r from\"../../portal/Portal.js\";import o from\"../../portal/PortalItem.js\";import{createForItemWrite as a}from\"../../portal/support/jsonContext.js\";import{addTypeKeyword as i,typeKeyword as n}from\"../../portal/support/portalItemUtils.js\";import{validateSaveAPIKey as s}from\"../../webdoc/support/saveAPIKeyUtils.js\";import{evaluateWriteErrors as p}from\"../../webdoc/support/saveUtils.js\";function l(t,r,o){const a=o(t);if(!a.isValid)throw new e(`${r}:invalid-parameters`,a.errorMessage,{layer:t})}async function m(e){const{layer:t,errorNamePrefix:r,validateLayer:o}=e;await t.load(),l(t,r,o)}function c(e,t){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`}function u(t){const{item:r,errorNamePrefix:o,layer:a,validateItem:i}=t;if(s(r),f(t),i){const t=i(r);if(!t.isValid)throw new e(`${o}:invalid-parameters`,t.errorMessage,{layer:a})}}function f(t){const{item:r,itemType:o,additionalItemType:a,errorNamePrefix:i,layer:n}=t,s=[o];if(a&&s.push(a),!s.includes(r.type)){const t=s.map((e=>`'${e}'`)).join(\", \");throw new e(`${i}:portal-item-wrong-type`,`Portal item type should be one of: \"${t}\"`,{item:r,layer:n})}}function d(t){const{layer:r,errorNamePrefix:o}=t,{portalItem:a}=r;if(!a)throw new e(`${o}:portal-item-not-set`,c(r,\"requires the portalItem property to be set\"));if(!a.loaded)throw new e(`${o}:portal-item-not-loaded`,c(r,\"cannot be saved to a portal item that does not exist or is inaccessible\"));u({...t,item:a})}function y(e){const{newItem:t,itemType:a}=e;let i=o.from(t);return i.id&&(i=i.clone(),i.id=null),i.type??=a,i.portal??=r.getDefault(),u({...e,item:i}),i}function w(e){return a(e,\"portal-item\")}async function I(e,t,r){\"beforeSave\"in e&&\"function\"==typeof e.beforeSave&&await e.beforeSave();const o=e.write({},t);return await Promise.all(t.resources?.pendingOperations??[]),p(t,{errorName:\"layer-write:unsupported\"},r),o}function v(e){i(e,n.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}async function P(e,t,r){const o=e.portal;await o.signIn(),await(o.user?.addItem({item:e,data:t,folder:r?.folder}))}async function $(e,r){const{layer:o,createItemData:a,createJSONContext:i,setItemProperties:n,saveResources:s,supplementalUnsupportedErrors:p}=e;await m(e),d(e);const l=o.portalItem,c=i?i(l):w(l),u=await I(o,c,{...r,supplementalUnsupportedErrors:p}),f=await a({layer:o,layerJSON:u},l);return await(n?.(o,l)),v(l),await l.update({data:f}),t(c),await(s?.(l,c)),l}async function j(e,r){const{layer:o,createItemData:a,createJSONContext:i,setItemProperties:n,saveResources:s,supplementalUnsupportedErrors:p}=e;await m(e);const l=y(e),c=i?i(l):w(l),u=await I(o,c,{...r,supplementalUnsupportedErrors:p}),f=await a({layer:o,layerJSON:u},l);return await n(o,l),v(l),await P(l,f,r),o.portalItem=l,t(c),await(s?.(l,c)),l}export{P as addItem,c as createErrorMessage,w as createJSONContextForWrite,d as ensureItemConfig,l as ensureLayerConfig,I as getLayerJSON,y as getPortalItem,$ as save,j as saveAs,v as setCommonItemProperties};\n"],"names":["l","t","r","o","a","e","m","c","u","s","f","n","d","y","i","w","I","p","P","_a","$","j"],"mappings":"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","x_google_ignoreList":[0]}