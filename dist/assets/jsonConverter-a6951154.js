import{ah as Xe,ai as Ie,a as p,aj as We,ak as Ge,A as ae,c as m,al as w,am as Ee,an as Ye,M as de,ao as Le,ap as Ke,a6 as Be,aq as ee,ar as qe,i as Qe,as as Je,at as ve,au as xe,av as Ae,aw as Se,ax as we,t as Ze,ay as He,n as ye,g as Te,az as Ce,aA as De,S as q,aB as Pe,aC as $e,aD as et,aE as Ne,aF as Ve,aG as ge,aH as tt,aI as _e,aJ as rt,aK as Me,C as nt,aL as st}from"./OperatorProject-2baa0db8.js";import{al as Fe,ho as at,hp as it,hq as ot}from"./index-02eff6e6.js";import"./SimpleGeometryCursor-e3941f41.js";Xe(t=>{let e,r;typeof t=="number"?e=t:r=t;const n={wkid:e,wkt:r};let a,i;if(r){a=ot(r);const s=Fe(n);if(!a&&!s)throw new Error(`Unsupported WKT type: ${r}`)}else a=!Fe(n);return i=e&&at.has(e)?Math.PI/200:a?it(n):Math.PI/180,{isPCS:a,metersOrRadiansPerUnit:i,semiMajor:0,wkidOrWkt:t}});function ut(){if(this.m_i===-1)return this.m_i=0,{value:{m_token:1,m_value:null},done:!1};if(this.m_i<this.m_keys.length){const t=this.m_bReturnKey,e=Math.trunc(this.m_i);return this.m_bReturnKey=!this.m_bReturnKey,this.m_i+=.5,t?{value:{m_token:5,m_value:this.m_keys[e]},done:!1}:{value:{m_token:6,m_value:this.m_o[this.m_keys[e]]},done:!1}}return{value:{m_token:3,m_value:null},done:!0}}function mt(){if(this.m_i===-1)return this.m_i=0,{value:{m_token:2,m_value:null},done:!1};if(this.m_i<this.m_a.length){const t={value:{m_token:6,m_value:this.m_a[this.m_i++]},done:!1};return this.m_strict||t.value.m_value===void 0&&(t.value.m_value=Number.NaN),t}return{value:{m_token:4,m_value:null},done:!0}}class lt{createJSONObjectIterator(e){return{m_iteratorType:"object",m_o:e,m_keys:this.m_options.strict?Object.keys(e):Object.keys(e).filter(r=>e[r]!==void 0),m_i:-1,m_bReturnKey:!0,next:ut}}createJSONArrayIterator(e){return{m_iteratorType:"array",m_strict:this.m_options.strict,m_i:-1,m_a:e,next:mt}}constructor(e,r){this.m_currentToken=0,this.m_options=r?{...r}:{strict:!0};const n=e;this.m_iteratorStack=[n instanceof Array?this.createJSONArrayIterator(n):this.createJSONObjectIterator(n)],this.m_nextFlatToken={m_value:null,m_token:0}}nextToken(){if(this.m_iteratorStack.length===0)return this.m_currentToken=0;switch(this.m_nextFlatToken=this.m_iteratorStack.at(-1).next().value,this.m_currentValue=void 0,this.m_nextFlatToken.m_token){case 1:return this.m_currentToken=1;case 3:return this.m_iteratorStack.pop(),this.m_currentToken=3;case 2:return this.m_currentToken=2;case 4:return this.m_iteratorStack.pop(),this.m_currentToken=4;case 5:return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=5;case 6:if(this.m_nextFlatToken.m_value instanceof Array)return this.m_iteratorStack.push(this.createJSONArrayIterator(this.m_nextFlatToken.m_value)),this.nextToken();if(this.m_nextFlatToken.m_value instanceof Object)return this.m_iteratorStack.push(this.createJSONObjectIterator(this.m_nextFlatToken.m_value)),this.nextToken();if(typeof this.m_nextFlatToken.m_value=="number")return this.m_currentValue=this.m_nextFlatToken.m_value,Number.isSafeInteger(this.m_currentValue)&&this.m_currentValue>=We()&&this.m_currentValue<=Ge()?this.m_currentToken=8:this.m_currentToken=7;if(typeof this.m_nextFlatToken.m_value=="string")return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=6;if(typeof this.m_nextFlatToken.m_value=="boolean")return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=this.m_nextFlatToken.m_value?11:12;if(typeof this.m_nextFlatToken.m_value=="object")return this.m_currentValue=null,this.m_currentToken=10;ae("unrecognized json element type")}return ae("unrecognized json element type"),0}currentToken(){return this.m_currentToken}skipChildren(){if(this.m_iteratorStack.length!==0)switch(this.m_currentValue=void 0,this.m_nextFlatToken.m_token){case 1:return this.m_iteratorStack.pop(),this.m_nextFlatToken.m_token=3,void(this.m_currentToken=3);case 2:return this.m_iteratorStack.pop(),this.m_nextFlatToken.m_token=4,void(this.m_currentToken=4)}}currentString(){return this.m_currentToken!==6&&this.m_currentToken!==5&&m("invalid token"),this.m_currentValue}currentDoubleValue(){return this.m_currentToken!==7&&this.m_currentToken!==8&&m("invalid token"),this.m_currentValue}currentInt32Value(){return this.m_currentToken!==8&&m("invalid token"),this.m_currentValue}currentInt64Value(){return w(0),0n}currentBoolValue(){return this.m_currentToken!==12&&this.m_currentToken!==11&&m("invalid token"),this.m_currentValue}isError(){return 0}}class ct{constructor(){this.m_pendingKey=null,this.m_acceptedObject=null,this.m_currentObject=[]}reset(){this.m_pendingKey=null,this.m_acceptedObject=null,this.m_currentObject.length=0}startObject(){const e={};this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):Array.isArray(this.m_currentObject.at(-1))&&this.m_currentObject.at(-1).push(e),this.m_currentObject.push(e)}startArray(){const e=[];this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):Array.isArray(this.m_currentObject.at(-1))&&this.m_currentObject.at(-1).push(e),this.m_currentObject.push(e)}endObject(){this.m_acceptedObject=this.m_currentObject.at(-1),this.m_currentObject.pop()}endArray(){this.m_currentObject.pop()}addFieldName(e){this.m_pendingKey=e}addValue_(e){this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):this.m_currentObject.at(-1).push(e)}addString(e){this.addValue_(e)}addDouble(e,r){this.addValue_(e)}addInt64(e){w(0)}addInt32(e){this.addValue_(e)}addBool(e){this.addValue_(e)}addNull(){this.addValue_(null)}getObject(){return this.m_acceptedObject}}class ie{constructor(e){return this.m_buffer=null,this.m_view=null,this.m_sz=0,this.m_offset=0,this.m_bOwnsBuffer=!0,this.m_bLittleEndian=!0,this.m_element=new ArrayBuffer(8),this.m_elementBytes=new Uint8Array(this.m_element),this.m_elementView=new DataView(this.m_element),this.m_elementDouble=new Float64Array(this.m_element),this.m_elementFloat=new Float32Array(this.m_element),this.m_elementInt64=new BigInt64Array(this.m_element),this.m_elementInt32=new Int32Array(this.m_element),this.m_elementInt16=new Int16Array(this.m_element),e.sz!==void 0?(this.m_sz=e.sz,e.buffer?(this.m_sz<0&&ge("size out of range"),this.m_buffer=e.buffer,this.m_offset=e.offset!==void 0?e.offset:0,this.m_view=e.offset!==void 0?new DataView(e.buffer,e.offset,e.sz):new DataView(this.m_buffer),this.m_bOwnsBuffer=!1,void(this.m_bLittleEndian=!0)):(this.m_sz<0&&ge("size out of range"),void(this.m_sz>0&&(this.m_buffer=new ArrayBuffer(this.m_sz),this.m_view=new DataView(this.m_buffer))))):e.move?(this.m_sz=e.move.m_sz,this.m_buffer=e.move.m_buffer,this.m_view=e.move.m_view,this.m_bOwnsBuffer=e.move.m_bOwnsBuffer,this.m_bLittleEndian=e.move.m_bLittleEndian,e.move.m_buffer=null,e.move.m_view=null,e.move.m_sz=0,void(e.move.m_bOwnsBuffer=!0)):void ae("unrecognized constructor options")}swapBytesDouble(){this.doSwap()&&(this.m_elementDouble[0]=this.m_elementBytes[0]<<56|this.m_elementBytes[1]<<48|this.m_elementBytes[2]<<40|this.m_elementBytes[3]<<32|this.m_elementBytes[4]<<24|this.m_elementBytes[5]<<16|this.m_elementBytes[6]<<8|this.m_elementBytes[7])}swapBytesInt32(){this.doSwap()&&(this.m_elementInt32[0]=this.m_elementBytes[0]<<24|this.m_elementBytes[1]<<16|this.m_elementBytes[2]<<8|this.m_elementBytes[3])}getOffset(){return this.m_offset}assignMove(e){return this===e||(this.clear(),this.m_sz=e.m_sz,this.m_buffer=e.m_buffer,this.m_view=e.m_view,this.m_bOwnsBuffer=e.m_bOwnsBuffer,this.m_bLittleEndian=e.m_bLittleEndian,e.m_buffer=null,e.m_sz=0,e.m_bOwnsBuffer=!0),this}doSwap(){return this.m_bLittleEndian!==(ie.getNativeByteOrder()===1)}setNativeByteOrder(){this.m_bLittleEndian=ie.getNativeByteOrder()===1}setOrder(e){this.m_bLittleEndian=e===1}getOrder(){return this.m_bLittleEndian?1:0}getView(){return this.m_view||tt("buffer not defined"),this.m_view}static getNativeByteOrder(){return 1}clear(){this.m_buffer=null,this.m_sz=0,this.m_bOwnsBuffer=!0}size(){return this.m_sz}readDouble(e){return this.doSwap()?(this.m_elementDouble[0]=this.m_view.getFloat64(e,this.m_bLittleEndian),this.swapBytesDouble(),this.m_elementDouble[0]):this.m_view.getFloat64(e,this.m_bLittleEndian)}writeDouble(e,r){this.m_elementDouble[0]=r,this.swapBytesDouble(),this.m_view.setFloat64(e,this.m_elementDouble[0],this.m_bLittleEndian)}readInt32(e){return this.doSwap()?(this.m_elementInt32[0]=this.m_view.getInt32(e,this.m_bLittleEndian),this.swapBytesInt32(),this.m_elementInt32[0]):this.m_view.getInt32(e,this.m_bLittleEndian)}writeInt32(e,r){this.m_elementInt32[0]=r,this.swapBytesInt32(),this.m_view.setInt32(e,this.m_elementInt32[0],this.m_bLittleEndian)}getPtr(){return this.m_buffer}setSizeNoRealloc(e){w(e>=0&&e<=this.m_sz),this.m_sz=e}}function dt(t,e,r,n,a,i){let s=!1,o=!1,c=!1,u=!1,l=!1,h=!1,_=!1,b=!1,T=!1,C=!1,v=!1,N=!1,F=!1,f=!1,x=!1,A=!1,E=!1,I=!1,U=!1,B=!1,D=!1,X=!1,P=!1,S=!1,O=Number.NaN,z=Number.NaN,V=Number.NaN,M=Number.NaN,J=0,j=Number.NaN,W=Number.NaN,y=Number.NaN,te=Number.NaN,me=Number.NaN,re=Number.NaN,Z=Number.NaN,H=Number.NaN,ne=0,L=0,$=!1,le=!1,G=null,Y=null,Q=null,K=null,R=null;for(;r.nextToken()!==3;){const k=r.currentString();if(r.nextToken(),k==="spatialReference"){if(a&&!s){s=!0,r.currentToken()===1?K=ht(r):r.currentToken()!==10&&m("failed to parse spatial reference: object or null is expected");continue}}else if(n)if(k==="hasZ"){if(!o){o=!0,$=r.currentToken()===11;continue}}else if(k==="hasM"){if(!c){c=!0,le=r.currentToken()===11;continue}}else if(k==="rings"){if(!(l||h||t!==p.enumUnknown&&t!==p.enumPolygon)){l=!0,{geometry:R,as:G,bs:Y}=pe(!0,!1,e,r);continue}}else if(k==="curveRings"){if(!h&&(t===p.enumUnknown||t===p.enumPolygon)){h=!0,{geometry:R,as:G,bs:Y}=pe(!0,!0,e,r);continue}}else if(k==="paths"){if(!(_||b||t!==p.enumUnknown&&t!==p.enumPolyline)){_=!0,{geometry:R,as:G,bs:Y}=pe(!1,!1,e,r);continue}}else if(k==="curvePaths"){if(!b&&(t===p.enumUnknown||t===p.enumPolyline)){b=!0,{geometry:R,as:G,bs:Y}=pe(!1,!0,e,r);continue}}else if(k==="points"){if(!T&&(t===p.enumUnknown||t===p.enumMultiPoint)){T=!0,{geometry:R,as:G,bs:Y}=ft(e,r);continue}}else if(k==="ids"){if(!u){u=!0,Q=pt(e,r);continue}}else if(k==="x"){if(!C&&(t===p.enumUnknown||t===p.enumPoint)){C=!0,O=g(r);continue}}else if(k==="y"){if(!v&&(t===p.enumUnknown||t===p.enumPoint)){v=!0,z=g(r);continue}}else if(k==="z"){if(!N&&(t===p.enumUnknown||t===p.enumPoint)){N=!0,V=g(r);continue}}else if(k==="m"){if(!F&&(t===p.enumUnknown||t===p.enumPoint)){F=!0,M=g(r);continue}}else if(k==="id"){if(!f&&(t===p.enumUnknown||t===p.enumPoint)){f=!0,J=he(r);continue}}else if(k==="xmin"){if(!x&&(t===p.enumUnknown||t===p.enumEnvelope)){x=!0,j=g(r);continue}}else if(k==="ymin"){if(!A&&(t===p.enumUnknown||t===p.enumEnvelope)){A=!0,W=g(r);continue}}else if(k==="mmin"){if(!D&&(t===p.enumUnknown||t===p.enumEnvelope)){D=!0,Z=g(r);continue}}else if(k==="zmin"){if(!U&&(t===p.enumUnknown||t===p.enumEnvelope)){U=!0,me=g(r);continue}}else if(k==="idmin"){if(!P&&(t===p.enumUnknown||t===p.enumEnvelope)){P=!0,ne=he(r);continue}}else if(k==="xmax"){if(!E&&(t===p.enumUnknown||t===p.enumEnvelope)){E=!0,y=g(r);continue}}else if(k==="ymax"){if(!I&&(t===p.enumUnknown||t===p.enumEnvelope)){I=!0,te=g(r);continue}}else if(k==="mmax"){if(!X&&(t===p.enumUnknown||t===p.enumEnvelope)){X=!0,H=g(r);continue}}else if(k==="zmax"){if(!B&&(t===p.enumUnknown||t===p.enumEnvelope)){B=!0,re=g(r);continue}}else if(k==="idmax"){if(!S&&(t===p.enumUnknown||t===p.enumEnvelope)){S=!0,L=he(r);continue}}else k==="materials"&&w(0);r.skipChildren()}if(l||h||_||b||T){let k=null,ke=null;const fe=R;$&&(R.addAttribute(1),k=G,k||(k=ee(fe.getPointCount(),Number.NaN))),le&&(R.addAttribute(2),ke=$?Y:G),Q!=null&&R.addAttribute(3),$&&k!=null&&fe.setAttributeStreamRef(1,k),le&&ke!=null&&fe.setAttributeStreamRef(2,ke),Q!=null&&kt(fe,Q)}else if(C||v||F||N||f){qe(O,z)||m("failed to parse point: x and y must be finite or nan"),(Number.isNaN(z)||Number.isNaN(O))&&(O=Number.NaN,z=Number.NaN);const k=new Qe({x:O,y:z});N&&k.setZ(V),F&&k.setM(M),f&&k.setID(J),R=k}else if(x||A||E||I||U||B||D||X||P||S){(Number.isNaN(W)||Number.isNaN(y)||Number.isNaN(te))&&(j=Number.NaN);const k=new Je({xmin:j,ymin:W,xmax:y,ymax:te});U&&B&&k.setInterval(1,0,me,re),D&&X&&k.setInterval(2,0,Z,H),P&&S&&k.setInterval(3,0,ne,L),R=k}return{...R?{geom:R}:{},...K?{sr:K}:{}}}function _t(t){let e=!1;for(;t.nextToken()!==3;){const r=t.currentString();t.nextToken(),r==="uwkid"?e||(e=!0,t.currentToken()===8&&t.currentInt32Value()):t.skipChildren()}return null}function ht(t){let e=!1,r=!1,n=!1,a=!1,i=!1,s=!1,o=!1,c=!1,u=!1,l=!1,h=!1,_=!1,b=!1,T=!1,C=!1,v=!1,N=!1,F=-1,f=-1,x=-1,A=-1,E=0,I=0,U=0,B=0,D=0,X=0,P=0,S=0,O=0,z=0,V="",M="",J=null;for(;t.nextToken()!==3;){const y=t.currentString();t.nextToken(),y==="wkid"?e||(e=!0,t.currentToken()===8&&(F=t.currentInt32Value())):y==="latestWkid"?r||(r=!0,t.currentToken()===8&&(f=t.currentInt32Value())):y==="wkt"?i||(i=!0,t.currentToken()===6&&(V=t.currentString())):y==="wkt2"?i||t.currentToken()===6&&(M=t.currentString()):y==="vcsWkid"?n||(n=!0,t.currentToken()===8&&(x=t.currentInt32Value())):y==="latestVcsWkid"?a||(a=!0,t.currentToken()===8&&(A=t.currentInt32Value())):y==="xyTolerance"?o||(o=!0,s=!0,E=t.currentDoubleValue()):y==="zTolerance"?c||(c=!0,s=!0,I=t.currentDoubleValue()):y==="mTolerance"?u||(u=!0,s=!0,U=t.currentDoubleValue()):y==="falseX"?l||(l=!0,s=!0,P=t.currentDoubleValue()):y==="falseY"?h||(h=!0,s=!0,S=t.currentDoubleValue()):y==="falseZ"?_||(_=!0,s=!0,O=t.currentDoubleValue()):y==="falseM"?b||(b=!0,s=!0,z=t.currentDoubleValue()):y==="xyUnits"?T||(T=!0,s=!0,B=t.currentDoubleValue()):y==="zUnits"?C||(C=!0,s=!0,D=t.currentDoubleValue()):y==="mUnits"?v||(v=!0,s=!0,X=t.currentDoubleValue()):y==="unit"?N||(N=!0,J=_t(t)):t.skipChildren()}A<=0&&x>0&&(A=x),x<=0&&A>0&&(x=A);let j=null,W=!0;if(V.length!==0&&(W=!1,ve(V)&&(j=xe(V))),j||M.length===0||(W=!1,ve(M)&&(j=xe(M))),!j&&f>0&&(W=!1,Ae(f)&&(A<=0||Se())&&(j=we(f,A))),!j&&F>0&&(W=!1,Ae(F)&&(x<=0||Se())&&(j=we(F,x))),W&&(j=Ze(J)),s&&j){const y=new Be;j.queryPrecisionDescriptorWithoutFalseXY(y),o&&y.setTolerance(0,E),c&&y.setTolerance(1,I),u&&y.setTolerance(2,U),T&&l&&h&&y.setGridParams(P,S,B),C&&_&&y.setZParams(O,D),v&&b&&y.setMParams(z,X),j=He(j,y)}return j}function pe(t,e,r,n){n.currentToken()!==2&&m("failed to parse multipath: array of array of vertices is expected");const a=t?new ye:new Te,i=a,s=Ce(0),o=ee(2,0),c=De(0);let u=null,l=null,h=null,_=null,b=null,T=0,C=0,v=0;const N=new Ee,F=q.getNAN();let f=0,x=0;const A=t?1:0;for(;n.nextToken()!==4;){n.currentToken()!==2&&m("failed to parse multipath: ring/path array is expected");let E=2,I=0,U=!0;const B=4;let D=0,X=0;const P=q.getNAN(),S=new Array(B),O=new Array(B);let z=!1;for(n.nextToken();n.currentToken()!==4;){if(e&&n.currentToken()===1)U&&m("failed to parse multipath: starting vertex array is expected"),h||(h=De(f-1,1),_=Ce(f-1,-1),b=ee(0)),z=!0,E=1,{segFlag:v,toPointSz:D}=gt(N,S,F,n);else{for(z=!1,n.currentToken()!==2&&m("failed to parse multipath: array is expected, rings/paths vertices consist of arrays of coordinates"),D=0;n.nextToken()!==4;)D===B&&m("failed to parse multipath: each vertex array has to have at most 4 elements"),S[D++]=g(n);D<2&&m("failed to parse multipath: each vertex array has to have at least 2 elements"),Pe(S[0],S[1])||m("failed to parse multipath: x and y must be finite")}n.nextToken();do{if(o.size()===2*f&&o.resize(Re(f)),o.writePoint2D(2*f,P.setCoords(S[0],S[1])),u&&u.size()===f&&u.resize(se(f)),D>2?(u||(u=ee(f+1,Number.NaN)),u.write(f,S[2])):u&&u.write(f,Number.NaN),l&&l.size()===f&&l.resize(se(f)),D>3?(l||(l=ee(f+1,Number.NaN)),l.write(f,S[3])):l&&l.write(f,Number.NaN),U)x++,s.add(f),c.add(A),U=!1,X=D,$e(O,S,0,0,X);else if(h!==null)if(z){const V=st(v),M=b.size();b.resize(M+V),h.add(v),_.add(T),N.get().writeInBufferStream(b,T),T+=V,i.incCurveType(v,1),C++}else h.add(1),_.add(-1);f++,I++,F.setCoords(S[0],S[1])}while(I<E&&n.currentToken()===4)}I!==0&&(t&&I>E&&D===X&&et(S,O,D)===0?(f--,I--):h!==null&&(h.add(1),_.add(-1)))}return f&&(s.resize(x),c.resize(x),f>0&&(s.add(f),c.add(0)),i.setAttributeStreamRef(0,o),i.setPathFlagsStreamRef(c),i.setPathStreamRef(s),h!==null&&(i.updateCurveCounter(C),i.setSegmentData(_,b,h,T)),i.notifyModifiedFlags(65535)),{geometry:a,as:u,bs:l}}function ft(t,e){e.currentToken()!==2&&m("failed to parse multipoint: array of vertices is expected");let r=0;const n=new Ne,a=ee(2,0);let i=0;const s=4,o=new Array(s),c=new q;let u=null,l=null;for(;e.nextToken()!==4;){for(e.currentToken()!==2&&m("failed to parse multipoint: array is expected, multipoint vertices consist of arrays of cooridinates"),i=0;e.nextToken()!==4;)i===s&&m("failed to parse multipoint: each vertex array has to have at most 4 elements"),o[i++]=g(e);i<2&&m("failed to parse multipoint: each vertex array has to have at least 2 elements"),Pe(o[0],o[1])||m("failed to parse multipoint: x and y must be finite"),a.size()===2*r&&a.resize(Re(r)),a.writePoint2D(2*r,c.setCoords(o[0],o[1])),u&&u.size()===r&&u.resize(se(r)),i>2?(u||(u=ee(r+1,Number.NaN)),u.write(r,o[2])):u&&u.write(r,Number.NaN),l&&l.size()===r&&l.resize(se(r)),i>3?(l||(l=ee(r+1,Number.NaN)),l.write(r,o[3])):l&&l.write(r,Number.NaN),r++}if(r){const h=n.getImpl();h.setAttributeStreamRef(0,a),h.resizeNoInit(r),h.notifyModifiedFlags(65535)}return{geometry:n,as:u,bs:l}}function pt(t,e){e.currentToken()!==2&&m("failed to parse array of IDs: array of array of integers is expected");const r=Ve(2,0);let n=0,a=-1;for(;e.nextToken()!==4;){const i=n;r.size()===n&&r.resize(se(n)),n++;let s=0;for(a===-1?a=e.currentToken()===2?1:0:a===1&&e.currentToken()!==2&&m("failed to parse array of IDs: array of array of integers is expected"),a===0&&(r.size()===n&&r.resize(se(n)),r.write(n,he(e)),s++,n++);e.nextToken()!==4;)r.size()===n&&r.resize(se(n)),r.write(n,he(e)),s++,n++;if(r.write(i,s),a===0)break}return r.resize(n),r}function g(t){const e=t.currentToken();if(e===10||e===6&&t.currentString()==="NaN")return Number.NaN;{const r=t.currentDoubleValue();return Number.isNaN(r)?Number.NaN:r}}function he(t){return t.currentInt32Value()}function kt(t,e){if(t.isEmpty())return;const r=Ve(2,0),n=t.getGeometryType();let a=0;n===Ne.type?a=1:n===Te.type||n===ye.type?a=t.getPathCount():ae("not implemented"),r.resize(t.getPointCount(),0);let i=0;for(let s=0;s<a;++s){const o=e.read(i);i++;const c=i+o;let u=0,l=0;n===Ne.type?u=t.getPointCount():n===Te.type||n===ye.type?(u=t.getPathSize(s),l=t.getPathStart(s)):ae("not implemented");for(let h=0,_=Math.min(o,u);h<_;++h)r.write(l,e.read(i)),i++,l++;i=c}t.getImpl().setAttributeStreamRef(3,r)}function Re(t){let e=2*Math.trunc(3*(t+1)/2);return e<8?e=8:e<32&&(e=32),e}function se(t){let e=Math.trunc(3*(t+1)/2);return e<4?e=4:e<16&&(e=16),e}function bt(t,e,r,n,a){a>=n.size()&&ge("Byte_buffer out of range access"),t.m_bits=0,t.m_rotation=0,t.m_cosr=1,t.m_sinr=0,t.setStartXY(e),t.setEndXY(r);const i=q.getNAN();i.x=n.readDouble(a),i.y=n.readDouble(a+8);const s=n.readInt32(a+16);if(1&s)return t.m_semiMajorAxis=0,t.m_minorMajorRatio=1,t.m_interior.assign(i),t.m_center.setNAN(),t.m_sweepAngle=0,t.m_startAngle=0,_e(t),!1;let o=!!(64&s);const c=!!(128&s);let u=!!(32&s);const l=!!(8&s),h=!!(16&s),_=e.equals(r);return o&&!_&&(o=!1,u=!0),u&&_&&(o=!0,u=!1,i.setCoords(0,0)),o||(c?u?(t.m_semiMajorAxis=1,t.m_minorMajorRatio=0,t.m_interior.assign(i),t.m_center.setNAN(),t.m_sweepAngle=0,t.m_startAngle=0):(t.constructCircularArcThreePoint(e,r,i),_&&l===t.isClockwise()&&t.reverse()):u?(t.m_semiMajorAxis=1,t.m_minorMajorRatio=0,t.m_center.setNAN(),t.m_sweepAngle=0,t.m_startAngle=0,_e(t),t.queryCoord2D(.5,t.m_interior)):rt(t,e,r,i,l,h)),o&&(t.m_center.assign(e),t.m_startAngle=i.x,t.m_sweepAngle=i.y,Me(t,Number.NaN,l,h),t.m_semiMajorAxis=0,t.m_minorMajorRatio=1,t.m_interior.setCoordsPoint2D(e)),t.setProjectionBehavior(0),_e(t),!0}function yt(t,e,r,n,a){t.m_bits=0,t.m_center.x=n.readDouble(a),t.m_center.y=n.readDouble(a+8),t.m_rotation=n.readDouble(a+16),t.m_semiMajorAxis=n.readDouble(a+24),t.m_minorMajorRatio=n.readDouble(a+32),t.m_XStart=e.x,t.m_YStart=e.y,t.m_XEnd=r.x,t.m_YEnd=r.y;const i=n.readInt32(a+40);if(1&i)return!1;let s=!!(64&i),o=!!(128&i);const c=!!(2048&i),u=!!(4096&i);return!(512&i)&&!(1024&i)||o||(s=!0),o&&!e.equals(r)?(o=!1,s=!0):s&&e.equals(r)&&(o=!0,s=!1),o?(t.m_center.assign(e),t.m_startAngle=t.m_center.x,t.m_sweepAngle=t.m_center.y,Me(t,Number.NaN,c,u),t.m_semiMajorAxis=0,t.m_interior.setCoordsPoint2D(e)):s?(t.m_center.setNAN(),t.m_semiMajorAxis=1,t.m_minorMajorRatio=0,t.m_center.setNAN(),t.m_sweepAngle=0,t.m_startAngle=0,_e(t),t.queryCoord2D(.5,t.m_interior)):t.constructEllipticArcEndPointsCenter(e,r,t.m_semiMajorAxis,t.m_minorMajorRatio,t.m_rotation,!u,c,t.m_center),t.setProjectionBehavior(1),_e(t),!0}function Tt(t,e,r,n,a){return w(a+32<=n.size()),t.m_cp=nt(q,2),t.m_cp[0].x=n.readDouble(a),t.m_cp[0].y=n.readDouble(a+8),t.m_cp[1].x=n.readDouble(a+16),t.m_cp[1].y=n.readDouble(a+24),t.m_XStart=e.x,t.m_YStart=e.y,t.m_XEnd=r.x,t.m_YEnd=r.y,!0}function Nt(t,e,r,n,a){return t.m_cp.x=n.readDouble(a),t.m_cp.y=n.readDouble(a+8),t.m_weights[0]=n.readDouble(a+16),t.m_weights[1]=n.readDouble(a+24),t.m_weights[2]=n.readDouble(a+32),t.m_XStart=e.x,t.m_YStart=e.y,t.m_XEnd=r.x,t.m_YEnd=r.y,!0}function gt(t,e,r,n,a){const i={segFlag:0,toPointSz:0};let s=n.currentToken();s=n.nextToken();const o=n.currentString(),c=o[0];for((o.length!==1||c!=="a"&&c!=="b"&&c!=="c"&&c!=="n"&&c!=="q")&&m('failed to parse curve: expecting "a", "b", "n", "q", or "c"'),s=n.nextToken(),s!==2&&m("failed to parse curve: start array is expected for curve parameters"),s=n.nextToken(),s!==2&&m("failed to parse curve: start array is expected for to point"),i.toPointSz=0;n.nextToken()!==4;)i.toPointSz===4&&m("failed to parse curve: vertex array cannot have more than 4 elements"),e[i.toPointSz++]=g(n);i.toPointSz<2&&m("failed to parse curve: vertex array must have at least 2 elements");const u=q.construct(e[0],e[1]),l=q.getNAN();let h=-1,_=-1,b=!1,T=Number.NaN,C=Number.NaN,v=Number.NaN;const N=[q.getNAN(),q.getNAN(),q.getNAN()],F=q.getNAN();if(c==="a"){s=n.nextToken(),s!==2&&m("failed to parse curve: start array is expected for center point"),s=n.nextToken();const f=g(n);s=n.nextToken();const x=g(n);s=n.nextToken(),s!==4&&m("failed to parse curve: end array is expected for center point"),l.setCoords(f,x),s=n.nextToken(),h=n.currentInt32Value(),s=n.nextToken(),_=n.currentInt32Value(),s=n.nextToken(),s!==4?(b=!1,T=g(n),s=n.nextToken(),C=g(n),s=n.nextToken(),v=g(n),s=n.nextToken(),s!==4&&m("failed to parse curve: end array is expected for curve parameters")):b=!0,i.segFlag=4}else if(c==="b"){for(let f=0;f<2;f++){s=n.nextToken(),s!==2&&m("failed to parse curve: start array is expected for control point"),s=n.nextToken();const x=g(n);s=n.nextToken();const A=g(n);s=n.nextToken(),s!==4&&m("failed to parse curve: end array is expected for control point"),N[f].setCoords(x,A)}s=n.nextToken(),s!==4&&m("failed to parse curve: end array is expected for curve parameters"),i.segFlag=2}else if(c==="n"){{s=n.nextToken(),s!==2&&m("failed to parse curve: start array is expected for control point"),s=n.nextToken();const E=g(n);s=n.nextToken();const I=g(n);s=n.nextToken(),s!==4&&m("failed to parse curve: end array is expected for control point"),N[0].setCoords(E,I)}s=n.nextToken();const f=g(n);s=n.nextToken();const x=g(n);s=n.nextToken();const A=g(n);N[1].setCoords(f,x),N[2].setCoords(A,A),s=n.nextToken(),s!==4&&m("failed to parse curve: end array is expected for curve parameters"),i.segFlag=8}else if(c==="q"){for(let f=0;f<1;f++){s=n.nextToken(),s!==2&&m("failed to parse curve: start array is expected for control point"),s=n.nextToken();const x=g(n);s=n.nextToken();const A=g(n);s=n.nextToken(),s!==4&&m("failed to parse curve: end array is expected for control point"),N[f].setCoords(x,A)}s=n.nextToken(),s!==4&&m("failed to parse curve: end array is expected for curve parameters"),i.segFlag=16}else{s=n.nextToken(),s!==2&&m("failed to parse curve: start array is expected for interior point"),s=n.nextToken();const f=g(n);s=n.nextToken();const x=g(n);s=n.nextToken(),s!==4&&m("failed to parse curve: end array is expected for interior point"),F.setCoords(f,x),s=n.nextToken(),s!==4&&m("failed to parse curve: end array is expected for curve parameters"),i.segFlag=4}if(s=n.nextToken(),s!==3&&m("failed to parse curve: end object is expected for curve"),c==="a")t.createEllipticArc(),b?je(t.get(),r,u,l,!0,h,_):vt(t.get(),r,u,l,h,_,T,C,v);else if(c==="b")t.createCubicBezier(),xt(t.get(),r,u,N);else if(c==="n")t.createQuadraticRationalBezier(),At(t.get(),r,u,N[0],N[1].x,N[1].y,N[2].x);else if(c==="q")t.createQuadraticBezier(),t.get().construct(r,N[0],u);else{t.createEllipticArc();const f=!1;je(t.get(),r,u,F,f,-1,-1)}return i}function je(t,e,r,n,a,i,s){t.dropAllAttributes();const o=20,c=new ArrayBuffer(o),u=new ie({sz:o,buffer:c});let l=0;u.writeDouble(l,n.x),l+=8,u.writeDouble(l,n.y),l+=8;let h=0;a?(s||(h|=8),i&&(h|=16)):h|=128,u.writeInt32(l,h),l+=4,bt(t,e,r,u,0)}function vt(t,e,r,n,a,i,s,o,c){t.dropAllAttributes();const u=44,l=new ArrayBuffer(u),h=new ie({sz:u,buffer:l});let _=0;h.writeDouble(_,n.x),_+=8,h.writeDouble(_,n.y),_+=8,h.writeDouble(_,s),_+=8,h.writeDouble(_,o),_+=8,h.writeDouble(_,c),_+=8;let b=0;i||(b|=2048),a&&(b|=4096),h.writeInt32(_,b),_+=4,yt(t,e,r,h,0)}function xt(t,e,r,n){t.dropAllAttributes();const a=32,i=new ArrayBuffer(a),s=new ie({sz:a,buffer:i});let o=0;s.writeDouble(o,n[0].x),o+=8,s.writeDouble(o,n[0].y),o+=8,s.writeDouble(o,n[1].x),o+=8,s.writeDouble(o,n[1].y),o+=8,Tt(t,e,r,s,0)}function At(t,e,r,n,a,i,s){t.dropAllAttributes();const o=40,c=new ArrayBuffer(o),u=new ie({sz:o,buffer:c});let l=0;u.writeDouble(l,n.x),l+=8,u.writeDouble(l,n.y),l+=8,u.writeDouble(l,a),l+=8,u.writeDouble(l,i),l+=8,u.writeDouble(l,s),l+=8,Nt(t,e,r,u,0)}function St(t,e,r,n,a){const i=t.getGeometryType();if(i===p.enumEllipticArc)return wt(t,e,r,n,a);if(i===p.enumBezier)return ze(t,e,r,n,a);if(i===p.enumRationalBezier2)return Ct(t,e,r,n,a);if(i===p.enumBezier2){const s=new Le;return s.constructFromQuadraticSegment(t),ze(s,e,r,n,a)}de("")}function wt(t,e,r,n,a){w(!Ke(t));const i=t.getEndXY(),s=t.hasAttribute(1)&&!e,o=t.hasAttribute(2)&&!r;let c=Number.NaN,u=Number.NaN;if(s&&(c=t.getEndAttributeAsDbl(1,0)),o&&(u=t.getEndAttributeAsDbl(2,0)),t.isDegenerateToLine()||t.isDegenerate(0))return oe(s,o,i.x,i.y,c,u,n,a),!0;const l=t.projectionBehavior()===0,h=!!l&&t.isClosed();if(l&&!h)a.startObject(),a.addFieldName("c"),a.startArray(),oe(s,o,i.x,i.y,c,u,n,a),ue(t.m_interior.x,t.m_interior.y,17,a),a.endArray(),a.endObject();else if(l){a.startObject(),a.addFieldName("a"),a.startArray(),oe(s,o,i.x,i.y,c,u,n,a);const _=0,b=0;ue(t.m_center.x+_,t.m_center.y+b,17,a);const T=!t.isMajor();a.addInt32(T?1:0);const C=t.isClockwise();a.addInt32(C?1:0),a.endArray(),a.endObject()}else{a.startObject(),a.addFieldName("a"),a.startArray(),oe(s,o,i.x,i.y,c,u,n,a);const _=t;ue(_.m_center.x,_.m_center.y,17,a);const b=!_.isMajor();a.addInt32(b?1:0);const T=_.isClockwise();a.addInt32(T?1:0),a.addDouble(_.m_rotation,17),a.addDouble(_.m_semiMajorAxis,17),a.addDouble(_.m_minorMajorRatio,17),a.endArray(),a.endObject()}return!1}function ze(t,e,r,n,a){const i=t.getEndXY(),s=t.hasAttribute(1)&&!e,o=t.hasAttribute(2)&&!r;let c=Number.NaN,u=Number.NaN;return s&&(c=t.getEndAttributeAsDbl(1,0)),o&&(u=t.getEndAttributeAsDbl(2,0)),a.startObject(),a.addFieldName("b"),a.startArray(),oe(s,o,i.x,i.y,c,u,n,a),ue(t.m_cp[0].x,t.m_cp[0].y,n,a),ue(t.m_cp[1].x,t.m_cp[1].y,n,a),a.endArray(),a.endObject(),!1}function Ct(t,e,r,n,a){const i=t.getEndXY(),s=t.hasAttribute(1)&&!e,o=t.hasAttribute(2)&&!r;let c=Number.NaN,u=Number.NaN;s&&(c=t.getEndAttributeAsDbl(1,0)),o&&(u=t.getEndAttributeAsDbl(2,0)),a.startObject(),a.addFieldName("n"),a.startArray(),oe(s,o,i.x,i.y,c,u,n,a),ue(t.m_cp.x,t.m_cp.y,n,a);const l=n;return a.addDouble(t.m_weights[0],l),a.addDouble(t.m_weights[1],l),a.addDouble(t.m_weights[2],l),a.endArray(),a.endObject(),!1}function oe(t,e,r,n,a,i,s,o){o.startArray(),o.addDouble(r,s),o.addDouble(n,s),t&&o.addDouble(a,s),e&&o.addDouble(i,s),o.endArray()}function ue(t,e,r,n){n.startArray(),n.addDouble(t,r),n.addDouble(e,r),n.endArray()}class Dt{getOperatorType(){return 10405}accelerateGeometry(e,r,n){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,r,n,a,i,s){Ft(e,r,n,a)}exportSpatialReference(e,r,n,a){w(0)}exportProjectionTransformation(e,r,n,a){w(0)}exportDatumTransformation(e,r,n,a){w(0)}static geometryTypeToString(e){return w(0),""}}function Ft(t,e,r,n,a){if(e||r){if(n.startObject(),e!==null)switch(e.getGeometryType()){case p.enumPolygon:Oe(!0,t,e,n);break;case p.enumPolyline:Oe(!1,t,e,n);break;case p.enumMultiPoint:jt(t,e,n);break;case p.enumPoint:zt(t,e,n);break;case p.enumEnvelope:Ot(t,e,n);break;case p.enumMultipatch:w(0);break;default:ae("exportToJSON")}r!==null&&(n.addFieldName("spatialReference"),Et(t,r,n)),n.endObject()}}function Oe(t,e,r,n){const a=r.getImpl(),i=!!(2&e),s=!!(4&e),o=!!(8&e),c=a.hasAttribute(1)&&!i,u=a.hasAttribute(2)&&!s,l=a.hasAttribute(3)&&!o,h=a.hasNonLinearSegments();c&&(n.addFieldName("hasZ"),n.addBool(!0)),u&&(n.addFieldName("hasM"),n.addBool(!0)),t?h?n.addFieldName("curveRings"):n.addFieldName("rings"):h?n.addFieldName("curvePaths"):n.addFieldName("paths");let _=null;const b=[];if(r.isEmpty())n.startArray(),n.endArray();else{const T=17-(31&e>>13);n.startArray();const C=r.getPathCount();let v=0;const N=a.getAttributeStreamRef(0);let F=null,f=null,x=null;const A=new Ee;let E=null,I=null,U=null;h&&(E=a.getSegmentFlagsStreamRef(),I=a.getSegmentIndexStreamRef(),U=a.getSegmentDataStreamRef()),c&&(F=a.getAttributeStreamRef(1)),u&&(f=a.getAttributeStreamRef(2)),l&&(x=a.getAttributeStreamRef(3),_=Ye(3,0));for(let B=0;B<C;B++){n.startArray(),l&&b.push(0);const D=r.getPathEnd(B);if(v===D){n.endArray();continue}const X=r.isClosedPath(B);let P=N.read(2*v),S=N.read(2*v+1),O=c?F.read(v):Number.NaN,z=u?f.read(v):Number.NaN,V=l?x.read(v):0;ce(c,u,P,S,O,z,T,n);let M=1;l&&(_.add(V),b[b.length-1]++);const J=P,j=S,W=O,y=z,te=V;let me=!1,re=0,Z=Number.NaN,H=Number.NaN,ne=0;for(let L=v+1,$=v,le=X?D+1:D;L<le;L++,$++){const G=E!==null?31&E.read($):1;let Y,Q;if(L<D?(Y=N.read(2*L),Q=N.read(2*L+1),c&&(Z=F.read(L)),u&&(H=f.read(L)),l&&(ne=x.read(L))):(Y=J,Q=j,Z=W,H=y,ne=te),G!==1){me=!0,G===4?A.createEllipticArc():G===2?A.createCubicBezier():G===16?A.createQuadraticBezier():G===8?A.createQuadraticRationalBezier():de("JSON export.unsupported curve");const K=A.get(),R=I.read($);K.setStartXYCoords(P,S),K.setEndXYCoords(Y,Q),c&&(K.setStartAttribute(1,0,O),K.setEndAttribute(1,0,Z)),u&&(K.setStartAttribute(2,0,z),K.setEndAttribute(2,0,H)),K.readFromBufferStream(U,R),St(A.get(),i,s,T,n)&&re++}else ce(c,u,Y,Q,Z,H,T,n);l&&(_.add(ne),b[b.length-1]++),M++,P=Y,S=Q,O=Z,z=H,V=ne}me&&re===0||(M<2&&re<1&&(ce(c,u,P,S,O,z,T,n),M++,l&&(_.add(V),b[b.length-1]++)),X&&M<3&&re<2&&(ce(c,u,J,j,W,y,T,n),M++,P=J,S=j,O=W,z=y,V=te,l&&(_.add(te),b[b.length-1]++))),n.endArray(),v=D}n.endArray()}if(l){n.addFieldName("ids"),n.startArray();let T=0;for(let C=0,v=b.length;C<v;++C){const N=b[C];w(N===0||_!==null&&T+N<=_.size()),n.startArray();for(let F=0;F<N;++F)n.addInt32(_.read(T)),T++;n.endArray()}n.endArray()}}function jt(t,e,r){const n=e.getImpl(),a=n.hasAttribute(1)&&!(2&t),i=n.hasAttribute(2)&&!(4&t),s=n.hasAttribute(3)&&!(8&t);a&&(r.addFieldName("hasZ"),r.addBool(!0)),i&&(r.addFieldName("hasM"),r.addBool(!0)),r.addFieldName("points");const o=e.getPointCount();if(e.isEmpty())r.startArray(),r.endArray();else{const c=17-(31&t>>13);r.startArray();const u=n.getAttributeStreamRef(0);let l=null,h=null;a&&(l=n.getAttributeStreamRef(1)),i&&(h=n.getAttributeStreamRef(2));for(let _=0;_<o;_++){const b=u.read(2*_),T=u.read(2*_+1);let C=Number.NaN,v=Number.NaN;a&&(C=l.read(_)),i&&(v=h.read(_)),ce(a,i,b,T,C,v,c,r)}r.endArray()}if(s){let c=null;n.isEmpty()||(c=n.getAttributeStreamRef(3)),w(o===0||c!==null&&c.size()>=o),r.addFieldName("ids"),r.startArray();for(let u=0;u<o;u++)r.addInt32(c.read(u));r.endArray()}}function zt(t,e,r){const n=e.hasAttribute(1)&&!(2&t),a=e.hasAttribute(2)&&!(4&t),i=e.hasAttribute(3)&&!(8&t);if(e.isEmpty())return r.addFieldName("x"),r.addNull(),r.addFieldName("y"),r.addNull(),n&&(r.addFieldName("z"),r.addNull()),a&&(r.addFieldName("m"),r.addNull()),void(i&&(r.addFieldName("id"),r.addInt32(0)));const s=17-(31&t>>13);r.addFieldName("x"),r.addDouble(e.getX(),s),r.addFieldName("y"),r.addDouble(e.getY(),s),n&&(r.addFieldName("z"),r.addDouble(e.getZ(),s)),a&&(r.addFieldName("m"),r.addDouble(e.getM(),s)),i&&(r.addFieldName("id"),r.addInt32(e.getID()))}function Ot(t,e,r){const n=e.hasAttribute(1)&&!(2&t),a=e.hasAttribute(2)&&!(4&t),i=e.hasAttribute(3)&&!(8&t);if(e.isEmpty())return r.addFieldName("xmin"),r.addNull(),r.addFieldName("ymin"),r.addNull(),r.addFieldName("xmax"),r.addNull(),r.addFieldName("ymax"),r.addNull(),n&&(r.addFieldName("zmin"),r.addNull(),r.addFieldName("zmax"),r.addNull()),a&&(r.addFieldName("mmin"),r.addNull(),r.addFieldName("mmax"),r.addNull()),void(i&&(r.addFieldName("idmin"),r.addInt32(0),r.addFieldName("idmax"),r.addInt32(0)));const s=17-(31&t>>13);if(r.addFieldName("xmin"),r.addDouble(e.getXMin(),s),r.addFieldName("ymin"),r.addDouble(e.getYMin(),s),r.addFieldName("xmax"),r.addDouble(e.getXMax(),s),r.addFieldName("ymax"),r.addDouble(e.getYMax(),s),n){const o=e.queryInterval(1,0);r.addFieldName("zmin"),r.addDouble(o.vmin,s),r.addFieldName("zmax"),r.addDouble(o.vmax,s)}if(a){const o=e.queryInterval(2,0);r.addFieldName("mmin"),r.addDouble(o.vmin,s),r.addFieldName("mmax"),r.addDouble(o.vmax,s)}if(i){const o=e.queryInterval(3,0);r.addFieldName("idmin"),r.addInt32(o.vmin),r.addFieldName("idmax"),r.addInt32(o.vmax)}}function It(t,e,r){r.startObject();const n=e.getID();n<=0&&m("cannot export unit that has no valid WKID"),r.addFieldName("uwkid"),r.addInt32(n),r.endObject()}function Et(t,e,r){r.startObject();let n=0;e.isCustomWkid()||(n=e.getOldID());let a=0;const i=e.getVCS();if(i!==null&&(i.isCustomWkid()||(a=i.getOldID()),a<=0&&(n=0)),n>0){r.addFieldName("wkid"),r.addInt32(n);const s=e.getLatestID();if(s>0&&s!==n&&(r.addFieldName("latestWkid"),r.addInt32(s)),a>0){r.addFieldName("vcsWkid"),r.addInt32(a);const o=e.getLatestVerticalID();o!==a&&(r.addFieldName("latestVcsWkid"),r.addInt32(o))}}if(e.getCoordinateSystemType()===0)r.addFieldName("wkid"),r.addNull(),e.getUnit()!==null&&(r.addFieldName("unit"),It(t,e.getUnit(),r));else if(n<=0||1&t){let s="";64&t&&(s=e.getText2(),r.addFieldName("wkt2"),r.addString(s));const o=e.getText();o!==s&&(r.addFieldName("wkt"),r.addString(o))}if(16&t){const s=new Be;e.queryPrecisionDescriptor(s),r.addFieldName("xyTolerance"),r.addDouble(s.getTolerance(0)),r.addFieldName("zTolerance"),r.addDouble(s.getTolerance(1)),r.addFieldName("mTolerance"),r.addDouble(s.getTolerance(2)),r.addFieldName("falseX"),r.addDouble(s.getFalseX()),r.addFieldName("falseY"),r.addDouble(s.getFalseY()),r.addFieldName("xyUnits"),r.addDouble(s.getGridUnitsXY()),r.addFieldName("falseZ"),r.addDouble(s.getFalseZ()),r.addFieldName("zUnits"),r.addDouble(s.getGridUnitsZ()),r.addFieldName("falseM"),r.addDouble(s.getFalseM()),r.addFieldName("mUnits"),r.addDouble(s.getGridUnitsM())}r.endObject()}function ce(t,e,r,n,a,i,s,o){o.startArray(),o.addDouble(r,s),o.addDouble(n,s),t&&o.addDouble(a,s),e&&o.addDouble(i,s),o.endArray()}const d={s_a:"a".charCodeAt(0),s_A:"A".charCodeAt(0),s_asterisk:"*".charCodeAt(0),s_b:"b".charCodeAt(0),s_backspace:"\b".charCodeAt(0),s_backslash:"\\".charCodeAt(0),s_beginArray:"[".charCodeAt(0),s_beginObject:"{".charCodeAt(0),s_colon:":".charCodeAt(0),s_period:".".charCodeAt(0),s_comma:",".charCodeAt(0),s_doubleQuote:'"'.charCodeAt(0),s_endArray:"]".charCodeAt(0),s_endObject:"}".charCodeAt(0),s_e:"e".charCodeAt(0),s_E:"E".charCodeAt(0),s_f:"f".charCodeAt(0),s_formfeed:"\f".charCodeAt(0),s_F:"F".charCodeAt(0),s_forwardslash:"/".charCodeAt(0),s_lt:"<".charCodeAt(0),s_minus:"-".charCodeAt(0),s_plus:"+".charCodeAt(0),s_n:"n".charCodeAt(0),s_N:"N".charCodeAt(0),s_newline:`
`.charCodeAt(0),s_r:"r".charCodeAt(0),s_carriageReturn:"\r".charCodeAt(0),s_t:"t".charCodeAt(0),s_tab:"	".charCodeAt(0),s_u:"u".charCodeAt(0),s_zero:"0".charCodeAt(0),s_nine:"9".charCodeAt(0)};class Bt{constructor(e){this.m_functionStack=[],this.m_pushPositions=[],this.m_utf8Decoder=new TextDecoder("utf-8",{fatal:!0}),e===void 0?(this.m_startToken=Number.MAX_SAFE_INTEGER,this.m_endToken=0,this.m_currentTokenType=0,this.m_functionStack.push(()=>this.accept_()),this.m_jsonString=null,this.m_bHasEscapes=!1):e.jsonString?this.resetParserFromString(e.jsonString):e.jsonStream?de("streaming json parsing not yet impl"):ae("invalid constructor parameter")}prepSubstrString_(){}getCurrentSubstrString_(){return this.m_jsonString.slice(this.m_startToken,this.m_endToken)}stepOverCharString_(){this.m_endToken++}peekCharString_(){return this.m_jsonString.charCodeAt(this.m_endToken)}getString_(e){var n;const r=(n=this.m_jsonString)==null?void 0:n.slice(this.m_startToken,this.m_startToken+e-1);return this.m_endToken+=e-1,{s:r,bDone:this.m_endToken>=this.m_jsonString.length}}incrementString_(){this.m_endToken++}eofString_(){return this.m_endToken>=this.m_jsonString.length}setStringFunctions_(){this.m_prepSubstr=this.prepSubstrString_,this.m_getCurrentSubstr=this.getCurrentSubstrString_,this.m_stepOverChar=this.stepOverCharString_,this.m_peekChar=this.peekCharString_,this.m_get=this.getString_,this.m_increment=this.incrementString_,this.m_eof=this.eofString_}setStreamFunctions_(){de("streaming json parsing not yet impl")}reset_(){this.m_jsonString=null,this.m_endToken=0,this.m_startToken=Number.MAX_SAFE_INTEGER,this.m_currentTokenType=0,this.m_bHasEscapes=!1,this.m_functionStack.length=0,this.m_functionStack.push(()=>this.start_()),this.m_pushPositions.length=0}resetParserFromString(e){this.reset_(),this.setStringFunctions_(),this.m_jsonString=e}resetParserFromStream(e){de("streaming json parsing not yet impl")}resetToPosition(e){return w(0),!1}nextToken(){return this.m_functionStack.at(-1)(),this.m_currentTokenType}currentToken(){return this.m_currentTokenType}currentTokenStartIndex(){return this.m_startToken}currentTokenEndIndex(){return this.m_endToken}currentText(){return w(0),""}childrenAsString(){return w(0),""}skipChildren(){this.skipChildren_()}skipChildren_(){if(this.m_currentTokenType!==1){if(this.m_currentTokenType===2){let e=1;do this.m_currentTokenType=this.nextToken(),this.m_currentTokenType===2?e++:this.m_currentTokenType===4&&e--;while(this.m_currentTokenType!==4||e!==0)}}else{let e=1;do this.m_currentTokenType=this.nextToken(),this.m_currentTokenType===1?e++:this.m_currentTokenType===3&&e--;while(this.m_currentTokenType!==3||e!==0)}}currentTerminalAsString_(){switch(this.m_currentTokenType){case 7:case 8:case 9:return this.m_getCurrentSubstr().slice(0,this.m_endToken-this.m_startToken);case 10:return"null";case 11:return"true";case 12:return"false"}m("invalid token")}toUTF8_(e,r){let n=0,a=e;for(;r.charCodeAt(a)===d.s_backslash&&r.charCodeAt(a+1)===d.s_u;)n++,a+=6;a=e;const i=new Uint8Array(n);let s=0;for(;r.charCodeAt(a)===d.s_backslash&&r.charCodeAt(a+1)===d.s_u;)i[s++]=Number.parseInt(r.slice(a+2,a+6),16),a+=6;return{u8s:this.m_utf8Decoder.decode(i),end:a}}unquoteCurrentString_(){let e="",r=1;const n=this.m_endToken-this.m_startToken-1;let a=0;const i=this.m_getCurrentSubstr();for(let s=r;s<n;s++)if(i.charCodeAt(s)!==d.s_backslash)a++;else{switch(a>0&&(e+=i.slice(r,r+a)),i.charCodeAt(++s)){case d.s_doubleQuote:e+='"';break;case d.s_u:{const{u8s:o,end:c}=this.toUTF8_(s-1,i);s=c-1,e+=o;break}case d.s_backslash:e+="\\";break;case d.s_forwardslash:e+="/";break;case d.s_b:e+="\b";break;case d.s_f:e+="\f";break;case d.s_n:e+=`
`;break;case d.s_r:e+="\r";break;case d.s_t:e+="	"}r=s+1,a=0}return a>0&&(e+=i.slice(r,r+a)),e}currentString(){return this.m_currentTokenType!==5&&this.m_currentTokenType!==6?this.currentTerminalAsString_():this.m_bHasEscapes?this.unquoteCurrentString_():this.m_getCurrentSubstr().slice(1,this.m_endToken-this.m_startToken-2+1)}currentDoubleValue(){if(this.m_currentTokenType!==7&&this.m_currentTokenType!==8&&this.m_currentTokenType!==9&&this.m_currentTokenType!==6&&this.m_currentTokenType!==10&&m("invalid token"),this.m_currentTokenType===10)return Number.NaN;let e=this.m_getCurrentSubstr(),r=this.m_endToken-this.m_startToken;if(this.m_currentTokenType===6){if(this.currentString()==="NaN")return Number.NaN;e=e.slice(1),r-=2,r===0&&m("invalid token")}const n=Number.parseFloat(e);if(this.m_currentTokenType===6)Number.isNaN(n)&&m("invalid token");else if(Number.isNaN(n))return Number.NaN;return n}currentInt32Value(){this.m_currentTokenType!==8&&this.m_currentTokenType!==6&&m("invalid token");let e=this.m_getCurrentSubstr(),r=this.m_endToken-this.m_startToken;this.m_currentTokenType===6&&(e=e.slice(1),r-=2,r===0&&m("invalid token"));const n=parseInt(e);return Number.isNaN(n)&&m("invalid token"),n}currentInt64Value(){return w(0),0n}currentBoolValue(){return w(0),!1}isError(){return 0}JSONString(){return w(0),""}pushPosition(){return w(0),!1}popPosition(){return w(0),!1}skipCStyleComments_(){w(0)}skipCppStyleComments_(){w(0)}skipComments_(){this.m_prepSubstr();let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&m("invalid token"),e=this.m_peekChar(),e===d.s_asterisk?this.skipCStyleComments_():e===d.s_forwardslash?this.skipCppStyleComments_():m("invalid token")}skipWhiteSpace_(){let e;do{this.m_eof()&&m("invalid token");let r=this.m_peekChar();for(;r>=9&&r<=13||r===32;)this.m_increment(),this.m_eof()&&m("invalid token"),r=this.m_peekChar();r===d.s_forwardslash?(this.m_startToken=this.m_endToken,e=!0,this.skipComments_()):e=!1}while(e)}rightBracket_(){return this.m_peekChar()===d.s_endArray&&(this.m_startToken=this.m_endToken,this.m_increment(),this.m_currentTokenType=4,!0)}rightBrace_(){return this.m_peekChar()===d.s_endObject&&(this.m_startToken=this.m_endToken,this.m_increment(),this.m_currentTokenType=3,!0)}string_(){this.m_prepSubstr(),this.m_bHasEscapes=!1,this.m_stepOverChar(),this.m_eof()&&m("invalid token");let e=this.m_peekChar();for(;e!==d.s_doubleQuote;){const r=e===d.s_backslash;if(this.m_stepOverChar(),this.m_eof()&&m("invalid token"),e=this.m_peekChar(),r)if(this.m_bHasEscapes=!0,e===d.s_doubleQuote||e===d.s_backslash||e===d.s_forwardslash||e===d.s_b||e===d.s_f||e===d.s_n||e===d.s_r||e===d.s_t)this.m_stepOverChar(),this.m_eof()&&m("invalid token"),e=this.m_peekChar();else if(e===d.s_u)for(let n=0;n<4;n++)this.m_stepOverChar(),this.m_eof()&&m("invalid token"),e=this.m_peekChar(),e>=d.s_zero&&e<=d.s_nine||e>=d.s_a&&e<=d.s_f||e>=d.s_A&&e<=d.s_F||m("invalid token");else m("invalid token")}this.m_stepOverChar()}comma_(){return this.m_peekChar()===d.s_comma&&(this.m_increment(),!0)}colon_(){return this.m_peekChar()===d.s_colon&&(this.m_increment(),!0)}fieldNameEnd_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.colon_()?(this.skipWhiteSpace_(),this.value_()):m("invalid token")}fieldNameStart_(){this.m_startToken=this.m_endToken,this.m_peekChar()!==d.s_doubleQuote&&m("invalid token"),this.string_(),this.m_currentTokenType=5,this.m_functionStack.push(()=>this.fieldNameEnd_())}pairEnd_(){this.skipWhiteSpace_(),this.comma_()?(this.skipWhiteSpace_(),this.fieldNameStart_()):this.rightBrace_()?this.m_functionStack.pop():m("invalid token")}arrayStart_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.rightBracket_()||(this.m_functionStack.push(()=>this.elementEnd_()),this.value_())}elementEnd_(){this.skipWhiteSpace_(),this.comma_()?(this.skipWhiteSpace_(),this.value_()):this.rightBracket_()?this.m_functionStack.pop():m("invalid token")}objectStart_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.rightBrace_()||(this.m_functionStack.push(()=>this.pairEnd_()),this.fieldNameStart_())}valueStartObject_(){this.m_increment(),this.m_currentTokenType=1,this.m_functionStack.push(()=>this.objectStart_())}valueStartArray_(){this.m_increment(),this.m_currentTokenType=2,this.m_functionStack.push(()=>this.arrayStart_())}valueString_(){this.string_(),this.m_currentTokenType=6}int_(){this.m_peekChar()!==d.s_zero?this.digits_():this.m_stepOverChar()}digits_(){let e=this.m_peekChar();do this.m_stepOverChar(),this.m_eof()&&m("invalid token"),e=this.m_peekChar();while(e>=d.s_zero&&e<=d.s_nine)}frac_(){let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&m("invalid token"),e=this.m_peekChar(),e>=d.s_zero&&e<=d.s_nine||m("invalid token"),this.digits_()}exp_(){let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&m("invalid token"),e=this.m_peekChar(),e!==d.s_plus&&e!==d.s_minus||(this.m_stepOverChar(),this.m_eof()&&m("invalid token"),e=this.m_peekChar()),e>=d.s_zero&&e<=d.s_nine||m("invalid token"),this.digits_()}valueNumber_(){this.m_prepSubstr();let e=!1,r=this.m_peekChar();if(r===d.s_minus?(this.m_stepOverChar(),this.m_eof()&&m("invalid token"),r=this.m_peekChar(),e=!0,r>=d.s_zero&&r<=d.s_nine||m("invalid token"),this.int_()):this.int_(),r=this.m_peekChar(),r===d.s_period)this.m_currentTokenType=7,this.frac_(),r=this.m_peekChar(),r!==d.s_e&&r!==d.s_E||this.exp_();else if(r===d.s_e||r===d.s_E)this.m_currentTokenType=7,this.exp_();else{let n=0;e&&n++;const a=this.m_endToken-this.m_startToken-n;if(a<10)this.m_currentTokenType=8;else if(a===10){const i=this.m_getCurrentSubstr();e?i.slice(n)<="2147483648"?this.m_currentTokenType=8:this.m_currentTokenType=9:i.slice(n)<="2147483647"?this.m_currentTokenType=8:this.m_currentTokenType=9}else if(a<19)this.m_currentTokenType=9;else if(a===19){const i=this.m_getCurrentSubstr();e?i.slice(n)<="9223372036854775808"?this.m_currentTokenType=9:this.m_currentTokenType=7:i.slice(n)<="9223372036854775807"?this.m_currentTokenType=9:this.m_currentTokenType=7}else this.m_currentTokenType=7}}valueNull_(){const{s:e,bDone:r}=this.m_get(5);r&&m("invalid token"),e!=="null"&&m("invalid token"),this.m_currentTokenType=10}valueTrue_(){const{s:e,bDone:r}=this.m_get(5);r&&m("invalid token"),e!=="true"&&m("invalid token"),this.m_currentTokenType=11}valueFalse_(){const{s:e,bDone:r}=this.m_get(6);r&&m("invalid token"),e!=="false"&&m("invalid token"),this.m_currentTokenType=12}valueNan_(){const{s:e,bDone:r}=this.m_get(4);r&&m("invalid token"),e!=="NaN"&&m("invalid token"),this.m_currentTokenType=7}value_(){this.m_startToken=this.m_endToken;const e=this.m_peekChar();e===d.s_beginObject?this.valueStartObject_():e===d.s_beginArray?this.valueStartArray_():e===d.s_doubleQuote?this.valueString_():e===d.s_minus||e>=d.s_zero&&e<=d.s_zero+9?this.valueNumber_():e===d.s_n?this.valueNull_():e===d.s_t?this.valueTrue_():e===d.s_f?this.valueFalse_():e===d.s_N?this.valueNan_():m("invalid token")}start_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.m_functionStack.push(()=>this.accept_());const e=this.m_peekChar();e!==d.s_beginObject&&e!==d.s_beginArray&&m("invalid token"),this.value_()}accept_(){this.m_startToken=this.m_endToken,this.m_currentTokenType=0}}class Pt{getOperatorType(){return 10404}accelerateGeometry(e,r,n){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,r,n,a,i,s,o){let c;typeof n=="string"?(c=new Bt({jsonString:n}),c.nextToken()):c=n,c.currentToken()!==1&&m("failed to import map geometry: start of object is expected");const u=dt(r,e,c,a,i);return new Ie(u)}importProjectionTransformation(e,r){return w(0),{}}importDatumTransformation(e,r){return w(0),{}}static stringToGeometryType(e){return p.enumPoint}}const be=new ct,Vt=new Dt,Mt=new Pt;function Yt(t){return Array.isArray(t)?t[0].spatialReference:t.spatialReference}function Ue(t,e){const r=new lt(t,{strict:!1});return r.nextToken(),Mt.execute(0,p.enumUnknown,r,!0,e)}function Lt(t){let e=null;return[t.map(r=>{if(e==null){const n=Rt(r);return e=n.getSpatialReference(),n.getGeometry()}return Ut(r)}),e]}function Rt(t){return Ue(t,!0)}function Ut(t){return Ue(t,!1).getGeometry()}function Kt(t,e){return t instanceof Ie&&(e=t.getSpatialReference(),t=t.getGeometry()),t!=null&&t.isEmpty()?null:(be.reset(),Vt.execute(0,t,e,be),be.getObject())}export{Lt as fromGeometries,Rt as fromGeometry,Ut as fromGeometryToGXGeometry,Yt as getSpatialReference,Kt as toGeometry};
