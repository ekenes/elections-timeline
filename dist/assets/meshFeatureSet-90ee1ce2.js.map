{"version":3,"file":"meshFeatureSet-90ee1ce2.js","sources":["../../node_modules/@arcgis/core/rest/support/meshFeatureSet.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport e from\"../../Graphic.js\";import t from\"../../core/Logger.js\";import{getOrCreateMapValue as r}from\"../../core/MapUtils.js\";import o from\"../../geometry/Extent.js\";import n from\"../../geometry/Mesh.js\";import s from\"../../geometry/Point.js\";import a from\"../../geometry/SpatialReference.js\";import i from\"../../geometry/support/MeshTransform.js\";import{ServiceAssetPart as u,ServiceAsset as f}from\"../../geometry/support/meshUtils/External.js\";import{getFormatIdMimeType as c}from\"../../layers/support/infoFor3D.js\";import l from\"./FeatureSet.js\";const m=()=>t.getLogger(\"esri.rest.support.meshFeatureSet\");function p(t,r,o){const n=o.features;o.features=[],delete o.geometryType;const s=l.fromJSON(o);if(s.geometryType=\"mesh\",!o.assetMaps)return s;const i=d(r,o.assetMaps),u=t.sourceSpatialReference??a.WGS84,f=o.globalIdFieldName,{outFields:c}=t,m=null!=c&&c.length>0?g(c.includes(\"*\")?null:new Set(c)):()=>({});for(const a of n){const t=y(a,f,u,r,i);s.features.push(new e({geometry:t,attributes:m(a)}))}return s}function g(e){return({attributes:t})=>{if(!t)return{};if(!e)return t;for(const r in t)e.has(r)||delete t[r];return t}}function y(e,t,r,s,a){const i=e.attributes[t],u=a.get(i);if(null==u||!e.geometry)return null;const f=E(e,r,s),c=o.fromJSON(e.geometry);c.spatialReference=r;const l=h(e.attributes,s),m=r.isGeographic?\"local\":\"georeferenced\",p=D(u);return p?n.createWithExternalSource(f,p,{extent:c,transform:l,vertexSpace:m}):n.createIncomplete(f,{extent:c,transform:l,vertexSpace:m})}function E({attributes:e},t,{transformFieldRoles:r}){const o=e[r.originX],n=e[r.originY],a=e[r.originZ];return new s({x:o,y:n,z:a,spatialReference:t})}function h(e,{transformFieldRoles:t}){return new i({translation:[e[t.translationX],-e[t.translationZ],e[t.translationY]],rotationAxis:[e[t.rotationX],-e[t.rotationZ],e[t.rotationY]],rotationAngle:e[t.rotationDeg],scale:[e[t.scaleX],e[t.scaleZ],e[t.scaleY]]})}var S;function d(e,t){const o=new Map;for(const n of t){const t=n.parentGlobalId;if(null==t)continue;const s=n.assetName,a=n.assetType,i=n.assetHash,u=n.assetURL,f=n.conversionStatus,l=n.seqNo,p=c(a,e.supportedFormats);if(!p){m().error(\"mesh-feature-set:unknown-format\",`Service returned an asset of type ${a}, but it does not list it as a supported type`);continue}const g=r(o,t,(()=>({files:new Map})));r(g.files,s,(()=>({name:s,type:a,mimeType:p,status:M(f),parts:[]}))).parts[l]={hash:i,url:u}}return o}function D(e){const t=Array.from(e.files.values()),r=new Array;for(const o of t){if(o.status!==S.COMPLETED)return null;const e=new Array;for(const t of o.parts){if(!t)return null;e.push(new u(t.url,t.hash))}r.push(new f(o.name,o.mimeType,e))}return r}function M(e){switch(e){case\"COMPLETED\":case\"SUBMITTED\":return S.COMPLETED;case\"INPROGRESS\":return S.PENDING;default:return S.FAILED}}!function(e){e[e.FAILED=0]=\"FAILED\",e[e.PENDING=1]=\"PENDING\",e[e.COMPLETED=2]=\"COMPLETED\"}(S||(S={}));export{d as assetMapFromAssetMapsJSON,y as extractMesh,p as meshFeatureSetFromJSON};\n"],"names":["m","t","p","r","o","n","s","l","i","d","u","a","f","c","g","y","e","E","h","D","S","M"],"mappings":"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","x_google_ignoreList":[0]}