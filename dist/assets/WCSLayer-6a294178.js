import{s as F,B as q,bF as $e,U as he,c2 as ge,r as D,q as A,w as ve,$ as oe,d9 as De,da as Te,eE as Le,eF as Ae,eQ as Re,fa as Pe,eD as Ee,eG as Oe,aU as Me,dd as Ne,fH as Ve,bX as ke,hF as Fe,hv as ne,cv as Ge,eI as _e,hL as Be,cy as je,ef as de,_ as We}from"./index-02eff6e6.js";import{t as y,e as x,n as E,r as I,l as O,i as P,c as ye,X as qe,W as Ue}from"./xmlUtilities-d40cdb10.js";import{D as He,p as ze,b as Ye}from"./rasterFieldUtils-0fc7af49.js";import{o as be}from"./crsUtils-3bab3d8c.js";import{a as ae,P as Xe}from"./RasterSymbolizer-12bf09d5.js";import{P as Ze}from"./dataUtils-4579a822.js";import"./ImageHistogramParameters-62eaa63b.js";import"./ClassBreaksDefinition-0149e616.js";import"./RawBlockCache-b7bcc0d1.js";import"./rasterProjectionHelper-e7904c0e.js";import"./rasterFunctionHelper-bcd1750d.js";import"./_commonjsHelpers-2f3e7994.js";function K(n){return n.endsWith("?")?n.slice(0,-1):n}function re(n){return n.filter(({coverageSubType:e})=>e==null||e===""||/^rectified(grid|dataset)/i.test(e))}function Ke(n){var c,l,d;const e=y(n,"Service/name"),t=x(n,"Capability"),s=((c=x(t,"GetCapabilities/Get/OnlineResource"))==null?void 0:c.getAttribute("xlink:href"))??"",i=((l=x(t,"DescribeCoverage/Get/OnlineResource"))==null?void 0:l.getAttribute("xlink:href"))??"",o=((d=x(t,"GetCoverage/Get/OnlineResource"))==null?void 0:d.getAttribute("xlink:href"))??"",r={getCapabilities:K(s),describeCoverage:K(i),getCoverage:K(o)},u=E(n,"CoverageOfferingBrief"),a=[];for(let h=0;h<u.length;h++){const f=u[h],g=y(f,"name"),m=E(f,"pos"),p=I(m[0]),v=I(m[1]),b=new q({xmin:p[0],ymin:p[1],xmax:v[0],ymax:v[1],spatialReference:{wkid:4326}});a.push({id:g,lonLatEnvelope:b})}return{name:e,onlineResources:r,coverages:a,gridCoverages:re(a),supportedVersions:["1.0.0"],version:"1.0.0"}}function we(n){const e={};for(let t=0;t<n.childNodes.length;t++){const s=n.childNodes[t];if(s.nodeType!==1)continue;const i=ye(s).toLowerCase();switch(i){case"title":case"abstract":e[i]=y(s);break;case"identifier":e.id=y(s);break;case"wgs84boundingbox":{const o=I(s,"LowerCorner"),r=I(s,"UpperCorner");e.lonLatEnvelope=new q({xmin:o[0],ymin:o[1],xmax:r[0],ymax:r[1],spatialReference:{wkid:4326}})}break;case"coveragesummary":e.coverageSummaries=e.coverageSummaries||[],e.coverageSummaries.push(we(s))}}return e}function xe(n,e){if(n.coverageSummaries)for(let t=0;t<n.coverageSummaries.length;t++)n.coverageSummaries[t].abstract=n.coverageSummaries[t].abstract||n.abstract,n.coverageSummaries[t].lonLatEnvelope=n.coverageSummaries[t].lonLatEnvelope||n.lonLatEnvelope,n.coverageSummaries[t].title=n.coverageSummaries[t].title||n.title,xe(n.coverageSummaries[t],e);n.id!=null&&e.push(n)}function Ce(n){var i,o,r;const e=((i=x(n.querySelector("Operation[name=GetCapabilities]"),"Get"))==null?void 0:i.getAttribute("xlink:href"))||"",t=((o=x(n.querySelector("Operation[name=DescribeCoverage]"),"Get"))==null?void 0:o.getAttribute("xlink:href"))||"",s=((r=x(n.querySelector("Operation[name=GetCoverage]"),"Get"))==null?void 0:r.getAttribute("xlink:href"))||"";return{getCapabilities:K(e),describeCoverage:K(t),getCoverage:K(s)}}function Qe(n){const e=y(n,"ServiceIdentification/Title"),t=O(n,"ServiceIdentification/ServiceTypeVersion"),s=Ce(x(n,"OperationsMetadata")),i=[],o=x(n,"Contents");for(let u=0;u<o.childNodes.length;u++){const a=o.childNodes[u];a.nodeType===1&&P(a,"CoverageSummary")&&xe(we(a),i)}const r=O(o,"SupportedFormat");return{name:e,onlineResources:s,coverages:i,gridCoverages:re(i),supportedVersions:t,supportedFormats:r,version:"1.1.0"}}function Je(n){const e=x(n,"ServiceIdentification"),t=y(e,"Title"),s=O(e,"ServiceTypeVersion"),i=O(e,"Profile"),o=Ce(x(n,"OperationsMetadata")),r=E(n,"Contents/CoverageSummary"),u=[];for(let c=0;c<r.length;c++){const l=r[c],d=y(l,"CoverageId"),h=x(l,"WGS84BoundingBox");let f;if(h){const m=I(h,"LowerCorner"),p=I(h,"UpperCorner");f=new q({xmin:m[0],ymin:m[1],xmax:p[0],ymax:p[1],spatialReference:{wkid:4326}})}const g=y(l,"CoverageSubtype")||"RectifiedGridCoverage";u.push({id:d,lonLatEnvelope:f,coverageSubType:g})}const a=x(n,"ServiceMetadata");return{name:t,supportedVersions:s,supportedFormats:O(a,"formatSupported"),supportedInterpolations:O(a,"interpolationSupported").concat(O(a,"InterpolationSupported")),onlineResources:o,profiles:i,coverages:u,gridCoverages:re(u),version:"2.0.1"}}function et(n,e=null){let t=null;typeof n=="string"?t=new DOMParser().parseFromString(n,"text/xml"):t=n;let s=t.documentElement.getAttribute("version");s==="1.0"?s="1.0.0":s==="1.1"&&(s="1.1.0");const i=s||e||"1.0.0",o=i.slice(0,3);let r;if(o==="2.0")r=Je(t);else if(o==="1.1")r=Qe(t);else{if(o!=="1.0")throw new F("wcsraster:parsecapabilities","the capabilities version is not supported");r=Ke(t)}return r.version=i,r}function le(n){n.variables.forEach(e=>e.dimensions.forEach(t=>t.values??(t.values=He(t))))}function tt(n){return{requestResponseCRSs:O(n,"requestResponseCRSs").map(e=>e.split(":")[1]),nativeCRSs:O(n,"nativeCRSs").map(e=>e.split(":")[1])}}function Se(n,e){const t=O(n,e==="1.0.0"?"interpolationMethod":"InterpolationMethod"),s=e==="1.0.0"?n.getAttribute("default"):y(n,"InterpolationMethods/Default");return s!=null?[s].concat(t.filter(i=>i.toLowerCase()!==s.toLowerCase())):t}function ce(n){return n==null?["nearest"]:n.map(e=>{const t=e.toLowerCase();return t.includes("nearest")?"nearest":t.includes("linear")?"bilinear":t.includes("cubic")?"cubic":null}).filter(e=>!!e)}function nt(n){const e=E(n,"pos"),t=I(e[0]),s=I(e[1]);return new q({xmin:t[0],ymin:t[1],xmax:s[0],ymax:s[1],spatialReference:{wkid:4326}})}function ue(n,e){const t=O(n,e);return t!=null&&t.length&&t[0]!==""&&!isNaN(Number(t[0]))?t.map(s=>Number(s)):null}function it(n){const e=I(n,"MinimumValue"),t=I(n,"MaximumValue");return e.length&&t.length?e.map((s,i)=>({min:s,max:t[i],avg:-1,stddev:-1})):null}function pe(n){return n==null?null:n.every(e=>e===n[0])?n[0]:n}function st(n){const e=[],t=E(n,"RangeSet");let s=[];for(let i=0;i<t.length;i++){const o=y(t[i],"name"),r=y(t[i],"label"),u=[],a=ue(t[i],"nullValues/singleValue"),c=E(t[i],"AxisDescription");for(let l=0;l<c.length;l++){const d=y(c[l],"name"),h=y(c[l],"label"),f=O(c[l],"singleValue");if(f.length===0){const g=y(c[l],"min"),m=y(c[l],"max"),p=Number(y(c[l],"res"))||1;if(g!==null&&m!==null)for(let v=parseInt(g,10);v<=parseInt(m,10);v+=p)f.push(v.toString())}d.toLowerCase()==="band"&&(s=f),u.push({name:d,label:h,values:f})}e.push({name:o,label:r,nullValues:a,axis:u})}return{rangeSet:e,bandNames:s}}function ot(n=null){if(!n)return{resolution:null,units:null};let e=n.toUpperCase();const t=["Y","M","D"],s=["H","M","S"],i=["Years","Months","Days","Hours","Minutes","Seconds"];let o,r,u;return e.includes("PT")?(e=e.slice(2),u=s.findIndex(a=>e.includes(a)),o=i[3+u],r=parseFloat(e.slice(0,-1))):(e=e.slice(1),u=t.findIndex(a=>e.includes(a)),u>-1&&(o=i[u]),r=parseFloat(e.slice(0,-1))),{resolution:r,units:o}}function se(n){const e=E(n,"timeposition");if(e.length>0){const s=[];for(let i=0;i<e.length;i++)s.push(new Date(y(e[i])));return{begin:s[0],end:s[s.length-1],values:s}}const t=x(n,"timePeriod")||x(n,"TimePeriod");return t?{begin:new Date(y(t,"beginPosition")||y(t,"BeginPosition")),end:new Date(y(t,"endPosition")||y(t,"EndPosition")),...ot(y(t,"timeResolution")||y(t,"TimeResolution"))}:null}function at(n){const e=x(n,"spatialDomain"),t=x(e,"Envelope")||x(e,"EnvelopeWithTimePeriod"),s=t.getAttribute("srsName").split(":"),i=s[s.length-1],o=E(t,"pos"),r=I(o[0]),u=I(o[1]),a=parseInt(i,10),c=isNaN(a)?null:{wkid:a},l=new q({xmin:r[0],ymin:r[1],xmax:u[0],ymax:u[1],spatialReference:c}),d=x(e,"RectifiedGrid"),h=y(d,"low").split(" "),f=y(d,"high").split(" "),g=parseInt(f[0],10)-parseInt(h[0],10)+1,m=parseInt(f[1],10)-parseInt(h[1],10)+1,p=I(e,"origin/pos"),v=E(e,"offsetVector"),b={envelope:l,columns:g,rows:m,offset:{x:parseFloat(y(v[0]).split(" ")[0]),y:parseFloat(y(v[1]).split(" ")[1])},origin:{x:p[0],y:p[1]}},w=x(n,"temporalDomain")||x(n,"TemporalDomain");return{spatialDomain:b,temporalDomain:w?se(w):null}}function rt(n){const e={version:"1.0"};let t,s=[];for(let g=0;g<n.childNodes.length;g++){const m=n.childNodes[g];if(m.nodeType===1)if(P(m,"description"))e.description=y(m);else if(P(m,"name"))e.name=y(m);else if(P(m,"label"))e.label=y(m);else if(P(m,"supportedFormats"))e.supportedFormats=O(m,"formats");else if(P(m,"supportedCRSs"))e.supportedCRSs=tt(m);else if(P(m,"supportedInterpolations"))e.supportedInterpolations=Se(m,"1.0.0");else if(P(m,"lonLatEnvelope"))e.lonLatEnvelope=nt(m);else if(P(m,"rangeSet")){const p=st(m);e.rangeSet=p.rangeSet,s=p.bandNames;const v=p.rangeSet[0].nullValues;v!=null&&v.length&&(t=pe(v))}else P(m,"domainSet")&&(e.domainSet=at(m))}const i=ce(e.supportedInterpolations),{name:o,description:r,label:u,lonLatEnvelope:a,supportedFormats:c}=e,{spatialDomain:l}=e.domainSet,d={x:Math.abs(l.offset.x),y:Math.abs(l.offset.y)},h=lt(e.domainSet),f=new ae({width:l.columns,height:l.rows,pixelSize:d,pixelType:"unknown",extent:l.envelope,spatialReference:l.envelope.spatialReference,bandCount:s.length||1,noDataValue:t,multidimensionalInfo:h});return{id:o,title:e.name,description:r||u,lonLatEnvelope:a,rasterInfo:f,bandNames:s,supportedFormats:c,supportedInterpolations:i,coverageDescription:e,version:"1.0.0",useEPSGAxis:!1}}function lt(n){if(!n.temporalDomain)return null;const{begin:e,end:t,values:s,units:i,resolution:o}=n.temporalDomain,r={variables:[{name:"default",description:"",dimensions:[{name:"StdTime",description:"",unit:"ISO8601",values:s==null?void 0:s.map(u=>u.getTime()),hasRegularIntervals:!s,interval:o,intervalUnit:i,extent:[e.getTime(),t.getTime()]}]}]};return le(r),r}function ct(n,e){const t=[],s=E(n,"Field");let i,o=[];for(let r=0;r<s.length;r++){const u=y(s[r],"Identifier"),a=y(s[r],"Description"),c=y(s[r],"Definition"),l=y(s[r],"Abstract"),d=y(s[r],"Title"),h=ue(s[r],"NullValue"),f=x(s[r],"AllowedValues"),g=f?it(f):null,m=Se(s[r],"1.1.0"),p=[],v=E(s[r],"Axis");for(let b=0;b<v.length;b++){const w=v[b].getAttribute("identifier"),$=y(v[b],"UOM"),C=y(v[b],"DataType"),T=O(v[b],"Key");e&&!w.toLowerCase().includes("band")||(o=T,i=h),p.push({identifier:w,uom:$,dataType:C,values:T,bandNoDataValues:i})}t.push({identifier:u,description:a,definition:c,abstract:l,title:d,supportedInterpolations:m,axis:p,nullValues:h,statistics:g})}return{rangeSet:t,bandNames:o,bandNoDataValues:i,statistics:t[0].statistics}}function ut(n,e){if(!e.temporalDomain)return null;const t=n.filter(i=>!i.identifier.toLowerCase().includes("field_1")&&!i.axis.some(o=>o.identifier.includes("band"))),s=[];if(t.length&&t.forEach(i=>{var r;const o=i.axis.map(u=>{const a=u.values.map(l=>u.uom==="ISO8601"?(l=l.trim()).toLowerCase().includes("z")?new Date(l).getTime():new Date(l+"Z").getTime():parseFloat(l.trim())),c=[Math.min.apply(null,a),Math.max.apply(null,a)];return{name:u.identifier.trim(),description:"",field:u.identifier.trim(),unit:u.uom?u.uom.trim():"",hasRegularIntervals:!1,values:a,extent:c}});s.push({name:i.identifier.trim(),description:((r=i.description)==null?void 0:r.trim())??"",unit:"",dimensions:o,statistics:i.statistics})}),e.temporalDomain){const{begin:i,end:o,values:r,units:u,resolution:a}=e.temporalDomain;s.some(c=>c.dimensions.some(l=>l.name.toLowerCase()==="stdtime"))||s.forEach(c=>{c.dimensions.push({name:"StdTime",description:"",unit:"ISO8601",values:r==null?void 0:r.map(l=>l.getTime()),hasRegularIntervals:!r,interval:a,intervalUnit:u,extent:[i.getTime(),o.getTime()]})})}if(s.length){const i={variables:s};return le(i),i}return null}function pt(n){var v;const e=x(n,"SpatialDomain"),t=x(e,"GridCRS"),s=y(t,"GridBaseCRS"),i=y(t,"GridOrigin"),o=(i==null?void 0:i.split(" ").map(b=>parseFloat(b)))??[0,0],r=I(t,"GridOffsets"),u=E(e,"BoundingBox");let a,c,l,d;for(let b=0;b<u.length;b++){const w=(v=u[b].getAttribute("crs"))==null?void 0:v.toLowerCase();if(w!=null){if(w.includes("imagecrs")){const $=I(u[b],"LowerCorner"),C=I(u[b],"UpperCorner");a=C[0]-$[0]+1,c=C[1]-$[1]+1}else if(w.indexOf("epsg")>0){const $=w.split(":");l=parseInt($[$.length-1],10);const C=I(u[b],"LowerCorner"),T=I(u[b],"UpperCorner");d=new q({xmin:C[0],ymin:C[1],xmax:T[0],ymax:T[1],spatialReference:{wkid:l}})}}}const h=a>c,f=d.xmax-d.xmin>d.ymax-d.ymin;let g=!1;be(l)&&(h===f?g=!1:(g=!0,d=new q({xmin:d.ymin,ymin:d.xmin,xmax:d.ymax,ymax:d.xmax,spatialReference:{wkid:l}})));const m={columns:a,rows:c,origin:{x:o[0],y:o[1]},offset:{x:r[0],y:r[r.length-1]},gridBaseCRS:s,envelope:d,useEPSGAxis:g},p=x(n,"temporalDomain")||x(n,"TemporalDomain");return{spatialDomain:m,temporalDomain:p?se(p):null}}function dt(n,e){var v;const t=[],s=[],i={supportedFormats:t,supportedCRSs:s,version:"1.1"};let o,r,u=[];for(let b=0;b<n.childNodes.length;b++){const w=n.childNodes[b];if(w.nodeType!==1)continue;const $=ye(w).toLowerCase();switch($){case"title":case"abstract":case"identifier":i[$]=y(w);break;case"supportedformat":{const C=y(w);t.includes(C)||t.push(C)}break;case"supportedcrs":{const C=y(w);s.includes(C)||s.push(C)}break;case"range":{const C=ct(w,!!((v=i.domain)!=null&&v.temporalDomain));i.range=C.rangeSet,u=C.bandNames;const{bandNoDataValues:T}=C;T!=null&&T.length&&(o=pe(T)),r=C.statistics}break;case"domain":i.domain=pt(w)}}const a=ce(i.range[0].supportedInterpolations),{identifier:c,abstract:l,title:d,domain:h,range:f}=i,g={x:Math.abs(h.spatialDomain.offset.x),y:Math.abs(h.spatialDomain.offset.y)},m=ut(f,h);m&&(o=f[0].nullValues,(o==null?void 0:o.length)===1&&(o=o[0]));const p=new ae({width:h.spatialDomain.columns,height:h.spatialDomain.rows,pixelSize:g,pixelType:"unknown",extent:h.spatialDomain.envelope,spatialReference:h.spatialDomain.envelope.spatialReference,bandCount:u.length||1,noDataValue:o,statistics:r,multidimensionalInfo:m});return{id:c,title:i.title,description:l||d,bandNames:u,rasterInfo:p,supportedFormats:t,supportedInterpolations:a,coverageDescription:i,version:e,useEPSGAxis:h.spatialDomain.useEPSGAxis}}function mt(n){const e=x(n,"Envelope")||x(n,"EnvelopeWithTimePeriod"),t=e.getAttribute("srsName"),s=t.slice(t.lastIndexOf("/")+1),i=e.getAttribute("axisLabels").split(" ").map(m=>m.trim()).filter(m=>m.trim()!==""),o=I(e,"lowerCorner"),r=I(e,"upperCorner"),u=!["y","lat","latitude","north","nor","n","b"].includes(i[0].toLowerCase());let a;const c=parseInt(s,10),l=isNaN(c)?null:{wkid:c};a=new q(u?{xmin:o[0],ymin:o[1],xmax:r[0],ymax:r[1],spatialReference:l}:{xmin:o[1],ymin:o[0],xmax:r[1],ymax:r[0],spatialReference:l});const d={mins:o,maxs:r},h=e.getAttribute("uomLabels").trim().split(" ");let f,g;if(P(e,"EnvelopeWithTimePeriod")){f=new Date(y(n,"beginPosition")||y(n,"BeginPosition")),g=new Date(y(n,"endPosition")||y(n,"EndPosition"));const m=h==null?void 0:h.findIndex(p=>(p==null?void 0:p.toLowerCase())==="oledatetime");m>-1&&(h[m]="ISO8601")}return{envelope:a,axisLabels:i,uomLabels:h.length?h:null,envelopeAllDims:d,beginPosition:f,endPosition:g,isEastFirst:u}}function ft(n,e){var u,a;const t=[],s=E(n,"DataRecord"),i=[];let o,r=[];for(let c=0;c<s.length;c++){const l=E(s[c],"field"),d=[];for(let h=0;h<l.length;h++){const f=l[h].getAttribute("name"),g=y(l[h],"description")||"",m=((u=x(l[h],"uom"))==null?void 0:u.getAttribute("code"))||"",p=I(l[h],"interval"),v=(a=ue(l[h],"nilValue"))==null?void 0:a[0];e&&!f.toLowerCase().includes("band")||(i.push(f),p!=null&&p.length&&(o=o||[],o.push({min:p[0],max:p[1],avg:-1,stddev:-1})),r.push(v)),d.push({name:f,description:g,uom:m,allowedValues:p,nilValue:v})}t.push(d)}return r.some(c=>c!=null)||(r=null),{rangeType:t,bandNames:i,bandStats:o,bandNoDataValues:r}}function ht(n){let e=1,t="";const s=.01;return Math.abs(n-1/24)<1/24*s?t="Hours":Math.abs(n-1)<1*s?t="Days":n<1?(e=Math.round(24*n),t="Hours"):n>28-s&&n<31+s||Math.round(n/30)<12?t="Months":n>365-s&&n<366+s&&(t="Years"),{interval:e,intervalUnit:t}}function gt(n,e,t){var o,r;if(t.axisLabels.length<=2)return null;const s=[];for(let u=0;u<n.length;u++){const a=n[u];for(let c=0;c<a.length;c++)a[c].name.toLowerCase().includes("band")||s.push(a[c])}const i=[];if(s.length){const u=[];for(let a=2;a<t.axisLabels.length;a++){const c=((r=(o=e.uomLabels)==null?void 0:o[a])==null?void 0:r.trim())??"",l=t.axisLabels[a].toLowerCase().includes("time")||c.toLowerCase()==="iso8601"||c.toLowerCase()==="oledatetime";let d,h;if(l){const g=ht(t.offset[a]);d=g.interval,h=g.intervalUnit}else d=t.offset[a],h=c;const f=[];l?(f.push(new Date().setTime(24*(e.envelopeAllDims.mins[a]-25569)*3600*1e3)),f.push(new Date().setTime(24*(e.envelopeAllDims.maxs[a]-25569)*3600*1e3))):(f.push(e.envelopeAllDims.mins[a]),f.push(e.envelopeAllDims.maxs[a])),u.push({name:t.axisLabels[a].trim(),description:t.axisLabels[a].trim(),unit:l?"ISO8601":c,hasRegularIntervals:!0,extent:f,interval:d,intervalUnit:h})}if(s.forEach(a=>{var d;const{allowedValues:c}=a,l=(c==null?void 0:c.length)===2?[{min:c[0],max:c[1],avg:-1,stddev:-1}]:null;i.push({name:a.name.trim(),description:((d=a.description)==null?void 0:d.trim())??"",unit:a.uom.trim(),statistics:l,dimensions:u})}),i.length){const a={variables:i};return le(a),a}}return null}function vt(n,e){const t=x(n,"RectifiedGrid"),s=I(t,"low"),i=I(t,"high"),o=[];for(let p=0;p<s.length;p++)o.push(i[p]-s[p]+1);const r=y(t,"axisLabels").split(" "),u=I(t,"origin/pos"),a=E(t,"offsetVector"),c=[];for(let p=0;p<a.length;p++){const v=I(a[p]),b=v.findIndex(w=>w!==0);c[b]=v[b]}const l=["y","lat","latitude","north","nor","n","b"];let d=!1;e!=null&&e.length&&(r!=null&&r.length)&&(d=[...e].sort((p,v)=>p<v?-1:1).join(",")===[...r].sort((p,v)=>p<v?-1:1).join(","));const h=d?r:e;let f,g,m;return l.includes(h[0].toLowerCase())?(f=o[1],g=o[0],m={y:Math.abs(c[0]),x:Math.abs(c[1])}):(f=o[0],g=o[1],m={x:Math.abs(c[0]),y:Math.abs(c[1])}),{columns:f,rows:g,origin:u,offset:c,resolution:m,gridSamples:o,axisLabels:r,hasSameAxisLabelsAsBoundedBy:d}}function yt(n){const e=x(n,"EarthObservation");if(!e)return null;const t=x(e,"phenomenonTime"),s=t?se(t):null,i=x(e,"phenomenonTime"),o=i?se(i):null,r=y(e,"featureOfInterest/Footprint/multiExtentOf/MultiSurface/surfaceMembers/Polygon/exterior/LinearRing/posList");let u=null;if(r){const a=r.split(" ").map(c=>c.trim()).filter(c=>c!=null&&c!=="").map(Number);if(a.length){const c=[];for(let l=0;l<a.length/2;l+=2)c.push(a[l],a[l+1]);u=new $e({rings:[[c]]})}}return{observation:{phenomenonTime:s,resultTime:o,footprint:u,identifier:y(n,"metaDataProperty/EarthObservationMetaData/identifier"),acquisitionType:y(n,"metaDataProperty/EarthObservationMetaData/acquisitionType"),status:y(n,"metaDataProperty/EarthObservationMetaData/status")}}}function bt(n){var d,h,f;const e={version:"2.0"};let t,s,i=[];for(let g=0;g<n.childNodes.length;g++){const m=n.childNodes[g];if(m.nodeType===1){if(P(m,"coverageId"))e.coverageId=y(m);else if(P(m,"ServiceParameters"))e.serviceParameters={supportedFormats:O(m,"nativeFormat")};else if(P(m,"boundedBy"))e.boundedBy=mt(m);else if(P(m,"rangeType")){const p=ft(m,((d=e.boundedBy)==null?void 0:d.axisLabels.length)>2||((h=e.domainSet)==null?void 0:h.axisLabels.length)>2);e.rangeType=p.rangeType,i=p.bandNames,t=p.bandStats;const{bandNoDataValues:v}=p;v!=null&&v.length&&(s=pe(v))}else if(P(m,"domainSet"))e.domainSet=vt(m,(f=e.boundedBy)==null?void 0:f.axisLabels);else if(P(m,"metadata")){const p=x(m,"EOMetadata");e.eoMetadata=p?yt(p):null}}}const{coverageId:o,boundedBy:r,domainSet:u,rangeType:a,serviceParameters:c}=e,l=gt(a,r,u);return!t&&l&&(t=l==null?void 0:l.variables[0].statistics),l!=null&&(s=a[0][0].nilValue),{id:o,title:o,description:o,bandNames:i,rasterInfo:new ae({width:u.columns,height:u.rows,pixelSize:u.resolution,pixelType:"unknown",extent:r.envelope,spatialReference:r.envelope.spatialReference,bandCount:i.length||1,statistics:t,noDataValue:s,multidimensionalInfo:l}),supportedFormats:c.supportedFormats,coverageDescription:e,version:"2.0.1",useEPSGAxis:!1}}function wt(n,e){let t=null;if(typeof n=="string"?t=new DOMParser().parseFromString(n,"text/xml"):t=n,e==="1.0.0")return E(t,"CoverageOffering").map(i=>rt(i));const s=E(t,"CoverageDescription");return e==="1.1.0"||e==="1.1.1"||e==="1.1.2"?s.map(i=>dt(i,e)):s.map(i=>bt(i))}async function xt(n,e){const{version:t,customParameters:s,signal:i}=e??{},o=t!=null&&t.startsWith("1.0")?"version":"acceptVersions",r={service:"WCS",request:"GetCapabilities",[o]:t,...s};try{const{data:u}=await he(n,{query:r,responseType:"xml",signal:i});return et(u)}catch(u){throw ge(u)?u:new F("wcslayer:open","wcs capabilities is not valid or supported")}}async function Ct(n,e){const{coverageIds:t,version:s,customParameters:i,signal:o}=e,r=s.slice(0,3),u=r==="1.0"?"coverage":r==="1.1"?"identifiers":"coverageId",a={service:"WCS",request:"DescribeCoverage",version:s,[u]:t.join(","),...i};try{const{data:c}=await he(n,{query:a,responseType:"xml",signal:o});return wt(c,s)}catch(c){throw ge(c)?c:new F("wcslayer:open","wcs coverage description is not valid or supported")}}const St=5e4;function It(n){const e=Dt(n);return e?{isMultipart:!0,data:e.boundary?$t(n.data,e,0):null}:{isMultipart:!1,data:null}}function $t(n,e,t=0){const s="--"+e.boundary,i=[];for(let p=0;p<s.length;p++)i.push(s.charCodeAt(p));const o=[],r=`
--`+e.boundary+"--";for(let p=0;p<r.length;p++)o.push(r.charCodeAt(p));const u=[10],a=[13,10],c=[],l=i.length,d=new Uint8Array(n,t),h=Math.min(St,d.length-l);let f=0,g=0;for(let p=0;p<h;p++){for(g=0;g<l&&d[p+g]===i[g];g++);g===l&&(f&&c.push(me(d.subarray(f,p),e)),p+=l-1,d[p+1]===u[0]?p+=1:d[p+1]===a[0]&&d[p+2]===a[1]&&(p+=2),f=p+1)}const m=o.length;for(let p=d.length-m-10;p<d.length-m;p++){for(g=0;g<m&&d[p+g]===o[g];g++);if(g===m){c.push(me(d.subarray(f,p),e));break}}return c}function Dt(n){var s,i;const e=(i=(s=n.getHeader)==null?void 0:s.call(n,"Content-Type"))==null?void 0:i.split(";");if(!e||!(e[0].trim()??"").startsWith("multipart/"))return null;const t={boundary:"",start:"",type:""};for(let o=1;o<e.length;o++){const r=e[o].indexOf("=");if(r>0){const u=e[o].slice(0,r).trim(),a=e[o].slice(r+1).trim();t[u]=a.startsWith('"')?a.slice(1,-1):a}}return t}function me(n,e){var r;const t=String.fromCharCode.apply(null,n.subarray(0,Math.min(300,n.length))).split(`
`),s=Math.min(t.length,7),i={contentDisposition:"inline"};let o=0;for(let u=0;u<s;u++)if(t[u].length<4)o=o+t[u].length+1;else if(t[u].slice(0,7).toLowerCase()==="content"){o=o+t[u].length+1;const a=t[u].indexOf(":");if(a===-1)continue;const c=t[u].slice(0,a).trim(),l=t[u].slice(a+1).trim();switch(c.toLowerCase()){case"content-type":i.contentType=l;break;case"content-description":i.contentDescription=l;break;case"content-transfer-encoding":i.contentTransferEncoding=l;break;case"content-id":i.contentID=l;break;case"content-disposition":i.contentDisposition=l;break;case"content-location":i.contentLocation=l}}else{if(i.contentDisposition.toLowerCase().includes("inline")&&t[u].length>=4&&((r=i.contentType)==null?void 0:r.toLowerCase().indexOf("image"))>-1){let a=!0,c=n.subarray(o,n.length);if(i.contentType.toLowerCase().indexOf("tif")>0){if(i.contentTransferEncoding==="base64"){let l="";const d=c;for(let f=0;f<d.length;f+=65535){const g=d.subarray(f,f+65535>d.length-1?d.length-1:f+65535);l+=String.fromCharCode.apply(null,g)}const h=atob(l);c=new Uint8Array(h.length);for(let f=0;f<c.length;f++)c[f]=h.charCodeAt(f)}a=c[0]===73&&c[1]===73||c[0]===77&&c[1]===77}if(a){let l=c.buffer;i.contentTransferEncoding!=="base64"&&(l=new ArrayBuffer(n.length-o),c=new Uint8Array(l),c.set(n.subarray(o,n.length))),i.contentData=l}break}if((e.start===""||i.contentID===e.start)&&i.contentType){if(i.contentType.includes("text")||i.contentType.includes("xml")){i.contentData=String.fromCharCode.apply(null,n.subarray(o,n.length));break}i.contentData=n.subarray(o,n.length)}}return i}const Tt=["nearest neighbor","bilinear","bicubic"],Lt=["nearest","linear","cubic"],fe="response is not a supported multipart/related mediaType with inline tiff,  switching to compatibility mode",At="response is not a supported multipart mediaType with inline tiff",Rt="response is base64 encoded which may impact layer display performance",Pt="server returns an exception",Et=new Set(["1.0.0","1.1.0","1.1.1","1.1.2","2.0.1"]);let X=class extends qe{constructor(){super(...arguments),this.datasetFormat="WCSServer",this.tileType="Raster"}async fetchRawTile(e,t,s,i={}){if(this.isBlockOutside(e,t,s))return null;const{nativePixelSize:o,spatialReference:r}=this.rasterInfo,u=2**e,a=o.x*u,c=o.y*u,{blockWidth:l,blockHeight:d}=this.getBlockWidthHeight(e),{origin:h}=this.rasterInfo.storageInfo.tileInfo,f=this.getTileExtent({x:a,y:c},t,s,h,r,[l,d]),g=this.rasterInfo.extent,m=f.xmax>g.xmax,p=f.ymin<g.ymin,v=m||p;let b=f,w=l,$=d;if(v&&(b=f.clone().intersection(g),b!=null&&(m&&(w=Math.floor((b.xmax-b.xmin)/a),b.xmax=b.xmin+a*w),p&&($=Math.floor((b.ymax-b.ymin)/c),b.ymin=b.ymax-c*$))),b==null||w<=1||$<=1)return null;const C=await this._getCoverage(b,w,$,u,i);if(!C)return null;const{coverageDescription:T}=this.coverageInfo,{noDataValue:Q,multidimensionalInfo:M}=this.rasterInfo,{multidimensionalDefinition:U}=i;let j;if(M!=null&&U!=null&&U.length){const z=U[0].variableName;if(T.version==="2.0"){const _=T.rangeType[0].find(G=>G.name===z);j=_==null?void 0:_.nilValue}else if(T.version==="1.1"){const _=T.range.find(G=>G.identifier===z);j=_==null?void 0:_.nullValues}}const H=j??Q,V=await this.decodePixelBlock(C,{width:w,height:$,planes:null,pixelType:null,tiffNoDataValue:Array.isArray(H)?H[0]:H});if(V==null)return null;if(V&&(V.width!==w||V.height!==$))throw new F("wcsraster-fetch",`the response has unexpected dimension width: ${V.width}, height: {pixelBlock.height}`);return v?Ze(V,{x:0,y:0},{width:d,height:d}):V}async _open(e){const{customFetchParameters:t}=this.ioConfig,s=e==null?void 0:e.signal,i=await xt(this.url,{version:this.version,customParameters:t,signal:s});if(this.capabilities=i,!this.version){let d=i.version.slice(0,3);d==="2.0"||d==="1.1"||d==="1.0"?this.version=i.version:(d=i.supportedVersions.find(h=>h==="2.0.1")||i.supportedVersions.find(h=>h.slice(0,3)==="2.0")||i.supportedVersions.find(h=>h.slice(0,3)==="1.1")||i.supportedVersions.find(h=>h.slice(0,3)==="1.0")||"1.0.0",this.version=d)}if(!Et.has(this.version))throw new F("wcsraster-open",`unsupported WCS version ${this.version}`);const{gridCoverages:o}=i;if(!o.length)throw new F("wcsraster-open","cannot find rectified grid coverages");this.coverageId==null&&(this.coverageId=o[0].id);const r=o.find(d=>d.id===this.coverageId);if(r==null)throw new F("wcsraster-open",`the coverageId ${this.coverageId} does not exist in capabilities`);const u=await Ct(this.url,{coverageIds:[this.coverageId],version:this.version,customParameters:t,signal:s});this.coverageInfo=u[0],this.version.slice(0,3)==="2.0"&&(this.coverageInfo.lonLatEnvelope=r.lonLatEnvelope,this.coverageInfo.supportedInterpolations=ce(i.supportedInterpolations)),this.datasetName=this.coverageInfo.title;const{rasterInfo:a}=this.coverageInfo;if(this.createRemoteDatasetStorageInfo(a,512,512),this._set("rasterInfo",a),a.spatialReference==null)throw new F("wcsraster-open",`coverage without spatial reference is not supported: ${this.coverageId}`);const{pixelType:c,bandCount:l}=await this._getPixelTypeAndBandCount(s);a.pixelType=c,a.bandCount===1&&l>1&&(a.bandCount=l),this.updateTileInfo()}async _getPixelTypeAndBandCount(e){var m;const{pixelSize:t,extent:s,multidimensionalInfo:i}=this.rasterInfo,o=s.center,r=new q({xmin:o.x-t.x,xmax:o.x+t.x,ymin:o.y-t.y,ymax:o.y+t.y,spatialReference:s.spatialReference});let u=[];if(i!=null){const p=i.variables[0];u=[],p.dimensions.forEach(v=>{var b,w;u.push(new ze({variableName:p.name,dimensionName:v.name,values:v.hasRegularIntervals?(b=v.extent)==null?void 0:b[0]:(w=v.values)==null?void 0:w[0],isSlice:!0}))})}const{coverageDescription:a}=this.coverageInfo,c={interpolation:"nearest",multidimensionalDefinition:u,signal:e},{version:l}=a,{ioConfig:d}=this,h=l==="2.0"&&d.allowAnyMediaType==null||l==="1.1"&&d.use2GridOffsets==null;let f;try{f=await this._getCoverage(r,2,2,1,c,!0)}catch(p){if(!h)throw p;if(l==="1.1"){if(!((m=p.details)!=null&&m.isResolutionMismatch))throw p;d.use2GridOffsets=!0}}if(!f&&h&&(l==="2.0"&&(d.allowAnyMediaType=!0),f=await this._getCoverage(r,2,2,1,c),f&&oe.getLogger(this).warn("wcsraster:getcoverage",fe)),!f)throw new F("wcsraster-open","unable to determine pixel type");const g=await this.decodePixelBlock(f,{width:2,height:2,planes:null,pixelType:null});if(g==null)throw new F("wcsraster-open","unable to determine pixel type");return{pixelType:g.pixelType,bandCount:g.getPlaneCount()??0}}async _getCoverage(e,t,s,i,o,r=!1){const{coverageDescription:u}=this.coverageInfo,{version:a}=u,c=a==="2.0"?this._getCoverage201Parameters(e,t,s,i,o,u):a==="1.1"?this._getCoverage110Parameters(e,t,s,o,u):this._getCoverage100Parameters(e,t,s,o),l=a==="2.0"?await this.request(this._constructWCS201Url(c),{signal:o.signal,responseType:"array-buffer"}):await this.request(this.url,{query:c,signal:o.signal,responseType:"array-buffer"});if(a==="1.0")return l.data;if(a==="2.0"&&this.ioConfig.allowAnyMediaType!==!1&&Xe(l.data)==="tiff")return r&&(this.ioConfig.allowAnyMediaType=!0,oe.getLogger(this).warn("wcsraster:getcoverage",fe)),l.data;const d=It(l);if(d.isMultipart&&d.data){const m=d.data.find(p=>{var v;return((v=p.contentType)==null?void 0:v.toLowerCase().includes("image"))&&p.contentData!=null});return r&&(m==null?void 0:m.contentTransferEncoding)==="base64"&&oe.getLogger(this).warn("wcsraster:getcoverage",Rt),m==null?void 0:m.contentData}const h=new Uint8Array(l.data,0,Math.min(l.data.byteLength,2e3)),f=String.fromCharCode.apply(null,h).toLowerCase().includes("exception"),g=f&&String.fromCharCode.apply(null,h).includes("A non-zero RESX/RESY or WIDTH/HEIGHT is required but neither was provided");throw f?new F("wcsraster:getcoverage",Pt,{isResolutionMismatch:g}):new F("wcsraster:getcoverage",At)}_getInterpolationIndex(e){var t;return e&&((t=this.coverageInfo.supportedInterpolations)!=null&&t.includes(e))?e==="nearest"?0:e==="bilinear"?1:e==="cubic"?2:0:0}_getCoverage100Parameters(e,t,s,i){const o=`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`,r=e.spatialReference.wkid,u=(this.coverageInfo.supportedFormats||[]).find(m=>m.toLowerCase().includes("tiff"))||"GEOTIFF",{bandIds:a,interpolation:c}=i,l=this._getInterpolationIndex(c),d=a?a.map(m=>this.coverageInfo.bandNames[m]):null,h=Tt[l],{multidimensionalDefinition:f}=i;let g;if(f!=null&&this.rasterInfo.multidimensionalInfo!=null){const m=f.find(v=>v.dimensionName==="StdTime");let p=m==null?void 0:m.values;p&&p.length>0&&(Array.isArray(p[0])&&(p=p[0]),g=p.map(v=>ie(v)).join(","))}return{service:"WCS",request:"GetCoverage",version:this.version,coverage:this.coverageId,format:u,crs:`EPSG:${r}`,bbox:o,width:t,height:s,time:g,interpolation:h,band:d==null?void 0:d.join(",")}}_getCoverage110Parameters(e,t,s,i,o){var k,W,J;const{multidimensionalDefinition:r,bandIds:u,interpolation:a}=i,c=e.spatialReference.wkid,l=`urn:ogc:def:crs:EPSG::${c}`,d=(this.coverageInfo.supportedFormats||[]).find(L=>L.toLowerCase().includes("tiff"))||"image/tiff",h=this._getInterpolationIndex(a),f=Lt[h],g=a==null||((k=this.coverageInfo.supportedInterpolations)==null?void 0:k.indexOf(a))===0,m=o.domain.spatialDomain,p=m.origin.x<=m.envelope.xmin&&m.origin.y<=m.envelope.ymin,v=e.width/t,b=e.height/s*(p?1:-1),w=p?[e.xmin,e.ymin]:[e.xmin,e.ymax],$=m.useEPSGAxis&&be(c),C=$?`${w[1]},${w[0]}`:`${w[0]},${w[1]}`,T=this.ioConfig.use2GridOffsets,Q=$?T?`${b},${v}`:`${b},0,0,${v}`:T?`${v},${b}`:`${v},0,0,${b}`,M=v/2,U=e.xmin+M,j=e.xmax-M,H=Math.abs(b)/2,V=e.ymin+H,z=e.ymax-H,_=$?`${V},${U},${z},${j},${l}`:`${U},${V},${j},${z},${l}`,G=o.range.find(L=>L.axis.some(N=>N.identifier.toLowerCase().includes("band")));let S,B=G&&f&&u?g?`${G.identifier}[${G.axis[0].identifier}[${u.join(",")}]]`:`${G.identifier}:${f}[${G.axis[0].identifier}[${u.join(",")}]]`:null;if(r!=null&&r.length)for(let L=0;L<r.length;L++){let N=r[L].values;const Y=(W=r[L].dimensionName)==null?void 0:W.toLowerCase(),ee=(J=r[L].variableName)==null?void 0:J.toLowerCase();if(N.length>0)if(Array.isArray(N[0])&&(N=N[0]),Y==="stdtime")S=N.map(Z=>ie(Z)).join(",");else{const Z=o.range.find(te=>te.identifier.toLowerCase()===ee);if(Z){const te=Z.axis.find(Ie=>Ie.identifier.toLowerCase()===Y);te&&(B=g?Z.identifier+"["+te.identifier+"["+N.join(",")+"]]":Z.identifier+":"+f+"["+te.identifier+"["+N.join(",")+"]]")}}}return{service:"WCS",request:"GetCoverage",version:this.version,identifier:this.coverageId,format:d,crs:`EPSG:${c}`,boundingbox:_,gridCS:"urn:ogc:def:cs:OGC:0.0:Grid2dSquareCS",gridType:"urn:ogc:def:method:WCS:1.1:2dGridIn2dCrs",gridOrigin:C,gridOffsets:Q,gridBaseCRS:l,timeSequence:S,rangeSubset:B}}_getCoverage201Parameters(e,t,s,i,o,r){var G;const{multidimensionalDefinition:u,interpolation:a}=o,c=this._getInterpolationIndex(a);let l=null;const{supportedInterpolations:d}=this.capabilities;if(d!=null&&d.length)switch(c){case 0:l=d.find(S=>S.toLowerCase().includes("nearest"));break;case 1:l=d.find(S=>S.toLowerCase().includes("linear"));break;case 2:l=d.find(S=>S.toLowerCase().includes("cubic")||S.toLowerCase().includes("quadratic"))}const h=(this.coverageInfo.supportedFormats||[]).find(S=>S.toLowerCase().includes("tiff"))||"image/tiff",{bandNames:f}=this.coverageInfo,{boundedBy:g,domainSet:m,rangeType:p}=r,v=g.isEastFirst?0:1,b=1-v,{axisLabels:w}=g,$=w[v],C=w[b],T=`http://www.opengis.net/def/crs/EPSG/0/${e.spatialReference.wkid}`,Q=T,M=[];M.push(`${$}(${e.xmin},${e.xmax})`),M.push(`${C}(${e.ymin},${e.ymax})`);const U=[];if(w.length>2)for(let S=2;S<w.length;S++){const B=m.origin[S];if(w[S].toLowerCase().includes("time")){let k=B.toString();(G=g.uomLabels)!=null&&G[S].toLowerCase().includes("ole")&&(U.push(w[S]),k=ie(B,!0)),M.push(w[S]+",http://www.opengis.net("+k+")")}else M.push(w[S]+",http://www.opengis.net("+B+")")}let j=null;if(u!=null&&u.length){const S=[];p.forEach(k=>k.forEach(W=>S.push(W.name)));const B=[];for(let k=0;k<u.length;k++){const W=w.find(L=>L===u[k].dimensionName),J=S.find(L=>L===u[k].variableName);if(B.includes(J)||B.push(J),W){let L=u[k].values;if(L.length>0){Array.isArray(L[0])&&(L=L[0]);let N="";N=W.toLowerCase().includes("time")?L.map(ee=>ie(ee)).join(","):L.join(",");const Y=M.findIndex(ee=>ee.indexOf(W+",http://www.opengis.net")===0);Y===-1&&M.push(W+",http://www.opengis.net("+N+")"),Y===-1||M[Y].includes("("+N+")")||M.splice(Y,1,W+",http://www.opengis.net("+N+")")}}}B.length&&(j=B.join(","))}else(f==null?void 0:f.length)>=2&&(j=(o.bandIds?o.bandIds.map(S=>f[S]):f).join(","));const H=M.join("&subset="),V=!r.domainSet.hasSameAxisLabelsAsBoundedBy&&this.ioConfig.allowScaleFactor!==!1,z=V?null:`${$}(${t}),${C}(${s})`,_=V?1/i:null;return{service:"WCS",request:"GetCoverage",version:this.version,coverageId:this.coverageId,rangesubset:j,interpolation:l,scaleSize:z,scaleFactor:_,subset:H,format:h,mediaType:this.ioConfig.allowAnyMediaType?null:"multipart/related",outputcrs:T,subsettingcrs:Q}}_constructWCS201Url(e){const t={...this.ioConfig.customFetchParameters,...e},s=[];return Object.keys(t).forEach(i=>{const o=t[i];o!=null&&(i==="subset"?typeof o=="string"&&o.split("&subset=").forEach(r=>{r&&s.push(`subset=${encodeURIComponent(r)}`)}):s.push(`${i}=${encodeURIComponent(o)}`))}),`${encodeURI(this.url)}?${s.join("&")}`}};function ie(n,e=!1){return(e?new Date(24*(n-25569)*60*60*1e3):new Date(n)).toISOString()}D([A({type:String,json:{write:!0}})],X.prototype,"datasetFormat",void 0),D([A({readOnly:!0})],X.prototype,"tileType",void 0),D([A({type:String,json:{write:!0}})],X.prototype,"version",void 0),D([A({type:String,json:{write:!0}})],X.prototype,"coverageId",void 0),X=D([ve("esri.layers.support.rasterDatasets.WCSRaster")],X);const Ot=X,Mt=new Set(["milliseconds","seconds","minutes","hours","days","weeks","months","years","decades","centuries"]);let R=class extends De(Te(Le(Ae(Re(Ue(Pe(Ee(Oe(Me.ClonableMixin(Ne)))))))))){constructor(...n){super(...n),this.coverageId=null,this.version=null,this.isReference=null,this.legendEnabled=!0,this.noData=0,this.operationalLayerType="WCS",this.type="wcs",this.popupEnabled=!0,this.popupTemplate=null,this.fields=null,this._debouncedSaveOperations=Ve(async(e,t,s)=>{const{save:i,saveAs:o}=await We(()=>import("./imageryUtils-444c668f.js"),["assets/imageryUtils-444c668f.js","assets/utils-f7369893.js","assets/index-02eff6e6.js","assets/index-d85835aa.css","assets/originUtils-cfe4feaf.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/saveUtils-795bb719.js"]);switch(e){case ne.SAVE:return i(this,t);case ne.SAVE_AS:return o(this,s,t)}})}normalizeCtorArgs(n,e){return typeof n=="string"?{url:n,...e}:n}load(n){const e=n!=null?n.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WCS"]},n).catch(ke).then(()=>this._openRaster(e))),Promise.resolve(this)}get coverageInfo(){return this.raster.coverageInfo}get defaultPopupTemplate(){return this.createPopupTemplate()}get rasterFields(){return[Ye("Pixel Value")]}createPopupTemplate(n){return Fe({fields:this.rasterFields,title:this.title},n)}async save(n){return this._debouncedSaveOperations(ne.SAVE,n)}async saveAs(n,e){return this._debouncedSaveOperations(ne.SAVE_AS,e,n)}async _openRaster(n){var i,o,r,u;const e=new Ot({url:this.url,version:this.version,coverageId:this.coverageId,ioConfig:{sampling:"closest",...this.ioConfig,customFetchParameters:this.customParameters}});if(await e.open({signal:n}),!e.rasterInfo)throw e.destroy(),new F("wcs-layer:load","cannot load resources on "+this.url);const{rasterInfo:t}=e;t.noDataValue==null&&(t.noDataValue=this.noData),this._set("serviceRasterInfo",t),this._set("spatialReference",t.spatialReference),this.title==null&&this.setAtOrigin("title",e.datasetName,"service"),this.coverageId==null&&this.setAtOrigin("coverageId",e.coverageInfo.id,"service"),this.version==null&&e.version&&this.setAtOrigin("version",e.version,"service"),this.setAtOrigin("tileInfo",e.rasterInfo.storageInfo.tileInfo,"service");const{multidimensionalInfo:s}=t;if(s!=null){const a=s.variables[0].dimensions.find(({name:c})=>c==="StdTime");if(a){let c=((i=a.extent)==null?void 0:i[0])??a.values[0];Array.isArray(c)&&(c=c[0]);let l=((o=a.extent)==null?void 0:o[1])??a.values[a.values.length-1];Array.isArray(l)&&(l=l[1]);const d=Mt.has((r=a.intervalUnit)==null?void 0:r.toLowerCase())?(u=a.intervalUnit)==null?void 0:u.toLowerCase():null;this.set("timeInfo",{startField:"StdTime",fullTimeExtent:{start:c,end:l},timeZone:null,interval:d?{value:a.interval,unit:d}:null})}}this.raster=e,this._configDefaultSettings(),this.addHandles(Ge(()=>this.customParameters,a=>this.raster.ioConfig.customFetchParameters=a))}};D([A({type:String,nonNullable:!0,json:{name:"wcsInfo.coverageId",write:{isRequired:!0}}})],R.prototype,"coverageId",void 0),D([A()],R.prototype,"coverageInfo",null),D([A({type:["1.0.0","1.1.0","1.1.1","1.1.2","2.0.1"],nonNullable:!0,json:{name:"wcsInfo.version",write:{isRequired:!0}}})],R.prototype,"version",void 0),D([A({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],R.prototype,"isReference",void 0),D([A({json:{read:!0,write:!0}})],R.prototype,"blendMode",void 0),D([A(_e)],R.prototype,"legendEnabled",void 0),D([A({type:["show","hide"]})],R.prototype,"listMode",void 0),D([A()],R.prototype,"noData",void 0),D([A({type:["WCS"]})],R.prototype,"operationalLayerType",void 0),D([A()],R.prototype,"raster",void 0),D([A({readOnly:!0})],R.prototype,"type",void 0),D([A(Be)],R.prototype,"popupEnabled",void 0),D([A({type:je,json:{name:"popupInfo",write:!0}})],R.prototype,"popupTemplate",void 0),D([A({readOnly:!0})],R.prototype,"defaultPopupTemplate",null),D([A({readOnly:!0,type:[de]})],R.prototype,"fields",void 0),D([A({readOnly:!0,type:[de]})],R.prototype,"rasterFields",null),R=D([ve("esri.layers.WCSLayer")],R);const Yt=R;export{Yt as default};
