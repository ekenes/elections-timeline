import{Q as C,hi as j,dz as Z,a3 as y,a4 as g,a5 as z,S as D,aQ as J,hj as V,hk as B,a0 as k,c4 as N,_ as A,hl as K,hm as L,hn as Q,ho as W,s as $,cg as x,c9 as Y}from"./index-d2e37ef9.js";import{d as H,h as P,b as X,P as G,$ as ee,H as te,U as re,K as M}from"./featureConversionUtils-844127df.js";import{t as S}from"./OptimizedGeometry-33b2eb0d.js";import{f as I,g as F}from"./projectionSupport-7d3f1ff4.js";import{b as ie}from"./normalizeUtils-04844d03.js";const ne=new C({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),_=Object.freeze({}),E=new S,se=new S,v=new S,m={esriGeometryPoint:G,esriGeometryPolyline:ee,esriGeometryPolygon:te,esriGeometryMultipoint:re};function xe(e,t,r,i=e.hasZ,n=e.hasM){if(t==null)return null;const l=e.hasZ&&i,s=e.hasM&&n;if(r){const a=P(v,t,e.hasZ,e.hasM,"esriGeometryPoint",r,i,n);return G(a,l,s)}return G(t,l,s)}function h(e,t,r,i,n,l,s=t,a=r){var R,p,d;const o=t&&s,u=r&&a,c=i!=null?"coords"in i?i:i.geometry:null;if(c==null)return null;if(n){let f=H(se,c,t,r,e,n,s,a);return l&&(f=P(v,f,o,u,e,l)),((R=m[e])==null?void 0:R.call(m,f,o,u))??null}if(l){const f=P(v,c,t,r,e,l,s,a);return((p=m[e])==null?void 0:p.call(m,f,o,u))??null}return X(E,c,t,r,s,a),((d=m[e])==null?void 0:d.call(m,E,o,u))??null}async function Me(e,t,r){const{outFields:i,orderByFields:n,groupByFieldsForStatistics:l,outStatistics:s}=e;if(i)for(let a=0;a<i.length;a++)i[a]=i[a].trim();if(n)for(let a=0;a<n.length;a++)n[a]=n[a].trim();if(l)for(let a=0;a<l.length;a++)l[a]=l[a].trim();if(s)for(let a=0;a<s.length;a++)s[a].onStatisticField&&(s[a].onStatisticField=s[a].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),le(e,t,r)}async function le(e,t,r){var l;if(!e)return null;let{where:i}=e;if(e.where=i=i&&i.trim(),(!i||/^1 *= *1$/.test(i)||t&&t===i)&&(e.where=null),!e.geometry)return e;let n=await oe(e);if(e.distance=0,e.units=null,e.spatialRel==="esriSpatialRelEnvelopeIntersects"){const{spatialReference:s}=e.geometry;n=j(n),n.spatialReference=s}if(n){await I(n.spatialReference,r),n=ae(n,r);const s=(await ie(Z(n)))[0];if(s==null)throw _;const a="quantizationParameters"in e&&((l=e.quantizationParameters)==null?void 0:l.tolerance)||"maxAllowableOffset"in e&&e.maxAllowableOffset||0,o=a&&O(n,r)?{densificationStep:8*a}:void 0,u=s.toJSON(),c=await F(u,u.spatialReference,r,o);if(!c)throw _;c.spatialReference=r,e.geometry=c}return e}function O(e,t){if(!e)return!1;const r=e.spatialReference;return(y(e)||g(e)||z(e))&&!D(r,t)&&!J(r,t)}function ae(e,t){const r=e.spatialReference;return O(e,t)&&y(e)?{spatialReference:r,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}async function oe(e){const{distance:t,units:r}=e,i=e.geometry;if(t==null||"vertexAttributes"in i)return i;const n=i.spatialReference,l=r?ne.fromJSON(r):V(n),s=n&&(B(n)||k(n))?i:await I(n,N).then(()=>F(i,N));return(await ue())(s.spatialReference,s,t,l)}async function ue(){return(await A(()=>import("./geometryEngineJSON-e1ea929f.js"),["assets/geometryEngineJSON-e1ea929f.js","assets/geometryEngineBase-c08b167e.js","assets/index-d2e37ef9.js","assets/index-0e712e80.css","assets/geometryEngineJSON-089d9db6.js","assets/json-48e3ea08.js"])).geodesicBuffer}function _e(e){return e&&T in e?JSON.parse(JSON.stringify(e,ce)):e}const T="_geVersion",ce=(e,t)=>e!==T?t:void 0;function fe(e){return e==="mesh"?K:L(e)}function U(e,t){return e?t?4:3:t?3:2}function me(e,t,r,i){return q(e,t,r,i.coords[0],i.coords[1])}function pe(e,t,r,i,n,l){const s=U(n,l),{coords:a,lengths:o}=i;if(!o)return!1;for(let u=0,c=0;u<o.length;u++,c+=s)if(!q(e,t,r,a[c],a[c+1]))return!1;return!0}function q(e,t,r,i,n){if(!e)return!1;const l=U(t,r),{coords:s,lengths:a}=e;let o=!1,u=0;for(const c of a)o=ye(o,s,l,u,c,i,n),u+=c*l;return o}function ye(e,t,r,i,n,l,s){let a=e,o=i;for(let u=i,c=i+n*r;u<c;u+=r){o=u+r,o===c&&(o=i);const R=t[u],p=t[u+1],d=t[o],f=t[o+1];(p<s&&f>=s||f<s&&p>=s)&&R+(s-p)/(f-p)*(d-R)<l&&(a=!a)}return a}const w="feature-store:unsupported-query",Re={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},b={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function Se(e){return e!=null&&b.spatialRelationship[e]===!0}function de(e){return e!=null&&b.queryGeometry[Y(e)]===!0}function he(e){return e!=null&&b.layerGeometry[e]===!0}function ge(){return A(()=>import("./geometryEngineJSON-e1ea929f.js"),["assets/geometryEngineJSON-e1ea929f.js","assets/geometryEngineBase-c08b167e.js","assets/index-d2e37ef9.js","assets/index-0e712e80.css","assets/geometryEngineJSON-089d9db6.js","assets/json-48e3ea08.js"])}function Ee(e,t,r,i,n){if(g(t)&&r==="esriGeometryPoint"&&(e==="esriSpatialRelIntersects"||e==="esriSpatialRelContains")){const l=M(new S,t,!1,!1);return Promise.resolve(s=>me(l,!1,!1,s))}if(g(t)&&r==="esriGeometryMultipoint"){const l=M(new S,t,!1,!1);if(e==="esriSpatialRelContains")return Promise.resolve(s=>pe(l,!1,!1,s,i,n))}if(y(t)&&r==="esriGeometryPoint"&&(e==="esriSpatialRelIntersects"||e==="esriSpatialRelContains"))return Promise.resolve(l=>Q(t,h(r,i,n,l)));if(y(t)&&r==="esriGeometryMultipoint"&&e==="esriSpatialRelContains")return Promise.resolve(l=>W(t,h(r,i,n,l)));if(y(t)&&e==="esriSpatialRelIntersects"){const l=fe(r);return Promise.resolve(s=>l(t,h(r,i,n,s)))}return ge().then(l=>{const s=l[Re[e]].bind(null,t.spatialReference,t);return a=>s(h(r,i,n,a))})}async function Ae(e,t,r){const{spatialRel:i,geometry:n}=e;if(n){if(!Se(i))throw new $(w,"Unsupported query spatial relationship",{query:e});if(x(n.spatialReference)&&x(r)){if(!de(n))throw new $(w,"Unsupported query geometry type",{query:e});if(!he(t))throw new $(w,"Unsupported layer geometry type",{query:e});if(e.outSR)return I(e.geometry&&e.geometry.spatialReference,e.outSR)}}}function Fe(e){if(y(e))return!0;if(g(e)){for(const t of e.rings)if(t.length!==5||t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1;return!0}return!1}async function Oe(e,t){if(!e)return null;const r=t.featureAdapter,{startTimeField:i,endTimeField:n}=e;let l=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;if(i&&n)await t.forEach(a=>{const o=r.getAttribute(a,i),u=r.getAttribute(a,n);o==null||isNaN(o)||(l=Math.min(l,o)),u==null||isNaN(u)||(s=Math.max(s,u))});else{const a=i||n;await t.forEach(o=>{const u=r.getAttribute(o,a);u==null||isNaN(u)||(l=Math.min(l,u),s=Math.max(s,u))})}return{start:l,end:s}}function Te(e,t,r){var o;if(!t||!e)return null;const{startTimeField:i,endTimeField:n}=e;if(!i&&!n)return null;const{start:l,end:s}=t;if(l===null&&s===null)return null;if(l===void 0&&s===void 0)return Pe();const a=((o=r.getAttributeAsTimestamp)==null?void 0:o.bind(r))??r.getAttribute.bind(r);return i&&n?$e(a,i,n,l,s):we(a,i||n,l,s)}function $e(e,t,r,i,n){return i!=null&&n!=null?l=>{const s=e(l,t),a=e(l,r);return(s==null||s<=n)&&(a==null||a>=i)}:i!=null?l=>{const s=e(l,r);return s==null||s>=i}:n!=null?l=>{const s=e(l,t);return s==null||s<=n}:void 0}function we(e,t,r,i){return r!=null&&i!=null&&r===i?n=>e(n,t)===r:r!=null&&i!=null?n=>{const l=e(n,t);return l>=r&&l<=i}:r!=null?n=>e(n,t)>=r:i!=null?n=>e(n,t)<=i:void 0}function Pe(){return()=>!1}export{xe as G,Fe as I,_ as M,h as P,_e as Z,Me as a,Ae as b,Te as n,Oe as t,Ee as v,le as z};
