import{o as X,a7 as I,b as Y,a8 as J,a9 as O,aa as R,c as W,l as K,a as Q,n as Z,f as $,g as ee,ab as te,W as se,S as d,ac as C,A as ne}from"./OperatorProject-1ae2812c.js";function M(){return{m_pGcs:new d,m_xyz:new C,m_factor:Number.NaN,m_geoLength:Number.NaN,setValues:oe,setLength:ae,assign:re}}function oe(i,e,t,n){this.m_factor=i,this.m_pGcs.assign(e),this.m_xyz.assign(n),this.m_geoLength=t}function ae(i){this.m_geoLength=i}function re(i){this.m_pGcs.assign(i.m_pGcs),this.m_xyz.assign(i.m_xyz),this.m_factor=i.m_factor,this.m_geoLength=i.m_geoLength}class ce{getOperatorType(){return 10315}supportsCurves(){return!0}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}_ExecuteShapePreservingLength(e,t,n,u,s){if(e.hasNonLinearSegments()&&(e=new X().execute(e,0,t.getTolerance(0),0,s)),t.isPannable()){let m=90,a=-90;if(n.getUnit().getUnitToBaseFactor()===1&&(m*=Math.PI/180,a*=Math.PI/180),t.getCoordinateSystemType()===2){let _=null;const o=[0,0,0,0];_=t.getPECoordSys(),o[0]=0,o[1]=m,o[2]=0,o[3]=a,I.geogToProj(_,2,o),m=o[1],a=o[3]}const g=new Y;e.queryEnvelope(g),g.ymin=a,g.ymax=m,e=new J().execute(e,g,t,s)}else{const m=t.getPCSHorizon();(e=new O().execute(e,m,t,s))===m&&(e=e.clone())}return e.isEmpty()?0:this._ExecuteIterativeApproach(e,t,n,u,1,s)}_ExecuteIterativeApproach(e,t,n,u,s,m){const a=se();n.querySpheroidData(a);const g=a.majorSemiAxis,_=a.e2,o=n.getUnit().getUnitToBaseFactor(),b=40,E=R(M,b),w=new Array(b),f=M(),c=M();let y;const r=[0,0,0,0],U=t.getPECoordSys(),L=new d,N=new d,l=new d,p=new d,S=new d;let V=0;const v=e.querySegmentIterator();for(;v.nextPath();)for(;v.hasNextSegment();){const z=v.nextSegment();L.assign(z.getStartXY()),N.assign(z.getEndXY()),t.getCoordinateSystemType()===2?(r[0]=L.x,r[1]=L.y,r[2]=N.x,r[3]=N.y,I.projToGeog(U,2,r),l.x=r[0]*o,l.y=r[1]*o,p.x=r[2]*o,p.y=r[3]*o):(l.setCoordsPoint2D(L),p.setCoordsPoint2D(N),l.scale(o),p.scale(o));const D=new C,A=new C;q(g,_,l,D),q(g,_,p,A);let x=T(g,D,A);f.setValues(0,l,Number.NaN,D),c.setValues(1,p,x,A),y=s,E[0].assign(c),w[0]=s;let h=0;for(;;){h>128&&ne("iterations exceeded");const B=.5*(f.m_factor+c.m_factor),j=z.getCoord2D(B);t.getCoordinateSystemType()===2?(r[0]=j.x,r[1]=j.y,I.projToGeog(U,1,r),S.x=r[0]*o,S.y=r[1]*o):(S.setCoordsPoint2D(j),S.scale(o)),l.setCoordsPoint2D(f.m_pGcs),p.setCoordsPoint2D(c.m_pGcs);const G=new C;q(g,_,S,G);const k=T(g,f.m_xyz,G),F=T(g,c.m_xyz,G);x=c.m_geoLength,Number.isNaN(x)&&(x=T(g,f.m_xyz,c.m_xyz));const P=k+F,H=y===s&&P>=20&&Math.abs(P-x)>1e-8*(x+P);if(h+2<b&&(H||Math.abs(P-x)>0&&y>0))c.setLength(F),E[h].assign(c),c.setValues(B,S,k,G),E[++h].assign(c),H?(y=s,w[h]=s):(y--,w[h-1]=y,w[h]=y);else{if(V+=P,h===0)break;f.assign(c),c.assign(E[--h]),y=w[h]}}}return V}execute(e,t,n){if(t&&t.getCoordinateSystemType()!==0||W(""),e.isEmpty()||e.getDimension()<1)return 0;let u=null;const s=t.getGCS();s!==t&&(u=K(t,s,null));const m=e.getGeometryType();if(m===Q.enumEnvelope){const a=new Z;return a.addEnvelope(e,!1),this._ExecuteShapePreservingLength(a,t,s,u,n)}if($(m)){const a=new ee;return a.addSegment(e,!0),this._ExecuteShapePreservingLength(a,t,s,u,n)}return this._ExecuteShapePreservingLength(e,t,s,u,n)}}function q(i,e,t,n){n.assign(te(i,e,t))}function T(i,e,t){const n=i,u=new C;u.setSub(e,t);const s=u.length();return 2*n*Math.asin(s/(2*n))}export{ce as P};
