import{d as N}from"./ClassBreaksDefinition-ef348958.js";import{a8 as k}from"./index-b8632133.js";const q=()=>k.getLogger("esri.rest.support.generateRendererUtils");function g(e,t){return Number(e.toFixed(t))}function C(e){const{normalizationTotal:t}=e;return{classBreaks:w(e),normalizationTotal:t}}function w(e){const t=e.definition,{classificationMethod:l,normalizationType:n,definedInterval:u}=t,i=t.breakCount??1,c=[];let o=e.values;if(o.length===0)return[];o=o.sort((m,d)=>m-d);const f=o[0],p=o[o.length-1];if(l==="equal-interval")if(o.length>=i){const m=(p-f)/i;let d=f;for(let r=1;r<i;r++){const a=g(f+r*m,6);c.push({minValue:d,maxValue:a,label:V(d,a,n)}),d=a}c.push({minValue:d,maxValue:p,label:V(d,p,n)})}else o.forEach(m=>{c.push({minValue:m,maxValue:m,label:V(m,m,n)})});else if(l==="natural-breaks"){const m=E(o),d=e.valueFrequency||m.valueFrequency,r=B(m.uniqueValues,d,i);let a=f;for(let s=1;s<i;s++)if(m.uniqueValues.length>s){const h=g(m.uniqueValues[r[s]],6);c.push({minValue:a,maxValue:h,label:V(a,h,n)}),a=h}c.push({minValue:a,maxValue:p,label:V(a,p,n)})}else if(l==="quantile")if(o.length>=i&&f!==p){let m=f,d=Math.ceil(o.length/i),r=0;for(let a=1;a<i;a++){let s=d+r-1;s>o.length&&(s=o.length-1),s<0&&(s=0),c.push({minValue:m,maxValue:o[s],label:V(m,o[s],n)}),m=o[s],r+=d,d=Math.ceil((o.length-r)/(i-a))}c.push({minValue:m,maxValue:p,label:V(m,p,n)})}else{let m=-1;for(let d=0;d<o.length;d++){const r=o[d];r!==m&&(m=r,c.push({minValue:m,maxValue:r,label:V(m,r,n)}),m=r)}}else if(l==="standard-deviation"){const m=P(o),d=L(o,m);if(d===0)c.push({minValue:o[0],maxValue:o[0],label:V(o[0],o[0],n)});else{const r=U(f,p,i,m,d)*d;let a=0,s=f;for(let b=i;b>=1;b--){const F=g(m-(b-.5)*r,6);c.push({minValue:s,maxValue:F,label:V(s,F,n)}),s=F,a++}let h=g(m+.5*r,6);c.push({minValue:s,maxValue:h,label:V(s,h,n)}),s=h,a++;for(let b=1;b<=i;b++)h=a===2*i?p:g(m+(b+.5)*r,6),c.push({minValue:s,maxValue:h,label:V(s,h,n)}),s=h,a++}}else if(l==="defined-interval"){if(!u)return c;const m=o[0],d=o[o.length-1],r=Math.ceil((d-m)/u);let a=m;for(let s=1;s<r;s++){const h=g(m+s*u,6);c.push({minValue:a,maxValue:h,label:V(a,h,n)}),a=h}c.push({minValue:a,maxValue:d,label:V(a,d,n)})}return c}function V(e,t,l){let n=null;return n=e===t?l&&l==="percent-of-total"?e+"%":e.toString():l&&l==="percent-of-total"?e+"% - "+t+"%":e+" - "+t,n}function E(e){const t=[],l=[];let n=Number.MIN_VALUE,u=1,i=-1;for(let c=0;c<e.length;c++){const o=e[c];o===n?(u++,l[i]=u):o!==null&&(t.push(o),n=o,u=1,l.push(u),i++)}return{uniqueValues:t,valueFrequency:l}}function B(e,t,l){const n=e.length,u=[];l>n&&(l=n);for(let c=0;c<l;c++)u.push(Math.round(c*n/l-1));u.push(n-1);let i=I(u,e,t,l);return O(i.mean,i.sdcm,u,e,t,l)&&(i=I(u,e,t,l)),u}function I(e,t,l,n){let u=[],i=[],c=[],o=0;const f=[],p=[];for(let a=0;a<n;a++){const s=v(a,e,t,l);f.push(s.sbMean),p.push(s.sbSdcm),o+=p[a]}let m,d=o,r=!0;for(;r||o<d;){r=!1,u=[];for(let a=0;a<n;a++)u.push(e[a]);for(let a=0;a<n;a++)for(let s=e[a]+1;s<=e[a+1];s++)if(m=t[s],a>0&&s!==e[a+1]&&Math.abs(m-f[a])>Math.abs(m-f[a-1]))e[a]=s;else if(a<n-1&&e[a]!==s-1&&Math.abs(m-f[a])>Math.abs(m-f[a+1])){e[a+1]=s-1;break}d=o,o=0,i=[],c=[];for(let a=0;a<n;a++){i.push(f[a]),c.push(p[a]);const s=v(a,e,t,l);f[a]=s.sbMean,p[a]=s.sbSdcm,o+=p[a]}}if(o>d){for(let a=0;a<n;a++)e[a]=u[a],f[a]=i[a],p[a]=c[a];o=d}return{mean:f,sdcm:p}}function O(e,t,l,n,u,i){let c=0,o=0,f=0,p=0,m=!0;for(let d=0;d<2&&m;d++){d===0&&(m=!1);for(let r=0;r<i-1;r++)for(;l[r+1]+1!==l[r+2];){l[r+1]=l[r+1]+1;const a=v(r,l,n,u);f=a.sbMean,c=a.sbSdcm;const s=v(r+1,l,n,u);if(p=s.sbMean,o=s.sbSdcm,!(c+o<t[r]+t[r+1])){l[r+1]=l[r+1]-1;break}t[r]=c,t[r+1]=o,e[r]=f,e[r+1]=p,m=!0}for(let r=i-1;r>0;r--)for(;l[r]!==l[r-1]+1;){l[r]=l[r]-1;const a=v(r-1,l,n,u);f=a.sbMean,c=a.sbSdcm;const s=v(r,l,n,u);if(p=s.sbMean,o=s.sbSdcm,!(c+o<t[r-1]+t[r])){l[r]=l[r]+1;break}t[r-1]=c,t[r]=o,e[r-1]=f,e[r]=p,m=!0}}return m}function U(e,t,l,n,u){let i=Math.max(n-e,t-n)/u/l;return i=i>=1?1:i>=.5?.5:.25,i}function P(e){let t=0;for(let l=0;l<e.length;l++)t+=e[l];return t/=e.length,t}function L(e,t){let l=0;for(let n=0;n<e.length;n++){const u=e[n];l+=(u-t)*(u-t)}return l/=e.length,Math.sqrt(l)}function v(e,t,l,n){let u=0,i=0;for(let f=t[e]+1;f<=t[e+1];f++){const p=n[f];u+=l[f]*p,i+=p}i<=0&&q().warn("Exception in Natural Breaks calculation");const c=u/i;let o=0;for(let f=t[e]+1;f<=t[e+1];f++)o+=n[f]*(l[f]-c)**2;return{sbMean:c,sbSdcm:o}}const G="<Null>",A="equal-interval",_=1,Y=5,j=10,Q=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,R=new Set(["esriFieldTypeDate","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeOID","esriFieldTypeBigInteger"]),H=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),J=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function x(e){return e==null||typeof e=="string"&&!e?G:e}function K(e){const t=e.normalizationField!=null||e.normalizationType!=null,l=e.minValue!=null||e.maxValue!=null,n=!!e.sqlExpression&&e.supportsSQLExpression;return!t&&!l&&!n}function he(e){const t=e.returnDistinct?[...new Set(e.values)]:e.values,l=t.filter(i=>i!=null).sort(),n=l.length,u={count:n,min:l[0],max:l[n-1]};return e.supportsNullCount&&(u.nullcount=t.length-n),e.percentileParams&&(u.median=$(t,e.percentileParams)),u}function W(e){const{values:t,useSampleStdDev:l,supportsNullCount:n}=e;let u=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,c=null,o=null,f=null,p=null,m=0;const d=e.minValue==null?-1/0:e.minValue,r=e.maxValue==null?1/0:e.maxValue;for(const s of t)Number.isFinite(s)?s>=d&&s<=r&&(c=c===null?s:c+s,u=Math.min(u,s),i=Math.max(i,s),m++):typeof s=="string"&&m++;if(m&&c!=null){o=c/m;let s=0;for(const h of t)Number.isFinite(h)&&h>=d&&h<=r&&(s+=(h-o)**2);p=l?m>1?s/(m-1):0:m>0?s/m:0,f=Math.sqrt(p)}else u=null,i=null;const a={avg:o,count:m,max:i,min:u,stddev:f,sum:c,variance:p};return n&&(a.nullcount=t.length-m),e.percentileParams&&(a.median=$(t,e.percentileParams)),a}function $(e,t){const{fieldType:l,value:n,orderBy:u,isDiscrete:i}=t,c=X(l,u==="desc");if((e=[...e].filter(a=>a!=null).sort((a,s)=>c(a,s))).length===0)return null;if(n<=0)return e[0];if(n>=1)return e[e.length-1];const o=(e.length-1)*n,f=Math.floor(o),p=f+1,m=o%1,d=e[f],r=e[p];return p>=e.length||i||typeof d=="string"||typeof r=="string"?d:d*(1-m)+r*m}function X(e,t){if(e){if(R.has(e))return D(t);if(H.has(e))return M(t,!1);if(e==="esriFieldTypeTimestampOffset")return le(t);const i=M(t,!0);if(e==="esriFieldTypeString")return i;if(e==="esriFieldTypeGUID"||e==="esriFieldTypeGlobalID")return(c,o)=>i(S(c),S(o))}const l=t?1:-1,n=D(t),u=M(t,!0);return(i,c)=>typeof i=="number"&&typeof c=="number"?n(i,c):typeof i=="string"&&typeof c=="string"?u(i,c):l}const T=(e,t)=>e==null?t==null?0:1:t==null?-1:null,y=(e,t)=>e==null?t==null?0:-1:t==null?1:null;function Z(e){return e?T:y}const ee=(e,t)=>y(e,t)??(e===t?0:new Date(e).getTime()-new Date(t).getTime()),te=(e,t)=>T(e,t)??(e===t?0:new Date(t).getTime()-new Date(e).getTime());function le(e){return e?te:ee}const ne=(e,t)=>y(e,t)??(e===t?0:e<t?-1:1),ae=(e,t)=>T(e,t)??(e===t?0:e<t?1:-1);function M(e,t){if(!t)return e?ae:ne;const l=Z(e);return e?(n,u)=>{const i=l(n,u);return i??((n=n.toUpperCase())>(u=u.toUpperCase())?-1:n<u?1:0)}:(n,u)=>{const i=l(n,u);return i??((n=n.toUpperCase())<(u=u.toUpperCase())?-1:n>u?1:0)}}const ie=(e,t)=>T(e,t)??t-e,oe=(e,t)=>y(e,t)??e-t;function D(e){return e?ie:oe}function S(e){return e.slice(24,36)+e.slice(19,23)+e.slice(16,18)+e.slice(14,16)+e.slice(11,13)+e.slice(9,11)+e.slice(6,8)+e.slice(4,6)+e.slice(2,4)+e.slice(0,2)}function Ve(e,t){let l;for(l in e)J.includes(l)&&(Number.isFinite(e[l])||(e[l]=null));return t&&["avg","stddev","variance"].forEach(n=>{e[n]!=null&&(e[n]=Math.ceil(e[n]??0))}),e}function be(e){const t={};for(let l of e)(l==null||typeof l=="string"&&l.trim()==="")&&(l=null),t[l]==null?t[l]={count:1,data:l}:t[l].count++;return{count:t}}function z(e){return(e==null?void 0:e.type)!=="coded-value"?[]:e.codedValues.map(t=>t.code)}function ge(e,t,l,n){const u=e.count,i=[];if(l&&t){const c=[],o=z(t[0]);for(const f of o)if(t[1]){const p=z(t[1]);for(const m of p)if(t[2]){const d=z(t[2]);for(const r of d)c.push(`${x(f)}${n}${x(m)}${n}${x(r)}`)}else c.push(`${x(f)}${n}${x(m)}`)}else c.push(f);for(const f of c)u.hasOwnProperty(f)||(u[f]={data:f,count:0})}for(const c in u){const o=u[c];i.push({value:o.data,count:o.count,label:o.label})}return{uniqueValueInfos:i}}function ve(e,t,l,n){let u=null;switch(t){case"log":e!==0&&(u=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(n)&&n!==0&&(u=e/n*100);break;case"field":Number.isFinite(l)&&l!==0&&(u=e/l);break;case"natural-log":e>0&&(u=Math.log(e));break;case"square-root":e>0&&(u=e**.5)}return u}function ue(e,t){const l=se({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,breakCount:t.numClasses||Y});return e=re(e,t.minValue,t.maxValue),C({definition:l,values:e,normalizationTotal:t.normalizationTotal})}function re(e,t,l){const n=t??-1/0,u=l??1/0;return e.filter(i=>Number.isFinite(i)&&i>=n&&i<=u)}function se(e){const{breakCount:t,field:l,normalizationField:n,normalizationType:u}=e,i=e.classificationMethod||A,c=i==="standard-deviation"?e.standardDeviationInterval||_:void 0,o=i==="defined-interval"?e.definedInterval:void 0;return new N({breakCount:t,classificationField:l,classificationMethod:i,normalizationField:u==="field"?n:void 0,normalizationType:u,standardDeviationInterval:c,definedInterval:o})}function xe(e,t){var f,p;let l=e.classBreaks;const n=l.length,u=(f=l[0])==null?void 0:f.minValue,i=(p=l[n-1])==null?void 0:p.maxValue,c=t==="standard-deviation",o=Q;return l=l.map(m=>{const d=m.label,r={minValue:m.minValue,maxValue:m.maxValue,label:d};if(c&&d){const a=d.match(o),s=(a==null?void 0:a.map(h=>+h.trim()))??[];s.length===2?(r.minStdDev=s[0],r.maxStdDev=s[1],s[0]<0&&s[1]>0&&(r.hasAvg=!0)):s.length===1&&(d.includes("<")?(r.minStdDev=null,r.maxStdDev=s[0]):d.includes(">")&&(r.minStdDev=s[0],r.maxStdDev=null))}return r}),{minValue:u,maxValue:i,classBreakInfos:l,normalizationTotal:e.normalizationTotal}}function Te(e,t){const l=ce(e,t);if(l.min==null&&l.max==null)return{bins:[],minValue:l.min,maxValue:l.max,normalizationTotal:t.normalizationTotal};const n=l.intervals,u=l.min??0,i=l.max??0,c=n.map((o,f)=>({minValue:n[f][0],maxValue:n[f][1],count:0}));for(const o of e)if(o!=null&&o>=u&&o<=i){const f=me(n,o);f>-1&&c[f].count++}return{bins:c,minValue:u,maxValue:i,normalizationTotal:t.normalizationTotal}}function ce(e,t){const{field:l,classificationMethod:n,standardDeviationInterval:u,normalizationType:i,normalizationField:c,normalizationTotal:o,minValue:f,maxValue:p}=t,m=t.numBins||j;let d=null,r=null,a=null;if((!n||n==="equal-interval")&&!i){if(f!=null&&p!=null)d=f,r=p;else{const s=W({values:e,minValue:f,maxValue:p,useSampleStdDev:!i,supportsNullCount:K({normalizationType:i,normalizationField:c,minValue:f,maxValue:p})});d=s.min??null,r=s.max??null}a=fe(d??0,r??0,m)}else{const{classBreaks:s}=ue(e,{field:l,normalizationType:i,normalizationField:c,normalizationTotal:o,classificationMethod:n,standardDeviationInterval:u,minValue:f,maxValue:p,numClasses:m});d=s[0].minValue,r=s[s.length-1].maxValue,a=s.map(h=>[h.minValue,h.maxValue])}return{min:d,max:r,intervals:a}}function me(e,t){let l=-1;for(let n=e.length-1;n>=0;n--)if(t>=e[n][0]){l=n;break}return l}function fe(e,t,l){const n=(t-e)/l,u=[];let i,c=e;for(let o=1;o<=l;o++)i=c+n,i=Number(i.toFixed(16)),u.push([c,o===l?t:i]),c=i;return u}export{ge as $,ve as B,Ve as C,ue as E,xe as P,X as T,Te as U,he as d,K as f,be as k,x as m,W as p,$ as v};
