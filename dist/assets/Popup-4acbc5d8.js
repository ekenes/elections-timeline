import{C as s,J as N,iF as I,D as r,cd as S,iG as R,iH as z,iI as H,iJ as U,iK as J,bI as u,bJ as g,bE as j,ff as C,a8 as k,iL as P,iM as G,w as K,fN as O,iN as q,fx as Q,iO as B}from"./index-76dad814.js";const b="esri-popup",_=`${b}--is-docked`,p={base:b,baseHidden:`${b}--hidden`,main:`${b}__main-container`,shadow:`${b}--shadow`,isDocked:_,isDockedTopLeft:`${_}-top-left`,isDockedTopCenter:`${_}-top-center`,isDockedTopRight:`${_}-top-right`,isDockedBottomLeft:`${_}-bottom-left`,isDockedBottomCenter:`${_}-bottom-center`,isDockedBottomRight:`${_}-bottom-right`,alignTopCenter:`${b}--aligned-top-center`,alignBottomCenter:`${b}--aligned-bottom-center`,alignTopLeft:`${b}--aligned-top-left`,alignBottomLeft:`${b}--aligned-bottom-left`,alignTopRight:`${b}--aligned-top-right`,alignBottomRight:`${b}--aligned-bottom-right`,pointer:`${b}__pointer`,pointerDirection:`${b}__pointer-direction`};let A=class extends I{constructor(e){super(e)}};A=s([N("esri.widgets.Popup.PopupViewModel")],A);const T=A;let v=class extends S{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!0,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.heading=!0,this.spinner=!0}};s([r({type:Boolean,nonNullable:!0})],v.prototype,"actionBar",void 0),s([r({type:Boolean,nonNullable:!0})],v.prototype,"closeButton",void 0),s([r({type:Boolean,nonNullable:!0})],v.prototype,"collapseButton",void 0),s([r({type:Boolean,nonNullable:!0})],v.prototype,"featureNavigation",void 0),s([r({type:Boolean,nonNullable:!0})],v.prototype,"featureListLayerTitle",void 0),s([r({type:Boolean,nonNullable:!0})],v.prototype,"heading",void 0),s([r({type:Boolean,nonNullable:!0})],v.prototype,"spinner",void 0),v=s([N("esri.widgets.Popup.PopupVisibleElements")],v);const L=v,X=200,$={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let a=class extends H{constructor(e,t){super(e,t),this._dockAction=new U({id:"popup-dock-action"}),this._featuresWidget=new J({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this._focusAbortController=null,this.alignment="auto",this.dockEnabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new T,this.visibleElements=new L}initialize(){this.addHandles([u(()=>{var e,t;return[(t=(e=this.viewModel)==null?void 0:e.view)==null?void 0:t.widthBreakpoint,this.dockEnabled]},()=>this._handleDockIcon(),g),u(()=>{var e,t;return[this.dockEnabled,(e=this.messages)==null?void 0:e.undock,(t=this.messages)==null?void 0:t.dock]},()=>this._handleDockEnabled(),g),u(()=>this.dockOptions,e=>{const{_dockAction:t}=this,i=this._featuresWidget.headerActions;i.remove(t),e.buttonEnabled&&i.add(t)},g),u(()=>{var e;return(e=this.viewModel)==null?void 0:e.screenLocation},()=>this._positionContainer()),u(()=>{var e;return[(e=this.viewModel)==null?void 0:e.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),u(()=>{var e,t,i,l,d,o,n;return[(e=this.viewModel)==null?void 0:e.screenLocation,(i=(t=this.viewModel)==null?void 0:t.view)==null?void 0:i.padding,(d=(l=this.viewModel)==null?void 0:l.view)==null?void 0:d.size,(o=this.viewModel)==null?void 0:o.active,(n=this.viewModel)==null?void 0:n.location,this.alignment]},()=>this.reposition()),u(()=>{var e,t;return(t=(e=this.viewModel)==null?void 0:e.view)==null?void 0:t.size},(e,t)=>this._updateDockEnabledForViewSize(e,t)),u(()=>{var e;return(e=this.viewModel)==null?void 0:e.view},(e,t)=>this._viewChange(e,t)),u(()=>{var e,t;return(t=(e=this.viewModel)==null?void 0:e.view)==null?void 0:t.ready},(e,t)=>this._viewReadyChange(e??!1,t??!1)),u(()=>this.viewModel,()=>this._featuresWidget.viewModel=this.viewModel,g),u(()=>this._featureNavigationTop,e=>this._featuresWidget.featureNavigationTop=e,g),u(()=>this.headingLevel,e=>this._featuresWidget.headingLevel=e,g),u(()=>this.visibleElements.actionBar,e=>this._featuresWidget.visibleElements.actionBar=!!e,g),u(()=>this.visibleElements.closeButton,e=>this._featuresWidget.visibleElements.closeButton=!!e,g),u(()=>this.visibleElements.collapseButton,e=>this._featuresWidget.visibleElements.collapseButton=!!e,g),u(()=>this.visibleElements.heading,e=>this._featuresWidget.visibleElements.heading=!!e,g),u(()=>this.visibleElements.spinner,e=>this._featuresWidget.visibleElements.spinner=!!e,g),u(()=>this.visibleElements.featureNavigation,e=>this._featuresWidget.visibleElements.featureNavigation=!!e,g),u(()=>this.visibleElements.featureListLayerTitle,e=>this._featuresWidget.visibleElements.featureListLayerTitle=!!e,g),j(()=>this._featuresWidget,"trigger-header-action",e=>{e.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)})])}normalizeCtorArgs(e){const t={...e};return(e==null?void 0:e.visibleElements)!=null&&(t.visibleElements=new L(e.visibleElements),e.collapseEnabled!=null&&(t.visibleElements.collapseButton=e.collapseEnabled),e.spinnerEnabled!=null&&(t.visibleElements.spinner=e.spinnerEnabled)),t}destroy(){var e,t;this._dockAction.destroy(),(e=this._featuresWidget)==null||e.destroy(),(t=this._focusAbortController)==null||t.abort()}get _featureNavigationTop(){const{currentAlignment:e,currentDockPosition:t}=this;return e==="bottom-left"||e==="bottom-center"||e==="bottom-right"||t==="top-left"||t==="top-center"||t==="top-right"}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}get active(){return this.viewModel.active}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get collapsed(){return this._featuresWidget.collapsed}set collapsed(e){this._featuresWidget.collapsed=e}get collapseEnabled(){return C(k.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton}set collapseEnabled(e){C(k.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||$}set dockOptions(e){var h,c;const t={...$},i=(c=(h=this.viewModel)==null?void 0:h.view)==null?void 0:c.breakpoints,l={};i&&(l.width=i.xsmall,l.height=i.xsmall);const d={...t,...e},o={...t.breakpoint,...l},{breakpoint:n}=d;typeof n=="object"?d.breakpoint={...o,...n}:n&&(d.breakpoint=o),this._set("dockOptions",d),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get icon(){return"popup"}set icon(e){this._overrideIfSome("icon",e)}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get spinnerEnabled(){return C(k.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner}set spinnerEnabled(e){C(k.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){const{active:e}=this.viewModel;e||k.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||k.getLogger(this).warn("Popup can only be focused when currently active."),this._handleFocus()}next(){return this.viewModel.next()}open(e){const t=!!e&&!!e.featureMenuOpen,i={collapsed:!!e&&!!e.collapsed,featureMenuOpen:t};this.set(i),this.viewModel.open(e),e!=null&&e.shouldFocus&&this._handleFocus(!0)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){var w,E,y,f;const{dockEnabled:e,currentAlignment:t,currentDockPosition:i}=this,{active:l,screenLocation:d}=this.viewModel,o=l&&e,n=l&&!e,h=(E=(w=this.selectedFeature)==null?void 0:w.layer)==null?void 0:E.title,c=(f=(y=this.selectedFeature)==null?void 0:y.layer)==null?void 0:f.id,m={[p.alignTopCenter]:t==="top-center",[p.alignBottomCenter]:t==="bottom-center",[p.alignTopLeft]:t==="top-left",[p.alignBottomLeft]:t==="bottom-left",[p.alignTopRight]:t==="top-right",[p.alignBottomRight]:t==="bottom-right",[p.isDocked]:o,[p.shadow]:n,[p.isDockedTopLeft]:i==="top-left",[p.isDockedTopCenter]:i==="top-center",[p.isDockedTopRight]:i==="top-right",[p.isDockedBottomLeft]:i==="bottom-left",[p.isDockedBottomCenter]:i==="bottom-center",[p.isDockedBottomRight]:i==="bottom-right"};return P("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(p.base,m,{[p.baseHidden]:!d&&!e}),"data-layer-id":c,"data-layer-title":h,role:"presentation"},l?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:P("div",{class:p.pointer,key:"popup-pointer",role:"presentation"},P("div",{class:this.classes(p.pointerDirection,p.shadow)}))}_renderMainContainer(){const{dockEnabled:e}=this,t={[p.shadow]:e};return P("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(p.main,G.widget,t)},this._featuresWidget.render())}_getAnimationDurationMS(){const{_containerNode:e}=this;return e?1e3*parseFloat(window.getComputedStyle(e).animationDuration):X}async _handleFocus(e=!1){var i;(i=this._focusAbortController)==null||i.abort(),this._focusAbortController=new AbortController;const t=this._focusAbortController.signal;e&&await K(()=>{var l;return((l=this.viewModel)==null?void 0:l.active)===!0},{signal:t}),await O(q(t)),await O(Q(this._getAnimationDurationMS(),t)),this._featuresWidget.focus()}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:l,side:d,view:o}=e;if(isNaN(i)||isNaN(t)||!o||!l)return!1;const n=o.padding;return d==="right"&&l.x+i/2>o.width-n.right||d==="left"&&l.x-i/2<n.left||d==="top"&&l.y-t<n.top||d==="bottom"&&l.y+t>o.height-n.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:l,viewModel:d}=this,{screenLocation:o,view:n}=d;if(o==null||!n||!i)return"top-center";function h(V){return parseInt(V.replaceAll(/[^-\d.]/g,""),10)}const c=l?window.getComputedStyle(l,null):null,m=c?h(c.getPropertyValue("max-height")):0,w=c?h(c.getPropertyValue("height")):0,{height:E,width:y}=i.getBoundingClientRect(),f=y+t,M=Math.max(E,m,w)+t,W=this._isOutsideView({popupHeight:M,popupWidth:f,screenLocation:o,side:"right",view:n}),x=this._isOutsideView({popupHeight:M,popupWidth:f,screenLocation:o,side:"left",view:n}),D=this._isOutsideView({popupHeight:M,popupWidth:f,screenLocation:o,side:"top",view:n}),F=this._isOutsideView({popupHeight:M,popupWidth:f,screenLocation:o,side:"bottom",view:n});return x?D?"bottom-right":"top-right":W?D?"bottom-left":"top-left":D?F?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return B(this.container)&&t.reverse(),e==null?void 0:e.replace(/leading/gi,t[0]).replaceAll(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(e){var n;if(e!=="auto")return e;const t=(n=this.viewModel)==null?void 0:n.view,i=B(this.container)?"top-left":"top-right";if(!t)return i;const l=t.padding||{left:0,right:0,top:0,bottom:0},d=t.width-l.left-l.right,{breakpoints:o}=t;return o&&d<=o.xsmall?"bottom-center":i}_getDockIcon(){const e=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(e){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){var e,t;this._dockAction.title=this.dockEnabled?(e=this.messages)==null?void 0:e.undock:(t=this.messages)==null?void 0:t.dock}_setMainContainerNode(e){this._mainContainerNode=e}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!this._containerNode)return;const{screenLocation:t}=this.viewModel,{width:i}=this._containerNode.getBoundingClientRect(),l=this._calculatePositionStyle(t,i);l&&Object.assign(this._containerNode.style,l)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,t,i,l){const{currentAlignment:d,_pointerOffsetInPx:o}=this;if(!i)return;const{padding:n}=i,h=l/2,c=i.height-t,m=i.width-e;return d==="bottom-center"?{top:t+o-n.top,left:e-h-n.left}:d==="top-left"?{bottom:c+o-n.bottom,right:m+o-n.right}:d==="bottom-left"?{top:t+o-n.top,right:m+o-n.right}:d==="top-right"?{bottom:c+o-n.bottom,left:e+o-n.left}:d==="bottom-right"?{top:t+o-n.top,left:e+o-n.left}:d==="top-center"?{bottom:c+o-n.bottom,left:e-h-n.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:l}=this;if(!l)return;if(i)return{left:"",top:"",right:"",bottom:""};if(e==null||!t)return;const d=this._calculateFullWidth(t),o=this._calculateAlignmentPosition(e.x,e.y,l,d);return o?{top:o.top!==void 0?`${o.top}px`:"auto",left:o.left!==void 0?`${o.left}px`:"auto",bottom:o.bottom!==void 0?`${o.bottom}px`:"auto",right:o.right!==void 0?`${o.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){e?this._wireUpView():t&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[l,d]=e,[o,n]=t,{width:h=0,height:c=0}=i??{};return l<=h&&o>h||l>h&&o<=h||d<=c&&n>c||d>c&&n<=c}_updateDockEnabledForViewSize(e,t){var m,w;if(!e||!t)return;const i=((w=(m=this.viewModel)==null?void 0:m.view)==null?void 0:w.padding)||{left:0,right:0,top:0,bottom:0},l=i.left+i.right,d=i.top+i.bottom,o=[],n=[];o[0]=e[0]-l,o[1]=e[1]-d,n[0]=t[0]-l,n[1]=t[1]-d;const{dockOptions:h}=this,c=h.breakpoint;this._dockingThresholdCrossed(o,n,c)&&this._setDockEnabledForViewSize(h),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var h,c;const t=e.breakpoint,i=(c=(h=this.viewModel)==null?void 0:h.view)==null?void 0:c.ui;if(!i)return!1;const{width:l,height:d}=i;if(isNaN(l)||isNaN(d)||!t)return!1;const o=t.hasOwnProperty("width")&&l<=(t.width??0),n=t.hasOwnProperty("height")&&d<=(t.height??0);return o||n}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}};s([r({readOnly:!0})],a.prototype,"_featureNavigationTop",null),s([r()],a.prototype,"actions",null),s([r({readOnly:!0})],a.prototype,"active",null),s([r()],a.prototype,"alignment",void 0),s([r()],a.prototype,"autoCloseEnabled",null),s([r()],a.prototype,"defaultPopupTemplateEnabled",null),s([r()],a.prototype,"content",null),s([r()],a.prototype,"collapsed",null),s([r()],a.prototype,"collapseEnabled",null),s([r({readOnly:!0})],a.prototype,"currentAlignment",null),s([r({readOnly:!0})],a.prototype,"currentDockPosition",null),s([r()],a.prototype,"dockOptions",null),s([r()],a.prototype,"dockEnabled",void 0),s([r({readOnly:!0})],a.prototype,"featureCount",null),s([r()],a.prototype,"featureMenuOpen",null),s([r()],a.prototype,"features",null),s([r()],a.prototype,"goToOverride",null),s([r()],a.prototype,"headingLevel",void 0),s([r()],a.prototype,"highlightEnabled",null),s([r()],a.prototype,"icon",null),s([r()],a.prototype,"location",null),s([r()],a.prototype,"label",null),s([r(),R("esri/widgets/Popup/t9n/Popup")],a.prototype,"messages",void 0),s([r()],a.prototype,"promises",null),s([r({readOnly:!0})],a.prototype,"selectedFeature",null),s([r()],a.prototype,"selectedFeatureIndex",null),s([r({readOnly:!0})],a.prototype,"selectedFeatureWidget",null),s([r()],a.prototype,"spinnerEnabled",null),s([r()],a.prototype,"title",null),s([r()],a.prototype,"updateLocationEnabled",null),s([r()],a.prototype,"view",null),s([r({type:T}),z(["triggerAction","trigger-action"])],a.prototype,"viewModel",void 0),s([r()],a.prototype,"visible",null),s([r({type:L,nonNullable:!0})],a.prototype,"visibleElements",void 0),a=s([N("esri.widgets.Popup")],a);const Z=a;export{Z as default};
