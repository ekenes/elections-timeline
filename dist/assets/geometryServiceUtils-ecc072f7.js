import{n as c,q as f,t as S,aB as d,c9 as m,fi as h,X as w,aZ as u,s as l,ai as v}from"./index-9b3f7302.js";import{f as R,i as j,o as J}from"./utils-c1f5fa42.js";let n=class extends d{constructor(t){super(t),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const t=this.geometries.map(i=>i.toJSON()),r=this.geometries[0],e={};return e.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),e.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference.toJSON()),e.geometries=JSON.stringify({geometryType:m(r),geometries:t}),this.transformation&&(e.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(e.transformForward=this.transformForward),e}};c([f()],n.prototype,"geometries",void 0),c([f({json:{read:{source:"outSR"}}})],n.prototype,"outSpatialReference",void 0),c([f()],n.prototype,"transformation",void 0),c([f()],n.prototype,"transformForward",void 0),n=c([S("esri.rest.support.ProjectParameters")],n);const p=n,N=h(p);async function O(o,t,r){t=N(t);const e=R(o),i={...e.query,f:"json",...t.toJSON()},a=t.outSpatialReference,s=m(t.geometries[0]),g=j(i,r);return w(e.path+"/project",g).then(({data:{geometries:y}})=>J(y,s,a))}async function $(o=null,t){var i,a;if(u.geometryServiceUrl)return u.geometryServiceUrl;if(!o)throw new l("internal:geometry-service-url-not-configured");let r;r="portal"in o?o.portal||v.getDefault():o,await r.load({signal:t});const e=(a=(i=r.helperServices)==null?void 0:i.geometry)==null?void 0:a.url;if(!e)throw new l("internal:geometry-service-url-not-configured");return e}async function q(o,t,r=null,e){const i=await $(r,e),a=new p;a.geometries=[o],a.outSpatialReference=t;const s=await O(i,a,{signal:e});if(s&&Array.isArray(s)&&s.length===1)return s[0];throw new l("internal:geometry-service-projection-failed")}export{$ as getGeometryServiceURL,q as projectGeometry};
